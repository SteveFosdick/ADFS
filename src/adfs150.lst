                    ACORN ADFS 1.50 ROM DISASSEMBLY
                    ===============================
                  ADFS CODE COPYRIGHT ACORN COMPUTERS

              DISASSEMBLY COMMENTARY COPYRIGHT J.G.HARSTON
              ============================================

ROM HEADER
==========
8000 00          .    BRK		No language entry
8001 00          .    BRK
8002 00          .    BRK
8003 4C CE 9A    LÎ.  JMP &9ACE		Jump to service handler
8006 82          .    EQUB &82		Service ROM, 6502 code
8007 17          .    EQUB &17		Offset to (C)
8008 50          P    EQUB &50		Binary version number
8009 41 63 6F 72 Acor EQUS "Acorn ADFS"	ROM Title
     6E 20 41 44 n AD
     46 53       FS
8013 00          .    EQUB &00
8014 31 35 30    150  EQUS "150"	Version string
8017 00          .    EQUB &00		Copyright string
8018 28 43 29 31 (C)1 EQUS "(C)1984"
8019 39 38 34    984
801F 00          .    EQUB &00


Claim Tube if present
---------------------
8020 A0 04        .   LDY #&04
8022 24 CD       $Í   BIT &CD
8024 10 13       ..   BPL &8039		Exit with no Tube present
8026 B1 B0       ±°   LDA (&B0),Y	Copy address to &C227-2A
8028 99 26 C2    .&Â  STA &C226,Y
802B 88          .    DEY
802C D0 F8       Ðø   BNE &8026
802E A9 40       ©@   LDA #&40
8030 04 CD       .Í   TSB &CD		Flag Tube being used
8032 A9 C4       ©Ä   LDA #&C4		ADFS Tube ID=&04, &C0=Claim
8034 20 06 04     ..  JSR &0406		Claim Tube
8037 90 F9       .ù   BCC &8032		Loop until claim successful
8039 60          `    RTS

Release Tube if used, and restore Screen settings
-------------------------------------------------
803A 24 CD       $Í   BIT &CD
803C 50 09       P.   BVC &8047		Tube not being used
803E A9 84       ©.   LDA #&84		ADFS Tube ID=&04, &80=Release
8040 20 06 04     ..  JSR &0406		Release Tube
8043 A9 40       ©@   LDA #&40
8045 14 CD       .Í   TRB &CD		Reset Tube being used flag
8047 AD D7 C2    ­×Â  LDA &C2D7		Screen memory used?
804A F0 03       ð.   BEQ &804F		Exit if screen unchanged
804C 8D 34 FE    .4þ  STA &FE34		Restore screen setting
804F 9C D7 C2    .×Â  STZ &C2D7		Clear screen flag
8052 60          `    RTS

Check for screen memory
-----------------------
Put shadow screen memory into main memory if i/o address specifies &FFFExxxx

8053 5A          Z    PHY		Save Y
8054 AC 34 FE    ¬4þ  LDY &FE34		Get current Screen setting
8057 8C D7 C2    .×Â  STY &C2D7		Save it
805A E8          è    INX		Address=&FFxxxxxx?
805B D0 10       Ð.   BNE &806D		Not I/O memory, exit
805D C9 FE       Éþ   CMP #&FE		Address=&FFFExxxx?
805F D0 0C       Ð.   BNE &806D		Not screen memory, exit
8061 98          .    TYA		Get current screen state into A
8062 6A          j    ROR A		Move to Cy
8063 A9 04       ©.   LDA #&04
8065 1C 34 FE    .4þ  TRB &FE34		Put normal RAM in memory
8068 90 03       ..   BCC &806D		Exit if shadow screen being displayed
806A 0C 34 FE    .4þ  TSB &FE34		Put shadow RAM in memory
806D 7A          z    PLY		Restore Y
806E 60          `    RTS


DRIVE ACCESS ROUTINES
=====================
This is the SCSI subsystem. Access to drives 4 to 7 access floppy
drives 0 to 3 with the 1770 FDC. Access to drives 0 to 3 access
SCSI devices 0 to 3 if a SCSI interface is present. If there is
no SCSI interface, access to drives 0 to 3 accesses floppy drives
0 to 3.

Read hard drive status. Waits for status value to settle before returning
-------------------------------------------------------------------------
806F 08          .    PHP
8070 AD 41 FC    ­Aü  LDA &FC41		Get SCSI status
8073 85 CC       .Ì   STA &CC		Save this value
8075 AD 41 FC    ­Aü  LDA &FC41		Get SCSI status
8078 C5 CC       ÅÌ   CMP &CC		Compare with previous status
807A D0 F4       Ðô   BNE &8070		Loop until status stays same
807C 28          (    PLP
807D 60          `    RTS

Set SCSI to command mode
------------------------
807E A0 00        .   LDY #&00		Useful place to set Y=0
8080 A9 01       ©.   LDA #&01
8082 48          H    PHA		Save data value
8083 20 6F 80     o.  JSR &806F		Get SCSI status
8086 29 02       ).   AND #&02		BUSY?
8088 D0 F9       Ðù   BNE &8083		Loop until not BUSY
808A 68          h    PLA		Get data value back
808B 8D 40 FC    .@ü  STA &FC40		Write to SCSI data
808E 8D 42 FC    .Bü  STA &FC42		Write to SCSI select to strobe it
8091 20 6F 80     o.  JSR &806F		Get SCSI status
8094 29 02       ).   AND #&02		BUSY?
8096 F0 F9       ðù   BEQ &8091		Loop until not BUSY
8098 60          `    RTS

Initialise retries value
------------------------
8099 AD 00 C2    ­.Â  LDA &C200		Get default retries
809C 85 CE       .Î   STA &CE		Set current retries
809E 60          `    RTS


809F 4C C9 82    LÉ.  JMP &82C9


Access a drive using SCSI protocol
==================================
Transfer up to &FF00 bytes at a time
XY=>control block:
  XY+ 0  Flag on entry, Returned result on exit
  XY+ 1  Addr0
  XY+ 2  Addr1
  XY+ 3  Addr2
  XY+ 4  Addr3
  XY+ 5  Command
  XY+ 6  Drive+Sector b16-19
  XY+ 7  Sector b8-b15
  XY+ 8  Sector b0-b7
  XY+ 9  Sector Count
  XY+10  -
  XY+11  Length0
  XY+12  Length1
  XY+13  Length2
  XY+14  Length3
  XY+15

On exit: A=result. 0=OK, <>0=error, with ADFS error block filled in

80A2 20 28 83     (.  JSR &8328		Wait for ensuring to complete
80A5 86 B0       .°   STX &B0
80A7 84 B1       .±   STY &B1		&B0/1=>control block
80A9 20 FD A6     ý¦  JSR &A6FD		Check if directory loaded
80AC A0 05        .   LDY #&05
80AE B1 B0       ±°   LDA (&B0),Y	Get Command
80B0 C9 2F       É/   CMP #&2F		Verify?
80B2 F0 2B       ð+   BEQ &80DF		Jump directly to do it
80B4 C9 1B       É.   CMP #&1B		Park?
80B6 F0 27       ð'   BEQ &80DF		Jump directly to do it
80B8 20 99 80     ..  JSR &8099		Set number of retries
80BB 10 1A       ..   BPL &80D7		Jump into middle of retry loop

This loop tries to access a drive. If the action returns 'Not ready' it
retries a number of times, allowing interuption by an Escape event.

80BD 20 DF 80     ß.  JSR &80DF		Do the specified command
80C0 F0 D6       ðÖ   BEQ &8098		Exit if ok
80C2 C9 04       É.   CMP #&04		Not ready?
80C4 D0 11       Ð.   BNE &80D7		Jump if result<>Not ready
					If Drive not ready, pause a bit
80C6 A0 19        .   LDY #&19		Loop 25*256*256 times
80C8 24 FF       $.   BIT &FF		Escape pressed?
80CA 30 D3       0Ó   BMI &809F		Abort with Escape error
80CC 38          8    SEC
80CD E9 01       é.   SBC #&01
80CF D0 F7       Ð÷   BNE &80C8		Loop 256 times with A
80D1 CA          Ê    DEX
80D2 D0 F4       Ðô   BNE &80C8		Loop 256 times with X
80D4 88          .    DEY
80D5 D0 F1       Ðñ   BNE &80C8		Loop 25 times with Y

80D7 C9 40       É@   CMP #&40		Result=Write protected?
80D9 F0 04       ð.   BEQ &80DF		Abort immediately
80DB C6 CE       ÆÎ   DEC &CE		Dec number of retries
80DD 10 DE       .Þ   BPL &80BD		Jump to try again
					Drop through to try once more

Try to access a drive
---------------------
80DF A0 04        .   LDY #&04
80E1 B1 B0       ±°   LDA (&B0),Y	Get Addr3
80E3 AA          ª    TAX		X=Addr3 - I/O or Language
80E4 88          .    DEY
80E5 B1 B0       ±°   LDA (&B0),Y	Get Addr2 - Screen bank
80E7 20 53 80     S.  JSR &8053		Set I/O and Screen settings

No hard drive present, drive 0 to 7 map onto floppies 0 to 3.
When hard drives are present, drives 4 to 7 map onto floppies 0 to 3.

80EA A5 CD       ¥Í   LDA &CD		Get ADFS I/O status
80EC 29 20       )    AND #&20		Hard drive present?
80EE D0 21       Ð!   BNE &8111		Jump when hard drive present

Access a floppy drive
---------------------
80F0 20 4B BA     Kº  JSR &BA4B		Do floppy operation
80F3 F0 1B       ð.   BEQ &8110		Completed ok
80F5 48          H    PHA		Save result
80F6 A0 06        .   LDY #&06		Update ADFS error infomation
80F8 B1 B0       ±°   LDA (&B0),Y	Get Drive+Sector b16-b19
80FA 0D 17 C3    ..Ã  ORA &C317		OR with current drive
80FD 8D D2 C2    .ÒÂ  STA &C2D2		Store
8100 C8          È    INY
8101 B1 B0       ±°   LDA (&B0),Y	Get Sector b8-b15
8103 8D D1 C2    .ÑÂ  STA &C2D1
8106 C8          È    INY
8107 B1 B0       ±°   LDA (&B0),Y	Get Sector b0-b7
8109 8D D0 C2    .ÐÂ  STA &C2D0
810C 68          h    PLA		Restore result
810D 8D D3 C2    .ÓÂ  STA &C2D3		Store
8110 60          `    RTS

ADFS Error Information:
  &C2D0 Sector b0-b7
  &C2D1 Sector b8-b15
  &C2D2 Sector b16-b19 and Drive
  &C2D3 SCSI error number
  &C2D4 Channel number if &C2D3.b7=1


Hard drive hardware is present. Check what drive is being accessed.

8111 A0 06        .   LDY #&06
8113 B1 B0       ±°   LDA (&B0),Y	Get drive
8115 0D 17 C3    ..Ã  ORA &C317		OR with current drive
8118 30 D6       0Ö   BMI &80F0		Jump back with 4,5,6,7 as floppies

Access a hard drive via the SCSI interface
------------------------------------------
811A 20 7E 80     ~.  JSR &807E		Write &01 to SCSI
					Put SCSI in command mode?
811D C8          È    INY		Y=1
811E B1 B0       ±°   LDA (&B0),Y	Get Addr0
8120 85 B2       .²   STA &B2
8122 C8          È    INY
8123 B1 B0       ±°   LDA (&B0),Y	Get Addr1
8125 85 B3       .³   STA &B3		&B2/3=address b0-b15
8127 C8          È    INY
8128 B1 B0       ±°   LDA (&B0),Y	Get Addr2
812A C9 FE       Éþ   CMP #&FE
812C 90 06       ..   BCC &8134		Addr<&FFFE0000, language space
812E C8          È    INY
812F B1 B0       ±°   LDA (&B0),Y	Get Addr3
8131 1A          .    INC A
8132 F0 03       ð.   BEQ &8137		Address &FFxxxxxx, use I/O memory
8134 20 20 80      .  JSR &8020		Claim Tube
8137 A0 05        .   LDY #&05
8139 B1 B0       ±°   LDA (&B0),Y	Get Command
813B 20 3E 83     >.  JSR &833E		Send to SCSI data port
813E C8          È    INY
813F B1 B0       ±°   LDA (&B0),Y	Get Drive
8141 0D 17 C3    ..Ã  ORA &C317		OR with current drive
8144 8D 33 C3    .3Ã  STA &C333
8147 4C 4C 81    LL.  JMP &814C		Send rest of command block

814A B1 B0       ±°   LDA (&B0),Y	Get a command block byte
814C 20 3E 83     >.  JSR &833E		Send to SCSI data port
814F 20 32 83     2.  JSR &8332		Wait until SCSI busy
8152 10 05       ..   BPL &8159		If SCSI says enough command
8154 70 03       p.   BVS &8159		bytes sent, jump ahead
8156 C8          È    INY		Keep sending command block
8157 D0 F1       Ðñ   BNE &814A		until SCSI says 'stop!'
8159 A0 05        .   LDY #&05
815B B1 B0       ±°   LDA (&B0),Y	Get Command
815D 29 FD       )ý   AND #&FD		Lose bit 1
815F 49 08       I.   EOR #&08		Is Command &08 or &0A?
8161 F0 78       ðx   BEQ &81DB		Jump if not Read or Write
8163 20 32 83     2.  JSR &8332		Wait until SCSI busy
8166 18          .    CLC		CC=Read
8167 50 01       P.   BVC &816A		Jump past with Read
8169 38          8    SEC		CS=Write
816A A0 00        .   LDY #&00		Initialise Y to 0
816C 24 CD       $Í   BIT &CD		Accessing Tube?
816E 50 0C       P.   BVC &817C		No, jump ahead to do the transfer
8170 A2 27       ¢'   LDX #&27
8172 A0 C2        Â   LDY #&C2		XY=>Tube address
8174 A9 00       ©.   LDA #&00		A=0
8176 08          .    PHP		Save CC/CS state
8177 2A          *    ROL A		A=0/1 for Read/Write
8178 20 13 82     ..  JSR &8213		Claim the Tube
817B 28          (    PLP		Restore CC/CS state

Do a data transfer to/from SCSI device
--------------------------------------
817C 20 32 83     2.  JSR &8332		Check SCSI status
817F 30 2C       0,   BMI &81AD		Transfer finished
8181 24 CD       $Í   BIT &CD		Check Tube/Direction flags
8183 70 16       p.   BVS &819B		Jump for Tube transfer
8185 B0 07       °.   BCS &818E		Jump for I/O read

					I/O write
8187 B1 B2       ±²   LDA (&B2),Y	Get byte from memory
8189 8D 40 FC    .@ü  STA &FC40		Write to SCSI data port
818C 80 05       ..   BRA &8193		Jump to update address

818E AD 40 FC    ­@ü  LDA &FC40		Read byte from SCSI data port
8191 91 B2       .²   STA (&B2),Y	Store byte in memory
8193 C8          È    INY		Point to next byte
8194 D0 E6       Ðæ   BNE &817C		Loop for 256 bytes
8196 E6 B3       æ³   INC &B3		Increment address high byte
8198 4C 7C 81    L|.  JMP &817C		Loop for next 256 bytes

819B B0 08       °.   BCS &81A5		Jump for Tube read
819D AD E5 FE    ­åþ  LDA &FEE5		Get byte from Tube
81A0 8D 40 FC    .@ü  STA &FC40		Write byte to SCSI data port
81A3 80 D7       .×   BRA &817C		Loop for next byte

81A5 AD 40 FC    ­@ü  LDA &FC40		Get byte from SCSI data port
81A8 8D E5 FE    .åþ  STA &FEE5		Write to Tube
81AB 80 CF       .Ï   BRA &817C		Loop for next byte

81AD 20 3A 80     :.  JSR &803A		Release Tube and restore screen
81B0 20 32 83     2.  JSR &8332		Wait for SCSI data ready
81B3 AD 40 FC    ­@ü  LDA &FC40		Get result byte
81B6 20 32 83     2.  JSR &8332		Wait for SCSI data ready
81B9 A8          ¨    TAY		Save result
81BA 20 6F 80     o.  JSR &806F		Get SCSI status
81BD 29 01       ).   AND #&01
81BF F0 EF       ðï   BEQ &81B0		Loop to try to get result again
81C1 98          .    TYA		Get result back
81C2 AE 40 FC    ®@ü  LDX &FC40		Get second result byte
81C5 F0 03       ð.   BEQ &81CA		OK, jump to return result
81C7 4C A5 82    L¥.  JMP &82A5		Return result=&7F

81CA AA          ª    TAX		Save result in X
81CB 29 02       ).   AND #&02		Check b1
81CD F0 03       ð.   BEQ &81D2		If b1=0, return with &00
81CF 4C 5D 82    L].  JMP &825D		Get status from SCSI and return it

81D2 A9 00       ©.   LDA #&00		A=0 - OK
81D4 A6 B0       ¦°   LDX &B0		Restore XY pointer
81D6 A4 B1       ¤±   LDY &B1
81D8 29 7F       ).   AND #&7F		Lose bit 7
81DA 60          `    RTS		Return with result in A


&CD ADFS status flag
--------------------
b7 Tube present
b6 Tube being used
b5 Hard Drive present
b4 FSM in memory inconsistant/being loaded
b3 -
b2 *OPT1 setting
b1 Bad Free Space Map
b0 Files being ensured


Not Read or Write
-----------------
81DB A0 00        .   LDY #&00
81DD 24 CD       $Í   BIT &CD
81DF 70 3E       p>   BVS &821F
81E1 20 32 83     2.  JSR &8332
81E4 30 C7       0Ç   BMI &81AD
81E6 70 0C       p.   BVS &81F4
81E8 B1 B2       ±²   LDA (&B2),Y
81EA 8D 40 FC    .@ü  STA &FC40
81ED C8          È    INY
81EE D0 F8       Ðø   BNE &81E8
81F0 E6 B3       æ³   INC &B3
81F2 80 ED       .í   BRA &81E1

81F4 AD 40 FC    ­@ü  LDA &FC40
81F7 91 B2       .²   STA (&B2),Y
81F9 C8          È    INY
81FA D0 F8       Ðø   BNE &81F4
81FC E6 B3       æ³   INC &B3
81FE 80 E1       .á   BRA &81E1

8200 EE 28 C2    î(Â  INC &C228
8203 D0 08       Ð.   BNE &820D
8205 EE 29 C2    î)Â  INC &C229
8208 D0 03       Ð.   BNE &820D
820A EE 2A C2    î*Â  INC &C22A
820D A2 27       ¢'   LDX #&27
820F A0 C2        Â   LDY #&C2
8211 60          `    RTS

8212 78          x    SEI
8213 20 06 04     ..  JSR &0406
8216 A0 00        .   LDY #&00
8218 20 1B 82     ..  JSR &821B
821B 20 1E 82     ..  JSR &821E
821E 60          `    RTS

821F A2 27       ¢'   LDX #&27
8221 A0 C2        Â   LDY #&C2
8223 20 32 83     2.  JSR &8332
8226 10 03       ..   BPL &822B
8228 4C AD 81    L­.  JMP &81AD

822B 70 18       p.   BVS &8245
822D 08          .    PHP
822E A9 06       ©.   LDA #&06
8230 20 12 82     ..  JSR &8212
8233 EA          ê    NOP
8234 EA          ê    NOP
8235 EA          ê    NOP
8236 AD E5 FE    ­åþ  LDA &FEE5
8239 8D 40 FC    .@ü  STA &FC40
823C C8          È    INY
823D D0 F4       Ðô   BNE &8233
823F 20 00 82     ..  JSR &8200
8242 28          (    PLP
8243 80 DE       .Þ   BRA &8223

8245 08          .    PHP
8246 A9 07       ©.   LDA #&07
8248 20 12 82     ..  JSR &8212
824B EA          ê    NOP
824C EA          ê    NOP
824D EA          ê    NOP
824E AD 40 FC    ­@ü  LDA &FC40
8251 8D E5 FE    .åþ  STA &FEE5
8254 C8          È    INY
8255 D0 F4       Ðô   BNE &824B
8257 20 00 82     ..  JSR &8200
825A 28          (    PLP
825B 80 C6       .Æ   BRA &8223


Read result from SCSI and return it as a result
-----------------------------------------------
825D 20 7E 80     ~.  JSR &807E		Set SCSI to command mode
8260 A9 03       ©.   LDA #&03
8262 AA          ª    TAX
8263 A8          ¨    TAY
8264 20 3E 83     >.  JSR &833E		Send &03 to SCSI
8267 AD 33 C3    ­3Ã  LDA &C333
826A 29 E0       )à   AND #&E0
826C 20 3E 83     >.  JSR &833E		Send drive to SCSI
826F 20 3E 83     >.  JSR &833E		Send &00 to SCSI
8272 88          .    DEY
8273 10 FA       .ú   BPL &826F		Send 4 zeros: sends &03 dd &00 &00 &00 &00
8275 20 32 83     2.  JSR &8332		Wait for SCSI
8278 AD 40 FC    ­@ü  LDA &FC40		Get byte from SCSI
827B 9D D0 C2    .ÐÂ  STA &C2D0,X	Store in error block
827E CA          Ê    DEX
827F 10 F4       .ô   BPL &8275		Loop to fetch four bytes, err, sec.hi, sec.mid, sec.lo
8281 AD 33 C3    ­3Ã  LDA &C333
8284 29 E0       )à   AND #&E0
8286 0D D2 C2    .ÒÂ  ORA &C2D2		ORA drive number with current drive
8289 8D D2 C2    .ÒÂ  STA &C2D2
828C 20 32 83     2.  JSR &8332		Wait for SCSI
828F AE D3 C2    ®ÓÂ  LDX &C2D3		Get returned error number 
8292 AD 40 FC    ­@ü  LDA &FC40		Get a byte from SCSI
8295 20 32 83     2.  JSR &8332		Wait for SCSI
8298 AC 40 FC    ¬@ü  LDY &FC40		Get another byte from SCSI
829B D0 08       Ð.   BNE &82A5		Second byte is non-zero, jump to return &7F
829D 29 02       ).   AND #&02		Test bit 1 of first byte
829F D0 04       Ð.   BNE &82A5		If set, jump to return &7F
82A1 8A          .    TXA
82A2 4C D4 81    LÔ.  JMP &81D4		Return returned SCSI result

82A5 A9 FF       ©.   LDA #&FF		Result=&FF
82A7 4C D4 81    LÔ.  JMP &81D4		Jump to return result

Do predefined SCSI operations
-----------------------------
82AA A2 15       ¢.   LDX #&15		Point to &C215
82AC A0 C2        Â   LDY #&C2
82AE 20 A2 80     ¢.  JSR &80A2		Do a disk operation
82B1 D0 0A       Ð.   BNE &82BD		Jump ahead with error
82B3 60          `    RTS		Exit if OK

Do a disk access
----------------
82B4 AD 2F C2    ­/Â  LDA &C22F
82B7 8D 17 C3    ..Ã  STA &C317
82BA 4C E2 8B    Lâ.  JMP &8BE2

82BD C9 25       É%   CMP #&25		Hard drive error &25 (Bad drive)?
82BF F0 F3       ðó   BEQ &82B4		Jump to give 'Not found' error
82C1 C9 65       Ée   CMP #&65		Floppy error &25 (Bad drive)
82C3 F0 EF       ðï   BEQ &82B4		Jump to give 'Not found' error
82C5 C9 6F       Éo   CMP #&6F		Floppy error &2F (Abort)?
82C7 D0 13       Ð.   BNE &82DC		If no, report a disk error

82C9 20 9A 84     ..  JSR &849A
82CC A9 7E       ©~   LDA #&7E
82CE 20 F4 FF     ô.  JSR &FFF4		Acknowledge Escape state
82D1 20 6B 83     k.  JSR &836B		Generate an error
82D4 11          .    EQUB &11		ERR=17
82D5 45 73 63 61 Esca EQUS "Escape"	REPORT="Escape"
82D9 70 65       pe
82DA 00          .    EQUB &00

82DC C9 04       É.   CMP #&04		Hard drive error &04 (Not ready)?
82DE D0 14       Ð.   BNE &82F4		No, try other errors
82E0 20 6B 83     k.  JSR &836B		Generate an error
82E3 CD 44 72    ÍDr  CMP &7244		Error "Drive not ready"
82E6 69 76       iv   ADC #&76
82E8 65 20       e    ADC &20
82EA 6E 6F 74    not  ROR &746F
82ED 20 72 65     re  JSR &6572
82F0 61 64       ad   ADC (&64,X)
82F2 79 00       y.   ADC &C900,Y

82F4 C9 40       .@   CMP #&40		Floppy drive error &10 (WRPROT)?
82F6 F0 13       ð.   BEQ &830B		Jump to report "Disk protected"
					All other results, give generic
					error message
82F8 20 D8 89     Ø.  JSR &89D8
82FB AA          ª    TAX
82FC 20 74 83     t.  JSR &8374
82FF C7 44       ÇD   CPY &44		Error "Disk error"
8301 69 73       is   ADC #&73
8303 63          c    EQUB &63
8304 20 65 72     er  JSR &7265
8307 72 6F       ro   ADC (&6F)
8309 72 00       r.   ADC (&00)

830B 20 4E 83     N.  JSR &834E		Generate an error
830E C9 44       ÉD   CMP #&44		Error "Disc protected"
8310 69 73       is   ADC #&73
8312 63          c    EQUB &63
8313 20 70 72     pr  JSR &7270
8316 6F 74 65    ote  BBR 6,&74,&837E
8319 63          c    EQUB &63
831A 74 65       te   STZ &65,X
831C 64 00       d.   STZ &00

831E 20 24 83     $.  JSR &8324
8321 D0 9A       Ð.   BNE &82BD
8323 60          `    RTS

8324 20 3E 83     >.  JSR &833E
8327 60          `    RTS


Wait until any ensuring completed
=================================
8328 A9 01       ©.   LDA #&01		Looking at bit 0
832A 08          .    PHP		Save IRQ disable
832B 58          X    CLI		Enable IRQs for a moment
832C 28          (    PLP		Restore IRQ disable
832D 24 CD       $Í   BIT &CD		Check Ensure
832F D0 F7       Ð÷   BNE &8328		Loop back if set
8331 60          `    RTS

Wait until SCSI ready to respond
--------------------------------
8332 48          H    PHA		Save A
8333 20 6F 80     o.  JSR &806F		Get SCSI status
8336 29 20       )    AND #&20		BUSY?
8338 F0 F9       ðù   BEQ &8333		Loop until BUSY
833A 68          h    PLA		Restore A
833B 24 CC       $Ì   BIT &CC
833D 60          `    RTS

833E 20 32 83     2.  JSR &8332		Wait until SCSI ready
8341 70 06       p.   BVS &8349
8343 8D 40 FC    .@ü  STA &FC40
8346 A9 00       ©.   LDA #&00
8348 60          `    RTS

8349 68          h    PLA
834A 68          h    PLA
834B 4C AD 81    L­.  JMP &81AD

834E AE 2F C2    ®/Â  LDX &C22F
8351 E8          è    INX
8352 D0 17       Ð.   BNE &836B
8354 AE 2E C2    ®.Â  LDX &C22E
8357 E8          è    INX
8358 D0 0B       Ð.   BNE &8365
835A A0 02        .   LDY #&02
835C B9 14 C3    ¹.Ã  LDA &C314,Y
835F 99 2C C2    .,Â  STA &C22C,Y
8362 88          .    DEY
8363 10 F7       .÷   BPL &835C
8365 AD 17 C3    ­.Ã  LDA &C317
8368 8D 2F C2    ./Â  STA &C22F
836B 20 D8 89     Ø.  JSR &89D8
836E A9 10       ©.   LDA #&10
8370 14 CD       .Í   TRB &CD
8372 A2 00       ¢.   LDX #&00

8374 68          h    PLA
8375 85 B2       .²   STA &B2
8377 68          h    PLA
8378 85 B3       .³   STA &B3
837A A9 10       ©.   LDA #&10
837C 14 CD       .Í   TRB &CD
837E A0 00        .   LDY #&00
8380 C8          È    INY
8381 B1 B2       ±²   LDA (&B2),Y
8383 99 00 01    ...  STA &0100,Y
8386 D0 F8       Ðø   BNE &8380
8388 8A          .    TXA
8389 F0 4F       ðO   BEQ &83DA
838B A9 20       ©    LDA #&20
838D 99 00 01    ...  STA &0100,Y
8390 8A          .    TXA
8391 C9 30       É0   CMP #&30
8393 B0 06       °.   BCS &839B
8395 20 51 84     Q.  JSR &8451
8398 4C A2 83    L¢.  JMP &83A2

839B C9 3A       É:   CMP #&3A
839D B0 F6       °ö   BCS &8395
839F 20 6D 84     m.  JSR &846D
83A2 A2 04       ¢.   LDX #&04
83A4 C8          È    INY
83A5 BD 40 84    ½@.  LDA &8440,X
83A8 99 00 01    ...  STA &0100,Y
83AB CA          Ê    DEX
83AC 10 F6       .ö   BPL &83A4
83AE AD D2 C2    ­ÒÂ  LDA &C2D2
83B1 0A          .    ASL A
83B2 2A          *    ROL A
83B3 2A          *    ROL A
83B4 2A          *    ROL A
83B5 20 62 84     b.  JSR &8462
83B8 C8          È    INY
83B9 99 00 01    ...  STA &0100,Y
83BC A9 2F       ©/   LDA #&2F
83BE C8          È    INY
83BF 99 00 01    ...  STA &0100,Y
83C2 AD D2 C2    ­ÒÂ  LDA &C2D2
83C5 29 1F       ).   AND #&1F
83C7 A2 02       ¢.   LDX #&02
83C9 D0 03       Ð.   BNE &83CE
83CB BD D0 C2    ½ÐÂ  LDA &C2D0,X
83CE 20 51 84     Q.  JSR &8451
83D1 CA          Ê    DEX
83D2 10 F7       .÷   BPL &83CB
83D4 C8          È    INY
83D5 A9 00       ©.   LDA #&00
83D7 99 00 01    ...  STA &0100,Y
83DA AD D5 C2    ­ÕÂ  LDA &C2D5
83DD F0 30       ð0   BEQ &840F
83DF A2 0B       ¢.   LDX #&0B
83E1 88          .    DEY
83E2 BD 45 84    ½E.  LDA &8445,X
83E5 C8          È    INY
83E6 99 00 01    ...  STA &0100,Y
83E9 CA          Ê    DEX
83EA 10 F6       .ö   BPL &83E2
83EC AD D5 C2    ­ÕÂ  LDA &C2D5
83EF 20 6D 84     m.  JSR &846D
83F2 5A          Z    PHY
83F3 A9 C6       ©Æ   LDA #&C6
83F5 8D D9 C2    .ÙÂ  STA &C2D9
83F8 20 C4 84     Ä.  JSR &84C4
83FB EC D5 C2    ìÕÂ  CPX &C2D5
83FE 08          .    PHP
83FF A2 BD       ¢½   LDX #&BD
8401 28          (    PLP
8402 F0 07       ð.   BEQ &840B
8404 CC D5 C2    ÌÕÂ  CPY &C2D5
8407 D0 05       Ð.   BNE &840E
8409 A2 C0       ¢À   LDX #&C0
840B 20 D3 84     Ó.  JSR &84D3
840E 7A          z    PLY
840F AD CE C2    ­ÎÂ  LDA &C2CE
8412 D0 03       Ð.   BNE &8417
8414 20 D4 A7     Ô§  JSR &A7D4
8417 A9 00       ©.   LDA #&00
8419 8D 00 01    ...  STA &0100
841C 99 01 01    ...  STA &0101,Y
841F 20 3A 80     :.  JSR &803A
8422 AD 01 01    ­..  LDA &0101
8425 C9 C7       ÉÇ   CMP #&C7
8427 D0 14       Ð.   BNE &843D
8429 3A          :    DEC A
842A 20 C4 84     Ä.  JSR &84C4
842D 5A          Z    PHY
842E 8A          .    TXA
842F A2 BD       ¢½   LDX #&BD
8431 20 CB 84     Ë.  JSR &84CB
8434 68          h    PLA
8435 A2 C0       ¢À   LDX #&C0
8437 20 CB 84     Ë.  JSR &84CB
843A 20 9A 84     ..  JSR &849A
843D 4C 00 01    L..  JMP &0100

8440 3A          :    DEC A
8441 20 74 61     ta  JSR &6174
8444 20 20 6C      l  JSR &6C20
8447 65 6E       en   ADC &6E
8449 6E 61 68    nah  ROR &6861
844C 63          c    EQUB &63
844D 20 6E 6F     no  JSR &6F6E
8450 20 48 4A     HJ  JSR &4A48
8453 4A          J    LSR A
8454 4A          J    LSR A
8455 4A          J    LSR A
8456 20 5A 84     Z.  JSR &845A
8459 68          h    PLA
845A 20 62 84     b.  JSR &8462
845D C8          È    INY
845E 99 00 01    ...  STA &0100,Y
8461 60          `    RTS

8462 29 0F       ).   AND #&0F
8464 09 30       .0   ORA #&30
8466 C9 3A       É:   CMP #&3A
8468 90 02       ..   BCC &846C
846A 69 06       i.   ADC #&06
846C 60          `    RTS

846D 2C 83 84    ,..  BIT &8483
8470 A2 64       ¢d   LDX #&64
8472 20 7D 84     }.  JSR &847D
8475 A2 0A       ¢.   LDX #&0A
8477 20 7D 84     }.  JSR &847D
847A B8          ¸    SEV
847B A2 01       ¢.   LDX #&01
847D 08          .    PHP
847E 86 B3       .³   STX &B3
8480 A2 2F       ¢/   LDX #&2F
8482 38          8    SEC
8483 E8          è    INX
8484 E5 B3       å³   SBC &B3
8486 B0 FB       °û   BCS &8483
8488 65 B3       e³   ADC &B3
848A 28          (    PLP
848B 48          H    PHA
848C 8A          .    TXA
848D 50 05       P.   BVC &8494
848F C9 30       É0   CMP #&30
8491 F0 05       ð.   BEQ &8498
8493 B8          ¸    SEV
8494 C8          È    INY
8495 99 00 01    ...  STA &0100,Y
8498 68          h    PLA
8499 60          `    RTS

849A A2 0C       ¢.   LDX #&0C
849C A9 FF       ©.   LDA #&FF
849E 9D 2B C2    .+Â  STA &C22B,X
84A1 9D 13 C3    ..Ã  STA &C313,X
84A4 CA          Ê    DEX
84A5 D0 F7       Ð÷   BNE &849E
84A7 20 89 A1     .¡  JSR &A189
84AA 20 89 A1     .¡  JSR &A189
84AD A0 00        .   LDY #&00
84AF 98          .    TYA
84B0 99 00 C1    ..Á  STA &C100,Y
84B3 99 00 C0    ..À  STA &C000,Y
84B6 99 00 C4    ..Ä  STA &C400,Y
84B9 C8          È    INY
84BA D0 F4       Ðô   BNE &84B0
84BC 60          `    RTS

84BD 45 2E       E.   EQUS "E."		Abbreviation of 'Exec'
84BF 0D          .    EQUB 13
84C0 53 50 2E    SP.  EQUS "SP."	Abbreviation of 'Spool'
84C3 0D          .    EQUB 13

OSBYTE READ
-----------
84C4 A0 FF       ..   LDY #&FF
84C6 A2 00       ¢.   LDX #&00
84C8 4C F4 FF    Lô.  JMP &FFF4		Osbyte A,&00,&FF

Close Spool or Exec if ADFS channel
-----------------------------------
84CB C9 30       É0   CMP #&30		Check against lowest ADFS handle
84CD 90 ED       .í   BCC &84BC		Exit if not ADFS
84CF C9 3A       É:   CMP #&3A		Check against highest ADFS handle
84D1 B0 E9       °é   BCS &84BC		Exit if not ADFS
84D3 A0 84        .   LDY #&84		Point to *Spool or *Exec
84D5 4C F7 FF    L÷.  JMP &FFF7		Jump to close via MOS

84D8 0D 53 45    .SE  ORA &4553
84DB 59 00 48    Y.H  EOR &4800,Y
84DE 75 67       ug   ADC &67,X
84E0 6F          o    BBR 6,&AD,&851A

84E1 AD 37 C2    ­7Â  LDA &C237
84E4 0D 38 C2    .8Â  ORA &C238
84E7 0D 39 C2    .9Â  ORA &C239
84EA D0 01       Ð.   BNE &84ED
84EC 60          `    RTS

84ED A2 00       ¢.   LDX #&00
84EF EC FE C1    ìþÁ  CPX &C1FE
84F2 B0 32       °2   BCS &8526
84F4 E8          è    INX
84F5 E8          è    INX
84F6 E8          è    INX
84F7 86 B2       .²   STX &B2
84F9 A0 02        .   LDY #&02
84FB CA          Ê    DEX
84FC BD 00 C0    ½.À  LDA &C000,X
84FF D9 34 C2    Ù4Â  CMP &C234,Y
8502 B0 04       °.   BCS &8508
8504 A6 B2       ¦²   LDX &B2
8506 80 E7       .ç   BRA &84EF

8508 D0 03       Ð.   BNE &850D
850A 88          .    DEY
850B 10 EE       .î   BPL &84FB
850D A6 B2       ¦²   LDX &B2
850F CA          Ê    DEX
8510 CA          Ê    DEX
8511 CA          Ê    DEX
8512 86 B2       .²   STX &B2
8514 18          .    CLC
8515 08          .    PHP
8516 A0 00        .   LDY #&00
8518 28          (    PLP
8519 B9 34 C2    ¹4Â  LDA &C234,Y
851C 79 37 C2    y7Â  ADC &C237,Y
851F 08          .    PHP
8520 DD 00 C0    Ý.À  CMP &C000,X
8523 F0 04       ð.   BEQ &8529
8525 28          (    PLP
8526 4C B3 85    L³.  JMP &85B3

8529 E8          è    INX
852A C8          È    INY
852B C0 03       À.   CPY #&03
852D D0 E9       Ðé   BNE &8518
852F 28          (    PLP
8530 A6 B2       ¦²   LDX &B2
8532 F0 62       ðb   BEQ &8596
8534 18          .    CLC
8535 08          .    PHP
8536 A0 00        .   LDY #&00
8538 28          (    PLP
8539 BD FD BF    ½ý¿  LDA &BFFD,X
853C 7D FD C0    }ýÀ  ADC &C0FD,X
853F 08          .    PHP
8540 D9 34 C2    Ù4Â  CMP &C234,Y
8543 F0 05       ð.   BEQ &854A
8545 A6 B2       ¦²   LDX &B2
8547 68          h    PLA
8548 80 4C       .L   BRA &8596

854A E8          è    INX
854B C8          È    INY
854C C0 03       À.   CPY #&03
854E D0 E8       Ðè   BNE &8538
8550 28          (    PLP
8551 A6 B2       ¦²   LDX &B2
8553 A0 00        .   LDY #&00
8555 18          .    CLC
8556 08          .    PHP
8557 28          (    PLP
8558 BD FD C0    ½ýÀ  LDA &C0FD,X
855B 79 37 C2    y7Â  ADC &C237,Y
855E 9D FD C0    .ýÀ  STA &C0FD,X
8561 08          .    PHP
8562 E8          è    INX
8563 C8          È    INY
8564 C0 03       À.   CPY #&03
8566 D0 EF       Ðï   BNE &8557
8568 28          (    PLP
8569 A0 02        .   LDY #&02
856B A6 B2       ¦²   LDX &B2
856D 18          .    CLC
856E BD FD C0    ½ýÀ  LDA &C0FD,X
8571 7D 00 C1    }.Á  ADC &C100,X
8574 9D FD C0    .ýÀ  STA &C0FD,X
8577 E8          è    INX
8578 88          .    DEY
8579 10 F3       .ó   BPL &856E
857B EC FE C1    ìþÁ  CPX &C1FE
857E B0 0F       °.   BCS &858F
8580 BD 00 C1    ½.Á  LDA &C100,X
8583 9D FD C0    .ýÀ  STA &C0FD,X
8586 BD 00 C0    ½.À  LDA &C000,X
8589 9D FD BF    .ý¿  STA &BFFD,X
858C E8          è    INX
858D D0 EC       Ðì   BNE &857B
858F CA          Ê    DEX
8590 CA          Ê    DEX
8591 CA          Ê    DEX
8592 8E FE C1    .þÁ  STX &C1FE
8595 60          `    RTS

8596 A0 00        .   LDY #&00
8598 18          .    CLC
8599 08          .    PHP
859A B9 34 C2    ¹4Â  LDA &C234,Y
859D 9D 00 C0    ..À  STA &C000,X
85A0 28          (    PLP
85A1 BD 00 C1    ½.Á  LDA &C100,X
85A4 79 37 C2    y7Â  ADC &C237,Y
85A7 9D 00 C1    ..Á  STA &C100,X
85AA 08          .    PHP
85AB C8          È    INY
85AC E8          è    INX
85AD C0 03       À.   CPY #&03
85AF D0 E9       Ðé   BNE &859A
85B1 28          (    PLP
85B2 60          `    RTS

85B3 A6 B2       ¦²   LDX &B2
85B5 F0 34       ð4   BEQ &85EB
85B7 18          .    CLC
85B8 08          .    PHP
85B9 A0 00        .   LDY #&00
85BB 28          (    PLP
85BC BD FD BF    ½ý¿  LDA &BFFD,X
85BF 7D FD C0    }ýÀ  ADC &C0FD,X
85C2 08          .    PHP
85C3 D9 34 C2    Ù4Â  CMP &C234,Y
85C6 F0 03       ð.   BEQ &85CB
85C8 28          (    PLP
85C9 80 20       .    BRA &85EB

85CB E8          è    INX
85CC C8          È    INY
85CD C0 03       À.   CPY #&03
85CF D0 EA       Ðê   BNE &85BB
85D1 28          (    PLP
85D2 A0 00        .   LDY #&00
85D4 A6 B2       ¦²   LDX &B2
85D6 18          .    CLC
85D7 08          .    PHP
85D8 28          (    PLP
85D9 BD FD C0    ½ýÀ  LDA &C0FD,X
85DC 79 37 C2    y7Â  ADC &C237,Y
85DF 9D FD C0    .ýÀ  STA &C0FD,X
85E2 08          .    PHP
85E3 E8          è    INX
85E4 C8          È    INY
85E5 C0 03       À.   CPY #&03
85E7 D0 EF       Ðï   BNE &85D8
85E9 28          (    PLP
85EA 60          `    RTS

85EB AD FE C1    ­þÁ  LDA &C1FE
85EE C9 F6       Éö   CMP #&F6
85F0 90 0D       ..   BCC &85FF
85F2 20 4E 83     N.  JSR &834E
85F5 99 4D 61    .Ma  STA &614D,Y
85F8 70 20       p    BVS &861A
85FA 66 75       fu   ROR &75
85FC 6C 6C 00    ll.  JMP (&006C)

85FF AE FE C1    ®þÁ  LDX &C1FE
8602 E4 B2       ä²   CPX &B2
8604 F0 0F       ð.   BEQ &8615
8606 CA          Ê    DEX
8607 BD 00 C0    ½.À  LDA &C000,X
860A 9D 03 C0    ..À  STA &C003,X
860D BD 00 C1    ½.Á  LDA &C100,X
8610 9D 03 C1    ..Á  STA &C103,X
8613 80 ED       .í   BRA &8602

8615 A0 00        .   LDY #&00
8617 B9 34 C2    ¹4Â  LDA &C234,Y
861A 9D 00 C0    ..À  STA &C000,X
861D B9 37 C2    ¹7Â  LDA &C237,Y
8620 9D 00 C1    ..Á  STA &C100,X
8623 E8          è    INX
8624 C8          È    INY
8625 C0 03       À.   CPY #&03
8627 D0 EE       Ðî   BNE &8617
8629 AD FE C1    ­þÁ  LDA &C1FE
862C 69 02       i.   ADC #&02
862E 8D FE C1    .þÁ  STA &C1FE
8631 60          `    RTS

8632 A2 00       ¢.   LDX #&00
8634 8E 5D C2    .]Â  STX &C25D
8637 8E 5E C2    .^Â  STX &C25E
863A 8E 5F C2    ._Â  STX &C25F
863D EC FE C1    ìþÁ  CPX &C1FE
8640 F0 EF       ðï   BEQ &8631
8642 A0 00        .   LDY #&00
8644 18          .    CLC
8645 08          .    PHP
8646 28          (    PLP
8647 BD 00 C1    ½.Á  LDA &C100,X
864A 79 5D C2    y]Â  ADC &C25D,Y
864D 99 5D C2    .]Â  STA &C25D,Y
8650 08          .    PHP
8651 C8          È    INY
8652 E8          è    INX
8653 C0 03       À.   CPY #&03
8655 D0 EF       Ðï   BNE &8646
8657 28          (    PLP
8658 4C 3D 86    L=.  JMP &863D

865B A2 FF       ¢.   LDX #&FF
865D 86 B3       .³   STX &B3
865F E8          è    INX
8660 EC FE C1    ìþÁ  CPX &C1FE
8663 90 7C       .|   BCC &86E1
8665 A6 B3       ¦³   LDX &B3
8667 E0 FF       à.   CPX #&FF
8669 D0 3A       Ð:   BNE &86A5
866B 20 32 86     2.  JSR &8632
866E A0 00        .   LDY #&00
8670 A2 02       ¢.   LDX #&02
8672 38          8    SEC
8673 B9 5D C2    ¹]Â  LDA &C25D,Y
8676 F9 3D C2    ù=Â  SBC &C23D,Y
8679 C8          È    INY
867A CA          Ê    DEX
867B 10 F6       .ö   BPL &8673
867D B0 0E       °.   BCS &868D
867F 20 4E 83     N.  JSR &834E
8682 C6 44       ÆD   DEC &44
8684 69 73       is   ADC #&73
8686 63          c    EQUB &63
8687 20 66 75     fu  JSR &7566
868A 6C 6C 00    ll.  JMP (&006C)

868D 20 4E 83     N.  JSR &834E
8690 98          .    TYA
8691 43          C    EQUB &43
8692 6F 6D 70    omp  BBR 6,&6D,&8705
8695 61 63       ac   ADC (&63,X)
8697 74 69       ti   STZ &69,X
8699 6F 6E 20    on   BBR 6,&6E,&86BC
869C 72 65       re   ADC (&65)
869E 71 75       qu   ADC (&75),Y
86A0 69 72       ir   ADC #&72
86A2 65 64       ed   ADC &64
86A4 00          .    BRK
86A5 A0 02        .   LDY #&02
86A7 CA          Ê    DEX
86A8 BD 00 C0    ½.À  LDA &C000,X
86AB 99 3A C2    .:Â  STA &C23A,Y
86AE 88          .    DEY
86AF 10 F6       .ö   BPL &86A7
86B1 C8          È    INY
86B2 A6 B3       ¦³   LDX &B3
86B4 18          .    CLC
86B5 08          .    PHP
86B6 28          (    PLP
86B7 BD FD BF    ½ý¿  LDA &BFFD,X
86BA 79 3D C2    y=Â  ADC &C23D,Y
86BD 9D FD BF    .ý¿  STA &BFFD,X
86C0 08          .    PHP
86C1 E8          è    INX
86C2 C8          È    INY
86C3 C0 03       À.   CPY #&03
86C5 D0 EF       Ðï   BNE &86B6
86C7 28          (    PLP
86C8 A0 00        .   LDY #&00
86CA A6 B3       ¦³   LDX &B3
86CC 38          8    SEC
86CD 08          .    PHP
86CE 28          (    PLP
86CF BD FD C0    ½ýÀ  LDA &C0FD,X
86D2 F9 3D C2    ù=Â  SBC &C23D,Y
86D5 9D FD C0    .ýÀ  STA &C0FD,X
86D8 08          .    PHP
86D9 E8          è    INX
86DA C8          È    INY
86DB C0 03       À.   CPY #&03
86DD D0 EF       Ðï   BNE &86CE
86DF 28          (    PLP
86E0 60          `    RTS

86E1 A0 02        .   LDY #&02
86E3 E8          è    INX
86E4 E8          è    INX
86E5 E8          è    INX
86E6 86 B2       .²   STX &B2
86E8 CA          Ê    DEX
86E9 BD 00 C1    ½.Á  LDA &C100,X
86EC D9 3D C2    Ù=Â  CMP &C23D,Y
86EF 90 3B       .;   BCC &872C
86F1 D0 30       Ð0   BNE &8723
86F3 88          .    DEY
86F4 10 F2       .ò   BPL &86E8
86F6 A6 B2       ¦²   LDX &B2
86F8 A0 02        .   LDY #&02
86FA CA          Ê    DEX
86FB BD 00 C0    ½.À  LDA &C000,X
86FE 99 3A C2    .:Â  STA &C23A,Y
8701 88          .    DEY
8702 10 F6       .ö   BPL &86FA
8704 A6 B2       ¦²   LDX &B2
8706 EC FE C1    ìþÁ  CPX &C1FE
8709 B0 0F       °.   BCS &871A
870B BD 00 C0    ½.À  LDA &C000,X
870E 9D FD BF    .ý¿  STA &BFFD,X
8711 BD 00 C1    ½.Á  LDA &C100,X
8714 9D FD C0    .ýÀ  STA &C0FD,X
8717 E8          è    INX
8718 D0 EC       Ðì   BNE &8706
871A AD FE C1    ­þÁ  LDA &C1FE
871D E9 03       é.   SBC #&03
871F 8D FE C1    .þÁ  STA &C1FE
8722 60          `    RTS

8723 A6 B3       ¦³   LDX &B3
8725 E8          è    INX
8726 D0 04       Ð.   BNE &872C
8728 A5 B2       ¥²   LDA &B2
872A 85 B3       .³   STA &B3
872C A6 B2       ¦²   LDX &B2
872E 4C 60 86    L`.  JMP &8660

8731 E6 B4       æ´   INC &B4
8733 D0 02       Ð.   BNE &8737
8735 E6 B5       æµ   INC &B5
8737 60          `    RTS

8738 20 0D A5     .¥  JSR &A50D
873B 20 79 8D     y.  JSR &8D79
873E A0 00        .   LDY #&00
8740 8C C0 C2    .ÀÂ  STY &C2C0
8743 B1 B4       ±´   LDA (&B4),Y
8745 29 7F       ).   AND #&7F
8747 C9 2E       É.   CMP #&2E
8749 F0 08       ð.   BEQ &8753
874B C9 22       É"   CMP #&22
874D F0 04       ð.   BEQ &8753
874F C9 20       É    CMP #&20
8751 B0 02       °.   BCS &8755
8753 A2 00       ¢.   LDX #&00
8755 60          `    RTS

8756 A0 0A        .   LDY #&0A
8758 20 43 87     C.  JSR &8743
875B F0 10       ð.   BEQ &876D
875D 88          .    DEY
875E 10 F8       .ø   BPL &8758

8760 20 6B 83     k.  JSR &836B
8763 CC 42 61    ÌBa  CPY &6142
8766 64 20       d    STZ &20
8768 6E 61 6D    nam  ROR &6D61
876B 65 00       e.   ADC &00

876D A0 09        .   LDY #&09
876F B1 B6       ±¶   LDA (&B6),Y
8771 29 7F       ).   AND #&7F
8773 99 62 C2    .bÂ  STA &C262,Y
8776 88          .    DEY
8777 10 F6       .ö   BPL &876F
8779 C8          È    INY
877A A2 00       ¢.   LDX #&00
877C E0 0A       à.   CPX #&0A
877E B0 41       °A   BCS &87C1
8780 BD 62 C2    ½bÂ  LDA &C262,X
8783 C9 21       É!   CMP #&21
8785 90 3A       .:   BCC &87C1
8787 09 20       .    ORA #&20
8789 8D 2B C2    .+Â  STA &C22B
878C C0 0A       À.   CPY #&0A
878E B0 1B       °.   BCS &87AB
8790 20 43 87     C.  JSR &8743
8793 F0 1B       ð.   BEQ &87B0
8795 C9 2A       É*   CMP #&2A
8797 F0 38       ð8   BEQ &87D1
8799 C9 23       É#   CMP #&23
879B F0 09       ð.   BEQ &87A6
879D 09 20       .    ORA #&20
879F CD 2B C2    Í+Â  CMP &C22B
87A2 90 0C       ..   BCC &87B0
87A4 D0 04       Ð.   BNE &87AA
87A6 E8          è    INX
87A7 C8          È    INY
87A8 D0 D2       ÐÒ   BNE &877C
87AA 60          `    RTS

87AB 20 43 87     C.  JSR &8743
87AE D0 B0       Ð°   BNE &8760
87B0 20 43 87     C.  JSR &8743
87B3 C9 23       É#   CMP #&23
87B5 F0 17       ð.   BEQ &87CE
87B7 C9 2A       É*   CMP #&2A
87B9 F0 13       ð.   BEQ &87CE
87BB 88          .    DEY
87BC 10 F2       .ò   BPL &87B0
87BE C9 FF       É.   CMP #&FF
87C0 60          `    RTS

87C1 C0 0A       À.   CPY #&0A
87C3 F0 E5       ðå   BEQ &87AA
87C5 20 43 87     C.  JSR &8743
87C8 F0 E0       ðà   BEQ &87AA
87CA C9 2A       É*   CMP #&2A
87CC F0 03       ð.   BEQ &87D1
87CE C9 00       É.   CMP #&00
87D0 60          `    RTS

87D1 C8          È    INY
87D2 BD 62 C2    ½bÂ  LDA &C262,X
87D5 29 7F       ).   AND #&7F
87D7 C9 21       É!   CMP #&21
87D9 90 19       ..   BCC &87F4
87DB E0 0A       à.   CPX #&0A
87DD B0 15       °.   BCS &87F4
87DF DA          Ú    PHX
87E0 5A          Z    PHY
87E1 20 7C 87     |.  JSR &877C
87E4 F0 08       ð.   BEQ &87EE
87E6 7A          z    PLY
87E7 FA          ú    PLX
87E8 E8          è    INX
87E9 D0 E7       Ðç   BNE &87D2
87EB E0 00       à.   CPX #&00
87ED 60          `    RTS

87EE 68          h    PLA
87EF 68          h    PLA
87F0 A9 00       ©.   LDA #&00
87F2 38          8    SEC
87F3 60          `    RTS

87F4 C0 0A       À.   CPY #&0A
87F6 B0 F8       °ø   BCS &87F0
87F8 B1 B4       ±´   LDA (&B4),Y
87FA C9 21       É!   CMP #&21
87FC 90 F2       .ò   BCC &87F0
87FE C9 2E       É.   CMP #&2E
8800 F0 EE       ðî   BEQ &87F0
8802 C9 22       É"   CMP #&22
8804 F0 EA       ðê   BEQ &87F0
8806 C9 2A       É*   CMP #&2A
8808 F0 C7       ðÇ   BEQ &87D1
880A D0 DF       Ðß   BNE &87EB
880C 20 0D A5     .¥  JSR &A50D
880F 20 CC 93     Ì.  JSR &93CC
8812 20 14 A7     .§  JSR &A714
8815 A0 00        .   LDY #&00
8817 B1 B6       ±¶   LDA (&B6),Y
8819 F0 13       ð.   BEQ &882E
881B 20 56 87     V.  JSR &8756
881E F0 10       ð.   BEQ &8830
8820 90 0E       ..   BCC &8830
8822 A5 B6       ¥¶   LDA &B6
8824 69 19       i.   ADC #&19
8826 85 B6       .¶   STA &B6
8828 90 EB       .ë   BCC &8815
882A E6 B7       æ·   INC &B7
882C D0 E7       Ðç   BNE &8815
882E C9 0F       É.   CMP #&0F
8830 60          `    RTS

8831 01 00       ..   ORA (&00,X)	Control block to load FSM
8833 C0 FF       À.   CPY #&FF
8835 FF 08 00    ...  BBS 7,&08,&8838
8838 00          .    BRK
8839 00          .    BRK
883A 02          .    EQUB &02
883B 00          .    BRK

883C 01 00       ..   ORA (&00,X)	Control block to load '$'
883E C4 FF       Ä.   CPY &FF
8840 FF 08 00    ...  BBS 7,&08,&8843
8843 00          .    BRK
8844 02          .    EQUB &02
8845 05 00       ..   ORA &00

Check drive character
8847 C9 30       É0   CMP #&30
8849 90 22       ."   BCC &886D		<'0' - error
884B C9 38       É8   CMP #&38
884D 90 0B       ..   BCC &885A		'0'-'7' - Ok
884F 09 20       .    ORA #&20		For to lower case
8851 C9 61       Éa   CMP #&61		<'A' - error
8853 90 18       ..   BCC &886D
8855 C9 69       Éi   CMP #&69
8857 B0 14       °.   BCS &886D		>'H' - error
8859 3A          :    DEC A		Convert 'A'-'H' to '0' to '7'
885A 48          H    PHA
885B A5 CD       ¥Í   LDA &CD
885D 29 20       )    AND #&20		Hard drive present?
885F D0 04       Ð.   BNE &8865
8861 68          h    PLA		No hard drive, reduce drive
8862 29 03       ).   AND #&03		number to 0-3
8864 48          H    PHA
8865 68          h    PLA
8866 29 07       ).   AND #&07		Drop top bits to get 0-7 (or 0-3)
8868 4A          J    LSR A		Move to top three bits
8869 6A          j    ROR A
886A 6A          j    ROR A
886B 6A          j    ROR A
886C 60          `    RTS

886D 4C 60 87    L`.  JMP &8760

8870 20 38 87     8.  JSR &8738
8873 F0 F8       ðø   BEQ &886D
8875 20 38 87     8.  JSR &8738
8878 F0 1F       ð.   BEQ &8899
887A C9 3A       É:   CMP #&3A
887C D0 71       Ðq   BNE &88EF
887E 20 31 87     1.  JSR &8731
8881 AE 2F C2    ®/Â  LDX &C22F
8884 E8          è    INX
8885 D0 06       Ð.   BNE &888D
8887 AD 17 C3    ­.Ã  LDA &C317
888A 8D 2F C2    ./Â  STA &C22F
888D 20 43 87     C.  JSR &8743
8890 20 47 88     G.  JSR &8847
8893 8D 17 C3    ..Ã  STA &C317
8896 20 31 87     1.  JSR &8731
8899 AE 17 C3    ®.Ã  LDX &C317
889C E8          è    INX
889D D0 0E       Ð.   BNE &88AD
889F A5 CD       ¥Í   LDA &CD		Get ADFS status byte
88A1 29 20       )    AND #&20		Hard drive present?
88A3 F0 05       ð.   BEQ &88AA		Jump if no hard drive
88A5 AD D8 C2    ­ØÂ  LDA &C2D8		Get CMOS byte RAM copy
88A8 29 80       ).   AND #&80		Get hard drive flag
88AA 8D 17 C3    ..Ã  STA &C317		Store in current drive
88AD A9 10       ©.   LDA #&10
88AF 04 CD       .Í   TSB &CD		Flag FSM inconsistant
88B1 A2 31       ¢1   LDX #&31
88B3 A0 88        .   LDY #&88
88B5 20 AE 82     ®.  JSR &82AE		Load FSM
88B8 A9 10       ©.   LDA #&10
88BA 14 CD       .Í   TRB &CD		Flag FSM loaded
88BC AD 2E C2    ­.Â  LDA &C22E
88BF 10 0B       ..   BPL &88CC
88C1 A0 02        .   LDY #&02
88C3 B9 14 C3    ¹.Ã  LDA &C314,Y
88C6 99 2C C2    .,Â  STA &C22C,Y
88C9 88          .    DEY
88CA 10 F7       .÷   BPL &88C3
88CC A0 88        .   LDY #&88
88CE A2 3C       ¢<   LDX #&3C
88D0 20 AE 82     ®.  JSR &82AE		Load '$'
88D3 A9 02       ©.   LDA #&02
88D5 8D 14 C3    ..Ã  STA &C314		Set CURR to &000002 - '$'
88D8 A9 00       ©.   LDA #&00
88DA 8D 15 C3    ..Ã  STA &C315
88DD 8D 16 C3    ..Ã  STA &C316
88E0 20 B9 B4     ¹´  JSR &B4B9
88E3 A0 00        .   LDY #&00
88E5 20 43 87     C.  JSR &8743
88E8 C9 2E       É.   CMP #&2E
88EA D0 24       Ð$   BNE &8910
88EC 20 31 87     1.  JSR &8731
88EF A0 00        .   LDY #&00
88F1 20 43 87     C.  JSR &8743
88F4 29 FD       )ý   AND #&FD
88F6 C9 24       É$   CMP #&24
88F8 F0 9C       ð.   BEQ &8896
88FA 20 46 B5     Fµ  JSR &B546
88FD 20 56 94     V.  JSR &9456
8900 D0 28       Ð(   BNE &892A
8902 C8          È    INY
8903 8C A2 C2    .¢Â  STY &C2A2
8906 20 43 87     C.  JSR &8743
8909 C9 2E       É.   CMP #&2E
890B D0 22       Ð"   BNE &892F
890D 4C 97 89    L..  JMP &8997

8910 A9 24       ©$   LDA #&24
8912 8D 62 C2    .bÂ  STA &C262
8915 A9 0D       ©.   LDA #&0D
8917 8D 63 C2    .cÂ  STA &C263
891A A9 D3       ©Ó   LDA #&D3
891C 85 B6       .¶   STA &B6
891E A9 94       ©.   LDA #&94
8920 85 B7       .·   STA &B7
8922 A9 02       ©.   LDA #&02
8924 8D C0 C2    .ÀÂ  STA &C2C0
8927 A9 00       ©.   LDA #&00
8929 60          `    RTS

892A 20 0C 88     ..  JSR &880C
892D F0 10       ð.   BEQ &893F
892F 60          `    RTS

8930 A2 01       ¢.   LDX #&01
8932 A0 03        .   LDY #&03
8934 B1 B6       ±¶   LDA (&B6),Y
8936 10 01       ..   BPL &8939
8938 E8          è    INX
8939 8E C0 C2    .ÀÂ  STX &C2C0
893C A9 00       ©.   LDA #&00
893E 60          `    RTS

893F A0 00        .   LDY #&00
8941 20 43 87     C.  JSR &8743
8944 C9 21       É!   CMP #&21
8946 90 E8       .è   BCC &8930
8948 C9 22       É"   CMP #&22
894A F0 E4       ðä   BEQ &8930
894C C9 2E       É.   CMP #&2E
894E F0 03       ð.   BEQ &8953
8950 C8          È    INY
8951 D0 EE       Ðî   BNE &8941
8953 8C A2 C2    .¢Â  STY &C2A2
8956 A0 03        .   LDY #&03
8958 B1 B6       ±¶   LDA (&B6),Y
895A 30 1F       0.   BMI &897B
895C 20 64 89     d.  JSR &8964
895F F0 F5       ðõ   BEQ &8956
8961 A9 FF       ©.   LDA #&FF
8963 60          `    RTS

8964 18          .    CLC
8965 A5 B6       ¥¶   LDA &B6
8967 69 1A       i.   ADC #&1A
8969 85 B6       .¶   STA &B6
896B 90 02       ..   BCC &896F
896D E6 B7       æ·   INC &B7
896F A0 00        .   LDY #&00
8971 B1 B6       ±¶   LDA (&B6),Y
8973 F0 EC       ðì   BEQ &8961
8975 20 56 87     V.  JSR &8756
8978 D0 EA       Ðê   BNE &8964
897A 60          `    RTS

897B A0 09        .   LDY #&09
897D B1 B6       ±¶   LDA (&B6),Y
897F 10 16       ..   BPL &8997
8981 29 7F       ).   AND #&7F
8983 91 B6       .¶   STA (&B6),Y
8985 20 91 8F     ..  JSR &8F91
8988 20 6B 83     k.  JSR &836B
898B B0 42       °B   BCS &89CF
898D 61 64       ad   ADC (&64,X)
898F 20 72 65     re  JSR &6572
8992 6E 61 6D    nam  ROR &6D61
8995 65 00       e.   ADC &00
8997 AD A2 C2    ­¢Â  LDA &C2A2
899A 38          8    SEC
899B 65 B4       e´   ADC &B4
899D 85 B4       .´   STA &B4
899F 90 02       ..   BCC &89A3
89A1 E6 B5       æµ   INC &B5
89A3 AD 2E C2    ­.Â  LDA &C22E
89A6 1A          .    INC A
89A7 D0 0B       Ð.   BNE &89B4
89A9 A0 02        .   LDY #&02
89AB B9 14 C3    ¹.Ã  LDA &C314,Y
89AE 99 2C C2    .,Â  STA &C22C,Y
89B1 88          .    DEY
89B2 10 F7       .÷   BPL &89AB
89B4 A2 0A       ¢.   LDX #&0A
89B6 BD 3C 88    ½<.  LDA &883C,X
89B9 9D 15 C2    ..Â  STA &C215,X
89BC CA          Ê    DEX
89BD 10 F7       .÷   BPL &89B6
89BF A2 02       ¢.   LDX #&02
89C1 A0 16        .   LDY #&16
89C3 B1 B6       ±¶   LDA (&B6),Y
89C5 9D 1B C2    ..Â  STA &C21B,X
89C8 99 FE C2    .þÂ  STA &C2FE,Y
89CB C8          È    INY
89CC CA          Ê    DEX
89CD 10 F4       .ô   BPL &89C3
89CF 20 AA 82     ª.  JSR &82AA
89D2 4C FD 88    Lý.  JMP &88FD

89D5 AD C0 C2    ­ÀÂ  LDA &C2C0

89D8 48          H    PHA
89D9 AD 2F C2    ­/Â  LDA &C22F
89DC C9 FF       É.   CMP #&FF
89DE F0 0F       ð.   BEQ &89EF
89E0 8D 17 C3    ..Ã  STA &C317
89E3 A9 FF       ©.   LDA #&FF
89E5 8D 2F C2    ./Â  STA &C22F
89E8 A2 31       ¢1   LDX #&31
89EA A0 88        .   LDY #&88
89EC 20 AE 82     ®.  JSR &82AE		Load FSM
89EF AD 2E C2    ­.Â  LDA &C22E
89F2 C9 FF       É.   CMP #&FF
89F4 F0 2C       ð,   BEQ &8A22
89F6 AA          ª    TAX
89F7 A0 0A        .   LDY #&0A
89F9 B9 3C 88    ¹<.  LDA &883C,Y	Copy parameter block to
89FC 99 15 C2    ..Â  STA &C215,Y	load '$'
89FF 88          .    DEY
8A00 10 F7       .÷   BPL &89F9
8A02 8E 16 C3    ..Ã  STX &C316		Copy parameters to &C215
8A05 8E 1B C2    ..Â  STX &C21B
8A08 AD 2D C2    ­-Â  LDA &C22D
8A0B 8D 15 C3    ..Ã  STA &C315
8A0E 8D 1C C2    ..Â  STA &C21C
8A11 AD 2C C2    ­,Â  LDA &C22C
8A14 8D 14 C3    ..Ã  STA &C314
8A17 8D 1D C2    ..Â  STA &C21D
8A1A A9 FF       ©.   LDA #&FF
8A1C 8D 2E C2    ..Â  STA &C22E
8A1F 20 AA 82     ª.  JSR &82AA		Do disk op from &C215
8A22 A5 CD       ¥Í   LDA &CD
8A24 8D 20 C3    . Ã  STA &C320
8A27 20 44 A7     D§  JSR &A744		Get WS address in &BA
8A2A A0 FB        û   LDY #&FB
8A2C B9 00 C3    ¹.Ã  LDA &C300,Y	Copy workspace to private
8A2F 91 BA       .º   STA (&BA),Y
8A31 88          .    DEY
8A32 D0 F8       Ðø   BNE &8A2C
8A34 AD 00 C3    ­.Ã  LDA &C300
8A37 91 BA       .º   STA (&BA),Y
8A39 20 61 A7     a§  JSR &A761		Reset workspace checksum
8A3C A6 B8       ¦¸   LDX &B8
8A3E A4 B9       ¤¹   LDY &B9
8A40 68          h    PLA
8A41 60          `    RTS

8A42 20 4A 8A     J.  JSR &8A4A		Do disk access
8A45 F0 FA       ðú   BEQ &8A41		No error, exit
8A47 4C BD 82    L½.  JMP &82BD		Generate disk error


User Disk Access
================
Do a disk access using SCSI protocol. Control block at &C215-&C224

   Addr Ctrl
  &C215  Returned result
  &C216  Addr0
  &C217  Addr1
  &C218  Addr2
  &C219  Addr3
  &C21A  Command
  &C21B  Drive+Sector b16-b20
  &C21C  Sector b8-b15
  &C21D  Sector b0-b7
  &C21E  Sector Count
  &C21F  -
  &C220  Length0
  &C221  Length1
  &C222  Length2
  &C223  Length3
  &C224 

8A4A AD 1A C2    ­.Â  LDA &C21A		Get command
8A4D C9 08       É.   CMP #&08		Read?
8A4F F0 17       ð.   BEQ &8A68		Jump forward with Read
8A51 AD 20 C2    ­ Â  LDA &C220		If Length0=0?
8A54 F0 12       ð.   BEQ &8A68		Whole number of sectors

Adjust the Length to be a whole number of sectors for writing

8A56 A9 00       ©.   LDA #&0
8A58 8D 20 C2    . Â  STA &C220
8A5B EE 21 C2    î!Â  INC &C221
8A5E D0 08       Ð.   BNE &8A68
8A60 EE 22 C2    î"Â  INC &C222
8A63 D0 03       Ð.   BNE &8A68
8A65 EE 23 C2    î#Â  INC &C223

Length is now a whole number of sectors, a whole multiple of 256 bytes

8A68 A2 15       ¢.   LDX #&15
8A6A A0 C2        Â   LDY #&C2		XY=>control block
8A6C A9 FF       ©.   LDA #&FF
8A6E 8D 1E C2    ..Â  STA &C21E		Set initial sector count to &FF

Transfer batches of &FF00 bytes until less than 64k left
--------------------------------------------------------
8A71 AD 23 C2    ­#Â  LDA &C223
8A74 0D 22 C2    ."Â  ORA &C222		Get Length2+Length3
8A77 F0 43       ðC   BEQ &8ABC		Jump if remaining length<64k

8A79 20 A2 80     ¢.  JSR &80A2		Do a transfer
8A7C D0 50       ÐP   BNE &8ACE		Exit with any error
8A7E A9 FF       ©.   LDA #&FF		Update address
8A80 18          .    CLC		Addr=Addr+&0000FF00
8A81 6D 17 C2    m.Â  ADC &C217		Addr1=Addr1+&FF
8A84 8D 17 C2    ..Â  STA &C217
8A87 90 08       ..   BCC &8A91		No overflow
8A89 EE 18 C2    î.Â  INC &C218		Addr2=Addr2+1
8A8C D0 03       Ð.   BNE &8A91		No overflow
8A8E EE 19 C2    î.Â  INC &C219		Addr3=Addr3+1

8A91 A9 FF       ©.   LDA #&FF		Update sector
8A93 18          .    CLC
8A94 6D 1D C2    m.Â  ADC &C21D		Sector=Sector+&FF
8A97 8D 1D C2    ..Â  STA &C21D		Sector0=Sector0+&FF
8A9A 90 08       ..   BCC &8AA4		No overflow
8A9C EE 1C C2    î.Â  INC &C21C		Sector1=Sector1+1
8A9F D0 03       Ð.   BNE &8AA4		No overflow
8AA1 EE 1B C2    î.Â  INC &C21B		Sector2=Sector2+1

8AA4 AD 21 C2    ­!Â  LDA &C221		Update length
8AA7 38          8    SEC
8AA8 E9 FF       é.   SBC #&FF		Length=Length-&0000FF00
8AAA 8D 21 C2    .!Â  STA &C221		Length1=Length1-&FF
8AAD B0 C2       °Â   BCS &8A71		No overflow
8AAF AD 22 C2    ­"Â  LDA &C222		Get Length2
8AB2 D0 03       Ð.   BNE &8AB7		No need to decrement
8AB4 CE 23 C2    Î#Â  DEC &C223		Length3=Length3-1
8AB7 CE 22 C2    Î"Â  DEC &C222		Length2=Length2-1
8ABA 80 B5       .µ   BRA &8A71		Loop back for another &FF00 bytes

There is now less than 64k to transfer
--------------------------------------
8ABC AD 21 C2    ­!Â  LDA &C221		Get Length1
8ABF F0 08       ð.   BEQ &8AC9		Now less than 256 bytes to go
8AC1 8D 1E C2    ..Â  STA &C21E		Set Sector Count
8AC4 20 A2 80     ¢.  JSR &80A2		Do this transfer
8AC7 D0 05       Ð.   BNE &8ACE		Exit with any error

8AC9 AD 20 C2    ­ Â  LDA &C220		Get Length0
8ACC D0 01       Ð.   BNE &8ACF		Jump to deal with any leftover bytes
8ACE 60          `    RTS

There are now less than 256 bytes left, must be reading
-------------------------------------------------------
8ACF 8D 1E C2    ..Â  STA &C21E		Store Length0 in Sector Count
8AD2 AD 21 C2    ­!Â  LDA &C221		Get last length transfered
8AD5 18          .    CLC
8AD6 6D 1D C2    m.Â  ADC &C21D		Add to Sector0
8AD9 8D 1D C2    ..Â  STA &C21D		Store in Sector0
8ADC 90 08       ..   BCC &8AE6
8ADE EE 1C C2    î.Â  INC &C21C		Increment Sector1
8AE1 D0 03       Ð.   BNE &8AE6
8AE3 EE 1B C2    î.Â  INC &C21B		Increment Sector2
8AE6 AD 21 C2    ­!Â  LDA &C221		Get Length1
8AE9 18          .    CLC
8AEA 6D 17 C2    m.Â  ADC &C217		Add to Addr1
8AED 8D 17 C2    ..Â  STA &C217		Store Addr1
8AF0 90 08       ..   BCC &8AFA
8AF2 EE 18 C2    î.Â  INC &C218		Increment Addr2
8AF5 D0 03       Ð.   BNE &8AFA
8AF7 EE 19 C2    î.Â  INC &C219		Increment Addr3
8AFA 20 28 83     (.  JSR &8328		Wait for ensuring to finish
8AFD 20 99 80     ..  JSR &8099		Initialise retries
8B00 20 09 8B     ..  JSR &8B09		Call to load data
8B03 F0 C9       ðÉ   BEQ &8ACE		All ok, so exit
8B05 C6 CE       ÆÎ   DEC &CE		Decrement retries
8B07 10 F7       .÷   BPL &8B00		Loop to try again
					Fall through to try once more
8B09 A2 15       ¢.   LDX #&15		Point to control block
8B0B A0 C2        Â   LDY #&C2
8B0D 86 B0       .°   STX &B0
8B0F 84 B1       .±   STY &B1
8B11 AE 19 C2    ®.Â  LDX &C219		Get Addr3
8B14 AD 18 C2    ­.Â  LDA &C218		Get Addr2
8B17 20 53 80     S.  JSR &8053		Check for shadow screen memory
8B1A AD 17 C3    ­.Ã  LDA &C317		Get current drive
8B1D 0D 1B C2    ..Â  ORA &C21B		OR with drive number
8B20 8D 1B C2    ..Â  STA &C21B		Store back into control block
8B23 8D 33 C3    .3Ã  STA &C333
8B26 A5 CD       ¥Í   LDA &CD		Get options
8B28 29 20       )    AND #&20		Hard drive present?
8B2A D0 23       Ð#   BNE &8B4F		Jump ahead if so
8B2C AD 1B C2    ­.Â  LDA &C21B
8B2F 0D 17 C3    ..Ã  ORA &C317
8B32 8D D2 C2    .ÒÂ  STA &C2D2
8B35 AD 1C C2    ­.Â  LDA &C21C
8B38 8D D1 C2    .ÑÂ  STA &C2D1
8B3B AD 1D C2    ­.Â  LDA &C21D
8B3E 8D D0 C2    .ÐÂ  STA &C2D0
8B41 20 E6 AC     æ¬  JSR &ACE6
8B44 9D 04 C2    ..Â  STA &C204,X
8B47 8A          .    TXA
8B48 4A          J    LSR A
8B49 4A          J    LSR A
8B4A 69 C9       iÉ   ADC #&C9
8B4C 4C 4E BA    LNº  JMP &BA4E

Get bytes from a partial sector from a hard drive
-------------------------------------------------
8B4F AD 33 C3    ­3Ã  LDA &C333		Get drive number
8B52 30 D8       0Ø   BMI &8B2C		Jump back with floppies
8B54 20 7E 80     ~.  JSR &807E		Set SCSI to command mode
8B57 AD 16 C2    ­.Â  LDA &C216
8B5A 85 B2       .²   STA &B2
8B5C AD 17 C2    ­.Â  LDA &C217
8B5F 85 B3       .³   STA &B3		&B2/3=address b0-b15
8B61 AD 18 C2    ­.Â  LDA &C218		Get Addr2
8B64 C9 FE       Éþ   CMP #&FE
8B66 90 06       ..   BCC &8B6E		Addr<&FFFE0000, language space
8B68 AD 19 C2    ­.Â  LDA &C219		Get Addr3
8B6B 1A          .    INC A
8B6C F0 03       ð.   BEQ &8B71		Address &FFxxxxxx, use I/O memory
8B6E 20 20 80      .  JSR &8020		Claim Tube
8B71 AD 1E C2    ­.Â  LDA &C21E		Get byte count (in Sector Count)
8B74 AA          ª    TAX		Pass to X
8B75 A9 01       ©.   LDA #&01
8B77 8D 1E C2    ..Â  STA &C21E		Set Sector Count to 1
8B7A A9 08       ©.   LDA #&08
8B7C 8D 1A C2    ..Â  STA &C21A		Command &08 - Read
8B7F A0 00        .   LDY #&00
8B81 B9 1A C2    ¹.Â  LDA &C21A,Y
8B84 20 3E 83     >.  JSR &833E		Send control block to SCSI
8B87 C8          È    INY
8B88 C0 06       À.   CPY #&06
8B8A D0 F5       Ðõ   BNE &8B81
8B8C 24 CD       $Í   BIT &CD		Check Tube flags
8B8E 50 0B       P.   BVC &8B9B		Tube not being used, jump ahead
8B90 DA          Ú    PHX		Save byte count in X
8B91 A2 27       ¢'   LDX #&27
8B93 A0 C2        Â   LDY #&C2
8B95 A9 01       ©.   LDA #&01
8B97 20 06 04     ..  JSR &0406		Set Tube transfer address
8B9A FA          ú    PLX		Get byte count back
8B9B A0 00        .   LDY #&00		Fetch 256 bytes
8B9D 20 32 83     2.  JSR &8332		Wait for SCSI ready
8BA0 30 19       0.   BMI &8BBB		Jump ahead if switched to write
8BA2 AD 40 FC    ­@ü  LDA &FC40		Get byte from SCSI
8BA5 E0 00       à.   CPX #&00		No more bytes left?
8BA7 F0 0F       ð.   BEQ &8BB8		Jump to ignore extra bytes
8BA9 24 CD       $Í   BIT &CD		Tube or I/O?
8BAB 50 08       P.   BVC &8BB5		Jump to read to I/O memory
8BAD 20 1B 82     ..  JSR &821B		Pause a bit
8BB0 8D E5 FE    .åþ  STA &FEE5		Send to Tube
8BB3 70 02       p.   BVS &8BB7		Jump ahead to loop back
8BB5 91 B2       .²   STA (&B2),Y	Store byte to I/O
8BB7 CA          Ê    DEX		Decrement byte count
8BB8 C8          È    INY		Next byte to fetch
8BB9 D0 E7       Ðç   BNE &8BA2		Loop for all 256 bytes

8BBB 4C AD 81    L­.  JMP &81AD		Jump to release and finish

8BBE 20 70 88     p.  JSR &8870
8BC1 F0 07       ð.   BEQ &8BCA
8BC3 D0 0D       Ð.   BNE &8BD2
8BC5 20 64 89     d.  JSR &8964
8BC8 D0 08       Ð.   BNE &8BD2
8BCA A0 03        .   LDY #&03
8BCC B1 B6       ±¶   LDA (&B6),Y
8BCE 30 F5       0õ   BMI &8BC5
8BD0 A9 00       ©.   LDA #&00
8BD2 60          `    RTS

8BD3 A0 00        .   LDY #&00
8BD5 B1 B4       ±´   LDA (&B4),Y
8BD7 C9 5E       É^   CMP #&5E
8BD9 D0 03       Ð.   BNE &8BDE
8BDB 4C 60 87    L`.  JMP &8760

8BDE C9 40       É@   CMP #&40
8BE0 F0 F9       ðù   BEQ &8BDB
8BE2 20 6B 83     k.  JSR &836B
8BE5 D6 4E       ÖN   DEC &4E,X
8BE7 6F 74 20    ot   BBR 6,&74,&8C0A
8BEA 66 6F       fo   ROR &6F
8BEC 75 6E       un   ADC &6E,X
8BEE 64 00       d.   STZ &00

Search for object, give error if 'E' set
========================================
8BF0 20 E8 8F     è.  JSR &8FE8		Search for object
8BF3 D0 DD       ÐÝ   BNE &8BD2		Not found, return NE
8BF5 A0 04        .   LDY #&04
8BF7 B1 B6       ±¶   LDA (&B6),Y	Check 'E' bit
8BF9 10 D5       .Õ   BPL &8BD0		Not 'E', return EQ for found
8BFB 20 6B 83     k.  JSR &836B		Error 'Access violation'
8BFE BD 41 63    ½Ac  LDA &6341,X
8C01 63          c    EQUB &63
8C02 65 73       es   ADC &73
8C04 73          s    EQUB &73
8C05 20 76 69     vi  JSR &6976
8C08 6F 6C 61    ola  BBR 6,&6C,&8C6C
8C0B 74 69       ti   STZ &69,X
8C0D 6F 6E 00    on.  BBR 6,&6E,&8C10

OSFILE &FF - LOAD
=================
8C10 20 BE 8B     ¾.  JSR &8BBE
8C13 D0 BE       Ð¾   BNE &8BD3
8C15 A0 00        .   LDY #&00
8C17 B1 B6       ±¶   LDA (&B6),Y
8C19 10 E0       .à   BPL &8BFB
8C1B A0 06        .   LDY #&06
8C1D B1 B8       ±¸   LDA (&B8),Y
8C1F D0 0D       Ð.   BNE &8C2E
8C21 88          .    DEY
8C22 B1 B8       ±¸   LDA (&B8),Y
8C24 99 14 C2    ..Â  STA &C214,Y
8C27 88          .    DEY
8C28 C0 01       À.   CPY #&01
8C2A D0 F6       Ðö   BNE &8C22
8C2C F0 0D       ð.   BEQ &8C3B
8C2E A2 04       ¢.   LDX #&04
8C30 A0 0D        .   LDY #&0D
8C32 B1 B6       ±¶   LDA (&B6),Y
8C34 9D 15 C2    ..Â  STA &C215,X
8C37 88          .    DEY
8C38 CA          Ê    DEX
8C39 D0 F7       Ð÷   BNE &8C32
8C3B A9 01       ©.   LDA #&01
8C3D 8D 15 C2    ..Â  STA &C215		Set flag byte to 1
8C40 A9 08       ©.   LDA #&08
8C42 8D 1A C2    ..Â  STA &C21A		Command 'read'
8C45 A9 00       ©.   LDA #&00
8C47 8D 1F C2    ..Â  STA &C21F
8C4A A0 16        .   LDY #&16
8C4C A2 03       ¢.   LDX #&03
8C4E B1 B6       ±¶   LDA (&B6),Y
8C50 9D 1A C2    ..Â  STA &C21A,X	Copy sector start
8C53 C8          È    INY
8C54 CA          Ê    DEX
8C55 D0 F7       Ð÷   BNE &8C4E
8C57 A0 15        .   LDY #&15
8C59 A2 04       ¢.   LDX #&04
8C5B B1 B6       ±¶   LDA (&B6),Y
8C5D 9D 1F C2    ..Â  STA &C21F,X	Copy length
8C60 88          .    DEY
8C61 CA          Ê    DEX
8C62 D0 F7       Ð÷   BNE &8C5B
8C64 20 42 8A     B.  JSR &8A42
8C67 20 6D 8C     m.  JSR &8C6D
8C6A 4C D5 89    LÕ.  JMP &89D5

8C6D 20 01 95     ..  JSR &9501		Print info if *OPT1 set

Copy file info to control block
-------------------------------
8C70 A0 15        .   LDY #&15		Top byte of length
8C72 A2 0B       ¢.   LDX #&0B		11+1 bytes to copy
8C74 B1 B6       ±¶   LDA (&B6),Y	Copy length/exec/load
8C76 9D 15 C2    ..Â  STA &C215,X	 to workspace
8C79 88          .    DEY
8C7A CA          Ê    DEX
8C7B 10 F7       .÷   BPL &8C74		Loop for 12 bytes
8C7D A0 0D        .   LDY #&0D
8C7F A2 0B       ¢.   LDX #&0B
8C81 BD 15 C2    ½.Â  LDA &C215,X	Copy from workspace
8C84 91 B8       .¸   STA (&B8),Y	 to control block
8C86 88          .    DEY
8C87 CA          Ê    DEX
8C88 10 F7       .÷   BPL &8C81		Loop for 12 bytes
8C8A A9 00       ©.   LDA #&00
8C8C 8D 2B C2    .+Â  STA &C22B		Clear byte for access
8C8F A0 02        .   LDY #&02		Point to 'L' bit
8C91 B1 B6       ±¶   LDA (&B6),Y
8C93 0A          .    ASL A
8C94 2E 2B C2    .+Â  ROL &C22B		Copy LWR into &C22B
8C97 88          .    DEY
8C98 10 F7       .÷   BPL &8C91
8C9A AD 2B C2    ­+Â  LDA &C22B		A=00000LWR
8C9D 6A          j    ROR A		A=000000LW Cy=R
8C9E 6A          j    ROR A		A=R000000L Cy=W
8C9F 6A          j    ROR A		A=WR000000 Cy=L
8CA0 08          .    PHP		Save 'L'
8CA1 4A          J    LSR A		A=0WR00000
8CA2 28          (    PLP		Get 'L'
8CA3 6A          j    ROR A		A=L0WR0000
8CA4 8D 2B C2    .+Â  STA &C22B		Store back in workspace
8CA7 4A          J    LSR A
8CA8 4A          J    LSR A
8CA9 4A          J    LSR A
8CAA 4A          J    LSR A		A=0000L0WR
8CAB 0D 2B C2    .+Â  ORA &C22B		A=L0WRL0WR
8CAE A0 0E        .   LDY #&0E
8CB0 91 B8       .¸   STA (&B8),Y	Store access byte in control block
8CB2 60          `    RTS

OSFILE &05 - Read Info
======================
&B8/9=>control block, &B4/5=>filename

8CB3 A0 00        .   LDY #&00		Copy filename address again
8CB5 B1 B8       ±¸   LDA (&B8),Y
8CB7 85 B4       .´   STA &B4
8CB9 C8          È    INY
8CBA B1 B8       ±¸   LDA (&B8),Y
8CBC 85 B5       .µ   STA &B5
8CBE 20 E8 8F     è.  JSR &8FE8		Search for object
8CC1 D0 0E       Ð.   BNE &8CD1
8CC3 A0 04        .   LDY #&04
8CC5 B1 B6       ±¶   LDA (&B6),Y	Get 'E' bit
8CC7 10 05       ..   BPL &8CCE		'E' not set, jump
8CC9 A9 FF       ©.   LDA #&FF		'E' set, filetype &FF
8CCB 4C D8 89    LØ.  JMP &89D8					STA &C2C0

8CCE 20 70 8C     p.  JSR &8C70
8CD1 4C D5 89    LÕ.  JMP &89D5

8CD4 A0 00        .   LDY #&00
8CD6 B1 B8       ±¸   LDA (&B8),Y
8CD8 85 B4       .´   STA &B4
8CDA C8          È    INY
8CDB B1 B8       ±¸   LDA (&B8),Y
8CDD 85 B5       .µ   STA &B5
8CDF 20 C8 8D     È.  JSR &8DC8
8CE2 20 E8 8F     è.  JSR &8FE8
8CE5 F0 05       ð.   BEQ &8CEC
8CE7 20 56 94     V.  JSR &9456
8CEA F0 15       ð.   BEQ &8D01
8CEC 60          `    RTS

8CED 20 D4 8C     Ô.  JSR &8CD4
8CF0 F0 29       ð)   BEQ &8D1B
8CF2 D0 05       Ð.   BNE &8CF9
8CF4 20 D4 8C     Ô.  JSR &8CD4
8CF7 F0 19       ð.   BEQ &8D12
8CF9 A0 00        .   LDY #&00
8CFB B1 B4       ±´   LDA (&B4),Y
8CFD C9 2E       É.   CMP #&2E
8CFF D0 03       Ð.   BNE &8D04
8D01 4C D3 8B    LÓ.  JMP &8BD3

8D04 C9 21       É!   CMP #&21
8D06 90 07       ..   BCC &8D0F
8D08 C9 22       É"   CMP #&22
8D0A F0 03       ð.   BEQ &8D0F
8D0C C8          È    INY
8D0D D0 EC       Ðì   BNE &8CFB
8D0F A9 11       ©.   LDA #&11
8D11 60          `    RTS

8D12 A0 03        .   LDY #&03
8D14 B1 B6       ±¶   LDA (&B6),Y
8D16 10 03       ..   BPL &8D1B
8D18 4C AB 95    L«.  JMP &95AB

8D1B A0 02        .   LDY #&02
8D1D B1 B6       ±¶   LDA (&B6),Y
8D1F 10 0B       ..   BPL &8D2C
8D21 20 6B 83     k.  JSR &836B
8D24 C3          Ã    EQUB &C3
8D25 4C 6F 63    Loc  JMP &636F

8D28 6B          k    ROR A
8D29 65 64       ed   ADC &64
8D2B 00          .    BRK
8D2C A2 09       ¢.   LDX #&09
8D2E BD AC C3    ½¬Ã  LDA &C3AC,X
8D31 F0 41       ðA   BEQ &8D74
8D33 BD B6 C3    ½¶Ã  LDA &C3B6,X
8D36 29 E0       )à   AND #&E0
8D38 CD 17 C3    Í.Ã  CMP &C317
8D3B D0 37       Ð7   BNE &8D74
8D3D BD E8 C3    ½èÃ  LDA &C3E8,X
8D40 CD 14 C3    Í.Ã  CMP &C314
8D43 D0 2F       Ð/   BNE &8D74
8D45 BD DE C3    ½ÞÃ  LDA &C3DE,X
8D48 CD 15 C3    Í.Ã  CMP &C315
8D4B D0 27       Ð'   BNE &8D74
8D4D BD D4 C3    ½ÔÃ  LDA &C3D4,X
8D50 CD 16 C3    Í.Ã  CMP &C316
8D53 D0 1F       Ð.   BNE &8D74
8D55 A0 19        .   LDY #&19
8D57 B1 B6       ±¶   LDA (&B6),Y
8D59 DD F2 C3    ÝòÃ  CMP &C3F2,X
8D5C D0 16       Ð.   BNE &8D74
8D5E 20 6B 83     k.  JSR &836B
8D61 C2          Â    EQUB &C2
8D62 43          C    EQUB &43
8D63 61 6E       an   ADC (&6E,X)
8D65 27 74       't   BIT &74
8D67 20 2D 20     -   JSR &202D
8D6A 46 69       Fi   LSR &69
8D6C 6C 65 20    le   JMP (&2065)

8D6F 6F 70 65    ope  BBR 6,&70,&8DD7
8D72 6E 00 CA    n.Ê  ROR &CA00
8D75 10 B7       .·   BPL &8D2E
8D77 E8          è    INX
8D78 60          `    RTS

8D79 A0 00        .   LDY #&00
8D7B 20 43 87     C.  JSR &8743
8D7E D0 05       Ð.   BNE &8D85
8D80 C9 2E       É.   CMP #&2E
8D82 F0 62       ðb   BEQ &8DE6
8D84 60          `    RTS

8D85 C9 3A       É:   CMP #&3A
8D87 D0 0F       Ð.   BNE &8D98
8D89 C8          È    INY
8D8A C8          È    INY
8D8B 20 43 87     C.  JSR &8743
8D8E D0 56       ÐV   BNE &8DE6
8D90 C9 2E       É.   CMP #&2E
8D92 D0 4C       ÐL   BNE &8DE0
8D94 C8          È    INY
8D95 20 E1 8D     á.  JSR &8DE1
8D98 29 FD       )ý   AND #&FD
8D9A C9 24       É$   CMP #&24
8D9C F0 EC       ðì   BEQ &8D8A
8D9E 20 E1 8D     á.  JSR &8DE1
8DA1 C9 5E       É^   CMP #&5E
8DA3 F0 04       ð.   BEQ &8DA9
8DA5 C9 40       É@   CMP #&40
8DA7 D0 0D       Ð.   BNE &8DB6
8DA9 C8          È    INY
8DAA 20 43 87     C.  JSR &8743
8DAD D0 37       Ð7   BNE &8DE6
8DAF C9 2E       É.   CMP #&2E
8DB1 D0 2D       Ð-   BNE &8DE0
8DB3 C8          È    INY
8DB4 80 E8       .è   BRA &8D9E

8DB6 20 43 87     C.  JSR &8743
8DB9 F0 F4       ðô   BEQ &8DAF
8DBB A2 05       ¢.   LDX #&05
8DBD DD F8 8D    Ýø.  CMP &8DF8,X
8DC0 F0 24       ð$   BEQ &8DE6
8DC2 CA          Ê    DEX
8DC3 10 F8       .ø   BPL &8DBD
8DC5 C8          È    INY
8DC6 D0 EE       Ðî   BNE &8DB6
8DC8 20 79 8D     y.  JSR &8D79
8DCB B1 B4       ±´   LDA (&B4),Y
8DCD 29 7F       ).   AND #&7F
8DCF C9 2A       É*   CMP #&2A
8DD1 F0 16       ð.   BEQ &8DE9
8DD3 C9 23       É#   CMP #&23
8DD5 F0 12       ð.   BEQ &8DE9
8DD7 C9 2E       É.   CMP #&2E
8DD9 F0 05       ð.   BEQ &8DE0
8DDB 88          .    DEY
8DDC C0 FF       À.   CPY #&FF
8DDE D0 EB       Ðë   BNE &8DCB
8DE0 60          `    RTS

8DE1 20 43 87     C.  JSR &8743
8DE4 D0 FA       Ðú   BNE &8DE0
8DE6 4C 60 87    L`.  JMP &8760

8DE9 20 6B 83     k.  JSR &836B
8DEC FD 57 69    ýWi  SBC &6957,X
8DEF 6C 64 20    ld   JMP (&2064)

8DF2 63          c    EQUB &63
8DF3 61 72       ar   ADC (&72,X)
8DF5 64 73       ds   STZ &73
8DF7 00          .    BRK
8DF8 7F 5E 40    .^@  BBR 7,&5E,&8E3B
8DFB 3A          :    DEC A
8DFC 24 26       $&   BIT &26
8DFE 20 F4 8C     ô.  JSR &8CF4
8E01 D0 21       Ð!   BNE &8E24
8E03 A2 02       ¢.   LDX #&02
8E05 A0 12        .   LDY #&12
8E07 B1 B6       ±¶   LDA (&B6),Y
8E09 C9 01       É.   CMP #&01
8E0B C8          È    INY
8E0C A9 00       ©.   LDA #&00
8E0E 71 B6       q¶   ADC (&B6),Y
8E10 99 24 C2    .$Â  STA &C224,Y
8E13 CA          Ê    DEX
8E14 10 F5       .õ   BPL &8E0B
8E16 A0 18        .   LDY #&18
8E18 A2 02       ¢.   LDX #&02
8E1A B1 B6       ±¶   LDA (&B6),Y
8E1C 9D 34 C2    .4Â  STA &C234,X
8E1F 88          .    DEY
8E20 CA          Ê    DEX
8E21 10 F7       .÷   BPL &8E1A
8E23 60          `    RTS

8E24 AD B1 C8    ­±È  LDA &C8B1
8E27 F0 0D       ð.   BEQ &8E36
8E29 20 6B 83     k.  JSR &836B
8E2C B3          ³    EQUB &B3
8E2D 44          D    EQUB &44
8E2E 69 72       ir   ADC #&72
8E30 20 66 75     fu  JSR &7566
8E33 6C 6C 00    ll.  JMP (&006C)

8E36 A5 B4       ¥´   LDA &B4
8E38 8D 27 C2    .'Â  STA &C227
8E3B A5 B5       ¥µ   LDA &B5
8E3D 8D 28 C2    .(Â  STA &C228
8E40 A9 B1       ©±   LDA #&B1
8E42 85 B4       .´   STA &B4
8E44 A9 C8       ©È   LDA #&C8
8E46 85 B5       .µ   STA &B5
8E48 A0 1A        .   LDY #&1A
8E4A A2 06       ¢.   LDX #&06
8E4C A9 00       ©.   LDA #&00
8E4E 9D 33 C2    .3Â  STA &C233,X
8E51 CA          Ê    DEX
8E52 D0 FA       Ðú   BNE &8E4E
8E54 A1 B4       ¡´   LDA (&B4,X)
8E56 91 B4       .´   STA (&B4),Y
8E58 A5 B4       ¥´   LDA &B4
8E5A C5 B6       Å¶   CMP &B6
8E5C D0 06       Ð.   BNE &8E64
8E5E A5 B5       ¥µ   LDA &B5
8E60 C5 B7       Å·   CMP &B7
8E62 F0 0B       ð.   BEQ &8E6F
8E64 A5 B4       ¥´   LDA &B4
8E66 D0 02       Ð.   BNE &8E6A
8E68 C6 B5       Æµ   DEC &B5
8E6A C6 B4       Æ´   DEC &B4
8E6C 4C 54 8E    LT.  JMP &8E54

8E6F AD 27 C2    ­'Â  LDA &C227
8E72 85 B4       .´   STA &B4
8E74 AD 28 C2    ­(Â  LDA &C228
8E77 85 B5       .µ   STA &B5
8E79 60          `    RTS

8E7A A0 09        .   LDY #&09
8E7C B1 B4       ±´   LDA (&B4),Y
8E7E 29 7F       ).   AND #&7F
8E80 C9 21       É!   CMP #&21
8E82 90 04       ..   BCC &8E88
8E84 C9 22       É"   CMP #&22
8E86 D0 02       Ð.   BNE &8E8A
8E88 A9 0D       ©.   LDA #&0D
8E8A C0 02       À.   CPY #&02
8E8C B0 02       °.   BCS &8E90
8E8E 09 80       ..   ORA #&80
8E90 91 B6       .¶   STA (&B6),Y
8E92 88          .    DEY
8E93 10 E7       .ç   BPL &8E7C
8E95 60          `    RTS

8E96 A0 11        .   LDY #&11
8E98 B1 B8       ±¸   LDA (&B8),Y
8E9A 99 15 C2    ..Â  STA &C215,Y
8E9D 88          .    DEY
8E9E 10 F8       .ø   BPL &8E98
8EA0 A0 12        .   LDY #&12
8EA2 38          8    SEC
8EA3 A2 03       ¢.   LDX #&03
8EA5 B9 11 C2    ¹.Â  LDA &C211,Y
8EA8 F9 0D C2    ù.Â  SBC &C20D,Y
8EAB 91 B6       .¶   STA (&B6),Y
8EAD C8          È    INY
8EAE CA          Ê    DEX
8EAF 10 F4       .ô   BPL &8EA5
8EB1 A0 0A        .   LDY #&0A
8EB3 B9 0D C2    ¹.Â  LDA &C20D,Y
8EB6 91 B6       .¶   STA (&B6),Y
8EB8 C8          È    INY
8EB9 C0 12       À.   CPY #&12
8EBB D0 F6       Ðö   BNE &8EB3
8EBD A5 B6       ¥¶   LDA &B6
8EBF 48          H    PHA
8EC0 A5 B7       ¥·   LDA &B7
8EC2 48          H    PHA
8EC3 A9 05       ©.   LDA #&05
8EC5 85 B6       .¶   STA &B6
8EC7 A9 C4       ©Ä   LDA #&C4
8EC9 85 B7       .·   STA &B7
8ECB A0 00        .   LDY #&00
8ECD B1 B6       ±¶   LDA (&B6),Y
8ECF F0 27       ð'   BEQ &8EF8
8ED1 A0 19        .   LDY #&19
8ED3 B1 B6       ±¶   LDA (&B6),Y
8ED5 CD FA C8    ÍúÈ  CMP &C8FA
8ED8 F0 0D       ð.   BEQ &8EE7
8EDA 18          .    CLC
8EDB A5 B6       ¥¶   LDA &B6
8EDD 69 1A       i.   ADC #&1A
8EDF 85 B6       .¶   STA &B6
8EE1 90 E8       .è   BCC &8ECB
8EE3 E6 B7       æ·   INC &B7
8EE5 B0 E4       °ä   BCS &8ECB
8EE7 AD FA C8    ­úÈ  LDA &C8FA
8EEA 18          .    CLC
8EEB F8          ø    SED
8EEC 69 01       i.   ADC #&01
8EEE D8          Ø    CLD
8EEF 8D FA C8    .úÈ  STA &C8FA
8EF2 8D 00 C4    ..Ä  STA &C400
8EF5 4C C3 8E    LÃ.  JMP &8EC3

8EF8 68          h    PLA
8EF9 85 B7       .·   STA &B7
8EFB 68          h    PLA
8EFC 85 B6       .¶   STA &B6
8EFE A0 19        .   LDY #&19
8F00 AD FA C8    ­úÈ  LDA &C8FA
8F03 91 B6       .¶   STA (&B6),Y
8F05 A9 01       ©.   LDA #&01
8F07 8D 15 C2    ..Â  STA &C215
8F0A A2 04       ¢.   LDX #&04
8F0C BD 1E C2    ½.Â  LDA &C21E,X
8F0F 9D 15 C2    ..Â  STA &C215,X
8F12 CA          Ê    DEX
8F13 D0 F7       Ð÷   BNE &8F0C
8F15 A9 0A       ©.   LDA #&0A
8F17 8D 1A C2    ..Â  STA &C21A
8F1A A9 00       ©.   LDA #&00
8F1C 8D 1E C2    ..Â  STA &C21E
8F1F A9 00       ©.   LDA #&00
8F21 8D 1F C2    ..Â  STA &C21F
8F24 A0 12        .   LDY #&12
8F26 B1 B6       ±¶   LDA (&B6),Y
8F28 99 0E C2    ..Â  STA &C20E,Y
8F2B C8          È    INY
8F2C C0 16       À.   CPY #&16
8F2E D0 F6       Ðö   BNE &8F26
8F30 A0 12        .   LDY #&12
8F32 B1 B6       ±¶   LDA (&B6),Y
8F34 C9 01       É.   CMP #&01
8F36 A2 02       ¢.   LDX #&02
8F38 A9 00       ©.   LDA #&00
8F3A C8          È    INY
8F3B 71 B6       q¶   ADC (&B6),Y
8F3D 99 2A C2    .*Â  STA &C22A,Y
8F40 CA          Ê    DEX
8F41 10 F5       .õ   BPL &8F38
8F43 90 03       ..   BCC &8F48
8F45 4C 7F 86    L..  JMP &867F

8F48 A0 16        .   LDY #&16
8F4A A9 FF       ©.   LDA #&FF
8F4C 91 B6       .¶   STA (&B6),Y
8F4E C8          È    INY
8F4F 91 B6       .¶   STA (&B6),Y
8F51 C8          È    INY
8F52 91 B6       .¶   STA (&B6),Y
8F54 4C E1 84    Lá.  JMP &84E1

8F57 20 FE 8D     þ.  JSR &8DFE
8F5A 20 7A 8E     z.  JSR &8E7A
8F5D 20 96 8E     ..  JSR &8E96
8F60 20 5B 86     [.  JSR &865B
8F63 A0 18        .   LDY #&18
8F65 A2 02       ¢.   LDX #&02
8F67 BD 3A C2    ½:Â  LDA &C23A,X
8F6A 91 B6       .¶   STA (&B6),Y
8F6C 88          .    DEY
8F6D CA          Ê    DEX
8F6E 10 F7       .÷   BPL &8F67
8F70 A2 02       ¢.   LDX #&02
8F72 A0 06        .   LDY #&06
8F74 BD 3A C2    ½:Â  LDA &C23A,X
8F77 99 15 C2    ..Â  STA &C215,Y
8F7A C8          È    INY
8F7B CA          Ê    DEX
8F7C 10 F6       .ö   BPL &8F74
8F7E 60          `    RTS

8F7F 20 57 8F     W.  JSR &8F57
8F82 20 42 8A     B.  JSR &8A42
8F85 4C 8B 8F    L..  JMP &8F8B

8F88 20 57 8F     W.  JSR &8F57
8F8B 20 91 8F     ..  JSR &8F91
8F8E 4C 67 8C    Lg.  JMP &8C67

8F91 20 14 A7     .§  JSR &A714
8F94 20 12 90     ..  JSR &9012
8F97 A2 0A       ¢.   LDX #&0A
8F99 BD 3C 88    ½<.  LDA &883C,X
8F9C 9D 15 C2    ..Â  STA &C215,X
8F9F CA          Ê    DEX
8FA0 10 F7       .÷   BPL &8F99
8FA2 A9 0A       ©.   LDA #&0A
8FA4 8D 1A C2    ..Â  STA &C21A
8FA7 AD 14 C3    ­.Ã  LDA &C314
8FAA 8D 1D C2    ..Â  STA &C21D
8FAD AD 15 C3    ­.Ã  LDA &C315
8FB0 8D 1C C2    ..Â  STA &C21C
8FB3 AD 16 C3    ­.Ã  LDA &C316
8FB6 8D 1B C2    ..Â  STA &C21B
8FB9 20 AA 82     ª.  JSR &82AA
8FBC AD 17 C3    ­.Ã  LDA &C317
8FBF 20 C5 B5     Åµ  JSR &B5C5		X=(A DIV 16)
8FC2 AD FC C1    ­üÁ  LDA &C1FC
8FC5 9D 22 C3    ."Ã  STA &C322,X
8FC8 AD 44 FE    ­Dþ  LDA &FE44		System VIA Latch Lo
8FCB 9D 21 C3    .!Ã  STA &C321,X
8FCE 8D FB C1    .ûÁ  STA &C1FB
8FD1 20 65 90     e.  JSR &9065		Calculate FSM checksums
8FD4 8E FF C0    ..À  STX &C0FF		Store sector 0 checksum
8FD7 8D FF C1    ..Á  STA &C1FF		Store sector 1 checksum
8FDA A2 7A       ¢z   LDX #&7A		Point to control block
8FDC A0 90        .   LDY #&90
8FDE 20 AE 82     ®.  JSR &82AE		Save FSM
8FE1 A9 10       ©.   LDA #&10
8FE3 14 CD       .Í   TRB &CD		Flag FSM loaded
8FE5 A9 00       ©.   LDA #&00
8FE7 60          `    RTS

8FE8 20 70 88     p.  JSR &8870
8FEB 08          .    PHP
8FEC 48          H    PHA		Save registers
8FED 20 F3 8F     ó.  JSR &8FF3		Check loaded FSM
8FF0 68          h    PLA		Restore registers
8FF1 28          (    PLP
8FF2 60          `    RTS

Check Free Space Map consistancy
================================
8FF3 20 12 90     ..  JSR &9012		Check for overlapping FSM entries
8FF6 20 65 90     e.  JSR &9065		Add up
8FF9 CD FF C1    Í.Á  CMP &C1FF		Does sector 1 sum match?
8FFC D0 05       Ð.   BNE &9003		No, jump to give error
8FFE EC FF C0    ì.À  CPX &C0FF		Does sector 0 sum match?
9001 F0 EF       ðï   BEQ &8FF2		Yes, exit
9003 20 4E 83     N.  JSR &834E		Generate error
9006 A9 42       ©B   LDA #&42		"Bad FS map"
9008 61 64       ad   ADC (&64,X)
900A 20 46 53     FS  JSR &5346
900D 20 6D 61     ma  JSR &616D
9010 70 00       p.   BVS &9012

Check Free Space Map doesn't have overlapping entries
-----------------------------------------------------
9012 AE FE C1    ®þÁ  LDX &C1FE		Get pointer to end of FSM
9015 F0 DB       ðÛ   BEQ &8FF2		Pointer=0, disk completely full, exit
9017 A9 00       ©.   LDA #&00		Seed the sum with zero
9019 1D FF BF    ..¿  ORA &BFFF,X	Merge with high byte of final free space
901C 1D FF C0    ..À  ORA &C0FF,X	Merge with high byte of final length
901F CA          Ê    DEX
9020 F0 E1       ðá   BEQ &9003		Give error if end pointer not *3
9022 CA          Ê    DEX
9023 F0 DE       ðÞ   BEQ &9003		Give error if end pointer not *3
9025 CA          Ê    DEX
9026 D0 F1       Ðñ   BNE &9019		Multiple of three, check net entry
9028 29 E0       )à   AND #&E0		Get "drive" bits
902A D0 D7       Ð×   BNE &9003		If any set, map entry too big
902C AE FE C1    ®þÁ  LDX &C1FE		Get pointer to end of FSM
902F E0 06       à.   CPX #&06		Are there two or more entries?
9031 90 BF       .¿   BCC &8FF2		Exit if only one FSM entry
9033 A2 03       ¢.   LDX #&03		Point to first entry minus 3
9035 A0 02        .   LDY #&02		Three bytes per entry
9037 18          .    CLC		Clear carry
9038 BD FD BF    ½ý¿  LDA &BFFD,X	Get FSM entry start sector
903B 7D FD C0    }ýÀ  ADC &C0FD,X	Add FSM entry length
903E 48          H    PHA		Save byte
903F E8          è    INX		Point to next byte
9040 88          .    DEY
9041 10 F5       .õ   BPL &9038		Loop for three bytes
9043 B0 BE       °¾   BCS &9003		Start+Length overflowed, give error
9045 A0 02        .   LDY #&02		Three bytes per entry
9047 68          h    PLA		Get start+length byte
9048 CA          Ê    DEX
9049 DD 00 C0    Ý.À  CMP &C000,X	Check against next entry start
904C 90 07       ..   BCC &9055		Hole in FSM, check next byte
904E D0 B3       Ð³   BNE &9003		Entry overlaps, give error
9050 88          .    DEY
9051 10 F4       .ô   BPL &9047		Loop for three bytes
9053 30 AE       0®   BMI &9003		Entry overlaps, give error
9055 68          h    PLA		Get next byte
9056 CA          Ê    DEX
9057 88          .    DEY
9058 10 FB       .û   BPL &9055
905A 48          H    PHA
905B E8          è    INX
905C E8          è    INX
905D E8          è    INX
905E E8          è    INX		Point to next entry
905F EC FE C1    ìþÁ  CPX &C1FE		Check against end of FSM
9062 90 D1       .Ñ   BCC &9035		Loop for all entries
9064 60          `    RTS

Add up FSM
----------
9065 18          .    CLC		Clear carry
9066 A0 FF        .   LDY #&FF		Point to &xxFE
9068 98          .    TYA		Initialise A with -1
9069 79 FF BF    y.¿  ADC &BFFF,Y	Add sector 0 bytes &FE to &00
906C 88          .    DEY
906D D0 FA       Ðú   BNE &9069		Loop for all bytes
906F AA          ª    TAX		Save result in X
9070 88          .    DEY		Reset Y to &FF again
9071 98          .    TYA		Initialise A with -1
9072 18          .    CLC		Clear carry
9073 79 FF C0    y.À  ADC &C0FF,Y	Add sector 1 bytes from &FE to &00
9076 88          .    DEY
9077 D0 FA       Ðú   BNE &9073		Loop for all bytes
9079 60          `    RTS

907A 01 00       ..   ORA (&00,X)	Control block to save FSM
907C C0 FF       À.   CPY #&FF
907E FF 0A 00    ...  BBS 7,&0A,&9081
9081 00          .    BRK
9082 00          .    BRK
9083 02          .    EQUB &02
9084 00          .    BRK

OSFILE &01-&03 - Write Info
===========================
9085 8D 23 C2    .#Â  STA &C223		Save function
9088 20 F0 8B     ð.  JSR &8BF0		Search for non-'E' object
908B F0 03       ð.   BEQ &9090		Jump if file found
908D A9 00       ©.   LDA #&00		Return 'no file'
908F 60          `    RTS

Write Info - file found
-----------------------
(&B6)=>file info, (&B8)=>control block
9090 AD 23 C2    ­#Â  LDA &C223		Get OSFILE function
9093 C9 03       É.   CMP #&03
9095 F0 21       ð!   BEQ &90B8		Jump past with Exec
9097 A0 05        .   LDY #&05
9099 A2 03       ¢.   LDX #&03
909B B1 B8       ±¸   LDA (&B8),Y
909D 9D 15 C2    ..Â  STA &C215,X
90A0 88          .    DEY
90A1 CA          Ê    DEX
90A2 10 F7       .÷   BPL &909B
90A4 A0 0D        .   LDY #&0D
90A6 A2 03       ¢.   LDX #&03
90A8 BD 15 C2    ½.Â  LDA &C215,X
90AB 91 B6       .¶   STA (&B6),Y
90AD 88          .    DEY
90AE CA          Ê    DEX
90AF 10 F7       .÷   BPL &90A8
90B1 AD 23 C2    ­#Â  LDA &C223
90B4 C9 02       É.   CMP #&02
90B6 F0 4C       ðL   BEQ &9104
90B8 A0 09        .   LDY #&09
90BA A2 03       ¢.   LDX #&03
90BC B1 B8       ±¸   LDA (&B8),Y
90BE 9D 15 C2    ..Â  STA &C215,X
90C1 88          .    DEY
90C2 CA          Ê    DEX
90C3 10 F7       .÷   BPL &90BC
90C5 A0 11        .   LDY #&11
90C7 A2 03       ¢.   LDX #&03
90C9 BD 15 C2    ½.Â  LDA &C215,X
90CC 91 B6       .¶   STA (&B6),Y
90CE 88          .    DEY
90CF CA          Ê    DEX
90D0 10 F7       .÷   BPL &90C9
90D2 AE 23 C2    ®#Â  LDX &C223
90D5 CA          Ê    DEX
90D6 D0 2C       Ð,   BNE &9104

90D8 A0 0E        .   LDY #&0E
90DA B1 B8       ±¸   LDA (&B8),Y	Get access byte
90DC 8D 2B C2    .+Â  STA &C22B
90DF A0 03        .   LDY #&03
90E1 B1 B6       ±¶   LDA (&B6),Y	Check 'D' bit
90E3 10 0D       ..   BPL &90F2		Jump if a file
90E5 4E 2B C2    N+Â  LSR &C22B
90E8 4E 2B C2    N+Â  LSR &C22B
90EB 4E 2B C2    N+Â  LSR &C22B		Move 'L' bit down to b0
90EE A0 02        .   LDY #&02		Point to 'L' bit
90F0 10 02       ..   BPL &90F4

90F2 A0 00        .   LDY #&00		Point to 'R' bit

90F4 B1 B6       ±¶   LDA (&B6),Y	Get filename byte
90F6 0A          .    ASL A		Drop access bit
90F7 4E 2B C2    N+Â  LSR &C22B		Get supplied access bit
90FA 6A          j    ROR A		Move into filename byte
90FB 91 B6       .¶   STA (&B6),Y	Store in object info
90FD C8          È    INY		Step to next byte
90FE C0 02       À.   CPY #&02
9100 90 F2       .ò   BCC &90F4		Loop until RW done
9102 F0 E7       ðç   BEQ &90EB		'L' bit, move source down one more bit
9104 20 91 8F     ..  JSR &8F91		RWL done, store catalogue entry
9107 4C CE 8C    LÎ.  JMP &8CCE

OSFILE &04 - Write Attributes
=============================
910A 20 F0 8B     ð.  JSR &8BF0
910D F0 C9       ðÉ   BEQ &90D8
910F A9 00       ©.   LDA #&00
9111 60          `    RTS

9112 20 0D A5     .¥  JSR &A50D
9115 A5 B4       ¥´   LDA &B4
9117 8D 40 C2    .@Â  STA &C240
911A A5 B5       ¥µ   LDA &B5
911C 8D 41 C2    .AÂ  STA &C241
911F A9 40       ©@   LDA #&40
9121 85 B8       .¸   STA &B8
9123 A9 C2       ©Â   LDA #&C2
9125 85 B9       .¹   STA &B9
9127 20 D4 8C     Ô.  JSR &8CD4
912A F0 05       ð.   BEQ &9131
912C A9 00       ©.   LDA #&00
912E 4C D8 89    LØ.  JMP &89D8

9131 20 1B 8D     ..  JSR &8D1B
9134 A0 03        .   LDY #&03
9136 B1 B6       ±¶   LDA (&B6),Y
9138 10 3D       .=   BPL &9177
913A A0 03        .   LDY #&03
913C B9 2C C2    ¹,Â  LDA &C22C,Y
913F 99 30 C2    .0Â  STA &C230,Y
9142 88          .    DEY
9143 10 F7       .÷   BPL &913C
9145 A9 FF       ©.   LDA #&FF
9147 8D 2E C2    ..Â  STA &C22E
914A 8D 2F C2    ./Â  STA &C22F
914D 20 86 94     ..  JSR &9486
9150 AD 05 C4    ­.Ä  LDA &C405
9153 08          .    PHP
9154 20 D8 89     Ø.  JSR &89D8
9157 A0 03        .   LDY #&03
9159 B9 30 C2    ¹0Â  LDA &C230,Y
915C 99 2C C2    .,Â  STA &C22C,Y
915F 88          .    DEY
9160 10 F7       .÷   BPL &9159
9162 28          (    PLP
9163 F0 12       ð.   BEQ &9177
9165 20 6B 83     k.  JSR &836B
9168 B4 44       ´D   LDY &44,X
916A 69 72       ir   ADC #&72
916C 20 6E 6F     no  JSR &6F6E
916F 74 20       t    STZ &20,X
9171 65 6D       em   ADC &6D
9173 70 74       pt   BVS &91E9
9175 79 00 A0    y.   ADC &A000,Y
9178 12 A2       .¢   ORA (&A2)
917A 02          .    EQUB &02
917B B1 B6       ±¶   LDA (&B6),Y
917D C9 01       É.   CMP #&01
917F C8          È    INY
9180 A9 00       ©.   LDA #&00
9182 71 B6       q¶   ADC (&B6),Y
9184 99 24 C2    .$Â  STA &C224,Y
9187 CA          Ê    DEX
9188 10 F5       .õ   BPL &917F
918A A0 18        .   LDY #&18
918C A2 02       ¢.   LDX #&02
918E B1 B6       ±¶   LDA (&B6),Y
9190 9D 34 C2    .4Â  STA &C234,X
9193 88          .    DEY
9194 CA          Ê    DEX
9195 10 F7       .÷   BPL &918E
9197 A0 03        .   LDY #&03
9199 B1 B6       ±¶   LDA (&B6),Y
919B 10 7E       .~   BPL &921B
919D AE 2F C2    ®/Â  LDX &C22F
91A0 E0 FF       à.   CPX #&FF
91A2 F0 05       ð.   BEQ &91A9
91A4 EC 17 C3    ì.Ã  CPX &C317
91A7 D0 22       Ð"   BNE &91CB
91A9 A2 02       ¢.   LDX #&02
91AB BD 34 C2    ½4Â  LDA &C234,X
91AE DD 2C C2    Ý,Â  CMP &C22C,X
91B1 D0 18       Ð.   BNE &91CB
91B3 CA          Ê    DEX
91B4 10 F5       .õ   BPL &91AB
91B6 20 6B 83     k.  JSR &836B
91B9 96 43       .C   STX &43,X
91BB 61 6E       an   ADC (&6E,X)
91BD 27 74       't   BIT &74
91BF 20 64 65     de  JSR &6564
91C2 6C 65 74    let  JMP (&7465)

91C5 65 20       e    ADC &20
91C7 43          C    EQUB &43
91C8 53          S    EQUB &53
91C9 44          D    EQUB &44
91CA 00          .    BRK
91CB AD 17 C3    ­.Ã  LDA &C317
91CE CD 1B C3    Í.Ã  CMP &C31B
91D1 D0 26       Ð&   BNE &91F9
91D3 A2 02       ¢.   LDX #&02
91D5 BD 34 C2    ½4Â  LDA &C234,X
91D8 DD 18 C3    Ý.Ã  CMP &C318,X
91DB D0 1C       Ð.   BNE &91F9
91DD CA          Ê    DEX
91DE 10 F5       .õ   BPL &91D5
91E0 20 6B 83     k.  JSR &836B
91E3 97 43       .C   STY &43,X
91E5 61 6E       an   ADC (&6E,X)
91E7 27 74       't   BIT &74
91E9 20 64 65     de  JSR &6564
91EC 6C 65 74    let  JMP (&7465)

91EF 65 20       e    ADC &20
91F1 4C 69 62    Lib  JMP &6269

91F4 72 61       ra   ADC (&61)
91F6 72 79       ry   ADC (&79)
91F8 00          .    BRK
91F9 AD 17 C3    ­.Ã  LDA &C317
91FC CD 1F C3    Í.Ã  CMP &C31F
91FF D0 1A       Ð.   BNE &921B
9201 A2 02       ¢.   LDX #&02
9203 BD 34 C2    ½4Â  LDA &C234,X
9206 DD 1C C3    Ý.Ã  CMP &C31C,X
9209 D0 10       Ð.   BNE &921B
920B CA          Ê    DEX
920C 10 F5       .õ   BPL &9203
920E A9 02       ©.   LDA #&02
9210 8D 1C C3    ..Ã  STA &C31C
9213 A9 00       ©.   LDA #&00
9215 8D 1D C3    ..Ã  STA &C31D
9218 8D 1E C3    ..Ã  STA &C31E
921B A0 04        .   LDY #&04
921D B1 B6       ±¶   LDA (&B6),Y
921F 30 03       0.   BMI &9224
9221 20 70 8C     p.  JSR &8C70
9224 A0 1A        .   LDY #&1A
9226 A2 00       ¢.   LDX #&00
9228 B1 B6       ±¶   LDA (&B6),Y
922A 81 B6       .¶   STA (&B6,X)
922C E6 B6       æ¶   INC &B6
922E D0 02       Ð.   BNE &9232
9230 E6 B7       æ·   INC &B7
9232 A5 B6       ¥¶   LDA &B6
9234 C9 BB       É»   CMP #&BB
9236 D0 F0       Ðð   BNE &9228
9238 A5 B7       ¥·   LDA &B7
923A C9 C8       ÉÈ   CMP #&C8
923C D0 EA       Ðê   BNE &9228
923E 20 E1 84     á.  JSR &84E1
9241 20 91 8F     ..  JSR &8F91
9244 4C D5 89    LÕ.  JMP &89D5


OSFILE
======
A=function, XY=>control block
-----------------------------
9247 86 B8       .¸   STX &B8		Store pointer to control block
9249 84 B9       .¹   STY &B9
924B A8          ¨    TAY		Y=function                  Unsupported should return A preserved:
                                                                    NOP
924C A2 00       ¢.   LDX #&00                                      CLR &C2D5
924E 8E D5 C2    .ÕÂ  STX &C2D5                                     ASL A
9251 0A          .    ASL A		Index into dispatch table   TAX
9252 AA          ª    TAX                                           TYA
9253 E8          è    INX                                           INX
9254 E8          è    INX                                           INX
9255 30 19       0.   BMI &9270		<&FF, return with A=func*2  BMI &9270
9257 E0 12       à.   CPX #&12
9259 B0 15       °.   BCS &9270		>&07, return with A=func*2
925B BD 72 92    ½r.  LDA &9272,X	Get dispatch address
925E 48          H    PHA
925F BD 71 92    ½q.  LDA &9271,X
9262 48          H    PHA
9263 5A          Z    PHY		Stack function
9264 A0 00        .   LDY #&00		Get filename address
9266 B1 B8       ±¸   LDA (&B8),Y
9268 85 B4       .´   STA &B4
926A C8          È    INY
926B B1 B8       ±¸   LDA (&B8),Y
926D 85 B5       .µ   STA &B5		&B4/5=>filename
926F 68          h    PLA		Get function to A
9270 60          `    RTS		Jump to subroutine

On dispatch, (&B8)=>control block, (&B4)=>filename, A=function, Y=1, X=corrupted
Subroutine should return A=filetype, XY=>control block


OSFILE Dispatch Block
=====================
9271 0F 8C       ..   EQUW &8C10-1 ; &FF - LOAD
9273 7E 8F       ~.   EQUW &8F7F-1 ; &00 - SAVE
9275 84 90       ..   EQUW &9085-1 ; &01 - Write Info
9277 84 90       ..   EQUW &9085-1 ; &02 - Write Load
9279 84 90       ..   EQUW &9085-1 ; &03 - Write Exec
927B 09 91       ..   EQUW &910A-1 ; &04 - Write Attrs
927D B2 8C       ².   EQUW &8CB3-1 ; &05 - Read Info
927F 26 91       &.   EQUW &9127-1 ; &06 - Delete
9281 87 8F       ..   EQUW &8F88-1 ; &07 - Create

9283 AA          ª    TAX
9284 A9 9F       ©.   LDA #&9F
9286 85 B7       .·   STA &B7
9288 BD 95 9E    ½..  LDA &9E95,X
928B 85 B6       .¶   STA &B6
928D A2 0C       ¢.   LDX #&0C

928F A0 00        .   LDY #&00
9291 B1 B6       ±¶   LDA (&B6),Y
9293 29 7F       ).   AND #&7F
9295 C9 20       É    CMP #&20
9297 90 08       ..   BCC &92A1
9299 20 CB 92     Ë.  JSR &92CB
929C C8          È    INY
929D CA          Ê    DEX
929E D0 F1       Ðñ   BNE &9291
92A0 60          `    RTS

92A1 20 36 A0     6   JSR &A036
92A4 CA          Ê    DEX
92A5 D0 FA       Ðú   BNE &92A1
92A7 60          `    RTS

92A8 68          h    PLA
92A9 85 B6       .¶   STA &B6
92AB 68          h    PLA
92AC 85 B7       .·   STA &B7
92AE A0 01        .   LDY #&01
92B0 B1 B6       ±¶   LDA (&B6),Y
92B2 30 06       0.   BMI &92BA
92B4 20 CB 92     Ë.  JSR &92CB
92B7 C8          È    INY
92B8 D0 F6       Ðö   BNE &92B0
92BA 29 7F       ).   AND #&7F
92BC 20 CB 92     Ë.  JSR &92CB
92BF 98          .    TYA
92C0 18          .    CLC
92C1 65 B6       e¶   ADC &B6
92C3 A8          ¨    TAY
92C4 A9 00       ©.   LDA #&00
92C6 65 B7       e·   ADC &B7
92C8 48          H    PHA
92C9 5A          Z    PHY
92CA 60          `    RTS

92CB 48          H    PHA
92CC 8A          .    TXA
92CD 48          H    PHA
92CE A5 B6       ¥¶   LDA &B6
92D0 48          H    PHA
92D1 A5 B7       ¥·   LDA &B7
92D3 48          H    PHA
92D4 BA          º    TSX
92D5 BD 04 01    ½..  LDA &0104,X
92D8 20 3C A0     <   JSR &A03C
92DB 68          h    PLA
92DC 85 B7       .·   STA &B7
92DE 68          h    PLA
92DF 85 B6       .¶   STA &B6
92E1 68          h    PLA
92E2 AA          ª    TAX
92E3 68          h    PLA
92E4 60          `    RTS

Print filename, access, cycle number
====================================
92E5 A2 0A       ¢.   LDX #&0A
92E7 20 8F 92     ..  JSR &928F
92EA 20 36 A0     6   JSR &A036
92ED A0 04        .   LDY #&04		Point to access bits
92EF A2 03       ¢.   LDX #&03		Allow three characters padding
92F1 B1 B6       ±¶   LDA (&B6),Y	Get access bit
92F3 2A          *    ROL A
92F4 90 07       ..   BCC &92FD		Not set, step to next one
92F6 B9 1D 93    ¹..  LDA &931D,Y	Get access character
92F9 20 3C A0     <   JSR &A03C		Print it
92FC CA          Ê    DEX		Dec. padding needed

92FD 88          .    DEY		Step to next access bit
92FE 10 F1       .ñ   BPL &92F1		Loop until <0
9300 CA          Ê    DEX		Dec. padding needed
9301 30 06       0.   BMI &9309		All done
9303 20 36 A0     6   JSR &A036		Print a space
9306 4C 00 93    L..  JMP &9300		Loop to print padding

9309 A9 28       ©(   LDA #&28
930B 20 3C A0     <   JSR &A03C		Print '('
930E A0 19        .   LDY #&19
9310 B1 B6       ±¶   LDA (&B6),Y	Get cycle number
9312 20 22 93     ".  JSR &9322		Print it
9315 A9 29       ©)   LDA #&29
9317 20 3C A0     <   JSR &A03C		Print ')'
931A 4C 36 A0    L6   JMP &A036		Finish with a space

Access bits
===========
931D 52 57       RW   EOR (&57)
931F 4C 44 45    LDE  JMP &4544

9322 48          H    PHA
9323 4A          J    LSR A
9324 4A          J    LSR A
9325 4A          J    LSR A
9326 4A          J    LSR A
9327 20 2B 93     +.  JSR &932B
932A 68          h    PLA
932B 20 62 84     b.  JSR &8462
932E 4C 3C A0    L<   JMP &A03C

9331 20 14 A7     .§  JSR &A714
9334 A9 D9       ©Ù   LDA #&D9
9336 85 B6       .¶   STA &B6
9338 A9 C8       ©È   LDA #&C8
933A 85 B7       .·   STA &B7
933C A2 13       ¢.   LDX #&13
933E 20 8F 92     ..  JSR &928F
9341 20 A8 92     ¨.  JSR &92A8
9344 20 A8 AD     ¨­  JSR &ADA8
9347 FA          ú    PLX
9348 C8          È    INY
9349 20 22 93     ".  JSR &9322
934C 20 A8 92     ¨.  JSR &92A8
934F 29 0D       ).   AND #&0D
9351 44          D    EQUB &44
9352 72 69       ri   ADC (&69)
9354 76 65       ve   ROR &65,X
9356 BA          º    TSX
9357 AD 17 C3    ­.Ã  LDA &C317
935A 0A          .    ASL A
935B 2A          *    ROL A
935C 2A          *    ROL A
935D 2A          *    ROL A
935E 69 30       i0   ADC #&30
9360 20 3C A0     <   JSR &A03C
9363 A9 68       ©h   LDA #&68
9365 85 B6       .¶   STA &B6
9367 A9 9A       ©.   LDA #&9A
9369 85 B7       .·   STA &B7
936B A2 0D       ¢.   LDX #&0D
936D 20 8F 92     ..  JSR &928F
9370 20 A8 92     ¨.  JSR &92A8
9373 4F 70 74    Opt  BBR 4,&70,&93EA
9376 69 6F       io   ADC #&6F
9378 6E A0 AD    n ­  ROR &ADA0
937B FD C1 20    ýÁ   SBC &20C1,X
937E 22          "    EQUB &22
937F 93          .    EQUB &93
9380 20 A8 92     ¨.  JSR &92A8
9383 20 A8 AE     ¨®  JSR &AEA8
9386 FD C1 BD    ýÁ½  SBC &BDC1,X
9389 26 94       &.   ROL &94
938B 85 B6       .¶   STA &B6
938D A9 94       ©.   LDA #&94
938F 85 B7       .·   STA &B7
9391 A2 04       ¢.   LDX #&04
9393 20 8F 92     ..  JSR &928F
9396 20 A8 92     ¨.  JSR &92A8
9399 29 0D       ).   AND #&0D
939B 44          D    EQUB &44
939C 69 72       ir   ADC #&72
939E 2E A0 A9    . ©  ROL &A9A0
93A1 00          .    BRK
93A2 85 B6       .¶   STA &B6
93A4 A9 C3       ©Ã   LDA #&C3
93A6 85 B7       .·   STA &B7
93A8 A2 0A       ¢.   LDX #&0A
93AA 20 8F 92     ..  JSR &928F
93AD 20 A8 92     ¨.  JSR &92A8
93B0 20 20 20         JSR &2020
93B3 20 20 4C      L  JSR &4C20
93B6 69 62       ib   ADC #&62
93B8 2E A0 A9    . ©  ROL &A9A0
93BB 0A          .    ASL A
93BC 85 B6       .¶   STA &B6
93BE A9 C3       ©Ã   LDA #&C3
93C0 85 B7       .·   STA &B7
93C2 A2 0A       ¢.   LDX #&0A
93C4 20 8F 92     ..  JSR &928F
93C7 20 A8 92     ¨.  JSR &92A8
93CA 0D 8D A9    ..©  ORA &A98D
93CD 05 85       ..   ORA &85
93CF B6 A9       ¶©   LDX &A9,X
93D1 C4 85       Ä.   CPY &85
93D3 B7 60       ·`   LDY &60,X

FSC 5 - *CAT
============
93D5 20 0D A5     .¥  JSR &A50D
93D8 20 78 94     x.  JSR &9478
93DB 20 31 93     1.  JSR &9331
93DE A9 04       ©.   LDA #&04
93E0 8D 2B C2    .+Â  STA &C22B
93E3 A0 00        .   LDY #&00
93E5 B1 B6       ±¶   LDA (&B6),Y
93E7 F0 23       ð#   BEQ &940C
93E9 20 E5 92     å.  JSR &92E5
93EC CE 2B C2    Î+Â  DEC &C22B
93EF D0 0B       Ð.   BNE &93FC
93F1 A9 04       ©.   LDA #&04
93F3 8D 2B C2    .+Â  STA &C22B
93F6 20 3A A0     :   JSR &A03A
93F9 4C FF 93    L..  JMP &93FF

93FC 20 36 A0     6   JSR &A036
93FF 18          .    CLC
9400 A5 B6       ¥¶   LDA &B6
9402 69 1A       i.   ADC #&1A
9404 85 B6       .¶   STA &B6
9406 90 DB       .Û   BCC &93E3
9408 E6 B7       æ·   INC &B7
940A B0 D7       °×   BCS &93E3
940C AD 2B C2    ­+Â  LDA &C22B
940F C9 04       É.   CMP #&04
9411 F0 10       ð.   BEQ &9423
9413 A9 86       ©.   LDA #&86
9415 20 F4 FF     ô.  JSR &FFF4
9418 8A          .    TXA
9419 D0 05       Ð.   BNE &9420
941B A9 0B       ©.   LDA #&0B
941D 20 3C A0     <   JSR &A03C
9420 20 3A A0     :   JSR &A03A
9423 4C D8 89    LØ.  JMP &89D8

9426 2A          *    ROL A
9427 2E 32 36    .26  ROL &3632
942A 4F 66 66    Off  BBR 4,&66,&9493
942D 20 4C 6F     Lo  JSR &6F4C
9430 61 64       ad   ADC (&64,X)
9432 52 75       Ru   EOR (&75)
9434 6E 20 45    n E  ROR &4520
9437 78          x    SEI
9438 65 63       ec   ADC &63

FSC 9 - *EX
=============
943A 20 78 94     x.  JSR &9478
943D 20 31 93     1.  JSR &9331
9440 A0 00        .   LDY #&00
9442 B1 B6       ±¶   LDA (&B6),Y
9444 F0 DD       ðÝ   BEQ &9423
9446 20 08 95     ..  JSR &9508
9449 18          .    CLC
944A A5 B6       ¥¶   LDA &B6
944C 69 1A       i.   ADC #&1A
944E 85 B6       .¶   STA &B6
9450 90 EE       .î   BCC &9440
9452 E6 B7       æ·   INC &B7
9454 80 EA       .ê   BRA &9440

9456 A0 00        .   LDY #&00
9458 B1 B4       ±´   LDA (&B4),Y
945A 29 7F       ).   AND #&7F
945C C9 5E       É^   CMP #&5E
945E D0 0A       Ð.   BNE &946A
9460 A9 C0       ©À   LDA #&C0
9462 85 B6       .¶   STA &B6
9464 A9 C8       ©È   LDA #&C8
9466 85 B7       .·   STA &B7
9468 D0 0C       Ð.   BNE &9476
946A C9 40       É@   CMP #&40
946C D0 09       Ð.   BNE &9477
946E A9 FE       ©þ   LDA #&FE
9470 85 B6       .¶   STA &B6
9472 A9 C2       ©Â   LDA #&C2
9474 85 B7       .·   STA &B7
9476 98          .    TYA
9477 60          `    RTS

9478 A0 00        .   LDY #&00
947A B1 B4       ±´   LDA (&B4),Y
947C C9 21       É!   CMP #&21
947E B0 06       °.   BCS &9486
9480 AE 17 C3    ®.Ã  LDX &C317
9483 E8          è    INX
9484 D0 F1       Ðñ   BNE &9477
9486 20 75 88     u.  JSR &8875
9489 D0 0E       Ð.   BNE &9499
948B A0 03        .   LDY #&03
948D B1 B6       ±¶   LDA (&B6),Y
948F 30 0D       0.   BMI &949E
9491 20 64 89     d.  JSR &8964
9494 F0 F5       ðõ   BEQ &948B
9496 4C E2 8B    Lâ.  JMP &8BE2

9499 20 56 94     V.  JSR &9456
949C D0 F8       Ðø   BNE &9496
949E AC 2E C2    ¬.Â  LDY &C22E
94A1 C8          È    INY
94A2 D0 0B       Ð.   BNE &94AF
94A4 A0 02        .   LDY #&02
94A6 B9 14 C3    ¹.Ã  LDA &C314,Y
94A9 99 2C C2    .,Â  STA &C22C,Y
94AC 88          .    DEY
94AD 10 F7       .÷   BPL &94A6
94AF A2 0A       ¢.   LDX #&0A
94B1 BD 3C 88    ½<.  LDA &883C,X
94B4 9D 15 C2    ..Â  STA &C215,X
94B7 CA          Ê    DEX
94B8 10 F7       .÷   BPL &94B1
94BA A2 02       ¢.   LDX #&02
94BC A0 16        .   LDY #&16
94BE B1 B6       ±¶   LDA (&B6),Y
94C0 9D 1B C2    ..Â  STA &C21B,X
94C3 99 FE C2    .þÂ  STA &C2FE,Y
94C6 C8          È    INY
94C7 CA          Ê    DEX
94C8 10 F4       .ô   BPL &94BE
94CA A5 B7       ¥·   LDA &B7
94CC C9 94       É.   CMP #&94
94CE F0 37       ð7   BEQ &9507
94D0 4C AA 82    Lª.  JMP &82AA

Fake entry for '$'
==================
94D3 A4 0D       ¤.   LDY &0D
94D5 8D 8D 0D    ...  STA &0D8D
94D8 0D 0D 0D    ...  ORA &0D0D
94DB 0D 0D 00    ...  ORA &000D
94DE 00          .    BRK
94DF 00          .    BRK
94E0 00          .    BRK
94E1 00          .    BRK
94E2 00          .    BRK
94E3 00          .    BRK
94E4 00          .    BRK
94E5 00          .    BRK
94E6 05 00       ..   ORA &00
94E8 00          .    BRK
94E9 02          .    EQUB &02
94EA 00          .    BRK
94EB 00          .    BRK
94EC 00          .    BRK
94ED 00          .    BRK

FSC 10 - *INFO
==============
94EE 20 E8 8F     è.  JSR &8FE8		Search for object
94F1 F0 03       ð.   BEQ &94F6
94F3 4C D3 8B    LÓ.  JMP &8BD3		Error 'File not found' or 'Bad name'

94F6 20 08 95     ..  JSR &9508		Call ...
94F9 20 64 89     d.  JSR &8964
94FC F0 F8       ðø   BEQ &94F6
94FE 4C D8 89    LØ.  JMP &89D8

9501 A5 CD       ¥Í   LDA &CD
9503 29 04       ).   AND #&04
9505 D0 01       Ð.   BNE &9508
9507 60          `    RTS

9508 20 E5 92     å.  JSR &92E5		Print filename
950B 20 3C A0     <   JSR &A03C		Print another space
950E A0 04        .   LDY #&04
9510 B1 B6       ±¶   LDA (&B6),Y	Get 'E' bit
9512 30 2F       0/   BMI &9543		If 'E' set, jump to finish	NOP:NOP
9514 88          .    DEY
9515 B1 B6       ±¶   LDA (&B6),Y	Get 'D' bit
9517 2A          *    ROL A		Rotate into Carry
9518 A2 0A       ¢.   LDX #&0A		X=10, Y-13 if file
951A A0 0D        .   LDY #&0D
951C 90 04       ..   BCC &9522		Jump if file			BRA &9522
951E A2 17       ¢.   LDX #&17		X=23, Y=24 if directory
9520 A0 18        .   LDY #&18		Just print sector start

9522 E0 16       à.   CPX #&16
9524 F0 05       ð.   BEQ &952B
9526 B1 B6       ±¶   LDA (&B6),Y
9528 20 22 93     ".  JSR &9322
952B 8A          .    TXA
952C 29 03       ).   AND #&03
952E C9 01       É.   CMP #&01
9530 D0 0B       Ð.   BNE &953D
9532 20 36 A0     6   JSR &A036		Print a space
9535 20 36 A0     6   JSR &A036		Print a space
9538 8A          .    TXA
9539 18          .    CLC
953A 69 05       i.   ADC #&05
953C A8          ¨    TAY
953D 88          .    DEY
953E E8          è    INX
953F E0 1A       à.   CPX #&1A
9541 D0 DF       Ðß   BNE &9522
9543 4C 3A A0    L:   JMP &A03A		Print newline

9546 20 86 94     ..  JSR &9486
9549 A0 09        .   LDY #&09
954B B9 CC C8    ¹ÌÈ  LDA &C8CC,Y
954E 99 00 C3    ..Ã  STA &C300,Y
9551 88          .    DEY
9552 10 F7       .÷   BPL &954B
9554 AD 2F C2    ­/Â  LDA &C22F
9557 C9 FF       É.   CMP #&FF
9559 D0 03       Ð.   BNE &955E
955B AD 17 C3    ­.Ã  LDA &C317
955E 8D 1F C3    ..Ã  STA &C31F
9561 A0 02        .   LDY #&02
9563 B9 2C C2    ¹,Â  LDA &C22C,Y
9566 99 1C C3    ..Ã  STA &C31C,Y
9569 88          .    DEY
956A 10 F7       .÷   BPL &9563
956C A9 FF       ©.   LDA #&FF
956E 8D 2E C2    ..Â  STA &C22E
9571 8D 2F C2    ./Â  STA &C22F
9574 4C D8 89    LØ.  JMP &89D8

9577 A9 FF       ©.   LDA #&FF
9579 A0 00        .   LDY #&00
957B 20 7A A9     z©  JSR &A97A
957E A2 0F       ¢.   LDX #&0F
9580 BD 39 96    ½9.  LDA &9639,X
9583 9D 42 C2    .BÂ  STA &C242,X
9586 CA          Ê    DEX
9587 10 F7       .÷   BPL &9580
9589 A5 B4       ¥´   LDA &B4
958B 8D 40 C2    .@Â  STA &C240
958E A5 B5       ¥µ   LDA &B5
9590 8D 41 C2    .AÂ  STA &C241
9593 A9 40       ©@   LDA #&40
9595 85 B8       .¸   STA &B8
9597 A9 C2       ©Â   LDA #&C2
9599 85 B9       .¹   STA &B9
959B 20 FE 8D     þ.  JSR &8DFE
959E A0 09        .   LDY #&09
95A0 AD 37 C2    ­7Â  LDA &C237
95A3 0D 38 C2    .8Â  ORA &C238
95A6 0D 39 C2    .9Â  ORA &C239
95A9 F0 13       ð.   BEQ &95BE
95AB 20 6B 83     k.  JSR &836B
95AE C4 41       ÄA   CPY &41
95B0 6C 72 65    lre  JMP (&6572)

95B3 61 64       ad   ADC (&64,X)
95B5 79 20 65    y e  ADC &6520,Y
95B8 78          x    SEI
95B9 69 73       is   ADC #&73
95BB 74 73       ts   STZ &73,X
95BD 00          .    BRK
95BE B1 B4       ±´   LDA (&B4),Y
95C0 29 7F       ).   AND #&7F
95C2 C9 22       É"   CMP #&22
95C4 F0 04       ð.   BEQ &95CA
95C6 C9 21       É!   CMP #&21
95C8 B0 02       °.   BCS &95CC
95CA A9 0D       ©.   LDA #&0D
95CC 91 B6       .¶   STA (&B6),Y
95CE 88          .    DEY
95CF 10 ED       .í   BPL &95BE
95D1 20 5D 8F     ].  JSR &8F5D
95D4 A0 03        .   LDY #&03
95D6 B1 B6       ±¶   LDA (&B6),Y
95D8 09 80       ..   ORA #&80
95DA 91 B6       .¶   STA (&B6),Y
95DC 88          .    DEY
95DD C0 01       À.   CPY #&01
95DF D0 F5       Ðõ   BNE &95D6
95E1 88          .    DEY
95E2 B1 B6       ±¶   LDA (&B6),Y
95E4 09 80       ..   ORA #&80
95E6 91 B6       .¶   STA (&B6),Y
95E8 A9 00       ©.   LDA #&00
95EA AA          ª    TAX
95EB A8          ¨    TAY
95EC 9D 00 CA    ..Ê  STA &CA00,X
95EF 9D 00 C9    ..É  STA &C900,X
95F2 9D 00 CB    ..Ë  STA &CB00,X
95F5 9D 00 CC    ..Ì  STA &CC00,X
95F8 9D 00 CD    ..Í  STA &CD00,X
95FB E8          è    INX
95FC D0 EE       Ðî   BNE &95EC
95FE A2 04       ¢.   LDX #&04
9600 BD DC 84    ½Ü.  LDA &84DC,X
9603 9D 00 C9    ..É  STA &C900,X
9606 9D FA CD    .úÍ  STA &CDFA,X
9609 BD 14 C3    ½.Ã  LDA &C314,X
960C 9D D6 CD    .ÖÍ  STA &CDD6,X
960F CA          Ê    DEX
9610 10 EE       .î   BPL &9600
9612 A2 00       ¢.   LDX #&00
9614 B1 B4       ±´   LDA (&B4),Y
9616 29 7F       ).   AND #&7F
9618 C9 22       É"   CMP #&22
961A F0 04       ð.   BEQ &9620
961C C9 21       É!   CMP #&21
961E B0 02       °.   BCS &9622
9620 A9 0D       ©.   LDA #&0D
9622 9D D9 CD    .ÙÍ  STA &CDD9,X
9625 9D CC CD    .ÌÍ  STA &CDCC,X
9628 C8          È    INY
9629 E8          è    INX
962A E0 0A       à.   CPX #&0A
962C D0 E6       Ðæ   BNE &9614
962E A9 0D       ©.   LDA #&0D
9630 9D D9 CD    .ÙÍ  STA &CDD9,X
9633 20 42 8A     B.  JSR &8A42
9636 4C 8B 8F    L..  JMP &8F8B

9639 00          .    BRK
963A 00          .    BRK
963B 00          .    BRK
963C 00          .    BRK
963D 00          .    BRK
963E 00          .    BRK
963F 00          .    BRK
9640 00          .    BRK
9641 00          .    BRK
9642 C9 FF       É.   CMP #&FF
9644 FF 00 CE    ..Î  BBS 7,&00,&9615
9647 FF FF AD    ..­  BBS 7,&FF,&95F7
964A 2F C2 CD    /ÂÍ  BBR 2,&C2,&961A
964D 17 C3       .Ã   TRB &C3
964F F0 03       ð.   BEQ &9654
9651 1A          .    INC A
9652 D0 18       Ð.   BNE &966C
9654 A0 02        .   LDY #&02
9656 B9 A2 C2    ¹¢Â  LDA &C2A2,Y
9659 D9 2C C2    Ù,Â  CMP &C22C,Y
965C D0 0E       Ð.   BNE &966C
965E 88          .    DEY
965F 10 F5       .õ   BPL &9656
9661 A0 02        .   LDY #&02
9663 B9 A8 C2    ¹¨Â  LDA &C2A8,Y
9666 99 2C C2    .,Â  STA &C22C,Y
9669 88          .    DEY
966A 10 F7       .÷   BPL &9663
966C AD 1B C3    ­.Ã  LDA &C31B
966F CD 17 C3    Í.Ã  CMP &C317
9672 D0 18       Ð.   BNE &968C
9674 A0 02        .   LDY #&02
9676 B9 A2 C2    ¹¢Â  LDA &C2A2,Y
9679 D9 18 C3    Ù.Ã  CMP &C318,Y
967C D0 0E       Ð.   BNE &968C
967E 88          .    DEY
967F 10 F5       .õ   BPL &9676
9681 A0 02        .   LDY #&02
9683 B9 A8 C2    ¹¨Â  LDA &C2A8,Y
9686 99 18 C3    ..Ã  STA &C318,Y
9689 88          .    DEY
968A 10 F7       .÷   BPL &9683
968C AD 1F C3    ­.Ã  LDA &C31F
968F CD 17 C3    Í.Ã  CMP &C317
9692 D0 18       Ð.   BNE &96AC
9694 A0 02        .   LDY #&02
9696 B9 A2 C2    ¹¢Â  LDA &C2A2,Y
9699 D9 1C C3    Ù.Ã  CMP &C31C,Y
969C D0 0E       Ð.   BNE &96AC
969E 88          .    DEY
969F 10 F5       .õ   BPL &9696
96A1 A0 02        .   LDY #&02
96A3 B9 A8 C2    ¹¨Â  LDA &C2A8,Y
96A6 99 1C C3    ..Ã  STA &C31C,Y
96A9 88          .    DEY
96AA 10 F7       .÷   BPL &96A3
96AC A5 CD       ¥Í   LDA &CD
96AE 29 08       ).   AND #&08
96B0 D0 06       Ð.   BNE &96B8
96B2 20 91 8F     ..  JSR &8F91
96B5 20 92 A9     .©  JSR &A992
96B8 AD A7 C2    ­§Â  LDA &C2A7
96BB 0D A6 C2    .¦Â  ORA &C2A6
96BE 0D A5 C2    .¥Â  ORA &C2A5
96C1 D0 01       Ð.   BNE &96C4
96C3 60          `    RTS

96C4 AD A7 C2    ­§Â  LDA &C2A7
96C7 0D A6 C2    .¦Â  ORA &C2A6
96CA D0 08       Ð.   BNE &96D4
96CC AD A5 C2    ­¥Â  LDA &C2A5
96CF CD 61 C2    ÍaÂ  CMP &C261
96D2 90 03       ..   BCC &96D7
96D4 AD 61 C2    ­aÂ  LDA &C261
96D7 8D 1E C2    ..Â  STA &C21E
96DA AD 60 C2    ­`Â  LDA &C260
96DD 8D 17 C2    ..Â  STA &C217
96E0 A2 00       ¢.   LDX #&00
96E2 8E 16 C2    ..Â  STX &C216
96E5 CA          Ê    DEX
96E6 8E 18 C2    ..Â  STX &C218
96E9 8E 19 C2    ..Â  STX &C219
96EC 38          8    SEC
96ED AD A5 C2    ­¥Â  LDA &C2A5
96F0 ED 61 C2    íaÂ  SBC &C261
96F3 8D A5 C2    .¥Â  STA &C2A5
96F6 AD A6 C2    ­¦Â  LDA &C2A6
96F9 E9 00       é.   SBC #&00
96FB 8D A6 C2    .¦Â  STA &C2A6
96FE AD A7 C2    ­§Â  LDA &C2A7
9701 E9 00       é.   SBC #&00
9703 8D A7 C2    .§Â  STA &C2A7
9706 B0 09       °.   BCS &9711
9708 AD A5 C2    ­¥Â  LDA &C2A5
970B 6D 61 C2    maÂ  ADC &C261
970E 8D 1E C2    ..Â  STA &C21E
9711 A9 08       ©.   LDA #&08
9713 8D 1A C2    ..Â  STA &C21A
9716 AD A2 C2    ­¢Â  LDA &C2A2
9719 8D 1D C2    ..Â  STA &C21D
971C AD A3 C2    ­£Â  LDA &C2A3
971F 8D 1C C2    ..Â  STA &C21C
9722 AD A4 C2    ­¤Â  LDA &C2A4
9725 8D 1B C2    ..Â  STA &C21B
9728 20 AA 82     ª.  JSR &82AA
972B A9 0A       ©.   LDA #&0A
972D 8D 1A C2    ..Â  STA &C21A
9730 AD A8 C2    ­¨Â  LDA &C2A8
9733 8D 1D C2    ..Â  STA &C21D
9736 AD A9 C2    ­©Â  LDA &C2A9
9739 8D 1C C2    ..Â  STA &C21C
973C AD AA C2    ­ªÂ  LDA &C2AA
973F 8D 1B C2    ..Â  STA &C21B
9742 20 AA 82     ª.  JSR &82AA
9745 AD A5 C2    ­¥Â  LDA &C2A5
9748 0D A6 C2    .¦Â  ORA &C2A6
974B 0D A7 C2    .§Â  ORA &C2A7
974E F0 33       ð3   BEQ &9783
9750 AD 1E C2    ­.Â  LDA &C21E
9753 CD 61 C2    ÍaÂ  CMP &C261
9756 D0 2B       Ð+   BNE &9783
9758 18          .    CLC
9759 AD A2 C2    ­¢Â  LDA &C2A2
975C 6D 61 C2    maÂ  ADC &C261
975F 8D A2 C2    .¢Â  STA &C2A2
9762 90 08       ..   BCC &976C
9764 EE A3 C2    î£Â  INC &C2A3
9767 D0 03       Ð.   BNE &976C
9769 EE A4 C2    î¤Â  INC &C2A4
976C 18          .    CLC
976D AD A8 C2    ­¨Â  LDA &C2A8
9770 6D 61 C2    maÂ  ADC &C261
9773 8D A8 C2    .¨Â  STA &C2A8
9776 90 08       ..   BCC &9780
9778 EE A9 C2    î©Â  INC &C2A9
977B D0 03       Ð.   BNE &9780
977D EE AA C2    îªÂ  INC &C2AA
9780 4C EC 96    Lì.  JMP &96EC

9783 A5 CD       ¥Í   LDA &CD
9785 29 08       ).   AND #&08
9787 F0 01       ð.   BEQ &978A
9789 60          `    RTS

978A A9 C4       ©Ä   LDA #&C4
978C 8D 17 C2    ..Â  STA &C217
978F A9 08       ©.   LDA #&08
9791 8D 1A C2    ..Â  STA &C21A
9794 AD 14 C3    ­.Ã  LDA &C314
9797 8D 1D C2    ..Â  STA &C21D
979A AD 15 C3    ­.Ã  LDA &C315
979D 8D 1C C2    ..Â  STA &C21C
97A0 AD 16 C3    ­.Ã  LDA &C316
97A3 8D 1B C2    ..Â  STA &C21B
97A6 A9 05       ©.   LDA #&05
97A8 8D 1E C2    ..Â  STA &C21E
97AB 4C AE 82    L®.  JMP &82AE

97AE A9 00       ©.   LDA #&00
97B0 8D AB C2    .«Â  STA &C2AB
97B3 8D AC C2    .¬Â  STA &C2AC
97B6 8D AD C2    .­Â  STA &C2AD
97B9 A9 FF       ©.   LDA #&FF
97BB 8D A2 C2    .¢Â  STA &C2A2
97BE 8D A3 C2    .£Â  STA &C2A3
97C1 8D A4 C2    .¤Â  STA &C2A4
97C4 20 CC 93     Ì.  JSR &93CC
97C7 A0 00        .   LDY #&00
97C9 B1 B6       ±¶   LDA (&B6),Y
97CB D0 0F       Ð.   BNE &97DC
97CD AD A2 C2    ­¢Â  LDA &C2A2
97D0 2D A3 C2    -£Â  AND &C2A3
97D3 2D A4 C2    -¤Â  AND &C2A4
97D6 1A          .    INC A
97D7 D0 45       ÐE   BNE &981E
97D9 4C 91 8F    L..  JMP &8F91

97DC A0 16        .   LDY #&16
97DE A2 02       ¢.   LDX #&02
97E0 38          8    SEC
97E1 B9 95 C2    ¹.Â  LDA &C295,Y
97E4 F1 B6       ñ¶   SBC (&B6),Y
97E6 C8          È    INY
97E7 CA          Ê    DEX
97E8 10 F7       .÷   BPL &97E1
97EA B0 25       °%   BCS &9811
97EC A0 16        .   LDY #&16
97EE A2 02       ¢.   LDX #&02
97F0 38          8    SEC
97F1 B9 8C C2    ¹.Â  LDA &C28C,Y
97F4 F1 B6       ñ¶   SBC (&B6),Y
97F6 C8          È    INY
97F7 CA          Ê    DEX
97F8 10 F7       .÷   BPL &97F1
97FA 90 15       ..   BCC &9811
97FC A0 16        .   LDY #&16
97FE A2 02       ¢.   LDX #&02
9800 B1 B6       ±¶   LDA (&B6),Y
9802 99 8C C2    ..Â  STA &C28C,Y
9805 C8          È    INY
9806 CA          Ê    DEX
9807 10 F7       .÷   BPL &9800
9809 A5 B6       ¥¶   LDA &B6
980B 85 B4       .´   STA &B4
980D A5 B7       ¥·   LDA &B7
980F 85 B5       .µ   STA &B5
9811 A5 B6       ¥¶   LDA &B6
9813 18          .    CLC
9814 69 1A       i.   ADC #&1A
9816 85 B6       .¶   STA &B6
9818 90 AD       .­   BCC &97C7
981A E6 B7       æ·   INC &B7
981C B0 A9       °©   BCS &97C7
981E A5 B4       ¥´   LDA &B4
9820 85 B6       .¶   STA &B6
9822 A5 B5       ¥µ   LDA &B5
9824 85 B7       .·   STA &B7
9826 A0 02        .   LDY #&02
9828 B9 A2 C2    ¹¢Â  LDA &C2A2,Y
982B 99 AB C2    .«Â  STA &C2AB,Y
982E 88          .    DEY
982F 10 F7       .÷   BPL &9828
9831 A2 00       ¢.   LDX #&00
9833 86 B2       .²   STX &B2
9835 EC FE C1    ìþÁ  CPX &C1FE
9838 90 03       ..   BCC &983D
983A 4C B9 97    L¹.  JMP &97B9

983D E8          è    INX
983E E8          è    INX
983F E8          è    INX
9840 86 B2       .²   STX &B2
9842 A0 02        .   LDY #&02
9844 CA          Ê    DEX
9845 BD 00 C0    ½.À  LDA &C000,X
9848 D9 A2 C2    Ù¢Â  CMP &C2A2,Y
984B B0 04       °.   BCS &9851
984D A6 B2       ¦²   LDX &B2
984F 80 E4       .ä   BRA &9835

9851 D0 03       Ð.   BNE &9856
9853 88          .    DEY
9854 10 EE       .î   BPL &9844
9856 A6 B2       ¦²   LDX &B2
9858 E0 06       à.   CPX #&06
985A 90 12       ..   BCC &986E
985C A0 00        .   LDY #&00
985E 18          .    CLC
985F 08          .    PHP
9860 28          (    PLP
9861 BD FA BF    ½ú¿  LDA &BFFA,X
9864 7D FA C0    }úÀ  ADC &C0FA,X
9867 08          .    PHP
9868 D9 A2 C2    Ù¢Â  CMP &C2A2,Y
986B F0 04       ð.   BEQ &9871
986D 28          (    PLP
986E 4C B9 97    L¹.  JMP &97B9

9871 E8          è    INX
9872 C8          È    INY
9873 C0 03       À.   CPY #&03
9875 D0 E9       Ðé   BNE &9860
9877 28          (    PLP
9878 A2 02       ¢.   LDX #&02
987A A0 12        .   LDY #&12
987C B1 B6       ±¶   LDA (&B6),Y
987E C9 01       É.   CMP #&01
9880 C8          È    INY
9881 B1 B6       ±¶   LDA (&B6),Y
9883 69 00       i.   ADC #&00
9885 99 92 C2    ..Â  STA &C292,Y
9888 99 2A C2    .*Â  STA &C22A,Y
988B 99 24 C2    .$Â  STA &C224,Y
988E BD A2 C2    ½¢Â  LDA &C2A2,X
9891 9D 34 C2    .4Â  STA &C234,X
9894 CA          Ê    DEX
9895 10 E9       .é   BPL &9880
9897 20 E1 84     á.  JSR &84E1
989A 20 5B 86     [.  JSR &865B
989D A2 02       ¢.   LDX #&02
989F A0 18        .   LDY #&18
98A1 BD 3A C2    ½:Â  LDA &C23A,X
98A4 91 B6       .¶   STA (&B6),Y
98A6 9D A8 C2    .¨Â  STA &C2A8,X
98A9 88          .    DEY
98AA CA          Ê    DEX
98AB 10 F4       .ô   BPL &98A1
98AD 20 49 96     I.  JSR &9649
98B0 4C AE 97    L®.  JMP &97AE

98B3 A9 00       ©.   LDA #&00
98B5 85 C0       .À   STA &C0
98B7 8D 53 C2    .SÂ  STA &C253
98BA 8D 54 C2    .TÂ  STA &C254
98BD A9 02       ©.   LDA #&02
98BF 8D 52 C2    .RÂ  STA &C252
98C2 A9 CD       ©Í   LDA #&CD
98C4 85 C1       .Á   STA &C1
98C6 A9 41       ©A   LDA #&41
98C8 85 B4       .´   STA &B4
98CA A9 99       ©.   LDA #&99
98CC 85 B5       .µ   STA &B5
98CE 20 86 94     ..  JSR &9486
98D1 A0 02        .   LDY #&02
98D3 B9 52 C2    ¹RÂ  LDA &C252,Y
98D6 99 D6 C8    .ÖÈ  STA &C8D6,Y
98D9 88          .    DEY
98DA 10 F7       .÷   BPL &98D3
98DC 20 AE 97     ®.  JSR &97AE
98DF 20 CC 93     Ì.  JSR &93CC
98E2 A0 00        .   LDY #&00
98E4 B1 B6       ±¶   LDA (&B6),Y
98E6 F0 2B       ð+   BEQ &9913
98E8 A0 03        .   LDY #&03
98EA B1 B6       ±¶   LDA (&B6),Y
98EC 10 42       .B   BPL &9930
98EE A5 C0       ¥À   LDA &C0
98F0 C9 FE       Éþ   CMP #&FE
98F2 F0 1F       ð.   BEQ &9913
98F4 A0 00        .   LDY #&00
98F6 A5 B6       ¥¶   LDA &B6
98F8 85 B4       .´   STA &B4
98FA 91 C0       .À   STA (&C0),Y
98FC E6 C0       æÀ   INC &C0
98FE A5 B7       ¥·   LDA &B7
9900 85 B5       .µ   STA &B5
9902 91 C0       .À   STA (&C0),Y
9904 E6 C0       æÀ   INC &C0
9906 A2 02       ¢.   LDX #&02
9908 BD 14 C3    ½.Ã  LDA &C314,X
990B 9D 52 C2    .RÂ  STA &C252,X
990E CA          Ê    DEX
990F 10 F7       .÷   BPL &9908
9911 30 BB       0»   BMI &98CE
9913 A5 C0       ¥À   LDA &C0
9915 F0 26       ð&   BEQ &993D
9917 A9 40       ©@   LDA #&40
9919 85 B4       .´   STA &B4
991B A9 99       ©.   LDA #&99
991D 85 B5       .µ   STA &B5
991F 20 86 94     ..  JSR &9486
9922 A0 00        .   LDY #&00
9924 C6 C0       ÆÀ   DEC &C0
9926 B1 C0       ±À   LDA (&C0),Y
9928 85 B7       .·   STA &B7
992A C6 C0       ÆÀ   DEC &C0
992C B1 C0       ±À   LDA (&C0),Y
992E 85 B6       .¶   STA &B6
9930 18          .    CLC
9931 A5 B6       ¥¶   LDA &B6
9933 69 1A       i.   ADC #&1A
9935 85 B6       .¶   STA &B6
9937 90 A9       .©   BCC &98E2
9939 E6 B7       æ·   INC &B7
993B 80 A5       .¥   BRA &98E2

993D 4C D8 89    LØ.  JMP &89D8

9940 5E 0D       ^.   EQUS "^"+CHR$13

9940 5E 0D 20    ^.   LSR &200D,X

*ACCESS
=======
9942 20 E8 8F     è.  JSR &8FE8		Search for object
9945 F0 0F       ð.   BEQ &9956		Jump forward if found
9947 4C D3 8B    LÓ.  JMP &8BD3		Jump to 'Not found'/'Bad name'

994A A0 02        .   LDY #&02		Clear existing LWR bits
994C B1 B6       ±¶   LDA (&B6),Y
994E 29 7F       ).   AND #&7F
9950 91 B6       .¶   STA (&B6),Y
9952 88          .    DEY
9953 10 F7       .÷   BPL &994C
9955 60          `    RTS

9956 20 4A 99     J.  JSR &994A		Clear existing LWR bits
9959 A0 04        .   LDY #&04
995B B1 B6       ±¶   LDA (&B6),Y	Get existing 'E' bit
995D 30 0B       0.   BMI &996A		Jump if 'E' file
995F 88          .    DEY
9960 B1 B6       ±¶   LDA (&B6),Y	Get 'D' bit
9962 29 80       ).   AND #&80
9964 A0 00        .   LDY #&00
9966 11 B6       .¶   ORA (&B6),Y	Copy 'D' bit into 'R' bit
9968 91 B6       .¶   STA (&B6),Y	Forces dirs to always have 'R'

996A 8D 2B C2    .+Â  STA &C22B		Store 'E' or 'D'+'R' bit
996D A0 00        .   LDY #&00		Step past filename
996F B1 B4       ±´   LDA (&B4),Y
9971 C9 20       É    CMP #&20
9973 90 4B       .K   BCC &99C0
9975 F0 07       ð.   BEQ &997E
9977 C9 22       É"   CMP #&22
9979 F0 03       ð.   BEQ &997E
997B C8          È    INY
997C D0 F1       Ðñ   BNE &996F
997E B1 B4       ±´   LDA (&B4),Y
9980 C9 20       É    CMP #&20
9982 90 3C       .<   BCC &99C0
9984 F0 04       ð.   BEQ &998A
9986 C9 22       É"   CMP #&22
9988 D0 03       Ð.   BNE &998D
998A C8          È    INY
998B D0 F1       Ðñ   BNE &997E

998D B1 B4       ±´   LDA (&B4),Y	Get access character
998F 29 DF       )ß   AND #&DF		Force to upper case
9991 2C 2B C2    ,+Â  BIT &C22B		Check 'E'/'D' flag
9994 30 14       0.   BMI &99AA		Jump past if already 'E' or 'D'
9996 C9 45       ÉE   CMP #&45
9998 D0 10       Ð.   BNE &99AA		Jump past if not setting 'E'
999A 20 4A 99     J.  JSR &994A		Clear all other bits
999D A0 04        .   LDY #&04
999F B1 B6       ±¶   LDA (&B6),Y
99A1 09 80       ..   ORA #&80
99A3 91 B6       .¶   STA (&B6),Y	Set 'E' bit
99A5 8D 2B C2    .+Â  STA &C22B		Set 'E'/'D' flag
99A8 30 13       0.   BMI &99BD

99AA A2 02       ¢.   LDX #&02		Check if access character
99AC DD 1D 93    Ý..  CMP &931D,X
99AF F0 1D       ð.   BEQ &99CE		Matching character
99B1 2C 2B C2    ,+Â  BIT &C22B
99B4 30 03       0.   BMI &99B9		If 'E'/'D' only check for setting 'L'
99B6 CA          Ê    DEX
99B7 10 F3       .ó   BPL &99AC		Otherwise check all access characters
99B9 C9 21       É!   CMP #&21
99BB 90 03       ..   BCC &99C0
99BD C8          È    INY
99BE D0 CD       ÐÍ   BNE &998D
99C0 20 01 95     ..  JSR &9501
99C3 20 64 89     d.  JSR &8964
99C6 F0 8E       ð.   BEQ &9956
99C8 20 91 8F     ..  JSR &8F91
99CB 4C D8 89    LØ.  JMP &89D8

99CE 5A          Z    PHY
99CF 8A          .    TXA
99D0 A8          ¨    TAY
99D1 B1 B6       ±¶   LDA (&B6),Y
99D3 09 80       ..   ORA #&80
99D5 91 B6       .¶   STA (&B6),Y
99D7 7A          z    PLY
99D8 80 E3       .ã   BRA &99BD

99DA 20 3A A0     :   JSR &A03A
99DD 20 6B 83     k.  JSR &836B
99E0 92 41       .A   STA (&41)
99E2 62          b    EQUB &62
99E3 6F 72 74    ort  BBR 6,&72,&9A5A
99E6 65 64       ed   ADC &64
99E8 00          .    BRK
99E9 A5 B4       ¥´   LDA &B4
99EB 48          H    PHA
99EC A5 B5       ¥µ   LDA &B5
99EE 48          H    PHA
99EF A9 40       ©@   LDA #&40
99F1 85 B8       .¸   STA &B8
99F3 A9 C2       ©Â   LDA #&C2
99F5 85 B9       .¹   STA &B9
99F7 20 EE 94     î.  JSR &94EE
99FA 68          h    PLA
99FB 85 B5       .µ   STA &B5
99FD 68          h    PLA
99FE 85 B4       .´   STA &B4
9A00 20 A8 92     ¨.  JSR &92A8
9A03 44          D    EQUB &44
9A04 65 73       es   ADC &73
9A06 74 72       tr   STZ &72,X
9A08 6F 79 20    oy   BBR 6,&79,&9A2B
9A0B 3F A0 A2    ? ¢  BBR 3,&A0,&99B0
9A0E 03          .    EQUB &03
9A0F 20 E0 FF     à.  JSR &FFE0
9A12 C9 20       É    CMP #&20
9A14 90 03       ..   BCC &9A19
9A16 20 3C A0     <   JSR &A03C
9A19 29 DF       )ß   AND #&DF
9A1B DD D8 84    ÝØ.  CMP &84D8,X
9A1E D0 BA       Ðº   BNE &99DA
9A20 CA          Ê    DEX
9A21 10 EC       .ì   BPL &9A0F
9A23 20 3A A0     :   JSR &A03A
9A26 9C D5 C2    .ÕÂ  STZ &C2D5
9A29 A5 B4       ¥´   LDA &B4
9A2B 48          H    PHA
9A2C A5 B5       ¥µ   LDA &B5
9A2E 48          H    PHA
9A2F 24 FF       $.   BIT &FF
9A31 10 03       ..   BPL &9A36
9A33 4C CC 82    LÌ.  JMP &82CC

9A36 20 E8 8F     è.  JSR &8FE8
9A39 D0 0C       Ð.   BNE &9A47
9A3B 20 31 91     1.  JSR &9131
9A3E 68          h    PLA
9A3F 85 B5       .µ   STA &B5
9A41 68          h    PLA
9A42 85 B4       .´   STA &B4
9A44 4C 29 9A    L).  JMP &9A29

9A47 68          h    PLA
9A48 68          h    PLA
9A49 4C D8 89    LØ.  JMP &89D8

9A4C 6C 1E 02    l..  JMP (&021E)


Default context
===============
9A4F 24 20       $    BIT &20		csd="$"
9A51 20 20 20         JSR &2020
9A54 20 20 20         JSR &2020
9A57 20 20 24      $  JSR &2420		lib="$"
9A5A 20 20 20         JSR &2020
9A5D 20 20 20         JSR &2020
9A60 20 20 20         JSR &2020
9A63 02          .    EQUB &02		csd=2
9A64 00          .    BRK
9A65 00          .    BRK
9A66 00          .    BRK
9A67 02          .    EQUB &02		lib=2
9A68 00          .    BRK
9A69 00          .    BRK
9A6A 00          .    BRK
9A6B 02          .    EQUB &02		back=2


Check if hard drive hardware present
====================================
On entry: none
On exit:  EQ  - hard drive present
          NE  - no hard drive present
          X,Y - preserved
          A   - corrupted

9A6C A9 5A       ©Z   LDA #&5A
9A6E 20 75 9A     u.  JSR &9A75
9A71 D0 0B       Ð.   BNE &9A7E
9A73 A9 A5       ©¥   LDA #&A5
9A75 8D 40 FC    .@ü  STA &FC40
9A78 9C 43 FC    .Cü  STZ &FC43
9A7B CD 40 FC    Í@ü  CMP &FC40
9A7E 60          `    RTS


9A7F A9 A1       ©¡   LDA #&A1		Read CMOS
9A81 A2 0B       ¢.   LDX #&0B		Location 11 - ADFS settings
9A83 20 F4 FF     ô.  JSR &FFF4		Read CMOS byte
9A86 98          .    TYA		Transfer CMOS byte to A
9A87 60          `    RTS

ADFS CMOS byte
--------------
b7    Floppy/Hard
b6    NoDir/Dir
b5    (Caps)
b4    (NoCaps)
b3    (ShCaps)
b2-b0 FDrive


9A88 A9 FD       ©ý   LDA #&FD
9A8A 20 C4 84     Ä.  JSR &84C4		Read BREAK type
9A8D 8A          .    TXA
9A8E 60          `    RTS

Boot command offset bytes
-------------------------
9A8F 92          .    EQUB &92		Option 1 at &9A92
9A90 94          .    EQUB &92		Option 2 at &9A94
9A91 9C          .    EQUB &9C		Option 3 at &9A9C

Boot commands
-------------
9A92 4C 2E       L.   EQUS "L."		Start of *Load option
9A94 24 2E 21 42 $.!B EQUS "$.!BOOT"	End of *Load and *Run option
9A98 4F 4F 54    OOT
9A9B 0D          .    EQUB &0D
9A9C 45 2E 2D 41 E.-A EQUS "E.-ADFS-$.!BOOT"
9AA0 44 46 53 2D DFS-			*Exec option
9AA4 24 2E 21 42 $.!B
9AA8 4F 4F 54    OOT
9AAB 0D          .    EQUB 13


SERVICE CALL HANDLERS
=====================

The following tables hold addresses pushed onto the stack to call
service routines. Consequently, they are one byte less than the
actual routine addresses as the RTS opcode increments the address
popped from the stack

Low service call routines address-1 low bytes
---------------------------------------------
9AAC D4          Ô    EQUB &D4			Serv0 - &9AD5 - Null
9AAD D4          Ô    EQUB &D4			Serv1 - &9AD5 - Null
9AAE FE          þ    EQUB &FE			Serv2 - &9AFF - Low w/s
9AAF 53          S    EQUB &53			Serv3 - &9B54 - Boot FS
9AB0 22          "    EQUB &22			Serv4 - &9D23 - Commands
9AB1 88          .    EQUB &88			Serv5 - &AB89 - Interrupt
9AB2 D4          Ô    EQUB &D4			Serv6 - &9AD5 - Null
9AB3 D4          Ô    EQUB &D4			Serv7 - &9AD5 - Null
9AB4 5D          ]    EQUB &5D			Serv8 - &9D5E - Osword
9AB5 0C          .    EQUB &0C			Serv9 - &9E0D - Help

Low service call routines address-1 high bytes
----------------------------------------------
9AB6 9A          .    EQUB &9A
9AB7 9A          .    TXS
9AB8 9A          .    TXS
9AB9 9B          .    EQUB &9B
9ABA 9D AB 9A    .«.  STA &9AAB,X
9ABD 9A          .    TXS
9ABE 9D 9E       ..   STA &D89E,X

High service call routines address-1 low bytes
----------------------------------------------
9AC0 D8          Ø    EQUB &D8			Serv21 - &9CD9 - High abs
9AC1 DF          ß    EQUB &DF			Serv22 - &9CE0 - High w/s
9AC2 D4          Ô    EQUB &D4			Serv23 - &9AD5 - Null
9AC3 E7          ç    EQUB &E7			Serv24 - &9CE8 - Hazel count
9AC4 E9          é    EQUB &04			Serv25 - &9CEA - FS Info
9AC5 04          .    EQUB &04			Serv26 - &9D05 - *SHUT
9AC6 D4          Ô    EQUB &D4			Serv27 - &9AD5 - Null

High service call routines address-1 high bytes
-----------------------------------------------
9AC7 9C 9C 9A    ...  STZ &9A9C
9ACA 9C 9C 9D    ...  STZ &9D9C
9ACD 9A          .    TXS


SERVICE CALL HANDLER
====================

9ACE 3C F0 0D    <ð.  BIT &0DF0,X	Check ROM w/s byte
9AD1 10 03       ..   BPL &9AD6		&00-&7F -> Check bit6
9AD3 70 03       p.   BVS &9AD8		&C0-&FF -> ROM enabled

Service quit - jump here with calls not used
--------------------------------------------
9AD5 60          `    RTS		&80-&BF -> ROM disabled
9AD6 70 FD       pý   BVS &9AD5		&40-&7F -> ROM disabled

Workspace is allowed to be at &00xx-&3Fxx or &C0xx-&FFxx. If the
ROM workspace byte is set to %01xxxxxx or %10xxxxxx, implying
workspace somewhere in &40xx-&BFxx, then the ROM is disabled.

9AD8 C9 12       É.   CMP #&12		Select filing system?
9ADA F0 70       ðp   BEQ &9B4C		Jump to check FS
9ADC C9 0A       É.   CMP #&0A		Service call 10 or higher?
9ADE B0 0D       °.   BCS &9AED		Jump forward with higher calls
9AE0 AA          ª    TAX		Pass service number into X
9AE1 BD B6 9A    ½¶.  LDA &9AB6,X	Index into address table
9AE4 48          H    PHA		Push service routine address
9AE5 BD AC 9A    ½¬.  LDA &9AAC,X	onto stack
9AE8 48          H    PHA
9AE9 8A          .    TXA		Pass service number back into A
9AEA A6 F4       ¦ô   LDX &F4		Get ROM number back into X
9AEC 60          `    RTS		Jump to service routine

Service calls &21 to &27
------------------------
9AED C9 21       É!   CMP #&21		Check against the lowest value
9AEF 90 E4       .ä   BCC &9AD5		Quit with calls <&21
9AF1 C9 28       É(   CMP #&28
9AF3 B0 E0       °à   BCS &9AD5		Quit with calls >&27
9AF5 AA          ª    TAX		Pass service call into X
9AF6 BD A6 9A    ½¦.  LDA &9AA6,X	Index into address table
9AF9 48          H    PHA		Push service routine address
9AFA BD 9F 9A    ½..  LDA &9A9F,X	onto stack
9AFD 80 E9       .é   BRA &9AE8		Jump back to jump to service routine


Serv2 - Low workspace claim
===========================
If insufficient workspace was available in high memory, ADFS claims
a page of workspace from low memory. ADFS also does some initialisation
on this call.

9AFF BD F0 0D    ½ð.  LDA &0DF0,X	Get workspace pointer
9B02 C9 DC       ÉÜ   CMP #&DC		Is it set to <&DC00?
9B04 90 04       ..   BCC &9B0A		Use existing value if it is
9B06 98          .    TYA
9B07 9D F0 0D    .ð.  STA &0DF0,X	Use low workspace
9B0A 5A          Z    PHY		Save current pointer

Now do some initialisation. Look for a hard drive?

9B0B 20 88 9A     ..  JSR &9A88		Read BREAK type
9B0E F0 2B       ð+   BEQ &9B3B		Soft BREAK, jump ahead
9B10 20 44 A7     D§  JSR &A744		Find workspace
9B13 A8          ¨    TAY		Y=0
9B14 B9 4F 9A    ¹O.  LDA &9A4F,Y	Initialise workspace
9B17 C0 1D       À.   CPY #&1D		First 29 bytes set to dir="$",
9B19 90 02       ..   BCC &9B1D		lib="$", csd=2, lib=2, back=2.
9B1B A9 00       ©.   LDA #&00		Rest of workspace set to zero
9B1D 91 BA       .º   STA (&BA),Y	Store byte into workspace
9B1F C8          È    INY
9B20 D0 F2       Ðò   BNE &9B14		Loop for all workspace
9B22 20 6C 9A     l.  JSR &9A6C		Check if SCSI hardware present
9B25 D0 11       Ð.   BNE &9B38		Not present, jump ahead
9B27 20 7F 9A     ..  JSR &9A7F		Read Config HARD/FLOPPY setting
9B2A 29 80       ).   AND #&80		Keep bit 7
9B2C A0 17        .   LDY #&17
9B2E 91 BA       .º   STA (&BA),Y	Set w/s byte &17
9B30 A0 1B        .   LDY #&1B
9B32 91 BA       .º   STA (&BA),Y	Set w/s byte &1B
9B34 A0 1F        .   LDY #&1F
9B36 91 BA       .º   STA (&BA),Y	Set w/s byte &1F
9B38 20 61 A7     a§  JSR &A761		Set workspace checksum

9B3B 20 67 A7     g§  JSR &A767		Check workspace checksum

9B3E 7A          z    PLY		Get pointer back
9B3F A6 F4       ¦ô   LDX &F4		Get ROM number back into X
9B41 3C F0 0D    <ð.  BIT &0DF0,X	Check w/s pointer
9B44 30 01       0.   BMI &9B47		Exit if using high workspace
9B46 C8          È    INY		Claim one page of low workspace
9B47 A9 02       ©.   LDA #&02		Restore A to &02
9B49 60          `    RTS


Select ADFS
===========
9B4A A0 08        .   LDY #&08		Y=8 to select ADFS


Serv12 - Select filing system
=============================
9B4C C0 08       À.   CPY #&08
9B4E D0 F9       Ðù   BNE &9B49		No, quit
9B50 5A          Z    PHY
9B51 5A          Z    PHY
9B52 80 40       .@   BRA &9B94


Serv3 - Boot filing system
==========================
9B54 98          .    TYA
9B55 48          H    PHA		Save Boot flag
9B56 A9 7A       ©z   LDA #&7A
9B58 20 F4 FF     ô.  JSR &FFF4		Scan keyboard
9B5B E8          è    INX		No key pressed?
9B5C F0 16       ð.   BEQ &9B74		Yes, jump to select FS
9B5E CA          Ê    DEX
9B5F E0 79       ày   CPX #&79		'->' pressed?
9B61 F0 11       ð.   BEQ &9B74		Yes
9B63 E0 41       àA   CPX #&41		'A' pressed?
9B65 F0 0D       ð.   BEQ &9B74		Yes
9B67 E0 43       àC   CPX #&43		'F' pressed?
9B69 F0 07       ð.   BEQ &9B72		Yes, jump to select FS
9B6B 68          h    PLA
9B6C A8          ¨    TAY		Restore Boot flag
9B6D A6 F4       ¦ô   LDX &F4		Restore ROM number
9B6F A9 03       ©.   LDA #&03		Restore A=FSBoot
9B71 60          `    RTS		Return unclaimed

9B72 68          h    PLA		Replace boot flag with 'F'-Break
9B73 DA          Ú    PHX		...flag to prevent booting
9B74 58          X    CLI		Enable IRQs
9B75 DA          Ú    PHX		Save keycode

Stack now holds:
  top-1: Key pressed, &FF=none, &41='A', &43='F', &79='->'
  top-2: Boot flag, &00=boot, <>&00=no boot

9B76 20 7F 9A     ..  JSR &9A7F		Read CMOS settings
9B79 0A          .    ASL A		Move NoDir/Dir into bit7
9B7A 10 09       ..   BPL &9B85		Jump forward with NoDir
9B7C 20 88 9A     ..  JSR &9A88		Read BREAK type
9B7F F0 04       ð.   BEQ &9B85		Jump forward if soft BREAK
9B81 68          h    PLA		With Hard BREAK and power on
9B82 A9 43       ©C   LDA #&43		...change key pressed to 'fadfs'
9B84 48          H    PHA
9B85 20 A8 92     ¨.  JSR &92A8		Print FS banner
9B88 41 63       Ac   EOR (&63,X)	'Acorn ADFS'<cr><cr>
9B8A 6F 72 6E    orn  BBR 6,&72,&9BFB
9B8D 20 41 44     AD  JSR &4441
9B90 46 53       FS   LSR &53
9B92 0D 8D				Run into ADFS selection

Select ADFS
===========
Stack now holds:
  top-1: Key pressed, &FF=none or *adfs, &41='A', &43='F' or *fadfs or
                      Serv08+Dir+Hard/PowerBreak, &79='->', &00/&08=Serv12
  top-2: Boot flag, &00=boot, <>&00=no boot

9B94 A9 06       ..   LDA #&06
9B96 20 4C 9A    ...  JSR &9A4C		Tell current FS new FS taking over
9B99 A9 10       ..   LDA #&10
9B9B 8D 00 C2    ...  STA &C200
9B9E 9C D7 C2    .×Â  STZ &C2D7
9BA1 20 7F 9A     ..  JSR &9A7F		Get ADFS CMOS byte
9BA4 8D D8 C2    .ØÂ  STA &C2D8		Store in workspace
9BA7 A0 0D        .   LDY #&0D		Initialise vectors
9BA9 B9 B6 9C    ¹¶.  LDA &9CB6,Y
9BAC 99 12 02    ...  STA &0212,Y
9BAF 88          .    DEY
9BB0 10 F7       .÷   BPL &9BA9
9BB2 A9 A8       ©¨   LDA #&A8
9BB4 20 C4 84     Ä.  JSR &84C4		Find extended vector table
9BB7 86 B4       .´   STX &B4
9BB9 84 B5       .µ   STY &B5
9BBB A0 2F        /   LDY #&2F
9BBD A2 14       ¢.   LDX #&14
9BBF BD C4 9C    ½Ä.  LDA &9CC4,X	Initialise extended vectors
9BC2 C9 FF       É.   CMP #&FF
9BC4 D0 02       Ð.   BNE &9BC8
9BC6 A5 F4       ¥ô   LDA &F4
9BC8 91 B4       .´   STA (&B4),Y
9BCA 88          .    DEY
9BCB CA          Ê    DEX
9BCC 10 F1       .ñ   BPL &9BBF
9BCE A9 8F       ©.   LDA #&8F
9BD0 A2 0F       ¢.   LDX #&0F
9BD2 A0 FF        .   LDY #&FF
9BD4 20 F4 FF     ô.  JSR &FFF4		Claim Vectors
9BD7 20 57 BA     Wº  JSR &BA57		Set a flag
9BDA 20 67 A7     g§  JSR &A767		Check workspace checksum
9BDD 9C 08 C2    ..Â  STZ &C208
9BE0 9C 0C C2    ..Â  STZ &C20C
9BE3 9C 10 C2    ..Â  STZ &C210
9BE6 9C 14 C2    ..Â  STZ &C214
9BE9 A9 01       ©.   LDA #&01
9BEB 8D 04 C2    ..Â  STA &C204
9BEE A0 FB        û   LDY #&FB		Copy workspace to &C300
9BF0 B1 BA       ±º   LDA (&BA),Y
9BF2 99 00 C3    ..Ã  STA &C300,Y
9BF5 88          .    DEY
9BF6 D0 F8       Ðø   BNE &9BF0		Loop for 252 bytes
9BF8 B1 BA       ±º   LDA (&BA),Y	Do zeroth byte
9BFA 99 00 C3    ..Ã  STA &C300,Y
9BFD AD 20 C3    ­ Ã  LDA &C320		Get *OPT1 setting
9C00 29 04       ).   AND #&04
9C02 85 CD       .Í   STA &CD		Put into &CD
9C04 20 D4 A7     Ô§  JSR &A7D4		Check some settings
9C07 20 6C 9A     l.  JSR &9A6C		See if SCSI hardware present
9C0A D0 04       Ð.   BNE &9C10		No SCSI hardware, jump forward
9C0C A9 20       ©    LDA #&20
9C0E 04 CD       .Í   TSB &CD		Signal hard drive present
9C10 68          h    PLA		Get selection flag from stack
9C11 C9 43       ÉC   CMP #&43		'*fadfs'/F-Break type of selection?
9C13 D0 03       Ð.   BNE &9C18		No, jump to keep context
9C15 20 9A 84     ..  JSR &849A		Set context to &FFFFFFFF when *fadfs
9C18 A0 03        .   LDY #&03		Copy current context to backup context
9C1A B9 14 C3    ¹.Ã  LDA &C314,Y
9C1D 99 2C C2    .,Â  STA &C22C,Y
9C20 88          .    DEY
9C21 10 F7       .÷   BPL &9C1A
9C23 20 D8 89     Ø.  JSR &89D8		Get FSM and root from :0 if context<>-1
9C26 AE 17 C3    ®.Ã  LDX &C317		Get current drive
9C29 E8          è    INX
9C2A F0 51       ðQ   BEQ &9C7D		No drive (eg *fadfs), jump ahead
9C2C 20 CD B4     Í´  JSR &B4CD
9C2F AD 18 C3    ­.Ã  LDA &C318		Is LIB set to ":0.$"?
9C32 C9 02       É.   CMP #&02
9C34 D0 44       ÐD   BNE &9C7A
9C36 AD 19 C3    ­.Ã  LDA &C319
9C39 0D 1A C3    ..Ã  ORA &C31A
9C3C 0D 1B C3    ..Ã  ORA &C31B
9C3F D0 39       Ð9   BNE &9C7A		No, don't look for Library
9C41 A9 AE       ©®   LDA #&AE
9C43 85 B4       .´   STA &B4
9C45 A9 9C       ©.   LDA #&9C
9C47 85 B5       .µ   STA &B5		Point to ":0.LIB*"
9C49 20 E8 8F     è.  JSR &8FE8
9C4C D0 2C       Ð,   BNE &9C7A
9C4E A0 03        .   LDY #&03
9C50 B1 B6       ±¶   LDA (&B6),Y
9C52 30 07       0.   BMI &9C5B
9C54 20 64 89     d.  JSR &8964
9C57 D0 21       Ð!   BNE &9C7A
9C59 F0 F3       ðó   BEQ &9C4E
9C5B A2 02       ¢.   LDX #&02
9C5D A0 18        .   LDY #&18
9C5F B1 B6       ±¶   LDA (&B6),Y
9C61 9D 18 C3    ..Ã  STA &C318,X
9C64 88          .    DEY
9C65 CA          Ê    DEX
9C66 10 F7       .÷   BPL &9C5F
9C68 AD 17 C3    ­.Ã  LDA &C317
9C6B 8D 1B C3    ..Ã  STA &C31B
9C6E A0 09        .   LDY #&09
9C70 B1 B6       ±¶   LDA (&B6),Y
9C72 29 7F       ).   AND #&7F
9C74 99 0A C3    ..Ã  STA &C30A,Y
9C77 88          .    DEY
9C78 10 F6       .ö   BPL &9C70
9C7A 20 D8 89     Ø.  JSR &89D8
9C7D A9 EA       ©ê   LDA #&EA
9C7F 20 C4 84     Ä.  JSR &84C4
9C82 A9 80       ©.   LDA #&80
9C84 14 CD       .Í   TRB &CD
9C86 E8          è    INX
9C87 D0 02       Ð.   BNE &9C8B
9C89 04 CD       .Í   TSB &CD
9C8B 68          h    PLA		Get boot flag
9C8C 48          H    PHA
9C8D D0 19       Ð.   BNE &9CA8		No boot, jump forward
9C8F AE 17 C3    ®.Ã  LDX &C317
9C92 E8          è    INX
9C93 D0 06       Ð.   BNE &9C9B
9C95 8E 6F C2    .oÂ  STX &C26F
9C98 20 A1 A1     ¡¡  JSR &A1A1
9C9B AC FD C1    ¬ýÁ  LDY &C1FD		Get boot option
9C9E F0 08       ð.   BEQ &9CA8		Zero, jump to finish
9CA0 BE 8E 9A    ¾..  LDX &9A8E,Y	Get
9CA3 A0 9A        .   LDY #&9A
9CA5 20 F7 FF     ÷.  JSR &FFF7		Do *Load/*Run/*Exec
9CA8 A6 F4       ¦ô   LDX &F4		Restore ROM number
9CAA 7A          z    PLY		Rebalance stack
9CAB A9 00       ©.   LDA #&00		Claim the call
9CAD 60          `    RTS

9CAE 3A 30 2E 4C :0.L EQUS ":0.LIB*"
9CB2 49 42 2A    IB*
9CB5 0D          .    EQUB 13


Vector Table
============
9CB6 1B FF       ..   EQUW &FF1B
9CB8 1E FF       ..   EQUW &FF1E
9CBA 21 FF       !.   EQUW &FF21
9CBC 24 FF       $.   EQUW &FF24
9CBE 27 FF       '.   EQUW &FF27
9CC0 2A FF       *.   EQUW &FF2A
9CC2 2D FF       -.   EQUW &FF2D

Extended Vector Table
=====================
9CC4 47 92 FF    G..  EQUW &9247:EQUB &FF	OSFILE
9CC7 7A A9 FF    z©.  EQUW &A97A:EQUB &FF	OSARGS
9CCA 72 AD FF    r­.  EQUW &AD72:EQUB &FF	OSBGET
9CCD EC B0 FF    ì°.  EQUW &B0EC:EQUB &FF	OSBPUT
9CD0 CB B5 FF    Ëµ.  EQUW &B5CB:EQUB &FF	OSGBPB
9CD3 13 B2 FF    .².  EQUW &B213:EQUB &FF	OSFIND
9CD6 9D 9E FF    ...  EQUW &9E9D:EQUB &FF	FSCV


Serv21 - Claim High Absolute Workspace
======================================
9CD9 C0 CE       ÀÎ   CPY #&CE		ADFS needs up to &CE00-1
9CDB B0 02       °.   BCS &9CDF		Exit if Y>&CE
9CDD A0 CE        Î   LDY #&CE		ADFS needs up to &CE00-1
9CDF 60          `    RTS

Serv22 - Claim High Private Workspace
=====================================
9CE0 98          .    TYA		Pass w/s pointer to A
9CE1 9D F0 0D    .ð.  STA &0DF0,X	Store in w/s byte
9CE4 A9 22       ©"   LDA #&22		Restore A to &22
9CE6 C8          È    INY		ADFS needs one page
9CE7 60          `    RTS

Serv24 - State how much high workspace needed
=============================================
9CE8 88          .    DEY		ADFS needs one page
9CE9 60          `    RTS

Serv25 - Return filing system information
=========================================
9CEA A2 0A       ¢.   LDX #&0A
9CEC BD FA 9C    ½ú.  LDA &9CFA,X	Copy information
9CEF 91 F2       .ò   STA (&F2),Y
9CF1 C8          È    INY
9CF2 CA          Ê    DEX
9CF3 10 F7       .÷   BPL &9CEC
9CF5 A9 25       ©%   LDA #&25		Restore A to &25
9CF7 A6 F4       ¦ô   LDX &F4		Get ROM number back to X
9CF9 60          `    RTS

Filing system information
-------------------------
9CFA 08          .    EQUB &08		Filing system number
9CFB 39          9    EQUB &39		Highest handle used
9CFC 30          0    EQUB &30		Lowest handle used
9CFD 20 20 20 20      EQUS "    sfda"	"adfs" filing system name
9D01 73 66 64 61 sfda

Serv26 - *SHUT
==============
9D05 5A          Z    PHY
9D06 20 44 A7     D§  JSR &A744
9D09 A0 AC        ¬   LDY #&AC
9D0B A2 09       ¢.   LDX #&09
9D0D A9 00       ©.   LDA #&00
9D0F 11 BA       .º   ORA (&BA),Y
9D11 C8          È    INY
9D12 CA          Ê    DEX
9D13 10 FA       .ú   BPL &9D0F
9D15 AA          ª    TAX
9D16 F0 06       ð.   BEQ &9D1E
9D18 20 4A 9B     J.  JSR &9B4A
9D1B 20 10 B2     .²  JSR &B210
9D1E 7A          z    PLY
9D1F A9 26       ©&   LDA #&26
9D21 80 D4       .Ô   BRA &9CF7

Serv04 - *Commands
==================
9D23 5A          Z    PHY		Save command pointer
9D24 A9 FF       ©.   LDA #&FF		Flag not '*fadfs'
9D26 48          H    PHA
9D27 B1 F2       ±ò   LDA (&F2),Y	Get first character
9D29 09 20       .    ORA #&20		Force to lower case
9D2B C9 66       Éf   CMP #&66		Is it 'f' of 'fadfs'?
9D2D D0 05       Ð.   BNE &9D34		No, jump past
9D2F 68          h    PLA		Lose previos flag
9D30 A9 43       ©C   LDA #&43		Change flags to indicate '*fadfs'
9D32 48          H    PHA
9D33 C8          È    INY		Point to next character
9D34 A2 03       ¢.   LDX #&03		'adfs' is 3+1 characters
9D36 B1 F2       ±ò   LDA (&F2),Y	Get character
9D38 C8          È    INY		Move to next
9D39 C9 2E       É.   CMP #&2E		Is it '.'?
9D3B F0 0A       ð.   BEQ &9D47		Jump to match abbreviated command
9D3D 09 20       .    ORA #&20		Force to lower case
9D3F DD 01 9D    Ý..  CMP &9D01,X	Compare with 'adfs' in FSInfo block
9D42 D0 13       Ð.   BNE &9D57		No match, abandon scanning
9D44 CA          Ê    DEX		Decrease length/pointer
9D45 10 EF       .ï   BPL &9D36		Loop for all four characters
9D47 B1 F2       ±ò   LDA (&F2),Y	Get next character
9D49 C8          È    INY		Move to next character
9D4A C9 20       É    CMP #&20		Check if it was a space
9D4C F0 F9       ðù   BEQ &9D47		Loop to skip spaces
9D4E B0 07       °.   BCS &9D57		Non-space found, jump to abandon
9D50 FA          ú    PLX		Get adfs/fadfs flag back
9D51 68          h    PLA		Get command pointer back
9D52 DA          Ú    PHX		Add extra byte to stack
9D53 DA          Ú    PHX		Save adfs/fadfs flag
9D54 4C 94 9B    L..  JMP &9B94		Jump to select FS 8

Not *fadfs/*adfs or command has extra characters after it
---------------------------------------------------------
9D57 68          h    PLA		Drop fadfs/adfs flag
9D58 7A          z    PLY		Get command pointer back
9D59 A9 04       ©.   LDA #&04		Restore A to '*Command'
9D5B A6 F4       ¦ô   LDX &F4		Restore ROM number
9D5D 60          `    RTS		Exit


Serv8 - OSWORD calls
====================
9D5E 5A          Z    PHY		Save Y
9D5F A5 EF       ¥ï   LDA &EF		Get OSWORD number
9D61 C9 70       Ép   CMP #&70
9D63 90 55       .U   BCC &9DBA		If <&70, exit unclaimed
9D65 C9 74       Ét   CMP #&74
9D67 B0 51       °Q   BCS &9DBA		If >&73, exit unclaimed

The following code is VERY annoying, as it means that if you call the
sector access calls with another filing system selected, ADFS selects
itself as the current filing system, thereby trampling all over any
memory you may be using.

9D69 A9 00       ©.   LDA #&00
9D6B A8          ¨    TAY
9D6C 20 DA FF     Ú.  JSR &FFDA		Get current filing system
9D6F C9 08       É.   CMP #&08		Is is ADFS?
9D71 F0 03       ð.   BEQ &9D76		Yes, jump to continue
9D73 20 4A 9B     J.  JSR &9B4A		Select ADFS if ADFS not selected
9D76 A5 EF       ¥ï   LDA &EF		Get OSWORD number
9D78 C9 72       Ér   CMP #&72		Is if &72?
9D7A D0 44       ÐD   BNE &9DC0		No, jump ahead


OSWORD &72 - SCSI Device Access (Sector Read/Write)
===================================================
9D7C A5 F0       ¥ð   LDA &F0		Copy block pointer to &BA/B
9D7E 85 BA       .º   STA &BA
9D80 A5 F1       ¥ñ   LDA &F1
9D82 85 BB       .»   STA &BB
9D84 A0 0F        .   LDY #&0F		Copy control block to &C215
9D86 B1 BA       ±º   LDA (&BA),Y
9D88 99 15 C2    ..Â  STA &C215,Y
9D8B 88          .    DEY
9D8C 10 F8       .ø   BPL &9D86

The control block is copied to ADFS filing system workspace:
   Addr Ctrl
  &C215  0  Returned result
  &C216  1  Addr0
  &C217  2  Addr1
  &C218  3  Addr2
  &C219  4  Addr3
  &C21A  5  Command
  &C21B  6  Drive+Sector b16-19
  &C21C  7  Sector b8-b15
  &C21D  8  Sector b0-b7
  &C21E  9  Sector Count
  &C21F 10  -
  &C220 11  Length0
  &C221 12  Length1
  &C222 13  Length2
  &C223 14  Length3
  &C224 15

9D8E AD 1A C2    ­.Â  LDA &C21A		Get command
9D91 29 FD       )ý   AND #&FD		Mask out bit 1
9D93 C9 08       É.   CMP #&08		Is it &08 or &0A, Read or Write?
9D95 F0 11       ð.   BEQ &9DA8		Jump forward with Read and Write

9D97 A2 15       ¢.   LDX #&15
9D99 A0 C2        Â   LDY #&C2
9D9B EE 17 C3    î.Ã  INC &C317
9D9E F0 03       ð.   BEQ &9DA3
9DA0 CE 17 C3    Î.Ã  DEC &C317
9DA3 20 A2 80     ¢.  JSR &80A2
9DA6 10 08       ..   BPL &9DB0		Jump to exit

9DA8 AD 1E C2    ­.Â  LDA &C21E		Get Sector Count
9DAB D0 EA       Ðê   BNE &9D97		If not zero jump back to use it
9DAD 20 4A 8A     J.  JSR &8A4A		Do the SCSI call

Store result value and claim call
---------------------------------
9DB0 A0 00        .   LDY #&00		Point to result byte
9DB2 91 BA       .º   STA (&BA),Y	Store result in control block
9DB4 A6 F4       ¦ô   LDX &F4		Put ROM number in X
9DB6 7A          z    PLY		Restore Y
9DB7 A9 00       ©.   LDA #&00		A=0 to claim OSWORD
9DB9 60          `    RTS

Exit from OSWORD service call
-----------------------------
9DBA A6 F4       ¦ô   LDX &F4		Put ROM number in X
9DBC 7A          z    PLY		Restore Y
9DBD A9 08       ©.   LDA #&08		A=8 to exit with OSWORD unclaimed
9DBF 60          `    RTS


9DC0 C9 73       És   CMP #&73
9DC2 D0 0C       Ð.   BNE &9DD0
9DC4 A0 04        .   LDY #&04
9DC6 B9 D0 C2    ¹ÐÂ  LDA &C2D0,Y
9DC9 91 F0       .ð   STA (&F0),Y
9DCB 88          .    DEY
9DCC 10 F8       .ø   BPL &9DC6
9DCE 30 E4       0ä   BMI &9DB4
9DD0 C9 70       Ép   CMP #&70
9DD2 D0 0F       Ð.   BNE &9DE3
9DD4 AD FA C8    ­úÈ  LDA &C8FA
9DD7 A0 00        .   LDY #&00
9DD9 91 F0       .ð   STA (&F0),Y
9DDB A5 CD       ¥Í   LDA &CD
9DDD C8          È    INY
9DDE 91 F0       .ð   STA (&F0),Y
9DE0 4C B4 9D    L´.  JMP &9DB4

9DE3 C9 71       Éq   CMP #&71
9DE5 D0 D3       ÐÓ   BNE &9DBA
9DE7 20 EA A1     ê¡  JSR &A1EA
9DEA A0 03        .   LDY #&03
9DEC B9 15 C2    ¹.Â  LDA &C215,Y
9DEF 91 F0       .ð   STA (&F0),Y
9DF1 88          .    DEY
9DF2 10 F8       .ø   BPL &9DEC
9DF4 80 BE       .¾   BRA &9DB4

9DF6 20 A8 92     ¨.  JSR &92A8
9DF9 0D 41 64    .Ad  ORA &6441
9DFC 76 61       va   ROR &61,X
9DFE 6E 63 65    nce  ROR &6563
9E01 64 20       d    STZ &20
9E03 44          D    EQUB &44
9E04 46 53       FS   LSR &53
9E06 20 31 2E     1.  JSR &2E31
9E09 35 30       50   AND &30,X
9E0B 8D 60 98    .`.  STA &9860
9E0E 48          H    PHA
9E0F B1 F2       ±ò   LDA (&F2),Y
9E11 C9 20       É    CMP #&20
9E13 B0 29       °)   BCS &9E3E
9E15 20 F6 9D     ö.  JSR &9DF6
9E18 20 A8 92     ¨.  JSR &92A8
9E1B 20 20 41      A  JSR &4120
9E1E 44          D    EQUB &44
9E1F 46 53       FS   LSR &53
9E21 8D 68 A8    .h¨  STA &A868
9E24 A6 F4       ¦ô   LDX &F4
9E26 A9 09       ©.   LDA #&09
9E28 60          `    RTS

9E29 C8          È    INY
9E2A B1 F2       ±ò   LDA (&F2),Y
9E2C C9 20       É    CMP #&20
9E2E B0 F8       °ø   BCS &9E28
9E30 68          h    PLA
9E31 68          h    PLA
9E32 90 EE       .î   BCC &9E22
9E34 20 29 9E     ).  JSR &9E29
9E37 D0 FB       Ðû   BNE &9E34
9E39 20 29 9E     ).  JSR &9E29
9E3C F0 FB       ðû   BEQ &9E39
9E3E A2 03       ¢.   LDX #&03
9E40 B1 F2       ±ò   LDA (&F2),Y
9E42 C9 2E       É.   CMP #&2E
9E44 F0 11       ð.   BEQ &9E57
9E46 09 20       .    ORA #&20
9E48 DD 01 9D    Ý..  CMP &9D01,X
9E4B D0 E7       Ðç   BNE &9E34
9E4D C8          È    INY
9E4E CA          Ê    DEX
9E4F 10 EF       .ï   BPL &9E40
9E51 B1 F2       ±ò   LDA (&F2),Y
9E53 C9 21       É!   CMP #&21
9E55 B0 DD       °Ý   BCS &9E34
9E57 20 F6 9D     ö.  JSR &9DF6
9E5A A2 00       ¢.   LDX #&00
9E5C BD 2D 9F    ½-.  LDA &9F2D,X
9E5F 30 C1       0Á   BMI &9E22
9E61 20 A8 92     ¨.  JSR &92A8
9E64 20 A0 A0         JSR &A0A0
9E67 09 BD       .½   ORA #&BD
9E69 2D 9F 30    -.0  AND &309F
9E6C 07 20       .    TSB &20
9E6E 3C A0 E8    < è  BIT &E8A0,X
9E71 88          .    DEY
9E72 10 F4       .ô   BPL &9E68
9E74 20 36 A0     6   JSR &A036
9E77 88          .    DEY
9E78 10 FA       .ú   BPL &9E74
9E7A DA          Ú    PHX
9E7B BD 2F 9F    ½/.  LDA &9F2F,X
9E7E 48          H    PHA
9E7F 4A          J    LSR A
9E80 4A          J    LSR A
9E81 4A          J    LSR A
9E82 4A          J    LSR A
9E83 20 83 92     ..  JSR &9283
9E86 68          h    PLA
9E87 29 0F       ).   AND #&0F
9E89 20 83 92     ..  JSR &9283
9E8C 20 3A A0     :   JSR &A03A
9E8F FA          ú    PLX
9E90 E8          è    INX
9E91 E8          è    INX
9E92 E8          è    INX
9E93 80 C7       .Ç   BRA &9E5C

9E95 FB          û    EQUB &FB
9E96 B1 BD       ±½   LDA (&BD),Y
9E98 C7 D3       ÇÓ   CPY &D3
9E9A DD E7 F4    Ýçô  CMP &F4E7,X


FSC - Filing System Control
===========================
9E9D 86 B4       .´   STX &B4		Store X and Y in &B4/5
9E9F 84 B5       .µ   STY &B5
9EA1 8D D6 C2    .ÖÂ  STA &C2D6		Store function
9EA4 AA          ª    TAX
9EA5 30 13       0.   BMI &9EBA		Function<0 - exit
9EA7 C9 0C       É.   CMP #&0C
9EA9 B0 0F       °.   BCS &9EBA		Function>11 - exit
9EAB 9C D5 C2    .ÕÂ  STZ &C2D5		Clear
9EAE BD C7 9E    ½Ç.  LDA &9EC7,X	Push routine address onto stack
9EB1 48          H    PHA
9EB2 BD BB 9E    ½».  LDA &9EBB,X
9EB5 48          H    PHA
9EB6 A6 B4       ¦´   LDX &B4		Retrieve X and Y
9EB8 A4 B5       ¤µ   LDY &B5
9EBA 60          `    RTS		Jump to routine

FSC Routine Low Bytes
---------------------
9EBB 00          .    BRK		0  - &A001 - *OPT
9EBC 48          H    PHA		1  - &AD49 - =EOF
9EBD DA          Ú    PHX		2  - &A3DB - */
9EBE D2          Ò    CMP (&DA)		3  - &9ED3 - *command
9EBF DA          Ú    CMP (&DA)		4  - &A3DB - *RUN
9EC0 D4          Ô    EQUB &D4		5  - &93D5 - *CAT
9EC1 6C          l    JMP (&DBFB)	6  - &A96D - NewFS taking over
9EC2 FB          û    JMP (&DBFB)	7  - &9FFC - File Handle Request
9EC3 DB          Û    JMP (&DBFB)	8  - &A0DC - OSCLI being processed
9EC4 39          9    AND &DAED,Y	9  - &943A - *EX
9EC5 ED          í    AND &DAED,Y	10 - &94EE - *INFO
9EC6 DA          Ú    AND &DAED,Y	11 - &A3DB - *RUN from library

FSC Routine High Bytes
----------------------
9EC7 A0 AD        ­   LDY #&AD
9EC9 A3          £    EQUB &A3
9ECA 9E A3 93    .£.  STZ &93A3,X
9ECD A9 9F       ©.   LDA #&9F
9ECF A0 94        .   LDY #&94
9ED1 94 A3       .£   STY &A3,X

FSC 3 - *command
================
9ED3 20 28 83     (.  JSR &8328
9ED6 A9 A2       ©¢   LDA #&A2
9ED8 85 B8       .¸   STA &B8
9EDA A9 C2       ©Â   LDA #&C2
9EDC 85 B9       .¹   STA &B9
9EDE 20 0D A5     .¥  JSR &A50D		Skip spaces, etc
9EE1 A2 FD       ¢ý   LDX #&FD		Point to table start minus 3
9EE3 E8          è    INX
9EE4 E8          è    INX
9EE5 A0 FF        .   LDY #&FF		Point to text line minus 1
9EE7 E8          è    INX
9EE8 C8          È    INY
9EE9 BD 2D 9F    ½-.  LDA &9F2D,X	Get byte from command table
9EEC 30 1A       0.   BMI &9F08		End of entry
9EEE D1 B4       Ñ´   CMP (&B4),Y	Compare with current character
9EF0 F0 F5       ðõ   BEQ &9EE7		Jump with match
9EF2 09 20       .    ORA #&20		Force to lower case
9EF4 D1 B4       Ñ´   CMP (&B4),Y	Compare again
9EF6 F0 EF       ðï   BEQ &9EE7		Jump with match
9EF8 CA          Ê    DEX
9EF9 E8          è    INX		Loop to end of entry
9EFA BD 2D 9F    ½-.  LDA &9F2D,X
9EFD 10 FA       .ú   BPL &9EF9
9EFF B1 B4       ±´   LDA (&B4),Y	Get current character
9F01 C9 2E       É.   CMP #&2E		Is it a '.'?
9F03 D0 DE       ÐÞ   BNE &9EE3		No, jump to check next entry
9F05 C8          È    INY		Move past '.'
9F06 D0 0F       Ð.   BNE &9F17		Jump to update line pointer
9F08 98          .    TYA		Check line pointer
9F09 F0 19       ð.   BEQ &9F24		If zero, doesn't need updating
9F0B B1 B4       ±´   LDA (&B4),Y	Get terminating character
9F0D 29 5F       )_   AND #&5F		Force to upper case
9F0F C9 41       ÉA   CMP #&41		If more letters, jump to check again
9F11 90 04       ..   BCC &9F17
9F13 C9 5B       É[   CMP #&5B
9F15 90 CC       .Ì   BCC &9EE3
9F17 98          .    TYA		Update &B4/5 to point to params
9F18 18          .    CLC
9F19 65 B4       e´   ADC &B4
9F1B 85 B4       .´   STA &B4
9F1D 90 02       ..   BCC &9F21
9F1F E6 B5       æµ   INC &B5
9F21 20 0D A5     .¥  JSR &A50D		Skip spaces, etc.
9F24 BD 2D 9F    ½-.  LDA &9F2D,X	Get command address
9F27 48          H    PHA		Stack it
9F28 BD 2E 9F    ½..  LDA &9F2E,X
9F2B 48          H    PHA
9F2C 60          `    RTS		Jump indirectly to routine

9F2D 41 43       AC   EOR (&43,X)	*ACCESS - &9942, &16
9F2F 43          C    EQUB &43
9F30 45 53       ES   EOR &53
9F32 53          S    EQUB &53
9F33 99 41 16    .A.  STA &1641,Y

9F36 42          B    EQUB &42		*BACK - &A4D5, &00
9F37 41 43       AC   EOR (&43,X)
9F39 4B          K    LSR A
9F3A A4 D4       ¤Ô   LDY &D4
9F3C 00          .    BRK

9F3D 42          B    EQUB &42		*BYE - &A103, &00
9F3E 59 45 A1    YE¡  EOR &A145,Y
9F41 02          .    EQUB &02
9F42 00          .    BRK

9F43 43          C    EQUB &43
9F44 44          D    EQUB &44
9F45 49 52       IR   EOR #&52
9F47 95 76       .v   STA &76,X
9F49 20 43 4F     CO  JSR &4F43
9F4C 4D 50 41    MPA  EOR &4150
9F4F 43          C    EQUB &43
9F50 54          T    EQUB &54
9F51 A2 B5       ¢µ   LDX #&B5
9F53 50 43       PC   BVC &9F98
9F55 4F 50 59    OPY  BBR 4,&50,&9FB1
9F58 A8          ¨    TAY
9F59 48          H    PHA
9F5A 13          .    EQUB &13
9F5B 44          D    EQUB &44
9F5C 45 53       ES   EOR &53
9F5E 54          T    EQUB &54
9F5F 52 4F       RO   EOR (&4F)
9F61 59 99 E8    Y.è  EOR &E899,Y
9F64 10 44       .D   BPL &9FAA
9F66 49 52       IR   EOR #&52
9F68 95 45       .E   STA &45,X
9F6A 20 44 49     DI  JSR &4944
9F6D 53          S    EQUB &53
9F6E 4D 4F 55    MOU  EOR &554F
9F71 4E 54 A1    NT¡  LSR &A154
9F74 50 40       P@   BVC &9FB6
9F76 46 52       FR   LSR &52
9F78 45 45       EE   EOR &45
9F7A A0 62        b   LDY #&62
9F7C 00          .    BRK
9F7D 4C 43 41    LCA  JMP &4143

9F80 54          T    EQUB &54
9F81 A4 BC       ¤¼   LDY &BC
9F83 00          .    BRK
9F84 4C 45 58    LEX  JMP &5845

9F87 A4 C8       ¤È   LDY &C8
9F89 00          .    BRK
9F8A 4C 49 42    LIB  JMP &4249

9F8D A4 81       ¤.   LDY &81
9F8F 30 4D       0M   BMI &9FDE
9F91 41 50       AP   EOR (&50,X)
9F93 A0 91        .   LDY #&91
9F95 00          .    BRK

9F96 4D 4F 55    MOU  EOR &554F		*MOUNT - &A19E, &40
9F99 4E 54 A1    NT¡  LSR &A154
9F9C 9D 40 52    .@R  STA &5240,X

9F9E 52          R    STA &5240,X
9F9F 45 4E       EN   EOR &4E
9FA1 41 4D       AM   EOR (&4D,X)
9FA3 45 A5       E¥   EOR &A5
9FA5 40          @    RTI

9FA6 22          "    EQUB &22
9FA7 54          T    EQUB &54
9FA8 49 54       IT   EOR #&54
9FAA 4C 45 A2    LE¢  JMP &A245

9FAD 91 70       .p   STA (&70),Y
9FAF A3          £    EQUB &A3
9FB0 DA          Ú    PHX
9FB1 3C 4C 69    <Li  BIT &694C,X
9FB4 73          s    EQUB &73
9FB5 74 20       t    STZ &20,X
9FB7 53          S    EQUB &53
9FB8 70 65       pe   BVS &A01F
9FBA 63          c    EQUB &63
9FBB 3E 00 3C    >.<  ROL &3C00,X
9FBE 4F 62 20    Ob   BBR 4,&62,&9FE1
9FC1 53          S    EQUB &53
9FC2 70 65       pe   BVS &A029
9FC4 63          c    EQUB &63
9FC5 3E 00 3C    >.<  ROL &3C00,X
9FC8 2A          *    ROL A
9FC9 4F 62 20    Ob   BBR 4,&62,&9FEC
9FCC 53          S    EQUB &53
9FCD 70 65       pe   BVS &A034
9FCF 63          c    EQUB &63
9FD0 2A          *    ROL A
9FD1 3E 00 28    >.(  ROL &2800,X
9FD4 3C 44 72    <Dr  BIT &7244,X
9FD7 69 76       iv   ADC #&76
9FD9 65 3E       e>   ADC &3E
9FDB 29 00       ).   AND #&00
9FDD 3C 53 50    <SP  BIT &5053,X
9FE0 3E 20 3C    > <  ROL &3C20,X
9FE3 4C 50 3E    LP>  JMP &3E50

9FE6 00          .    BRK
9FE7 28          (    PLP
9FE8 4C 29 28    L)(  JMP &2829

9FEB 57          W    EQUB &57
9FEC 29 28       )(   AND #&28
9FEE 52 29       R)   EOR (&29)
9FF0 28          (    PLP
9FF1 45 29       E)   EOR &29
9FF3 00          .    BRK
9FF4 3C 54 69    <Ti  BIT &6954,X
9FF7 74 6C       tl   STZ &6C,X
9FF9 65 3E       e>   ADC &3E
9FFB 00          .    BRK

FSC 7 - Handle Request
======================
9FFC A2 30       ¢0   LDX #&30		Lowest handle=&30
9FFE A0 39        9   LDY #&39		Highest handle=&39
A000 60          `    RTS

FSC 0 - *OPT
============
A001 A6 B4       ¦´   LDX &B4
A003 F0 0A       ð.   BEQ &A00F
A005 CA          Ê    DEX
A006 D0 0E       Ð.   BNE &A016
A008 A9 04       ©.   LDA #&04
A00A 04 CD       .Í   TSB &CD
A00C 98          .    TYA
A00D D0 04       Ð.   BNE &A013
A00F A9 04       ©.   LDA #&04
A011 14 CD       .Í   TRB &CD
A013 4C D8 89    LØ.  JMP &89D8

A016 E0 03       à.   CPX #&03
A018 D0 10       Ð.   BNE &A02A
A01A 20 F3 8F     ó.  JSR &8FF3
A01D 20 46 B5     Fµ  JSR &B546
A020 A5 B5       ¥µ   LDA &B5
A022 29 03       ).   AND #&03
A024 8D FD C1    .ýÁ  STA &C1FD
A027 4C 91 8F    L..  JMP &8F91

A02A 20 6B 83     k.  JSR &836B
A02D CB          Ë    EQUB &CB
A02E 42          B    EQUB &42
A02F 61 64       ad   ADC (&64,X)
A031 20 6F 70     op  JSR &706F
A034 74 00       t.   STZ &00,X
A036 A9 20       ©    LDA #&20
A038 80 02       ..   BRA &A03C

A03A A9 0D       ©.   LDA #&0D
A03C DA          Ú    PHX
A03D 5A          Z    PHY
A03E 48          H    PHA
A03F A9 C7       ©Ç   LDA #&C7
A041 A0 00        .   LDY #&00
A043 20 C6 84     Æ.  JSR &84C6
A046 E0 30       à0   CPX #&30
A048 90 09       ..   BCC &A053
A04A E0 3A       à:   CPX #&3A
A04C B0 05       °.   BCS &A053
A04E 20 F4 FF     ô.  JSR &FFF4
A051 A2 00       ¢.   LDX #&00
A053 68          h    PLA
A054 48          H    PHA
A055 20 E3 FF     ã.  JSR &FFE3
A058 A9 C7       ©Ç   LDA #&C7
A05A A0 FF        .   LDY #&FF
A05C 20 F4 FF     ô.  JSR &FFF4
A05F 68          h    PLA
A060 7A          z    PLY
A061 FA          ú    PLX
A062 60          `    RTS

A063 20 EA A1     ê¡  JSR &A1EA
A066 20 06 A2     .¢  JSR &A206
A069 20 A8 92     ¨.  JSR &92A8
A06C 46 72       Fr   LSR &72
A06E 65 65       ee   ADC &65
A070 8D 20 EA    . ê  STA &EA20
A073 A1 A0       ¡    LDA (&A0,X)
A075 01 A2       .¢   ORA (&A2,X)
A077 02          .    EQUB &02
A078 38          8    SEC
A079 B9 FB C0    ¹ûÀ  LDA &C0FB,Y
A07C F9 15 C2    ù.Â  SBC &C215,Y
A07F 99 15 C2    ..Â  STA &C215,Y
A082 C8          È    INY
A083 CA          Ê    DEX
A084 10 F3       .ó   BPL &A079
A086 20 06 A2     .¢  JSR &A206
A089 20 A8 92     ¨.  JSR &92A8
A08C 55 73       Us   EOR &73,X
A08E 65 64       ed   ADC &64
A090 8D 60 20    .`   STA &2060
A093 A8          ¨    TAY
A094 92 41       .A   STA (&41)
A096 64 64       dd   STZ &64
A098 72 65       re   ADC (&65)
A09A 73          s    EQUB &73
A09B 73          s    EQUB &73
A09C 20 3A 20     :   JSR &203A
A09F 20 4C 65     Le  JSR &654C
A0A2 6E 67 74    ngt  ROR &7467
A0A5 68          h    PLA
A0A6 8D A2 00    .¢.  STA &00A2
A0A9 EC FE C1    ìþÁ  CPX &C1FE
A0AC F0 E3       ðã   BEQ &A091
A0AE E8          è    INX
A0AF E8          è    INX
A0B0 E8          è    INX
A0B1 86 C6       .Æ   STX &C6
A0B3 A0 02        .   LDY #&02
A0B5 CA          Ê    DEX
A0B6 BD 00 C0    ½.À  LDA &C000,X
A0B9 20 22 93     ".  JSR &9322
A0BC 88          .    DEY
A0BD 10 F6       .ö   BPL &A0B5
A0BF 20 A8 92     ¨.  JSR &92A8
A0C2 20 20 3A      :  JSR &3A20
A0C5 20 A0 A6      ¦  JSR &A6A0
A0C8 C6 A0       Æ    DEC &A0
A0CA 02          .    EQUB &02
A0CB CA          Ê    DEX
A0CC BD 00 C1    ½.Á  LDA &C100,X
A0CF 20 22 93     ".  JSR &9322
A0D2 88          .    DEY
A0D3 10 F6       .ö   BPL &A0CB
A0D5 20 3A A0     :   JSR &A03A
A0D8 A6 C6       ¦Æ   LDX &C6
A0DA 80 CD       .Í   BRA &A0A9

FSC 8 - OSCLI being processed
=============================
A0DC AE D9 C2    ®ÙÂ  LDX &C2D9
A0DF D0 B0       Ð°   BNE &A091		Exit
A0E1 AE FE C1    ®þÁ  LDX &C1FE		Get FSM size
A0E4 E0 E1       àá   CPX #&E1
A0E6 90 A9       .©   BCC &A091		If FSM not filling up, exit
A0E8 20 A8 92     ¨.  JSR &92A8		Print message
A0EB 43          C    EQUB &43		"Compaction recommended"
A0EC 6F 6D 70    omp  BBR 6,&6D,&A15F
A0EF 61 63       ac   ADC (&63,X)
A0F1 74 69       ti   STZ &69,X
A0F3 6F 6E 20    on   BBR 6,&6E,&A116
A0F6 72 65       re   ADC (&65)
A0F8 63          c    EQUB &63
A0F9 6F 6D 6D    omm  BBR 6,&6D,&A169
A0FC 65 6E       en   ADC &6E
A0FE 64 65       de   STZ &65
A100 64 8D       d.   STZ &8D
A102 60          `    RTS


*BYE
====
A103 AD 17 C3    ­.Ã  LDA &C317		Get current drive
A106 48          H    PHA		Save current drive
A107 AA          ª    TAX
A108 E8          è    INX
A109 F0 03       ð.   BEQ &A10E		No drive selected
A10B 20 10 B2     .²  JSR &B210		Do CLOSE#0
A10E A9 60       ©`   LDA #&60
A110 8D 17 C3    ..Ã  STA &C317		Set drive to 3
A113 A2 2A       ¢*   LDX #&2A
A115 A0 A1        ¡   LDY #&A1		Point to control block
A117 20 A2 80     ¢.  JSR &80A2		Do command &1B - park heads
A11A AD 17 C3    ­.Ã  LDA &C317		Get current drive
A11D 38          8    SEC
A11E E9 20       é    SBC #&20		Step back one
A120 8D 17 C3    ..Ã  STA &C317
A123 B0 EE       °î   BCS &A113		Loop for drives 3 to 0
A125 68          h    PLA
A126 8D 17 C3    ..Ã  STA &C317		Restore current drive
A129 60          `    RTS

A12A 00          .    BRK
A12B 00          .    BRK		&FFFFC900
A12C C9 FF       É.   CMP #&FF
A12E FF 1B 00    ...  BBS 7,&1B,&A131	Command &1B
A131 00          .    BRK		Drive 0, Sector 0
A132 00          .    BRK
A133 00          .    BRK
A134 00          .    BRK		Zero sectors

A135 20 0D A5     .¥  JSR &A50D
A138 AC 17 C3    ¬.Ã  LDY &C317
A13B C8          È    INY
A13C F0 01       ð.   BEQ &A13F
A13E 88          .    DEY
A13F 8C 6F C2    .oÂ  STY &C26F
A142 A0 00        .   LDY #&00
A144 B1 B4       ±´   LDA (&B4),Y
A146 C9 20       É    CMP #&20
A148 90 06       ..   BCC &A150
A14A 20 47 88     G.  JSR &8847
A14D 8D 6F C2    .oÂ  STA &C26F		Set drive number
A150 60          `    RTS

A151 20 35 A1     5¡  JSR &A135
A154 A2 09       ¢.   LDX #&09
A156 BD AC C3    ½¬Ã  LDA &C3AC,X
A159 F0 14       ð.   BEQ &A16F
A15B BD B6 C3    ½¶Ã  LDA &C3B6,X
A15E 29 E0       )à   AND #&E0
A160 CD 6F C2    ÍoÂ  CMP &C26F
A163 D0 0A       Ð.   BNE &A16F
A165 18          .    CLC
A166 8A          .    TXA
A167 69 30       i0   ADC #&30
A169 A8          ¨    TAY
A16A A9 00       ©.   LDA #&00
A16C 20 13 B2     .²  JSR &B213
A16F CA          Ê    DEX
A170 10 E4       .ä   BPL &A156
A172 AD 17 C3    ­.Ã  LDA &C317
A175 CD 6F C2    ÍoÂ  CMP &C26F
A178 D0 3F       Ð?   BNE &A1B9
A17A A9 FF       ©.   LDA #&FF
A17C 8D 17 C3    ..Ã  STA &C317
A17F 8D 16 C3    ..Ã  STA &C316
A182 A2 00       ¢.   LDX #&00
A184 20 89 A1     .¡  JSR &A189
A187 80 30       .0   BRA &A1B9

A189 A0 09        .   LDY #&09
A18B B9 94 A1    ¹.¡  LDA &A194,Y
A18E 9D 00 C3    ..Ã  STA &C300,X
A191 E8          è    INX
A192 88          .    DEY
A193 10 F6       .ö   BPL &A18B
A195 60          `    RTS

A196 0D 22 74    ."t  ORA &7422
A199 65 73       es   ADC &73
A19B 6E 55 22    nU"  ROR &2255

*MOUNT
======
A19E 20 35 A1     5¡  JSR &A135		Scan drive number parameter
A1A1 AD 6F C2    ­oÂ  LDA &C26F		Get drive
A1A4 8D 17 C3    ..Ã  STA &C317		Set current drive
A1A7 A2 DF       ¢ß   LDX #&DF
A1A9 A0 A1        ¡   LDY #&A1
A1AB 20 A2 80     ¢.  JSR &80A2		Do SCSI command &1B - Park
A1AE A9 EA       ©ê   LDA #&EA
A1B0 85 B4       .´   STA &B4
A1B2 A9 A2       ©¢   LDA #&A2
A1B4 85 B5       .µ   STA &B5		Point to &A2EA
A1B6 20 46 95     F.  JSR &9546		Do something
A1B9 AD 1F C3    ­.Ã  LDA &C31F		Get previous drive
A1BC CD 6F C2    ÍoÂ  CMP &C26F		Compare with ???
A1BF D0 08       Ð.   BNE &A1C9		If different, jump past
A1C1 A9 FF       ©.   LDA #&FF
A1C3 8D 1E C3    ..Ã  STA &C31E		Set previous directory to &FFFFxxxx
A1C6 8D 1F C3    ..Ã  STA &C31F
A1C9 AD 1B C3    ­.Ã  LDA &C31B		Get library drive
A1CC CD 6F C2    ÍoÂ  CMP &C26F		Compare with ???
A1CF D0 0D       Ð.   BNE &A1DE		If different, jump past
A1D1 A9 FF       ©.   LDA #&FF
A1D3 8D 1A C3    ..Ã  STA &C31A		Set library to &FFFFxxxx
A1D6 8D 1B C3    ..Ã  STA &C31B
A1D9 A2 0A       ¢.   LDX #&0A
A1DB 20 89 A1     .¡  JSR &A189		Set library name to "Unset"
A1DE 60          `    RTS

A1DF 00          .    BRK		Flag = &00
A1E0 00          .    BRK		&FFFFC900
A1E1 C9 FF       É.   CMP #&FF
A1E3 FF 1B 00    ...  BBS 7,&1B,&A1E6	Command &1B - Park
A1E6 00          .    BRK		Drive 0, Sector 0
A1E7 00          .    BRK
A1E8 01 00       ..   ORA (&00,X)	1 sector

A1EA A9 00       ©.   LDA #&00
A1EC A2 03       ¢.   LDX #&03
A1EE 9D 15 C2    ..Â  STA &C215,X
A1F1 9D 27 C2    .'Â  STA &C227,X
A1F4 CA          Ê    DEX
A1F5 10 F7       .÷   BPL &A1EE
A1F7 20 32 86     2.  JSR &8632
A1FA A2 02       ¢.   LDX #&02
A1FC BD 5D C2    ½]Â  LDA &C25D,X
A1FF 9D 16 C2    ..Â  STA &C216,X
A202 CA          Ê    DEX
A203 10 F7       .÷   BPL &A1FC
A205 60          `    RTS

A206 AD 18 C2    ­.Â  LDA &C218
A209 20 22 93     ".  JSR &9322
A20C AD 17 C2    ­.Â  LDA &C217
A20F 20 22 93     ".  JSR &9322
A212 AD 16 C2    ­.Â  LDA &C216
A215 20 22 93     ".  JSR &9322
A218 20 A8 92     ¨.  JSR &92A8
A21B 20 53 65     Se  JSR &6553
A21E 63          c    EQUB &63
A21F 74 6F       to   STZ &6F,X
A221 72 73       rs   ADC (&73)
A223 20 3D A0     =   JSR &A03D
A226 A2 1F       ¢.   LDX #&1F
A228 8E 33 C2    .3Â  STX &C233
A22B A9 00       ©.   LDA #&00
A22D A2 09       ¢.   LDX #&09
A22F 9D 40 C2    .@Â  STA &C240,X
A232 CA          Ê    DEX
A233 10 FA       .ú   BPL &A22F
A235 0E 15 C2    ..Â  ASL &C215
A238 2E 16 C2    ..Â  ROL &C216
A23B 2E 17 C2    ..Â  ROL &C217
A23E 2E 18 C2    ..Â  ROL &C218
A241 A2 00       ¢.   LDX #&00
A243 A0 09        .   LDY #&09
A245 BD 40 C2    ½@Â  LDA &C240,X
A248 2A          *    ROL A
A249 C9 0A       É.   CMP #&0A
A24B 90 02       ..   BCC &A24F
A24D E9 0A       é.   SBC #&0A
A24F 9D 40 C2    .@Â  STA &C240,X
A252 E8          è    INX
A253 88          .    DEY
A254 10 EF       .ï   BPL &A245
A256 CE 33 C2    Î3Â  DEC &C233
A259 10 DA       .Ú   BPL &A235
A25B A0 20            LDY #&20
A25D A2 08       ¢.   LDX #&08
A25F D0 02       Ð.   BNE &A263
A261 A0 2C        ,   LDY #&2C
A263 BD 40 C2    ½@Â  LDA &C240,X
A266 D0 08       Ð.   BNE &A270
A268 C0 2C       À,   CPY #&2C
A26A F0 04       ð.   BEQ &A270
A26C A9 20       ©    LDA #&20
A26E D0 05       Ð.   BNE &A275
A270 A0 2C        ,   LDY #&2C
A272 18          .    CLC
A273 69 30       i0   ADC #&30
A275 20 3C A0     <   JSR &A03C
A278 E0 06       à.   CPX #&06
A27A F0 04       ð.   BEQ &A280
A27C E0 03       à.   CPX #&03
A27E D0 04       Ð.   BNE &A284
A280 98          .    TYA
A281 20 3C A0     <   JSR &A03C
A284 CA          Ê    DEX
A285 10 D8       .Ø   BPL &A25F
A287 20 A8 92     ¨.  JSR &92A8
A28A 20 42 79     By  JSR &7942
A28D 74 65       te   STZ &65,X
A28F 73          s    EQUB &73
A290 A0 60        `   LDY #&60
A292 20 46 B5     Fµ  JSR &B546
A295 20 F3 8F     ó.  JSR &8FF3
A298 20 0D A5     .¥  JSR &A50D
A29B A0 00        .   LDY #&00
A29D B1 B4       ±´   LDA (&B4),Y
A29F 29 7F       ).   AND #&7F
A2A1 C9 22       É"   CMP #&22
A2A3 F0 04       ð.   BEQ &A2A9
A2A5 C9 20       É    CMP #&20
A2A7 B0 02       °.   BCS &A2AB
A2A9 A9 0D       ©.   LDA #&0D
A2AB 99 D9 C8    .ÙÈ  STA &C8D9,Y
A2AE C8          È    INY
A2AF C0 13       À.   CPY #&13
A2B1 D0 EA       Ðê   BNE &A29D
A2B3 4C 91 8F    L..  JMP &8F91

A2B6 20 0D A5     .¥  JSR &A50D
A2B9 A0 00        .   LDY #&00
A2BB B1 B4       ±´   LDA (&B4),Y
A2BD C9 21       É!   CMP #&21
A2BF B0 2A       °*   BCS &A2EB
A2C1 A9 84       ©.   LDA #&84
A2C3 20 F4 FF     ô.  JSR &FFF4
A2C6 8A          .    TXA
A2C7 D0 12       Ð.   BNE &A2DB
A2C9 98          .    TYA
A2CA 30 0F       0.   BMI &A2DB
A2CC 8D 60 C2    .`Â  STA &C260
A2CF A9 80       ©.   LDA #&80
A2D1 38          8    SEC
A2D2 ED 60 C2    í`Â  SBC &C260
A2D5 8D 61 C2    .aÂ  STA &C261
A2D8 4C 77 A3    Lw£  JMP &A377

A2DB 20 6B 83     k.  JSR &836B
A2DE 94 42       .B   STY &42,X
A2E0 61 64       ad   ADC (&64,X)
A2E2 20 63 6F     co  JSR &6F63
A2E5 6D 70 61    mpa  ADC &6170
A2E8 63          c    EQUB &63
A2E9 74 00       t.   STZ &00,X

A2EB 8D 15 C2    ..Â  STA &C215
A2EE C8          È    INY
A2EF B1 B4       ±´   LDA (&B4),Y
A2F1 8D 16 C2    ..Â  STA &C216
A2F4 C8          È    INY
A2F5 B1 B4       ±´   LDA (&B4),Y
A2F7 C9 20       É    CMP #&20
A2F9 F0 04       ð.   BEQ &A2FF
A2FB C9 2C       É,   CMP #&2C
A2FD D0 DC       ÐÜ   BNE &A2DB
A2FF C8          È    INY
A300 B1 B4       ±´   LDA (&B4),Y
A302 C9 20       É    CMP #&20
A304 F0 F9       ðù   BEQ &A2FF
A306 8D 17 C2    ..Â  STA &C217
A309 C8          È    INY
A30A B1 B4       ±´   LDA (&B4),Y
A30C 8D 18 C2    ..Â  STA &C218
A30F C9 21       É!   CMP #&21
A311 B0 0C       °.   BCS &A31F
A313 AD 17 C2    ­.Â  LDA &C217
A316 8D 18 C2    ..Â  STA &C218
A319 A9 30       ©0   LDA #&30
A31B 8D 17 C2    ..Â  STA &C217
A31E 88          .    DEY
A31F C8          È    INY
A320 B1 B4       ±´   LDA (&B4),Y
A322 C9 20       É    CMP #&20
A324 F0 F9       ðù   BEQ &A31F
A326 B0 B3       °³   BCS &A2DB
A328 A2 03       ¢.   LDX #&03
A32A BD 15 C2    ½.Â  LDA &C215,X
A32D C9 30       É0   CMP #&30
A32F 90 AA       .ª   BCC &A2DB
A331 C9 3A       É:   CMP #&3A
A333 B0 08       °.   BCS &A33D
A335 38          8    SEC
A336 E9 30       é0   SBC #&30
A338 9D 15 C2    ..Â  STA &C215,X
A33B 10 0F       ..   BPL &A34C
A33D 29 5F       )_   AND #&5F
A33F C9 41       ÉA   CMP #&41
A341 90 98       ..   BCC &A2DB
A343 C9 47       ÉG   CMP #&47
A345 B0 94       °.   BCS &A2DB
A347 E9 36       é6   SBC #&36
A349 9D 15 C2    ..Â  STA &C215,X
A34C CA          Ê    DEX
A34D 10 DB       .Û   BPL &A32A
A34F E8          è    INX
A350 20 89 A3     .£  JSR &A389
A353 30 86       0.   BMI &A2DB
A355 8D 60 C2    .`Â  STA &C260
A358 A2 02       ¢.   LDX #&02
A35A 20 89 A3     .£  JSR &A389
A35D 10 03       ..   BPL &A362
A35F 4C DB A2    LÛ¢  JMP &A2DB

A362 F0 FB       ðû   BEQ &A35F
A364 8D 61 C2    .aÂ  STA &C261
A367 18          .    CLC
A368 AD 60 C2    ­`Â  LDA &C260
A36B 6D 61 C2    maÂ  ADC &C261
A36E 10 07       ..   BPL &A377
A370 C9 80       É.   CMP #&80
A372 F0 03       ð.   BEQ &A377
A374 4C DB A2    LÛ¢  JMP &A2DB

A377 20 10 B2     .²  JSR &B210
A37A 20 28 83     (.  JSR &8328
A37D A9 08       ©.   LDA #&08
A37F 04 CD       .Í   TSB &CD
A381 20 B3 98     ³.  JSR &98B3
A384 A9 08       ©.   LDA #&08
A386 14 CD       .Í   TRB &CD
A388 60          `    RTS

A389 BD 15 C2    ½.Â  LDA &C215,X
A38C 0A          .    ASL A
A38D 0A          .    ASL A
A38E 0A          .    ASL A
A38F 0A          .    ASL A
A390 1D 16 C2    ..Â  ORA &C216,X
A393 60          `    RTS

A394 20 F5 A4     õ¤  JSR &A4F5
A397 A5 B5       ¥µ   LDA &B5
A399 48          H    PHA
A39A A5 B4       ¥´   LDA &B4
A39C 48          H    PHA
A39D 20 F5 A4     õ¤  JSR &A4F5
A3A0 A0 00        .   LDY #&00
A3A2 B1 B4       ±´   LDA (&B4),Y
A3A4 C9 20       É    CMP #&20
A3A6 B0 23       °#   BCS &A3CB
A3A8 68          h    PLA
A3A9 85 B4       .´   STA &B4
A3AB 8D 40 C2    .@Â  STA &C240
A3AE 68          h    PLA
A3AF 85 B5       .µ   STA &B5
A3B1 8D 41 C2    .AÂ  STA &C241
A3B4 60          `    RTS

A3B5 20 B1 A4     ±¤  JSR &A4B1
A3B8 20 D8 89     Ø.  JSR &89D8
A3BB AD D6 C2    ­ÖÂ  LDA &C2D6		Get FSC function
A3BE C9 0B       É.   CMP #&0B		Was this Run from libfs?
A3C0 F0 09       ð.   BEQ &A3CB		Yes, jump to error
A3C2 A9 0B       ©.   LDA #&0B		Otherwise, pass on to libfs
A3C4 A6 C0       ¦À   LDX &C0
A3C6 A4 C1       ¤Á   LDY &C1
A3C8 4C 4C 9A    LL.  JMP &9A4C		Pass on to FSC to call libfs

A3CB 20 6B 83     k.  JSR &836B		Generate error
A3CE FE 42 61    þBa  INC &6142,X	Error 254, 'Bad command'
A3D1 64 20       d    STZ &20
A3D3 63          c    EQUB &63
A3D4 6F 6D 6D    omm  BBR 6,&6D,&A444
A3D7 61 6E       an   ADC (&6E,X)
A3D9 64 00       d.   STZ &00

FSC 2,4,11 - */, *RUN, *RUN from library
========================================
A3DB A5 B4       ¥´   LDA &B4
A3DD 85 C0       .À   STA &C0
A3DF A5 B5       ¥µ   LDA &B5
A3E1 85 C1       .Á   STA &C1
A3E3 20 BE 8B     ¾.  JSR &8BBE
A3E6 F0 16       ð.   BEQ &A3FE
A3E8 20 D8 89     Ø.  JSR &89D8
A3EB A5 C0       ¥À   LDA &C0
A3ED 85 B4       .´   STA &B4
A3EF A5 C1       ¥Á   LDA &C1
A3F1 85 B5       .µ   STA &B5
A3F3 20 9E A4     .¤  JSR &A49E
A3F6 20 BE 8B     ¾.  JSR &8BBE
A3F9 D0 BA       Ðº   BNE &A3B5
A3FB 20 B1 A4     ±¤  JSR &A4B1
A3FE A5 B4       ¥´   LDA &B4
A400 8D A2 C2    .¢Â  STA &C2A2
A403 A5 B5       ¥µ   LDA &B5
A405 8D A3 C2    .£Â  STA &C2A3
A408 A0 0E        .   LDY #&0E
A40A B1 B6       ±¶   LDA (&B6),Y
A40C A2 02       ¢.   LDX #&02
A40E C8          È    INY
A40F 31 B6       1¶   AND (&B6),Y
A411 CA          Ê    DEX
A412 10 FA       .ú   BPL &A40E
A414 1A          .    INC A
A415 D0 13       Ð.   BNE &A42A
A417 A6 B6       ¦¶   LDX &B6
A419 A4 B7       ¤·   LDY &B7
A41B A9 40       ©@   LDA #&40
A41D 20 13 B2     .²  JSR &B213
A420 8D 32 C3    .2Ã  STA &C332
A423 A2 9C       ¢.   LDX #&9C		Point to E.-ADFS-$.!BOOT
A425 A0 9A        .   LDY #&9A
A427 4C F7 FF    L÷.  JMP &FFF7

A42A A0 0B        .   LDY #&0B
A42C B1 B6       ±¶   LDA (&B6),Y
A42E C8          È    INY
A42F 31 B6       1¶   AND (&B6),Y
A431 C8          È    INY
A432 31 B6       1¶   AND (&B6),Y
A434 1A          .    INC A
A435 D0 08       Ð.   BNE &A43F
A437 20 6B 83     k.  JSR &836B
A43A 93          .    EQUB &93
A43B 4E 6F 21    No!  LSR &216F
A43E 00          .    BRK
A43F A9 A5       ©¥   LDA #&A5
A441 8D A8 C2    .¨Â  STA &C2A8
A444 A2 A2       ¢¢   LDX #&A2
A446 A0 C2        Â   LDY #&C2
A448 86 B8       .¸   STX &B8
A44A 84 B9       .¹   STY &B9
A44C 20 BE 8B     ¾.  JSR &8BBE
A44F A0 04        .   LDY #&04
A451 B1 B6       ±¶   LDA (&B6),Y
A453 A0 00        .   LDY #&00
A455 11 B6       .¶   ORA (&B6),Y
A457 30 03       0.   BMI &A45C
A459 4C FB 8B    Lû.  JMP &8BFB

A45C 20 1B 8C     ..  JSR &8C1B
A45F AD AB C2    ­«Â  LDA &C2AB
A462 C9 FF       É.   CMP #&FF
A464 D0 0C       Ð.   BNE &A472
A466 AD AA C2    ­ªÂ  LDA &C2AA
A469 C9 FE       Éþ   CMP #&FE
A46B 90 05       ..   BCC &A472
A46D A9 01       ©.   LDA #&01
A46F 6C A8 C2    l¨Â  JMP (&C2A8)

A472 24 CD       $Í   BIT &CD
A474 10 F7       .÷   BPL &A46D
A476 20 32 80     2.  JSR &8032
A479 A2 A8       ¢¨   LDX #&A8
A47B A0 C2        Â   LDY #&C2
A47D A9 04       ©.   LDA #&04
A47F 4C 06 04    L..  JMP &0406

A482 20 86 94     ..  JSR &9486
A485 A0 09        .   LDY #&09
A487 B9 CC C8    ¹ÌÈ  LDA &C8CC,Y
A48A 99 0A C3    ..Ã  STA &C30A,Y
A48D 88          .    DEY
A48E 10 F7       .÷   BPL &A487
A490 A0 03        .   LDY #&03
A492 B9 14 C3    ¹.Ã  LDA &C314,Y
A495 99 18 C3    ..Ã  STA &C318,Y
A498 88          .    DEY
A499 10 F7       .÷   BPL &A492
A49B 4C D8 89    LØ.  JMP &89D8

A49E A0 03        .   LDY #&03
A4A0 B9 14 C3    ¹.Ã  LDA &C314,Y
A4A3 99 30 C2    .0Â  STA &C230,Y
A4A6 B9 18 C3    ¹.Ã  LDA &C318,Y
A4A9 99 2C C2    .,Â  STA &C22C,Y
A4AC 88          .    DEY
A4AD 10 F1       .ñ   BPL &A4A0
A4AF 30 EA       0ê   BMI &A49B
A4B1 A0 03        .   LDY #&03
A4B3 B9 30 C2    ¹0Â  LDA &C230,Y
A4B6 99 2C C2    .,Â  STA &C22C,Y
A4B9 88          .    DEY
A4BA 10 F7       .÷   BPL &A4B3
A4BC 60          `    RTS

A4BD 20 9E A4     .¤  JSR &A49E
A4C0 20 B1 A4     ±¤  JSR &A4B1
A4C3 20 DB 93     Û.  JSR &93DB
A4C6 4C D8 89    LØ.  JMP &89D8

A4C9 20 9E A4     .¤  JSR &A49E
A4CC 20 B1 A4     ±¤  JSR &A4B1
A4CF 20 3D 94     =.  JSR &943D
A4D2 4C D8 89    LØ.  JMP &89D8

A4D5 A0 03        .   LDY #&03
A4D7 B9 1C C3    ¹.Ã  LDA &C31C,Y
A4DA 99 2C C2    .,Â  STA &C22C,Y
A4DD B9 14 C3    ¹.Ã  LDA &C314,Y
A4E0 99 1C C3    ..Ã  STA &C31C,Y
A4E3 88          .    DEY
A4E4 10 F1       .ñ   BPL &A4D7
A4E6 20 D8 89     Ø.  JSR &89D8
A4E9 A0 09        .   LDY #&09
A4EB B9 CC C8    ¹ÌÈ  LDA &C8CC,Y
A4EE 99 00 C3    ..Ã  STA &C300,Y
A4F1 88          .    DEY
A4F2 10 F7       .÷   BPL &A4EB
A4F4 60          `    RTS

A4F5 A0 00        .   LDY #&00
A4F7 20 43 87     C.  JSR &8743
A4FA F0 03       ð.   BEQ &A4FF
A4FC C8          È    INY
A4FD D0 F8       Ðø   BNE &A4F7
A4FF C9 2E       É.   CMP #&2E
A501 F0 F9       ðù   BEQ &A4FC
A503 98          .    TYA
A504 18          .    CLC
A505 65 B4       e´   ADC &B4
A507 85 B4       .´   STA &B4
A509 90 02       ..   BCC &A50D
A50B E6 B5       æµ   INC &B5

A50D A0 00        .   LDY #&00
A50F 18          .    CLC
A510 08          .    PHP
A511 B1 B4       ±´   LDA (&B4),Y	Get current character
A513 C9 20       É    CMP #&20		Is it a space?
A515 90 11       ..   BCC &A528		Control character,
A517 F0 0C       ð.   BEQ &A525		Space,
A519 C9 22       É"   CMP #&22		Is it a quote?
A51B D0 0B       Ð.   BNE &A528
A51D 28          (    PLP
A51E 90 03       ..   BCC &A523
A520 4C 60 87    L`.  JMP &8760

A523 38          8    SEC
A524 08          .    PHP
A525 C8          È    INY
A526 D0 E9       Ðé   BNE &A511
A528 98          .    TYA
A529 28          (    PLP
A52A 18          .    CLC
A52B 65 B4       e´   ADC &B4
A52D 85 B4       .´   STA &B4
A52F 90 02       ..   BCC &A533
A531 E6 B5       æµ   INC &B5
A533 60          `    RTS

A534 A0 00        .   LDY #&00
A536 B1 B4       ±´   LDA (&B4),Y
A538 29 7F       ).   AND #&7F
A53A C9 3A       É:   CMP #&3A
A53C D0 F5       Ðõ   BNE &A533
A53E 4C 88 89    L..  JMP &8988

A541 A5 B4       ¥´   LDA &B4
A543 48          H    PHA
A544 A5 B5       ¥µ   LDA &B5
A546 48          H    PHA
A547 20 34 A5     4¥  JSR &A534
A54A 20 C8 8D     È.  JSR &8DC8
A54D 20 F0 8B     ð.  JSR &8BF0
A550 F0 03       ð.   BEQ &A555
A552 4C D3 8B    LÓ.  JMP &8BD3

A555 A0 03        .   LDY #&03
A557 B1 B6       ±¶   LDA (&B6),Y
A559 20 D8 89     Ø.  JSR &89D8
A55C 10 22       ."   BPL &A580
A55E FA          ú    PLX
A55F 68          h    PLA
A560 85 B4       .´   STA &B4
A562 86 B5       .µ   STX &B5
A564 48          H    PHA
A565 DA          Ú    PHX
A566 A0 00        .   LDY #&00
A568 B1 B4       ±´   LDA (&B4),Y
A56A 29 7D       )}   AND #&7D
A56C C9 24       É$   CMP #&24
A56E F0 CE       ðÎ   BEQ &A53E
A570 20 43 87     C.  JSR &8743
A573 F0 07       ð.   BEQ &A57C
A575 C9 5E       É^   CMP #&5E
A577 F0 C5       ðÅ   BEQ &A53E
A579 C8          È    INY
A57A D0 F4       Ðô   BNE &A570
A57C C9 2E       É.   CMP #&2E
A57E F0 F9       ðù   BEQ &A579
A580 20 94 A3     .£  JSR &A394
A583 20 34 A5     4¥  JSR &A534
A586 A9 40       ©@   LDA #&40
A588 85 B8       .¸   STA &B8
A58A A9 C2       ©Â   LDA #&C2
A58C 85 B9       .¹   STA &B9
A58E 20 ED 8C     í.  JSR &8CED
A591 08          .    PHP
A592 20 01 8E     ..  JSR &8E01
A595 28          (    PLP
A596 D0 0D       Ð.   BNE &A5A5
A598 A5 B6       ¥¶   LDA &B6
A59A A0 03        .   LDY #&03
A59C 99 34 C2    .4Â  STA &C234,Y
A59F B9 13 C3    ¹.Ã  LDA &C313,Y
A5A2 88          .    DEY
A5A3 10 F7       .÷   BPL &A59C
A5A5 AD 2E C2    ­.Â  LDA &C22E
A5A8 10 0B       ..   BPL &A5B5
A5AA A0 02        .   LDY #&02
A5AC B9 14 C3    ¹.Ã  LDA &C314,Y
A5AF 99 2C C2    .,Â  STA &C22C,Y
A5B2 88          .    DEY
A5B3 10 F7       .÷   BPL &A5AC
A5B5 20 D8 89     Ø.  JSR &89D8
A5B8 FA          ú    PLX
A5B9 68          h    PLA
A5BA 85 B4       .´   STA &B4
A5BC 86 B5       .µ   STX &B5
A5BE 48          H    PHA
A5BF DA          Ú    PHX
A5C0 20 E8 8F     è.  JSR &8FE8
A5C3 20 1B 8D     ..  JSR &8D1B
A5C6 A0 03        .   LDY #&03
A5C8 A5 B6       ¥¶   LDA &B6
A5CA D9 34 C2    Ù4Â  CMP &C234,Y
A5CD D0 56       ÐV   BNE &A625
A5CF B9 13 C3    ¹.Ã  LDA &C313,Y
A5D2 88          .    DEY
A5D3 10 F5       .õ   BPL &A5CA
A5D5 68          h    PLA
A5D6 85 B5       .µ   STA &B5
A5D8 68          h    PLA
A5D9 85 B4       .´   STA &B4
A5DB 20 94 A3     .£  JSR &A394
A5DE A0 00        .   LDY #&00
A5E0 B1 B4       ±´   LDA (&B4),Y
A5E2 C9 2E       É.   CMP #&2E
A5E4 F0 09       ð.   BEQ &A5EF
A5E6 29 7D       )}   AND #&7D
A5E8 C9 21       É!   CMP #&21
A5EA 90 0E       ..   BCC &A5FA
A5EC C8          È    INY
A5ED 80 F1       .ñ   BRA &A5E0

A5EF 98          .    TYA
A5F0 65 B4       e´   ADC &B4
A5F2 85 B4       .´   STA &B4
A5F4 90 E8       .è   BCC &A5DE
A5F6 E6 B5       æµ   INC &B5
A5F8 D0 E4       Ðä   BNE &A5DE
A5FA A0 09        .   LDY #&09
A5FC B1 B6       ±¶   LDA (&B6),Y
A5FE 29 80       ).   AND #&80
A600 8D 2B C2    .+Â  STA &C22B
A603 B1 B4       ±´   LDA (&B4),Y
A605 29 7F       ).   AND #&7F
A607 C9 22       É"   CMP #&22
A609 F0 04       ð.   BEQ &A60F
A60B C9 21       É!   CMP #&21
A60D B0 02       °.   BCS &A611
A60F A9 0D       ©.   LDA #&0D
A611 0D 2B C2    .+Â  ORA &C22B
A614 91 B6       .¶   STA (&B6),Y
A616 88          .    DEY
A617 10 E3       .ã   BPL &A5FC
A619 20 91 8F     ..  JSR &8F91
A61C 20 BB A6     »¦  JSR &A6BB
A61F 4C D8 89    LØ.  JMP &89D8

A622 4C AB 95    L«.  JMP &95AB

A625 AD 37 C2    ­7Â  LDA &C237
A628 D0 F8       Ðø   BNE &A622
A62A A0 09        .   LDY #&09
A62C B1 B6       ±¶   LDA (&B6),Y
A62E 09 80       ..   ORA #&80
A630 91 B6       .¶   STA (&B6),Y
A632 20 91 8F     ..  JSR &8F91
A635 A0 0A        .   LDY #&0A
A637 A2 07       ¢.   LDX #&07
A639 B1 B6       ±¶   LDA (&B6),Y
A63B 99 38 C2    .8Â  STA &C238,Y
A63E C8          È    INY
A63F CA          Ê    DEX
A640 10 F7       .÷   BPL &A639
A642 9C 4A C2    .JÂ  STZ &C24A
A645 9C 4B C2    .KÂ  STZ &C24B
A648 9C 4C C2    .LÂ  STZ &C24C
A64B 9C 4D C2    .MÂ  STZ &C24D
A64E A2 03       ¢.   LDX #&03
A650 B1 B6       ±¶   LDA (&B6),Y
A652 99 3C C2    .<Â  STA &C23C,Y
A655 C8          È    INY
A656 CA          Ê    DEX
A657 10 F7       .÷   BPL &A650
A659 A0 00        .   LDY #&00
A65B B1 B6       ±¶   LDA (&B6),Y
A65D 2A          *    ROL A
A65E 2E 5D C2    .]Â  ROL &C25D
A661 C8          È    INY
A662 C0 04       À.   CPY #&04
A664 D0 F5       Ðõ   BNE &A65B
A666 20 94 A3     .£  JSR &A394
A669 A0 18        .   LDY #&18
A66B A2 02       ¢.   LDX #&02
A66D B1 B6       ±¶   LDA (&B6),Y
A66F 9D 3A C2    .:Â  STA &C23A,X
A672 88          .    DEY
A673 CA          Ê    DEX
A674 10 F7       .÷   BPL &A66D
A676 20 D8 89     Ø.  JSR &89D8
A679 A9 40       ©@   LDA #&40
A67B 85 B8       .¸   STA &B8
A67D A9 C2       ©Â   LDA #&C2
A67F 85 B9       .¹   STA &B9
A681 20 FE 8D     þ.  JSR &8DFE
A684 20 7A 8E     z.  JSR &8E7A
A687 A0 03        .   LDY #&03
A689 B1 B6       ±¶   LDA (&B6),Y
A68B 0A          .    ASL A
A68C 6E 5D C2    n]Â  ROR &C25D
A68F 6A          j    ROR A
A690 91 B6       .¶   STA (&B6),Y
A692 88          .    DEY
A693 10 F4       .ô   BPL &A689
A695 20 96 8E     ..  JSR &8E96
A698 20 63 8F     c.  JSR &8F63
A69B 20 91 8F     ..  JSR &8F91
A69E 20 BB A6     »¦  JSR &A6BB
A6A1 20 D8 89     Ø.  JSR &89D8
A6A4 68          h    PLA
A6A5 85 B5       .µ   STA &B5
A6A7 68          h    PLA
A6A8 85 B4       .´   STA &B4
A6AA 20 E8 8F     è.  JSR &8FE8
A6AD A2 05       ¢.   LDX #&05
A6AF 9E 34 C2    .4Â  STZ &C234,X
A6B2 CA          Ê    DEX
A6B3 10 FA       .ú   BPL &A6AF
A6B5 20 1B 92     ..  JSR &921B
A6B8 4C D8 89    LØ.  JMP &89D8

A6BB A0 03        .   LDY #&03
A6BD B1 B6       ±¶   LDA (&B6),Y
A6BF 30 01       0.   BMI &A6C2
A6C1 60          `    RTS

A6C2 A0 02        .   LDY #&02
A6C4 B9 14 C3    ¹.Ã  LDA &C314,Y
A6C7 99 70 C2    .pÂ  STA &C270,Y
A6CA 88          .    DEY
A6CB 10 F7       .÷   BPL &A6C4
A6CD A0 09        .   LDY #&09
A6CF B1 B6       ±¶   LDA (&B6),Y
A6D1 29 7F       ).   AND #&7F
A6D3 99 74 C2    .tÂ  STA &C274,Y
A6D6 88          .    DEY
A6D7 10 F6       .ö   BPL &A6CF
A6D9 A9 74       ©t   LDA #&74
A6DB 85 B4       .´   STA &B4
A6DD A9 C2       ©Â   LDA #&C2
A6DF 85 B5       .µ   STA &B5
A6E1 20 86 94     ..  JSR &9486
A6E4 A0 09        .   LDY #&09
A6E6 B9 74 C2    ¹tÂ  LDA &C274,Y
A6E9 99 CC C8    .ÌÈ  STA &C8CC,Y
A6EC 88          .    DEY
A6ED 10 F7       .÷   BPL &A6E6
A6EF A0 02        .   LDY #&02
A6F1 B9 70 C2    ¹pÂ  LDA &C270,Y
A6F4 99 D6 C8    .ÖÈ  STA &C8D6,Y
A6F7 88          .    DEY
A6F8 10 F7       .÷   BPL &A6F1
A6FA 4C 91 8F    L..  JMP &8F91

Check loaded directory
----------------------
A6FD AE 17 C3    ®.Ã  LDX &C317		Get current drive
A700 E8          è    INX		If &FF, no directory loaded
A701 D0 2B       Ð+   BNE &A72E		Directory loaded, exit
A703 20 72 83     r.  JSR &8372		Generate error
A706 A9 4E       ©N   LDA #&4E		"No directory"
A708 6F 20 64    o d  BBR 6,&20,&A76F
A70B 69 72       ir   ADC #&72
A70D 65 63       ec   ADC &63
A70F 74 6F       to   STZ &6F,X
A711 72 79       ry   ADC (&79)
A713 00          .    BRK

A714 20 FD A6     ý¦  JSR &A6FD		Check if directory loaded
A717 A2 00       ¢.   LDX #&00		Point to first character to check
A719 AD FA C8    ­úÈ  LDA &C8FA		Get initial character
A71C DD 00 C4    Ý.Ä  CMP &C400,X	Check "Hugo" string at start of dir
A71F D0 0E       Ð.   BNE &A72F		Jump to give broken dir error
A721 DD FA C8    ÝúÈ  CMP &C8FA,X	Check "Hugo" string at end of dir
A724 D0 09       Ð.   BNE &A72F		Jump to give broken dir error
A726 E8          è    INX		Move to next char
A727 BD DC 84    ½Ü.  LDA &84DC,X	Get byte from "Hugo" string
A72A E0 05       à.   CPX #&05
A72C D0 EE       Ðî   BNE &A71C		Loop for 4 characters
A72E 60          `    RTS

A72F 20 4E 83     N.  JSR &834E		Generate error
A732 A8          ¨    TAY		"Broken directory"
A733 42          B    EQUB &42
A734 72 6F       ro   ADC (&6F)
A736 6B          k    ROR A
A737 65 6E       en   ADC &6E
A739 20 64 69     di  JSR &6964
A73C 72 65       re   ADC (&65)
A73E 63          c    EQUB &63
A73F 74 6F       to   STZ &6F,X
A741 72 79       ry   ADC (&79)
A743 00          .    BRK


Get pointer to workspace into &BA/B
===================================
A744 A6 F4       ¦ô   LDX &F4
A746 BD F0 0D    ½ð.  LDA &0DF0,X
A749 85 BB       .»   STA &BB
A74B A9 00       ©.   LDA #&00
A74D 85 BA       .º   STA &BA
A74F 60          `    RTS


Calculate workspace checksum
----------------------------
A750 20 44 A7     D§  JSR &A744		Find workspace
A753 A0 FD        ý   LDY #&FD
A755 98          .    TYA
A756 18          .    CLC
A757 71 BA       qº   ADC (&BA),Y	Add up contents of workspace
A759 88          .    DEY
A75A D0 FB       Ðû   BNE &A757		Loop for 252 bytes
A75C 71 BA       qº   ADC (&BA),Y	Add zeroth byte
A75E A0 FE        þ   LDY #&FE		Point to checksum
A760 60          `    RTS

Set workspace checksum
----------------------
A761 20 50 A7     P§  JSR &A750		Calculate workspace checksum
A764 91 BA       .º   STA (&BA),Y	Store checksum
A766 60          `    RTS

Check workspace checksum
------------------------
A767 20 50 A7     P§  JSR &A750		Calculate workspace checksum
A76A D1 BA       Ñº   CMP (&BA),Y	Does it match?
A76C F0 F8       ðø   BEQ &A766		Exit if it does
A76E A9 0F       ©.   LDA #&0F
A770 8D CE C2    .ÎÂ  STA &C2CE
A773 20 72 83     r.  JSR &8372		Generate error
A776 AA          ª    TAX		"Bad sum"
A777 42          B    EQUB &42
A778 61 64       ad   ADC (&64,X)
A77A 20 73 75     su  JSR &7573
A77D 6D 00 08    m..  ADC &0800


A77F 08          .    PHP		Save all registers
A780 48          H    PHA
A781 5A          Z    PHY
A782 DA          Ú    PHX
A783 AD CE C2    ­ÎÂ  LDA &C2CE		Get workspace checksum
A786 D0 E6       Ðæ   BNE &A76E		If nonzero, generate 'Bad sum' error
A788 20 F3 8F     ó.  JSR &8FF3		Check FSM checksum
A78B 18          .    CLC
A78C A2 10       ¢.   LDX #&10
A78E BD 04 C2    ½.Â  LDA &C204,X
A791 29 21       )!   AND #&21
A793 F0 06       ð.   BEQ &A79B
A795 B0 D7       °×   BCS &A76E
A797 C9 01       É.   CMP #&01
A799 D0 D3       ÐÓ   BNE &A76E
A79B CA          Ê    DEX
A79C CA          Ê    DEX
A79D CA          Ê    DEX
A79E CA          Ê    DEX
A79F 10 ED       .í   BPL &A78E
A7A1 90 CB       .Ë   BCC &A76E
A7A3 20 C9 A7     É§  JSR &A7C9
A7A6 CD C1 C2    ÍÁÂ  CMP &C2C1
A7A9 D0 C3       ÐÃ   BNE &A76E
A7AB 48          H    PHA		Create two spaces on stack
A7AC 48          H    PHA
A7AD A0 05        .   LDY #&05		Move stack down two bytes
A7AF BA          º    TSX
A7B0 BD 03 01    ½..  LDA &0103,X
A7B3 9D 01 01    ...  STA &0101,X
A7B6 E8          è    INX
A7B7 88          .    DEY
A7B8 10 F6       .ö   BPL &A7B0
A7BA A9 D3       ©Ó   LDA #&D3
A7BC 9D 01 01    ...  STA &0101,X
A7BF A9 A7       ©§   LDA #&A7
A7C1 9D 02 01    ...  STA &0102,X	Force return address to &A7D4
A7C4 FA          ú    PLX
A7C5 7A          z    PLY
A7C6 68          h    PLA
A7C7 28          (    PLP
A7C8 60          `    RTS

A7C9 A2 78       ¢x   LDX #&78
A7CB 8A          .    TXA
A7CC 18          .    CLC
A7CD 7D 83 C3    }.Ã  ADC &C383,X
A7D0 CA          Ê    DEX
A7D1 D0 FA       Ðú   BNE &A7CD
A7D3 60          `    RTS

A7D4 08          .    PHP		Save all registers
A7D5 48          H    PHA
A7D6 5A          Z    PHY
A7D7 DA          Ú    PHX
A7D8 20 C9 A7     É§  JSR &A7C9
A7DB 8D C1 C2    .ÁÂ  STA &C2C1
A7DE 9C CE C2    .ÎÂ  STZ &C2CE
A7E1 9C D5 C2    .ÕÂ  STZ &C2D5
A7E4 9C D9 C2    .ÙÂ  STZ &C2D9
A7E7 FA          ú    PLX
A7E8 7A          z    PLY
A7E9 68          h    PLA
A7EA 28          (    PLP
A7EB 60          `    RTS

A7EC AD 91 C2    ­.Â  LDA &C291
A7EF 85 B4       .´   STA &B4
A7F1 AD 92 C2    ­.Â  LDA &C292
A7F4 85 B5       .µ   STA &B5
A7F6 AD 94 C2    ­.Â  LDA &C294
A7F9 85 B7       .·   STA &B7
A7FB AD 93 C2    ­.Â  LDA &C293
A7FE 85 B6       .¶   STA &B6
A800 A2 0B       ¢.   LDX #&0B
A802 BD 3B 88    ½;.  LDA &883B,X
A805 9D 14 C2    ..Â  STA &C214,X
A808 CA          Ê    DEX
A809 D0 F7       Ð÷   BNE &A802
A80B A0 03        .   LDY #&03
A80D B9 6C C2    ¹lÂ  LDA &C26C,Y
A810 99 14 C3    ..Ã  STA &C314,Y
A813 E0 00       à.   CPX #&00
A815 F0 03       ð.   BEQ &A81A
A817 9D 1A C2    ..Â  STA &C21A,X
A81A E8          è    INX
A81B 88          .    DEY
A81C 10 EF       .ï   BPL &A80D
A81E 4C AA 82    Lª.  JMP &82AA

A821 A2 0B       ¢.   LDX #&0B
A823 BD 3B 88    ½;.  LDA &883B,X
A826 9D 14 C2    ..Â  STA &C214,X
A829 CA          Ê    DEX
A82A D0 F7       Ð÷   BNE &A823
A82C A0 03        .   LDY #&03
A82E B9 70 C2    ¹pÂ  LDA &C270,Y
A831 99 14 C3    ..Ã  STA &C314,Y
A834 E0 00       à.   CPX #&00
A836 F0 03       ð.   BEQ &A83B
A838 9D 1A C2    ..Â  STA &C21A,X
A83B E8          è    INX
A83C 88          .    DEY
A83D 10 EF       .ï   BPL &A82E
A83F 20 AA 82     ª.  JSR &82AA
A842 A2 31       ¢1   LDX #&31
A844 A0 88        .   LDY #&88
A846 4C AE 82    L®.  JMP &82AE

A849 A9 7F       ©.   LDA #&7F
A84B 85 B8       .¸   STA &B8
A84D A9 C2       ©Â   LDA #&C2
A84F 85 B9       .¹   STA &B9
A851 A9 74       ©t   LDA #&74
A853 8D 7F C2    ..Â  STA &C27F
A856 A9 C2       ©Â   LDA #&C2
A858 8D 80 C2    ..Â  STA &C280
A85B 20 BE 8B     ¾.  JSR &8BBE
A85E F0 03       ð.   BEQ &A863
A860 4C D3 8B    LÓ.  JMP &8BD3

A863 A5 B6       ¥¶   LDA &B6
A865 8D 93 C2    ..Â  STA &C293
A868 A5 B7       ¥·   LDA &B7
A86A 8D 94 C2    ..Â  STA &C294
A86D A5 B4       ¥´   LDA &B4
A86F 8D 91 C2    ..Â  STA &C291
A872 A5 B5       ¥µ   LDA &B5
A874 8D 92 C2    ..Â  STA &C292
A877 A0 03        .   LDY #&03
A879 B9 14 C3    ¹.Ã  LDA &C314,Y
A87C 99 6C C2    .lÂ  STA &C26C,Y
A87F 88          .    DEY
A880 10 F7       .÷   BPL &A879
A882 20 D8 89     Ø.  JSR &89D8
A885 A0 03        .   LDY #&03
A887 B9 14 C3    ¹.Ã  LDA &C314,Y
A88A 99 2C C2    .,Â  STA &C22C,Y
A88D 88          .    DEY
A88E 10 F7       .÷   BPL &A887
A890 20 94 A3     .£  JSR &A394
A893 20 43 87     C.  JSR &8743
A896 D0 03       Ð.   BNE &A89B
A898 4C 60 87    L`.  JMP &8760

A89B 20 86 94     ..  JSR &9486
A89E 20 F3 8F     ó.  JSR &8FF3
A8A1 A0 03        .   LDY #&03
A8A3 B9 14 C3    ¹.Ã  LDA &C314,Y
A8A6 99 70 C2    .pÂ  STA &C270,Y
A8A9 88          .    DEY
A8AA 10 F7       .÷   BPL &A8A3
A8AC 20 EC A7     ì§  JSR &A7EC
A8AF A0 04        .   LDY #&04
A8B1 B1 B6       ±¶   LDA (&B6),Y
A8B3 88          .    DEY
A8B4 11 B6       .¶   ORA (&B6),Y
A8B6 10 0F       ..   BPL &A8C7
A8B8 24 FF       $.   BIT &FF
A8BA 10 03       ..   BPL &A8BF
A8BC 4C CC 82    LÌ.  JMP &82CC

A8BF 20 64 89     d.  JSR &8964
A8C2 F0 EB       ðë   BEQ &A8AF
A8C4 4C D8 89    LØ.  JMP &89D8

A8C7 A5 B6       ¥¶   LDA &B6
A8C9 8D 93 C2    ..Â  STA &C293
A8CC A5 B7       ¥·   LDA &B7
A8CE 8D 94 C2    ..Â  STA &C294
A8D1 20 6D 8C     m.  JSR &8C6D
A8D4 A0 16        .   LDY #&16
A8D6 B1 B6       ±¶   LDA (&B6),Y
A8D8 8D A2 C2    .¢Â  STA &C2A2
A8DB C8          È    INY
A8DC B1 B6       ±¶   LDA (&B6),Y
A8DE 8D A3 C2    .£Â  STA &C2A3
A8E1 C8          È    INY
A8E2 B1 B6       ±¶   LDA (&B6),Y
A8E4 0D 17 C3    ..Ã  ORA &C317
A8E7 8D A4 C2    .¤Â  STA &C2A4
A8EA A2 00       ¢.   LDX #&00
A8EC A0 03        .   LDY #&03
A8EE B9 89 C2    ¹.Â  LDA &C289,Y
A8F1 99 8D C2    ..Â  STA &C28D,Y
A8F4 8A          .    TXA
A8F5 99 89 C2    ..Â  STA &C289,Y
A8F8 88          .    DEY
A8F9 10 F3       .ó   BPL &A8EE
A8FB A0 09        .   LDY #&09
A8FD B1 B6       ±¶   LDA (&B6),Y
A8FF 29 7F       ).   AND #&7F
A901 99 74 C2    .tÂ  STA &C274,Y
A904 88          .    DEY
A905 10 F6       .ö   BPL &A8FD
A907 A9 0D       ©.   LDA #&0D
A909 8D 7E C2    .~Â  STA &C27E
A90C 20 21 A8     !¨  JSR &A821
A90F 20 FE 8D     þ.  JSR &8DFE
A912 20 7A 8E     z.  JSR &8E7A
A915 20 5D 8F     ].  JSR &8F5D
A918 A0 02        .   LDY #&02
A91A B9 3A C2    ¹:Â  LDA &C23A,Y
A91D 99 A8 C2    .¨Â  STA &C2A8,Y
A920 B9 3D C2    ¹=Â  LDA &C23D,Y
A923 99 A5 C2    .¥Â  STA &C2A5,Y
A926 88          .    DEY
A927 10 F1       .ñ   BPL &A91A
A929 A9 83       ©.   LDA #&83
A92B 20 F4 FF     ô.  JSR &FFF4
A92E 8C 60 C2    .`Â  STY &C260
A931 A9 84       ©.   LDA #&84
A933 20 F4 FF     ô.  JSR &FFF4
A936 98          .    TYA
A937 38          8    SEC
A938 ED 60 C2    í`Â  SBC &C260
A93B 8D 61 C2    .aÂ  STA &C261
A93E A9 08       ©.   LDA #&08
A940 04 CD       .Í   TSB &CD
A942 AD 6F C2    ­oÂ  LDA &C26F
A945 0D A4 C2    .¤Â  ORA &C2A4
A948 8D A4 C2    .¤Â  STA &C2A4
A94B AD 73 C2    ­sÂ  LDA &C273
A94E 0D AA C2    .ªÂ  ORA &C2AA
A951 8D AA C2    .ªÂ  STA &C2AA
A954 AD 17 C3    ­.Ã  LDA &C317
A957 48          H    PHA
A958 A9 00       ©.   LDA #&00
A95A 8D 17 C3    ..Ã  STA &C317
A95D 20 AC 96     ¬.  JSR &96AC
A960 68          h    PLA
A961 8D 17 C3    ..Ã  STA &C317
A964 20 91 8F     ..  JSR &8F91
A967 20 EC A7     ì§  JSR &A7EC
A96A 4C B8 A8    L¸¨  JMP &A8B8

FSC 6 - New FS taking over
==========================
A96D AE 17 C3    ®.Ã  LDX &C317
A970 E8          è    INX
A971 F0 10       ð.   BEQ &A983
A973 20 D8 89     Ø.  JSR &89D8
A976 A9 FF       ©.   LDA #&FF		Continue into OSARGS &FF,0
A978 A0 00        .   LDY #&00		 to ensure all files

OSARGS
======
A97A C0 00       À.   CPY #&00
A97C D0 2A       Ð*   BNE &A9A8		Jump with OSARGS Y<>0, info on channel
A97E A8          ¨    TAY
A97F D0 03       Ð.   BNE &A984		Jump with OSARGS Y=0, info on filing system
A981 A9 08       ©.   LDA #&08		OSARGS 0,0 - return filing system number
A983 60          `    RTS

OSARGS Y=0 - Info on filing system
----------------------------------
A984 20 7F A7     .§  JSR &A77F		Check FSM
A987 86 C3       .Ã   STX &C3		Store X, pointer to data word in zero page
A989 88          .    DEY		Y=&FF
A98A D0 06       Ð.   BNE &A992		Jump forward

Exit OSARGS Y=0
---------------
A98C A6 C3       ¦Ã   LDX &C3		Restore X
A98E A9 00       ©.   LDA #&00		A=0
A990 A8          ¨    TAY		Y=0
A991 60          `    RTS

OSARGS Y=0 - implement all calls as ENSURE (A=&FF)
--------------------------------------------------
A992 A2 10       ¢.   LDX #&10
A994 20 06 AB     .«  JSR &AB06		Check things
A997 9E 04 C2    ..Â  STZ &C204,X
A99A CA          Ê    DEX
A99B CA          Ê    DEX
A99C CA          Ê    DEX
A99D CA          Ê    DEX
A99E 10 F4       .ô   BPL &A994
A9A0 EE 04 C2    î.Â  INC &C204
A9A3 20 28 83     (.  JSR &8328		Wait for ensuring to complete
A9A6 80 E4       .ä   BRA &A98C		Exit

OSARGS Y<>0 - Info on open channel
----------------------------------
A9A8 20 7F A7     .§  JSR &A77F		Check FSM
A9AB 86 C3       .Ã   STX &C3		Store X, pointer to data word in zero page
A9AD 48          H    PHA
A9AE 20 0D AD     .­  JSR &AD0D		Check channel and channel flags
A9B1 20 E9 B1     é±  JSR &B1E9
A9B4 68          h    PLA		Get action back
A9B5 A4 CF       ¤Ï   LDY &CF		Y=offset to channel info
A9B7 AA          ª    TAX
A9B8 D0 20       Ð    BNE &A9DA		Jump if not 0, not =PTR

OSARGS 0,Y - Read PTR
---------------------
A9BA A6 C3       ¦Ã   LDX &C3		Get pointer to data word
A9BC B9 7A C3    ¹zÃ  LDA &C37A,Y	Copy PTR to data word
A9BF 95 00       ..   STA &00,X
A9C1 B9 70 C3    ¹pÃ  LDA &C370,Y
A9C4 95 01       ..   STA &01,X
A9C6 B9 66 C3    ¹fÃ  LDA &C366,Y
A9C9 95 02       ..   STA &02,X
A9CB B9 5C C3    ¹\Ã  LDA &C35C,Y
A9CE 95 03       ..   STA &03,X
A9D0 20 9C B1     .±  JSR &B19C
A9D3 A9 00       ©.   LDA #&00		A=0 - action done
A9D5 A6 C3       ¦Ã   LDX &C3		Restore X,Y
A9D7 A4 C2       ¤Â   LDY &C2
A9D9 60          `    RTS

OSARGS 1,Y - Write PTR
----------------------
A9DA CA          Ê    DEX
A9DB D0 7C       Ð|   BNE &AA59		Jump if not 1, not PTR=
A9DD B9 AC C3    ¹¬Ã  LDA &C3AC,Y
A9E0 10 34       .4   BPL &AA16
A9E2 A6 C3       ¦Ã   LDX &C3
A9E4 B5 00       µ.   LDA &00,X
A9E6 8D 9A C2    ..Â  STA &C29A
A9E9 B5 01       µ.   LDA &01,X
A9EB 8D 9B C2    ..Â  STA &C29B
A9EE B5 02       µ.   LDA &02,X
A9F0 8D 9C C2    ..Â  STA &C29C
A9F3 B5 03       µ.   LDA &03,X
A9F5 8D 9D C2    ..Â  STA &C29D
A9F8 20 68 AE     h®  JSR &AE68
A9FB A6 C3       ¦Ã   LDX &C3
A9FD A4 CF       ¤Ï   LDY &CF
A9FF B5 00       µ.   LDA &00,X
AA01 99 7A C3    .zÃ  STA &C37A,Y
AA04 B5 01       µ.   LDA &01,X
AA06 99 70 C3    .pÃ  STA &C370,Y
AA09 B5 02       µ.   LDA &02,X
AA0B 99 66 C3    .fÃ  STA &C366,Y
AA0E B5 03       µ.   LDA &03,X
AA10 99 5C C3    .\Ã  STA &C35C,Y
AA13 4C D0 A9    LÐ©  JMP &A9D0

AA16 A6 C3       ¦Ã   LDX &C3
AA18 A4 CF       ¤Ï   LDY &CF
AA1A 38          8    SEC
AA1B B9 52 C3    ¹RÃ  LDA &C352,Y
AA1E F5 00       õ.   SBC &00,X
AA20 B9 48 C3    ¹HÃ  LDA &C348,Y
AA23 F5 01       õ.   SBC &01,X
AA25 B9 3E C3    ¹>Ã  LDA &C33E,Y
AA28 F5 02       õ.   SBC &02,X
AA2A B9 34 C3    ¹4Ã  LDA &C334,Y
AA2D F5 03       õ.   SBC &03,X
AA2F 90 17       ..   BCC &AA48
AA31 B5 00       µ.   LDA &00,X
AA33 99 7A C3    .zÃ  STA &C37A,Y
AA36 B5 01       µ.   LDA &01,X
AA38 99 70 C3    .pÃ  STA &C370,Y
AA3B B5 02       µ.   LDA &02,X
AA3D 99 66 C3    .fÃ  STA &C366,Y
AA40 B5 03       µ.   LDA &03,X
AA42 99 5C C3    .\Ã  STA &C35C,Y
AA45 4C D0 A9    LÐ©  JMP &A9D0

AA48 20 6B 83     k.  JSR &836B
AA4B B7 4F       ·O   LDY &4F,X
AA4D 75 74       ut   ADC &74,X
AA4F 73          s    EQUB &73
AA50 69 64       id   ADC #&64
AA52 65 20       e    ADC &20
AA54 66 69       fi   ROR &69
AA56 6C 65 00    le.  JMP (&0065)

OSARGS 2,Y - Read EXT
---------------------
AA59 CA          Ê    DEX
AA5A D0 19       Ð.   BNE &AA75
AA5C A6 C3       ¦Ã   LDX &C3
AA5E B9 52 C3    ¹RÃ  LDA &C352,Y
AA61 95 00       ..   STA &00,X
AA63 B9 48 C3    ¹HÃ  LDA &C348,Y
AA66 95 01       ..   STA &01,X
AA68 B9 3E C3    ¹>Ã  LDA &C33E,Y
AA6B 95 02       ..   STA &02,X
AA6D B9 34 C3    ¹4Ã  LDA &C334,Y
AA70 95 03       ..   STA &03,X
AA72 4C D0 A9    LÐ©  JMP &A9D0

OSARGS 3,Y - Write EXT
----------------------
AA75 CA          Ê    DEX
AA76 D0 41       ÐA   BNE &AAB9
AA78 A6 C3       ¦Ã   LDX &C3
AA7A B9 AC C3    ¹¬Ã  LDA &C3AC,Y
AA7D 30 03       0.   BMI &AA82
AA7F 4C FA B0    Lú°  JMP &B0FA

AA82 B5 00       µ.   LDA &00,X
AA84 8D 9A C2    ..Â  STA &C29A
AA87 B5 01       µ.   LDA &01,X
AA89 8D 9B C2    ..Â  STA &C29B
AA8C B5 02       µ.   LDA &02,X
AA8E 8D 9C C2    ..Â  STA &C29C
AA91 B5 03       µ.   LDA &03,X
AA93 8D 9D C2    ..Â  STA &C29D
AA96 20 68 AE     h®  JSR &AE68
AA99 A6 C3       ¦Ã   LDX &C3
AA9B A4 CF       ¤Ï   LDY &CF
AA9D B5 00       µ.   LDA &00,X
AA9F 99 52 C3    .RÃ  STA &C352,Y
AAA2 B5 01       µ.   LDA &01,X
AAA4 99 48 C3    .HÃ  STA &C348,Y
AAA7 B5 02       µ.   LDA &02,X
AAA9 99 3E C3    .>Ã  STA &C33E,Y
AAAC B5 03       µ.   LDA &03,X
AAAE 99 34 C3    .4Ã  STA &C334,Y
AAB1 20 25 AD     %­  JSR &AD25
AAB4 B0 BC       °¼   BCS &AA72
AAB6 4C E2 A9    Lâ©  JMP &A9E2

OSARGS 4+,Y - treat as OSARGS &FF,Y - Ensure File
-------------------------------------------------
AAB9 A2 10       ¢.   LDX #&10
AABB BD 04 C2    ½.Â  LDA &C204,X
AABE 4A          J    LSR A
AABF 29 0F       ).   AND #&0F
AAC1 C5 CF       ÅÏ   CMP &CF
AAC3 D0 0B       Ð.   BNE &AAD0
AAC5 20 06 AB     .«  JSR &AB06
AAC8 BD 04 C2    ½.Â  LDA &C204,X
AACB 29 01       ).   AND #&01
AACD 9D 04 C2    ..Â  STA &C204,X
AAD0 CA          Ê    DEX
AAD1 CA          Ê    DEX
AAD2 CA          Ê    DEX
AAD3 CA          Ê    DEX
AAD4 10 E5       .å   BPL &AABB
AAD6 4C 8C A9    L.©  JMP &A98C

Send a command block to SCSI for BGET/BPUT
------------------------------------------
AAD9 48          H    PHA
AADA 20 28 83     (.  JSR &8328		Wait for ensuring to complete
AADD 20 80 80     ..  JSR &8080		Set SCSI to command mode
AAE0 68          h    PLA
AAE1 20 1E 83     ..  JSR &831E		Send command
AAE4 BD 03 C2    ½.Â  LDA &C203,X
AAE7 8D 33 C3    .3Ã  STA &C333
AAEA 20 1E 83     ..  JSR &831E		Send sector address
AAED BD 02 C2    ½.Â  LDA &C202,X
AAF0 20 1E 83     ..  JSR &831E
AAF3 BD 01 C2    ½.Â  LDA &C201,X
AAF6 20 1E 83     ..  JSR &831E
AAF9 A9 01       ©.   LDA #&01		Send '1 sector'
AAFB 20 1E 83     ..  JSR &831E
AAFE A9 00       ©.   LDA #&00
AB00 4C 1E 83    L..  JMP &831E

AB03 20 E6 AC     æ¬  JSR &ACE6		Check checksum
AB06 20 B4 AB     ´«  JSR &ABB4		Check for data lost
AB09 BD 04 C2    ½.Â  LDA &C204,X
AB0C C9 C0       ÉÀ   CMP #&C0
AB0E 90 78       .x   BCC &AB88
AB10 8A          .    TXA
AB11 4A          J    LSR A
AB12 4A          J    LSR A
AB13 69 C9       iÉ   ADC #&C9
AB15 85 BD       .½   STA &BD
AB17 A9 00       ©.   LDA #&00
AB19 85 BC       .¼   STA &BC
AB1B BD 04 C2    ½.Â  LDA &C204,X
AB1E 29 BF       )¿   AND #&BF
AB20 9D 04 C2    ..Â  STA &C204,X
AB23 29 1E       ).   AND #&1E
AB25 6A          j    ROR A
AB26 09 30       .0   ORA #&30
AB28 8D D4 C2    .ÔÂ  STA &C2D4
AB2B BD 01 C2    ½.Â  LDA &C201,X
AB2E 8D D0 C2    .ÐÂ  STA &C2D0
AB31 BD 02 C2    ½.Â  LDA &C202,X
AB34 8D D1 C2    .ÑÂ  STA &C2D1
AB37 BD 03 C2    ½.Â  LDA &C203,X
AB3A 8D D2 C2    .ÒÂ  STA &C2D2
AB3D 20 6C B5     lµ  JSR &B56C		?
AB40 20 99 80     ..  JSR &8099		Set default retries
AB43 86 C1       .Á   STX &C1
AB45 A5 CD       ¥Í   LDA &CD		Get hard drive presence
AB47 29 20       )    AND #&20
AB49 F0 05       ð.   BEQ &AB50		No hard drive, jump forward to do floppy
AB4B BD 03 C2    ½.Â  LDA &C203,X	Get drive
AB4E 10 0E       ..   BPL &AB5E		Hard drive, jump ahead
AB50 A6 C1       ¦Á   LDX &C1
AB52 20 51 BA     Qº  JSR &BA51
AB55 F0 2F       ð/   BEQ &AB86
AB57 C6 CE       ÆÎ   DEC &CE
AB59 10 F5       .õ   BPL &AB50
AB5B 4C BD 82    L½.  JMP &82BD

BPUT to hard drive
--------------------
AB5E A6 C1       ¦Á   LDX &C1		Get something
AB60 A9 0A       ©.   LDA #&0A		&0A - Write
AB62 20 D9 AA     Ùª  JSR &AAD9		Send command block to SCSI
AB65 A0 00        .   LDY #&00
AB67 20 32 83     2.  JSR &8332		Wait for SCSI not busy
AB6A 10 0A       ..   BPL &AB76		Jump ahead with writing
AB6C 20 AD 81     ­.  JSR &81AD		Release Tube, get SCSI status
AB6F C6 CE       ÆÎ   DEC &CE		Decrease retries
AB71 10 EB       .ë   BPL &AB5E		Loop to try again
AB73 4C BD 82    L½.  JMP &82BD		Generate a disk error

Write a BPUT buffer to hard drive
---------------------------------
AB76 B1 BC       ±¼   LDA (&BC),Y	Get byte from buffer
AB78 8D 40 FC    .@ü  STA &FC40		Send to SCSI
AB7B C8          È    INY
AB7C D0 F8       Ðø   BNE &AB76		Loop for 256 bytes
AB7E A9 01       ©.   LDA #&01
AB80 04 CD       .Í   TSB &CD
AB82 88          .    DEY
AB83 8C 43 FC    .Cü  STY &FC43		Set &FC43 to &FF
AB86 A6 C1       ¦Á   LDX &C1
AB88 60          `    RTS

Service 5 - Interupt occured
============================
AB89 A5 CD       ¥Í   LDA &CD		Get flags
AB8B 29 21       )!   AND #&21		Check for hard drive+IRQ pending
AB8D C9 21       É!   CMP #&21
AB8F D0 07       Ð.   BNE &AB98		No hard drive or IRQ pending
AB91 20 6F 80     o.  JSR &806F		Get SCSI status
AB94 C9 F2       Éò   CMP #&F2
AB96 F0 03       ð.   BEQ &AB9B
AB98 A9 05       ©.   LDA #&05		Return from service call
AB9A 60          `    RTS

AB9B 5A          Z    PHY		Send something to SCSI
AB9C A9 00       ©.   LDA #&00
AB9E 8D 43 FC    .Cü  STA &FC43
ABA1 A9 01       ©.   LDA #&01
ABA3 14 CD       .Í   TRB &CD
ABA5 AD 40 FC    ­@ü  LDA &FC40
ABA8 20 32 83     2.  JSR &8332
ABAB 0D 40 FC    .@ü  ORA &FC40
ABAE 8D 31 C3    .1Ã  STA &C331
ABB1 4C B4 9D    L´.  JMP &9DB4		Restore Y,X, claim call


Check for data loss
===================
ABB4 AD 31 C3    ­1Ã  LDA &C331
ABB7 F0 2D       ð-   BEQ &ABE6		Jump forward to exit
ABB9 A9 00       ©.   LDA #&00
ABBB 8D 31 C3    .1Ã  STA &C331		Clear the flag
ABBE AE D4 C2    ®ÔÂ  LDX &C2D4
ABC1 20 74 83     t.  JSR &8374		Generate 'Data lost' error
ABC4 CA          Ê    DEX
ABC5 44          D    EQUB &44
ABC6 61 74       at   ADC (&74,X)
ABC8 61 20       a    ADC (&20,X)
ABCA 6C 6F 73    los  JMP (&736F)
ABCD 74 2C       t,   STZ &2C,X
ABCF 20 63 68     ch  JSR &6863
ABD2 61 6E       an   ADC (&6E,X)
ABD4 6E 65 6C    nel  ROR &6C65
ABD7 00          .    BRK

ABD8 8A          .    TXA
ABD9 8E A1 C2    .¡Â  STX &C2A1
ABDC 4A          J    LSR A
ABDD 4A          J    LSR A
ABDE 69 C9       iÉ   ADC #&C9
ABE0 85 BF       .¿   STA &BF
ABE2 A9 00       ©.   LDA #&00
ABE4 85 BE       .¾   STA &BE
ABE6 60          `    RTS


ABE7 A2 10       ¢.   LDX #&10
ABE9 8E 95 C2    ..Â  STX &C295
ABEC A8          ¨    TAY
ABED BD 04 C2    ½.Â  LDA &C204,X
ABF0 29 01       ).   AND #&01
ABF2 F0 03       ð.   BEQ &ABF7
ABF4 8E 95 C2    ..Â  STX &C295
ABF7 BD 04 C2    ½.Â  LDA &C204,X
ABFA 10 75       .u   BPL &AC71
ABFC BD 01 C2    ½.Â  LDA &C201,X
ABFF CD 96 C2    Í.Â  CMP &C296
AC02 D0 6D       Ðm   BNE &AC71
AC04 BD 02 C2    ½.Â  LDA &C202,X
AC07 CD 97 C2    Í.Â  CMP &C297
AC0A D0 65       Ðe   BNE &AC71
AC0C BD 03 C2    ½.Â  LDA &C203,X
AC0F CD 98 C2    Í.Â  CMP &C298
AC12 D0 5D       Ð]   BNE &AC71
AC14 20 D8 AB     Ø«  JSR &ABD8
AC17 98          .    TYA
AC18 4A          J    LSR A
AC19 29 40       )@   AND #&40
AC1B 1D 04 C2    ..Â  ORA &C204,X
AC1E 6A          j    ROR A
AC1F 29 E0       )à   AND #&E0
AC21 05 CF       .Ï   ORA &CF
AC23 08          .    PHP
AC24 18          .    CLC
AC25 2A          *    ROL A
AC26 9D 04 C2    ..Â  STA &C204,X
AC29 28          (    PLP
AC2A 90 1E       ..   BCC &AC4A
AC2C A0 10        .   LDY #&10
AC2E B9 04 C2    ¹.Â  LDA &C204,Y
AC31 D0 07       Ð.   BNE &AC3A
AC33 A9 01       ©.   LDA #&01
AC35 99 04 C2    ..Â  STA &C204,Y
AC38 D0 34       Ð4   BNE &AC6E
AC3A 88          .    DEY
AC3B 88          .    DEY
AC3C 88          .    DEY
AC3D 88          .    DEY
AC3E 10 EE       .î   BPL &AC2E
AC40 20 04 AD     .­  JSR &AD04
AC43 7E 04 C2    ~.Â  ROR &C204,X
AC46 38          8    SEC
AC47 3E 04 C2    >.Â  ROL &C204,X
AC4A E8          è    INX
AC4B E8          è    INX
AC4C E8          è    INX
AC4D E8          è    INX
AC4E E0 11       à.   CPX #&11
AC50 90 02       ..   BCC &AC54
AC52 A2 00       ¢.   LDX #&00
AC54 BD 04 C2    ½.Â  LDA &C204,X
AC57 4A          J    LSR A
AC58 F0 14       ð.   BEQ &AC6E
AC5A 90 12       ..   BCC &AC6E
AC5C 18          .    CLC
AC5D 2A          *    ROL A
AC5E 9D 04 C2    ..Â  STA &C204,X
AC61 20 04 AD     .­  JSR &AD04
AC64 20 04 AD     .­  JSR &AD04
AC67 7E 04 C2    ~.Â  ROR &C204,X
AC6A 38          8    SEC
AC6B 3E 04 C2    >.Â  ROL &C204,X
AC6E 4C 03 AB    L.«  JMP &AB03

AC71 CA          Ê    DEX
AC72 CA          Ê    DEX
AC73 CA          Ê    DEX
AC74 CA          Ê    DEX
AC75 30 03       0.   BMI &AC7A
AC77 4C ED AB    Lí«  JMP &ABED

AC7A AE 95 C2    ®.Â  LDX &C295
AC7D AD 96 C2    ­.Â  LDA &C296
AC80 9D 01 C2    ..Â  STA &C201,X
AC83 8D D0 C2    .ÐÂ  STA &C2D0
AC86 AD 97 C2    ­.Â  LDA &C297
AC89 9D 02 C2    ..Â  STA &C202,X
AC8C 8D D1 C2    .ÑÂ  STA &C2D1
AC8F AD 98 C2    ­.Â  LDA &C298
AC92 9D 03 C2    ..Â  STA &C203,X
AC95 8D D2 C2    .ÒÂ  STA &C2D2
AC98 20 D8 AB     Ø«  JSR &ABD8
AC9B AD 98 C2    ­.Â  LDA &C298
AC9E 20 6C B5     lµ  JSR &B56C
ACA1 84 B1       .±   STY &B1
ACA3 86 B0       .°   STX &B0
ACA5 20 99 80     ..  JSR &8099
ACA8 A6 B0       ¦°   LDX &B0
ACAA A5 CD       ¥Í   LDA &CD
ACAC 29 20       )    AND #&20
ACAE F0 05       ð.   BEQ &ACB5
ACB0 BD 03 C2    ½.Â  LDA &C203,X
ACB3 10 0C       ..   BPL &ACC1
ACB5 20 54 BA     Tº  JSR &BA54
ACB8 F0 20       ð    BEQ &ACDA
ACBA C6 CE       ÆÎ   DEC &CE		Decrement retries
ACBC 10 EA       .ê   BPL &ACA8		Loop to rey again
ACBE 4C BD 82    L½.  JMP &82BD		Generate a disk error

BGET from hard drive
--------------------
ACC1 A9 08       ©.   LDA #&08		&08 - READ
ACC3 20 D9 AA     Ùª  JSR &AAD9		Send command block to SCSI
ACC6 20 32 83     2.  JSR &8332		Wait for SCSI not busy
ACC9 30 0A       0.   BMI &ACD5		If SCSI writing, finish
ACCB A0 00        .   LDY #&00
ACCD AD 40 FC    ­@ü  LDA &FC40		Get byte from SCSI
ACD0 91 BE       .¾   STA (&BE),Y	Store to buffer
ACD2 C8          È    INY
ACD3 D0 F8       Ðø   BNE &ACCD		Loop for 256 bytes
ACD5 20 AD 81     ­.  JSR &81AD		Release and get result
ACD8 D0 E0       Ðà   BNE &ACBA		Retry with error
ACDA A6 B0       ¦°   LDX &B0		Restore X & Y
ACDC A4 B1       ¤±   LDY &B1
ACDE A9 81       ©.   LDA #&81
ACE0 9D 04 C2    ..Â  STA &C204,X
ACE3 4C 17 AC    L.¬  JMP &AC17

ACE6 A2 10       ¢.   LDX #&10
ACE8 BD 04 C2    ½.Â  LDA &C204,X
ACEB 29 01       ).   AND #&01
ACED D0 35       Ð5   BNE &AD24
ACEF CA          Ê    DEX
ACF0 CA          Ê    DEX
ACF1 CA          Ê    DEX
ACF2 CA          Ê    DEX
ACF3 10 F3       .ó   BPL &ACE8
ACF5 4C 6E A7    Ln§  JMP &A76E

ACF8 20 6B 83     k.  JSR &836B
ACFB DE 43 68    ÞCh  DEC &6843,X
ACFE 61 6E       an   ADC (&6E,X)
AD00 6E 65 6C    nel  ROR &6C65
AD03 00          .    BRK
AD04 CA          Ê    DEX
AD05 CA          Ê    DEX
AD06 CA          Ê    DEX
AD07 CA          Ê    DEX
AD08 10 02       ..   BPL &AD0C
AD0A A2 10       ¢.   LDX #&10
AD0C 60          `    RTS

Check channel and get channel flags
-----------------------------------
AD0D 84 C2       .Â   STY &C2		Save channel
AD0F 8C D5 C2    .ÕÂ  STY &C2D5
AD12 C0 3A       À:   CPY #&3A		Check channel is in range
AD14 B0 E2       °â   BCS &ACF8		Too high - error
AD16 98          .    TYA
AD17 38          8    SEC
AD18 E9 30       é0   SBC #&30
AD1A 90 DC       .Ü   BCC &ACF8		Too low - error
AD1C 85 CF       .Ï   STA &CF		Store channel offset
AD1E AA          ª    TAX
AD1F BD AC C3    ½¬Ã  LDA &C3AC,X	Get channel flags
AD22 F0 D4       ðÔ   BEQ &ACF8		Channel not open - error
AD24 60          `    RTS

&C3AC,X channel flags
&C334,X
&C33E,X
&C348,X
&C352,X
&C35C,X
&C366,X
&C370,X
&C37A,X

Compare something
-----------------
AD25 A6 CF       ¦Ï   LDX &CF		Get channel offset
AD27 BD 34 C3    ½4Ã  LDA &C334,X
AD2A DD 5C C3    Ý\Ã  CMP &C35C,X	Compare something
AD2D D0 19       Ð.   BNE &AD48		Different, so end with NE+CC/CS
AD2F BD 3E C3    ½>Ã  LDA &C33E,X
AD32 DD 66 C3    ÝfÃ  CMP &C366,X	Compare something
AD35 D0 11       Ð.   BNE &AD48		Different, so end with NE+CC/CS
AD37 BD 48 C3    ½HÃ  LDA &C348,X
AD3A DD 70 C3    ÝpÃ  CMP &C370,X	Compare something
AD3D D0 09       Ð.   BNE &AD48		Different, so end with NE+CC/CS
AD3F BD 52 C3    ½RÃ  LDA &C352,X
AD42 DD 7A C3    ÝzÃ  CMP &C37A,X	Compare something
AD45 D0 01       Ð.   BNE &AD48		Different, so end with NE+CC/CS
AD47 18          .    CLC		All same, set EQ+CC
AD48 60          `    RTS

FSC 1 - Read EOF
================
AD49 A4 B4       ¤´   LDY &B4
AD4B 20 0D AD     .­  JSR &AD0D
AD4E 6A          j    ROR A
AD4F B0 09       °.   BCS &AD5A
AD51 20 7F A7     .§  JSR &A77F
AD54 20 E9 B1     é±  JSR &B1E9
AD57 20 25 AD     %­  JSR &AD25
AD5A A2 00       ¢.   LDX #&00
AD5C B0 01       °.   BCS &AD5F
AD5E CA          Ê    DEX
AD5F A4 B5       ¤µ   LDY &B5
AD61 60          `    RTS

AD62 BD AC C3    ½¬Ã  LDA &C3AC,X
AD65 29 C8       )È   AND #&C8
AD67 9D AC C3    .¬Ã  STA &C3AC,X
AD6A 20 6B 83     k.  JSR &836B		Generate an error
AD6D DF 45 4F    ßEO  BBS 5,&45,&ADBF	Error 'EOF'
AD70 46 00       F.   LSR &00


OSBGET
======
AD72 86 C3       .Ã   STX &C3		Save X
AD74 20 0D AD     .­  JSR &AD0D		Check channel and get flags
AD77 6A          j    ROR A
AD78 B0 22       °"   BCS &AD9C
AD7A 29 04       ).   AND #&04		Gone past EOF?
AD7C D0 E4       Ðä   BNE &AD62		Generate EOF error
AD7E 20 25 AD     %­  JSR &AD25		Compare something
AD81 B0 19       °.   BCS &AD9C		CS+NE, ok to read byte
AD83 D0 DD       ÐÝ   BNE &AD62		Not same, so generate 'EOF' error
AD85 20 7F A7     .§  JSR &A77F		Check various checksums
AD88 A6 CF       ¦Ï   LDX &CF		Get offset to channel
AD8A BD AC C3    ½¬Ã  LDA &C3AC,X	Get channel flag
AD8D 29 C0       )À   AND #&C0
AD8F 09 08       ..   ORA #&08		Set EOF flag
AD91 9D AC C3    .¬Ã  STA &C3AC,X
AD94 A4 C2       ¤Â   LDY &C2		Restore Y
AD96 A6 C3       ¦Ã   LDX &C3		Restore X
AD98 38          8    SEC		Flag EOF
AD99 A9 FE       ©þ   LDA #&FE		EOF value
AD9B 60          `    RTS		Return

Read byte from channel
----------------------
AD9C A6 CF       ¦Ï   LDX &CF		Get channel offset
AD9E 18          .    CLC
AD9F BD CA C3    ½ÊÃ  LDA &C3CA,X
ADA2 7D 70 C3    }pÃ  ADC &C370,X
ADA5 8D 96 C2    ..Â  STA &C296
ADA8 BD C0 C3    ½ÀÃ  LDA &C3C0,X
ADAB 7D 66 C3    }fÃ  ADC &C366,X
ADAE 8D 97 C2    ..Â  STA &C297
ADB1 BD B6 C3    ½¶Ã  LDA &C3B6,X
ADB4 7D 5C C3    }\Ã  ADC &C35C,X
ADB7 8D 98 C2    ..Â  STA &C298		&C296/7/8=&C3CA/B/C,X+&C370/1/2,X
ADBA A9 40       ©@   LDA #&40
ADBC 20 E7 AB     ç«  JSR &ABE7		Manipulate various things
ADBF A6 CF       ¦Ï   LDX &CF
ADC1 BC 7A C3    ¼zÃ  LDY &C37A,X
ADC4 A9 00       ©.   LDA #&00
ADC6 8D CF C2    .ÏÂ  STA &C2CF
ADC9 20 80 B1     .±  JSR &B180
ADCC B1 BE       ±¾   LDA (&BE),Y	Get byte from buffer
ADCE A4 C2       ¤Â   LDY &C2		Restore Y
ADD0 A6 C3       ¦Ã   LDX &C3		Restore X
ADD2 18          .    CLC		Clear EOF flag
ADD3 60          `    RTS		Return

ADD4 A0 02        .   LDY #&02
ADD6 B9 14 C3    ¹.Ã  LDA &C314,Y
ADD9 99 30 C2    .0Â  STA &C230,Y
ADDC 88          .    DEY
ADDD 10 F7       .÷   BPL &ADD6
ADDF AD 17 C3    ­.Ã  LDA &C317
ADE2 8D 33 C2    .3Â  STA &C233
ADE5 A6 CF       ¦Ï   LDX &CF
ADE7 BD B6 C3    ½¶Ã  LDA &C3B6,X
ADEA 29 E0       )à   AND #&E0
ADEC 8D 2F C2    ./Â  STA &C22F
ADEF BD E8 C3    ½èÃ  LDA &C3E8,X
ADF2 8D 2C C2    .,Â  STA &C22C
ADF5 BD DE C3    ½ÞÃ  LDA &C3DE,X
ADF8 8D 2D C2    .-Â  STA &C22D
ADFB BD D4 C3    ½ÔÃ  LDA &C3D4,X
ADFE 8D 2E C2    ..Â  STA &C22E
AE01 20 D8 89     Ø.  JSR &89D8
AE04 A0 02        .   LDY #&02
AE06 B9 30 C2    ¹0Â  LDA &C230,Y
AE09 99 2C C2    .,Â  STA &C22C,Y
AE0C 88          .    DEY
AE0D 10 F7       .÷   BPL &AE06
AE0F AD 33 C2    ­3Â  LDA &C233
AE12 8D 2F C2    ./Â  STA &C22F
AE15 20 DF B4     ß´  JSR &B4DF
AE18 A6 CF       ¦Ï   LDX &CF
AE1A BD CA C3    ½ÊÃ  LDA &C3CA,X
AE1D 8D 34 C2    .4Â  STA &C234
AE20 BD C0 C3    ½ÀÃ  LDA &C3C0,X
AE23 8D 35 C2    .5Â  STA &C235
AE26 BD B6 C3    ½¶Ã  LDA &C3B6,X
AE29 29 1F       ).   AND #&1F
AE2B 8D 36 C2    .6Â  STA &C236
AE2E A9 05       ©.   LDA #&05
AE30 85 B8       .¸   STA &B8
AE32 A9 C4       ©Ä   LDA #&C4
AE34 85 B9       .¹   STA &B9
AE36 A6 CF       ¦Ï   LDX &CF
AE38 A0 00        .   LDY #&00
AE3A B1 B8       ±¸   LDA (&B8),Y
AE3C D0 06       Ð.   BNE &AE44
AE3E 9D AC C3    .¬Ã  STA &C3AC,X
AE41 4C 6E A7    Ln§  JMP &A76E

AE44 A0 19        .   LDY #&19
AE46 B1 B8       ±¸   LDA (&B8),Y
AE48 DD F2 C3    ÝòÃ  CMP &C3F2,X
AE4B D0 0E       Ð.   BNE &AE5B
AE4D 88          .    DEY
AE4E B1 B8       ±¸   LDA (&B8),Y
AE50 D9 1E C2    Ù.Â  CMP &C21E,Y
AE53 D0 06       Ð.   BNE &AE5B
AE55 88          .    DEY
AE56 C0 16       À.   CPY #&16
AE58 B0 F4       °ô   BCS &AE4E
AE5A 60          `    RTS

AE5B A5 B8       ¥¸   LDA &B8
AE5D 18          .    CLC
AE5E 69 1A       i.   ADC #&1A
AE60 85 B8       .¸   STA &B8
AE62 90 D4       .Ô   BCC &AE38
AE64 E6 B9       æ¹   INC &B9
AE66 B0 D0       °Ð   BCS &AE38
AE68 A9 00       ©.   LDA #&00
AE6A 8D B5 C2    .µÂ  STA &C2B5
AE6D AD 2F C2    ­/Â  LDA &C22F
AE70 8D BF C2    .¿Â  STA &C2BF
AE73 A2 02       ¢.   LDX #&02
AE75 BD 2C C2    ½,Â  LDA &C22C,X
AE78 9D BC C2    .¼Â  STA &C2BC,X
AE7B CA          Ê    DEX
AE7C 10 F7       .÷   BPL &AE75
AE7E A9 FF       ©.   LDA #&FF
AE80 8D 2E C2    ..Â  STA &C22E
AE83 8D 2F C2    ./Â  STA &C22F
AE86 A6 CF       ¦Ï   LDX &CF
AE88 BD 84 C3    ½.Ã  LDA &C384,X
AE8B CD 9D C2    Í.Â  CMP &C29D
AE8E D0 16       Ð.   BNE &AEA6
AE90 BD 8E C3    ½.Ã  LDA &C38E,X
AE93 CD 9C C2    Í.Â  CMP &C29C
AE96 D0 0E       Ð.   BNE &AEA6
AE98 BD 98 C3    ½.Ã  LDA &C398,X
AE9B CD 9B C2    Í.Â  CMP &C29B
AE9E D0 06       Ð.   BNE &AEA6
AEA0 BD A2 C3    ½¢Ã  LDA &C3A2,X
AEA3 CD 9A C2    Í.Â  CMP &C29A
AEA6 90 28       .(   BCC &AED0
AEA8 BD 34 C3    ½4Ã  LDA &C334,X
AEAB CD 9D C2    Í.Â  CMP &C29D
AEAE D0 1B       Ð.   BNE &AECB
AEB0 BD 3E C3    ½>Ã  LDA &C33E,X
AEB3 CD 9C C2    Í.Â  CMP &C29C
AEB6 D0 13       Ð.   BNE &AECB
AEB8 BD 48 C3    ½HÃ  LDA &C348,X
AEBB CD 9B C2    Í.Â  CMP &C29B
AEBE D0 0B       Ð.   BNE &AECB
AEC0 BD 52 C3    ½RÃ  LDA &C352,X
AEC3 CD 9A C2    Í.Â  CMP &C29A
AEC6 D0 03       Ð.   BNE &AECB
AEC8 4C DA B0    LÚ°  JMP &B0DA

AECB B0 FB       °û   BCS &AEC8
AECD 4C E4 AF    Lä¯  JMP &AFE4

AED0 20 D4 AD     Ô­  JSR &ADD4
AED3 BD A2 C3    ½¢Ã  LDA &C3A2,X
AED6 C9 01       É.   CMP #&01
AED8 BD 98 C3    ½.Ã  LDA &C398,X
AEDB 69 00       i.   ADC #&00
AEDD 8D 37 C2    .7Â  STA &C237
AEE0 BD 8E C3    ½.Ã  LDA &C38E,X
AEE3 69 00       i.   ADC #&00
AEE5 8D 38 C2    .8Â  STA &C238
AEE8 BD 84 C3    ½.Ã  LDA &C384,X
AEEB 69 00       i.   ADC #&00
AEED 8D 39 C2    .9Â  STA &C239
AEF0 20 E1 84     á.  JSR &84E1
AEF3 9C 3D C2    .=Â  STZ &C23D
AEF6 9C 3E C2    .>Â  STZ &C23E
AEF9 9C 3F C2    .?Â  STZ &C23F
AEFC AE FE C1    ®þÁ  LDX &C1FE
AEFF AD 3F C2    ­?Â  LDA &C23F
AF02 DD FF C0    Ý.À  CMP &C0FF,X
AF05 90 14       ..   BCC &AF1B
AF07 D0 21       Ð!   BNE &AF2A
AF09 AD 3E C2    ­>Â  LDA &C23E
AF0C DD FE C0    ÝþÀ  CMP &C0FE,X
AF0F 90 0A       ..   BCC &AF1B
AF11 D0 17       Ð.   BNE &AF2A
AF13 AD 3D C2    ­=Â  LDA &C23D
AF16 DD FD C0    ÝýÀ  CMP &C0FD,X
AF19 B0 0F       °.   BCS &AF2A
AF1B A0 02        .   LDY #&02
AF1D BD FF C0    ½.À  LDA &C0FF,X
AF20 99 3D C2    .=Â  STA &C23D,Y
AF23 CA          Ê    DEX
AF24 88          .    DEY
AF25 10 F6       .ö   BPL &AF1D
AF27 8A          .    TXA
AF28 80 03       ..   BRA &AF2D

AF2A CA          Ê    DEX
AF2B CA          Ê    DEX
AF2C CA          Ê    DEX
AF2D D0 D0       ÐÐ   BNE &AEFF
AF2F A2 03       ¢.   LDX #&03
AF31 BD 3C C2    ½<Â  LDA &C23C,X
AF34 DD 9A C2    Ý.Â  CMP &C29A,X
AF37 D0 06       Ð.   BNE &AF3F
AF39 CA          Ê    DEX
AF3A D0 F5       Ðõ   BNE &AF31
AF3C EC 9A C2    ì.Â  CPX &C29A
AF3F AD 9C C2    ­.Â  LDA &C29C
AF42 AC 9D C2    ¬.Â  LDY &C29D
AF45 1A          .    INC A
AF46 D0 06       Ð.   BNE &AF4E
AF48 C8          È    INY
AF49 D0 03       Ð.   BNE &AF4E
AF4B 4C 7F 86    L..  JMP &867F

AF4E 90 0E       ..   BCC &AF5E
AF50 CC 3F C2    Ì?Â  CPY &C23F
AF53 90 09       ..   BCC &AF5E
AF55 D0 10       Ð.   BNE &AF67
AF57 CD 3E C2    Í>Â  CMP &C23E
AF5A 90 02       ..   BCC &AF5E
AF5C D0 09       Ð.   BNE &AF67
AF5E 8C 3F C2    .?Â  STY &C23F
AF61 8D 3E C2    .>Â  STA &C23E
AF64 9C 3D C2    .=Â  STZ &C23D
AF67 20 5B 86     [.  JSR &865B
AF6A A0 12        .   LDY #&12
AF6C A9 00       ©.   LDA #&00
AF6E A6 CF       ¦Ï   LDX &CF
AF70 91 B8       .¸   STA (&B8),Y
AF72 9D A2 C3    .¢Ã  STA &C3A2,X
AF75 C8          È    INY
AF76 AD 3D C2    ­=Â  LDA &C23D
AF79 91 B8       .¸   STA (&B8),Y
AF7B 9D 98 C3    ..Ã  STA &C398,X
AF7E AD 3E C2    ­>Â  LDA &C23E
AF81 C8          È    INY
AF82 91 B8       .¸   STA (&B8),Y
AF84 9D 8E C3    ..Ã  STA &C38E,X
AF87 AD 3F C2    ­?Â  LDA &C23F
AF8A C8          È    INY
AF8B 91 B8       .¸   STA (&B8),Y
AF8D 9D 84 C3    ..Ã  STA &C384,X
AF90 AD 3A C2    ­:Â  LDA &C23A
AF93 C8          È    INY
AF94 91 B8       .¸   STA (&B8),Y
AF96 9D CA C3    .ÊÃ  STA &C3CA,X
AF99 AD 3B C2    ­;Â  LDA &C23B
AF9C C8          È    INY
AF9D 91 B8       .¸   STA (&B8),Y
AF9F 9D C0 C3    .ÀÃ  STA &C3C0,X
AFA2 AD 3C C2    ­<Â  LDA &C23C
AFA5 C8          È    INY
AFA6 91 B8       .¸   STA (&B8),Y
AFA8 0D 17 C3    ..Ã  ORA &C317
AFAB 9D B6 C3    .¶Ã  STA &C3B6,X
AFAE 20 91 8F     ..  JSR &8F91
AFB1 A9 08       ©.   LDA #&08
AFB3 14 CD       .Í   TRB &CD
AFB5 A9 C4       ©Ä   LDA #&C4
AFB7 8D 60 C2    .`Â  STA &C260
AFBA A9 09       ©.   LDA #&09
AFBC 8D 61 C2    .aÂ  STA &C261
AFBF A2 00       ¢.   LDX #&00
AFC1 A0 02        .   LDY #&02
AFC3 B9 34 C2    ¹4Â  LDA &C234,Y
AFC6 99 A2 C2    .¢Â  STA &C2A2,Y
AFC9 D9 3A C2    Ù:Â  CMP &C23A,Y
AFCC F0 04       ð.   BEQ &AFD2
AFCE E8          è    INX
AFCF B9 3A C2    ¹:Â  LDA &C23A,Y
AFD2 99 A8 C2    .¨Â  STA &C2A8,Y
AFD5 B9 37 C2    ¹7Â  LDA &C237,Y
AFD8 99 A5 C2    .¥Â  STA &C2A5,Y
AFDB 88          .    DEY
AFDC 10 E5       .å   BPL &AFC3
AFDE 8A          .    TXA
AFDF F0 03       ð.   BEQ &AFE4
AFE1 20 AC 96     ¬.  JSR &96AC
AFE4 AD B5 C2    ­µÂ  LDA &C2B5
AFE7 F0 03       ð.   BEQ &AFEC
AFE9 4C BD B0    L½°  JMP &B0BD

AFEC A6 CF       ¦Ï   LDX &CF
AFEE 18          .    CLC
AFEF BD 48 C3    ½HÃ  LDA &C348,X
AFF2 7D CA C3    }ÊÃ  ADC &C3CA,X
AFF5 8D 96 C2    ..Â  STA &C296
AFF8 BD 3E C3    ½>Ã  LDA &C33E,X
AFFB 7D C0 C3    }ÀÃ  ADC &C3C0,X
AFFE 8D 97 C2    ..Â  STA &C297
B001 BD 34 C3    ½4Ã  LDA &C334,X
B004 7D B6 C3    }¶Ã  ADC &C3B6,X
B007 8D 98 C2    ..Â  STA &C298
B00A A9 C0       ©À   LDA #&C0
B00C 20 E7 AB     ç«  JSR &ABE7
B00F A6 CF       ¦Ï   LDX &CF
B011 BC 52 C3    ¼RÃ  LDY &C352,X
B014 A9 00       ©.   LDA #&00
B016 91 BE       .¾   STA (&BE),Y
B018 C8          È    INY
B019 D0 FB       Ðû   BNE &B016
B01B AD 9B C2    ­.Â  LDA &C29B
B01E 18          .    CLC
B01F 7D CA C3    }ÊÃ  ADC &C3CA,X
B022 8D 34 C2    .4Â  STA &C234
B025 AD 9C C2    ­.Â  LDA &C29C
B028 7D C0 C3    }ÀÃ  ADC &C3C0,X
B02B 8D 35 C2    .5Â  STA &C235
B02E AD 9D C2    ­.Â  LDA &C29D
B031 7D B6 C3    }¶Ã  ADC &C3B6,X
B034 8D 36 C2    .6Â  STA &C236
B037 AD 9A C2    ­.Â  LDA &C29A
B03A D0 13       Ð.   BNE &B04F
B03C AD 34 C2    ­4Â  LDA &C234
B03F D0 0B       Ð.   BNE &B04C
B041 AD 35 C2    ­5Â  LDA &C235
B044 D0 03       Ð.   BNE &B049
B046 CE 36 C2    Î6Â  DEC &C236
B049 CE 35 C2    Î5Â  DEC &C235
B04C CE 34 C2    Î4Â  DEC &C234
B04F AD 34 C2    ­4Â  LDA &C234
B052 CD 96 C2    Í.Â  CMP &C296
B055 D0 13       Ð.   BNE &B06A
B057 AD 35 C2    ­5Â  LDA &C235
B05A CD 97 C2    Í.Â  CMP &C297
B05D D0 0B       Ð.   BNE &B06A
B05F AD 36 C2    ­6Â  LDA &C236
B062 CD 98 C2    Í.Â  CMP &C298
B065 D0 03       Ð.   BNE &B06A
B067 4C BD B0    L½°  JMP &B0BD

B06A 20 28 83     (.  JSR &8328
B06D EE 96 C2    î.Â  INC &C296
B070 D0 08       Ð.   BNE &B07A
B072 EE 97 C2    î.Â  INC &C297
B075 D0 03       Ð.   BNE &B07A
B077 EE 98 C2    î.Â  INC &C298
B07A A9 40       ©@   LDA #&40
B07C 20 E7 AB     ç«  JSR &ABE7
B07F A0 00        .   LDY #&00
B081 98          .    TYA
B082 91 BE       .¾   STA (&BE),Y
B084 C8          È    INY
B085 D0 FB       Ðû   BNE &B082
B087 AE A1 C2    ®¡Â  LDX &C2A1
B08A A9 C0       ©À   LDA #&C0
B08C 1D 04 C2    ..Â  ORA &C204,X
B08F 9D 04 C2    ..Â  STA &C204,X
B092 20 06 AB     .«  JSR &AB06
B095 AD 34 C2    ­4Â  LDA &C234
B098 DD 01 C2    Ý.Â  CMP &C201,X
B09B D0 10       Ð.   BNE &B0AD
B09D AD 35 C2    ­5Â  LDA &C235
B0A0 DD 02 C2    Ý.Â  CMP &C202,X
B0A3 D0 08       Ð.   BNE &B0AD
B0A5 AD 36 C2    ­6Â  LDA &C236
B0A8 DD 03 C2    Ý.Â  CMP &C203,X
B0AB F0 10       ð.   BEQ &B0BD
B0AD FE 01 C2    þ.Â  INC &C201,X
B0B0 D0 D5       ÐÕ   BNE &B087
B0B2 FE 02 C2    þ.Â  INC &C202,X
B0B5 D0 D0       ÐÐ   BNE &B087
B0B7 FE 03 C2    þ.Â  INC &C203,X
B0BA 4C 87 B0    L.°  JMP &B087

B0BD A6 CF       ¦Ï   LDX &CF
B0BF AD 9A C2    ­.Â  LDA &C29A
B0C2 9D 52 C3    .RÃ  STA &C352,X
B0C5 AD 9B C2    ­.Â  LDA &C29B
B0C8 9D 48 C3    .HÃ  STA &C348,X
B0CB AD 9C C2    ­.Â  LDA &C29C
B0CE 9D 3E C3    .>Ã  STA &C33E,X
B0D1 AD 9D C2    ­.Â  LDA &C29D
B0D4 9D 34 C3    .4Ã  STA &C334,X
B0D7 20 D8 89     Ø.  JSR &89D8
B0DA AD BF C2    ­¿Â  LDA &C2BF
B0DD 8D 2F C2    ./Â  STA &C22F
B0E0 A2 02       ¢.   LDX #&02
B0E2 BD BC C2    ½¼Â  LDA &C2BC,X
B0E5 9D 2C C2    .,Â  STA &C22C,X
B0E8 CA          Ê    DEX
B0E9 10 F7       .÷   BPL &B0E2
B0EB 60          `    RTS

OSBPUT
======
B0EC 86 C3       .Ã   STX &C3		Save X
B0EE 48          H    PHA		Save output byte
B0EF 20 0D AD     .­  JSR &AD0D		Check channel and get flags
B0F2 A0 00        .   LDY #&00
B0F4 8C CF C2    .ÏÂ  STY &C2CF
B0F7 A8          ¨    TAY
B0F8 30 18       0.   BMI &B112
B0FA 20 6B 83     k.  JSR &836B
B0FD C1 4E       ÁN   CMP (&4E,X)
B0FF 6F 74 20    ot   BBR 6,&74,&B122
B102 6F 70 65    ope  BBR 6,&70,&B16A
B105 6E 20 66    n f  ROR &6620
B108 6F 72 20    or   BBR 6,&72,&B12B
B10B 75 70       up   ADC &70,X
B10D 64 61       da   STZ &61
B10F 74 65       te   STZ &65,X
B111 00          .    BRK

B112 BD AC C3    ½¬Ã  LDA &C3AC,X
B115 29 07       ).   AND #&07
B117 C9 06       É.   CMP #&06
B119 B0 32       °2   BCS &B14D
B11B C9 03       É.   CMP #&03
B11D F0 2E       ð.   BEQ &B14D
B11F BD 7A C3    ½zÃ  LDA &C37A,X
B122 38          8    SEC
B123 69 00       i.   ADC #&00
B125 8D 9A C2    ..Â  STA &C29A
B128 BD 70 C3    ½pÃ  LDA &C370,X
B12B 69 00       i.   ADC #&00
B12D 8D 9B C2    ..Â  STA &C29B
B130 BD 66 C3    ½fÃ  LDA &C366,X
B133 69 00       i.   ADC #&00
B135 8D 9C C2    ..Â  STA &C29C
B138 BD 5C C3    ½\Ã  LDA &C35C,X
B13B 69 00       i.   ADC #&00
B13D 8D 9D C2    ..Â  STA &C29D
B140 68          h    PLA
B141 20 7F A7     .§  JSR &A77F
B144 48          H    PHA
B145 CE CF C2    ÎÏÂ  DEC &C2CF
B148 20 68 AE     h®  JSR &AE68
B14B A6 CF       ¦Ï   LDX &CF
B14D 18          .    CLC
B14E BD CA C3    ½ÊÃ  LDA &C3CA,X
B151 7D 70 C3    }pÃ  ADC &C370,X
B154 8D 96 C2    ..Â  STA &C296
B157 BD C0 C3    ½ÀÃ  LDA &C3C0,X
B15A 7D 66 C3    }fÃ  ADC &C366,X
B15D 8D 97 C2    ..Â  STA &C297
B160 BD B6 C3    ½¶Ã  LDA &C3B6,X
B163 7D 5C C3    }\Ã  ADC &C35C,X
B166 8D 98 C2    ..Â  STA &C298
B169 A9 C0       ©À   LDA #&C0
B16B 20 E7 AB     ç«  JSR &ABE7
B16E A6 CF       ¦Ï   LDX &CF
B170 BC 7A C3    ¼zÃ  LDY &C37A,X
B173 68          h    PLA
B174 91 BE       .¾   STA (&BE),Y
B176 48          H    PHA
B177 20 80 B1     .±  JSR &B180
B17A 68          h    PLA
B17B A4 C2       ¤Â   LDY &C2
B17D A6 C3       ¦Ã   LDX &C3
B17F 60          `    RTS

B180 A6 CF       ¦Ï   LDX &CF
B182 FE 7A C3    þzÃ  INC &C37A,X
B185 D0 F8       Ðø   BNE &B17F
B187 2C CF C2    ,ÏÂ  BIT &C2CF
B18A 30 03       0.   BMI &B18F
B18C 20 7F A7     .§  JSR &A77F
B18F FE 70 C3    þpÃ  INC &C370,X
B192 D0 08       Ð.   BNE &B19C
B194 FE 66 C3    þfÃ  INC &C366,X
B197 D0 03       Ð.   BNE &B19C
B199 FE 5C C3    þ\Ã  INC &C35C,X
B19C 20 E9 B1     é±  JSR &B1E9
B19F 48          H    PHA
B1A0 38          8    SEC
B1A1 BD 70 C3    ½pÃ  LDA &C370,X
B1A4 FD 48 C3    ýHÃ  SBC &C348,X
B1A7 BD 66 C3    ½fÃ  LDA &C366,X
B1AA FD 3E C3    ý>Ã  SBC &C33E,X
B1AD BD 5C C3    ½\Ã  LDA &C35C,X
B1B0 FD 34 C3    ý4Ã  SBC &C334,X
B1B3 90 29       .)   BCC &B1DE
B1B5 BD 7A C3    ½zÃ  LDA &C37A,X
B1B8 DD 52 C3    ÝRÃ  CMP &C352,X
B1BB D0 04       Ð.   BNE &B1C1
B1BD 68          h    PLA
B1BE 09 04       ..   ORA #&04
B1C0 48          H    PHA
B1C1 38          8    SEC
B1C2 BD 48 C3    ½HÃ  LDA &C348,X
B1C5 FD 98 C3    ý.Ã  SBC &C398,X
B1C8 BD 3E C3    ½>Ã  LDA &C33E,X
B1CB FD 8E C3    ý.Ã  SBC &C38E,X
B1CE BD 34 C3    ½4Ã  LDA &C334,X
B1D1 FD 84 C3    ý.Ã  SBC &C384,X
B1D4 90 03       ..   BCC &B1D9
B1D6 68          h    PLA
B1D7 D0 08       Ð.   BNE &B1E1
B1D9 68          h    PLA
B1DA 09 02       ..   ORA #&02
B1DC D0 03       Ð.   BNE &B1E1
B1DE 68          h    PLA
B1DF 09 03       ..   ORA #&03
B1E1 30 02       0.   BMI &B1E5
B1E3 29 F9       )ù   AND #&F9
B1E5 9D AC C3    .¬Ã  STA &C3AC,X
B1E8 60          `    RTS

B1E9 A6 CF       ¦Ï   LDX &CF		Get channel offset
B1EB BD AC C3    ½¬Ã  LDA &C3AC,X
B1EE 48          H    PHA
B1EF 29 04       ).   AND #&04
B1F1 F0 18       ð.   BEQ &B20B
B1F3 BD 7A C3    ½zÃ  LDA &C37A,X
B1F6 9D 52 C3    .RÃ  STA &C352,X
B1F9 BD 70 C3    ½pÃ  LDA &C370,X
B1FC 9D 48 C3    .HÃ  STA &C348,X
B1FF BD 66 C3    ½fÃ  LDA &C366,X
B202 9D 3E C3    .>Ã  STA &C33E,X
B205 BD 5C C3    ½\Ã  LDA &C35C,X
B208 9D 34 C3    .4Ã  STA &C334,X
B20B 68          h    PLA
B20C 29 C0       )À   AND #&C0
B20E D0 D5       ÐÕ   BNE &B1E5
B210 A9 00       ©.   LDA #&00		A=0 for CLOSE
B212 A8          ¨    TAY		CLOSE#0 - close all open channels


OSFIND - Open a file or close a channel
=======================================
B213 20 7F A7     .§  JSR &A77F		Check checksums
B216 8E 40 C2    .@Â  STX &C240
B219 86 B4       .´   STX &B4
B21B 86 C5       .Å   STX &C5		Store X -> filename
B21D 84 C4       .Ä   STY &C4
B21F 8C 41 C2    .AÂ  STY &C241
B222 84 B5       .µ   STY &B5		Store Y -> filename
B224 29 C0       )À   AND #&C0		Open or close?
B226 A0 00        .   LDY #&00
B228 8C D5 C2    .ÕÂ  STY &C2D5
B22B A8          ¨    TAY		Zero A and Y
B22C D0 03       Ð.   BNE &B231		Jump ahead for open
B22E 4C E0 B3    Là³  JMP &B3E0		Jump to close

OPEN
----
B231 AD 32 C3    ­2Ã  LDA &C332		Handle stored from *RUN?
B234 F0 08       ð.   BEQ &B23E		No, do a real OPEN
B236 A0 00        .   LDY #&00
B238 8C 32 C3    .2Ã  STY &C332		Clear stored handle
B23B A4 B5       ¤µ   LDY &B5		Restore Y
B23D 60          `    RTS		Return handle from *RUN

Open a file
-----------
B23E A2 09       ¢.   LDX #&09		Look for a spare channel
B240 BD AC C3    ½¬Ã  LDA &C3AC,X	Check channel flags
B243 F0 1B       ð.   BEQ &B260		Found a spare channel
B245 CA          Ê    DEX		Loop to next channel
B246 10 F8       .ø   BPL &B240		Keep going until run out of channels
B248 20 6B 83     k.  JSR &836B		Generate an error
B24B C0 54       ÀT   CPY #&54
B24D 6F 6F 20    oo   BBR 6,&6F,&B270
B250 6D 61 6E    man  ADC &6E61
B253 79 20 6F    y o  ADC &6F20,Y
B256 70 65       pe   BVS &B2BD
B258 6E 20 66    n f  ROR &6620
B25B 69 6C       il   ADC #&6C
B25D 65 73       es   ADC &73
B25F 00          .    BRK

Found a spare channel
---------------------
B260 86 CF       .Ï   STX &CF		Store channel offset
B262 8C A0 C2    . Â  STY &C2A0
B265 98          .    TYA
B266 10 03       ..   BPL &B26B
B268 4C 3E B3    L>³  JMP &B33E

B26B 20 E8 8F     è.  JSR &8FE8
B26E F0 05       ð.   BEQ &B275
B270 A9 00       ©.   LDA #&00
B272 4C 36 B3    L6³  JMP &B336

B275 A2 09       ¢.   LDX #&09
B277 BD AC C3    ½¬Ã  LDA &C3AC,X
B27A 10 2E       ..   BPL &B2AA
B27C BD B6 C3    ½¶Ã  LDA &C3B6,X
B27F 29 E0       )à   AND #&E0
B281 CD 17 C3    Í.Ã  CMP &C317
B284 D0 24       Ð$   BNE &B2AA
B286 BD E8 C3    ½èÃ  LDA &C3E8,X
B289 CD 14 C3    Í.Ã  CMP &C314
B28C D0 1C       Ð.   BNE &B2AA
B28E BD DE C3    ½ÞÃ  LDA &C3DE,X
B291 CD 15 C3    Í.Ã  CMP &C315
B294 D0 14       Ð.   BNE &B2AA
B296 BD D4 C3    ½ÔÃ  LDA &C3D4,X
B299 CD 16 C3    Í.Ã  CMP &C316
B29C D0 0C       Ð.   BNE &B2AA
B29E A0 19        .   LDY #&19
B2A0 B1 B6       ±¶   LDA (&B6),Y
B2A2 DD F2 C3    ÝòÃ  CMP &C3F2,X
B2A5 D0 03       Ð.   BNE &B2AA
B2A7 4C 5E 8D    L^.  JMP &8D5E

B2AA CA          Ê    DEX
B2AB 10 CA       .Ê   BPL &B277
B2AD A0 00        .   LDY #&00
B2AF B1 B6       ±¶   LDA (&B6),Y
B2B1 30 03       0.   BMI &B2B6
B2B3 4C FB 8B    Lû.  JMP &8BFB

B2B6 A0 12        .   LDY #&12
B2B8 A6 CF       ¦Ï   LDX &CF
B2BA B1 B6       ±¶   LDA (&B6),Y
B2BC 9D 52 C3    .RÃ  STA &C352,X
B2BF C8          È    INY
B2C0 B1 B6       ±¶   LDA (&B6),Y
B2C2 9D 48 C3    .HÃ  STA &C348,X
B2C5 C8          È    INY
B2C6 B1 B6       ±¶   LDA (&B6),Y
B2C8 9D 3E C3    .>Ã  STA &C33E,X
B2CB C8          È    INY
B2CC B1 B6       ±¶   LDA (&B6),Y
B2CE 9D 34 C3    .4Ã  STA &C334,X
B2D1 A0 12        .   LDY #&12
B2D3 A6 CF       ¦Ï   LDX &CF
B2D5 B1 B6       ±¶   LDA (&B6),Y
B2D7 9D A2 C3    .¢Ã  STA &C3A2,X
B2DA C8          È    INY
B2DB B1 B6       ±¶   LDA (&B6),Y
B2DD 9D 98 C3    ..Ã  STA &C398,X
B2E0 C8          È    INY
B2E1 B1 B6       ±¶   LDA (&B6),Y
B2E3 9D 8E C3    ..Ã  STA &C38E,X
B2E6 C8          È    INY
B2E7 B1 B6       ±¶   LDA (&B6),Y
B2E9 9D 84 C3    ..Ã  STA &C384,X
B2EC C8          È    INY
B2ED B1 B6       ±¶   LDA (&B6),Y
B2EF 9D CA C3    .ÊÃ  STA &C3CA,X
B2F2 C8          È    INY
B2F3 B1 B6       ±¶   LDA (&B6),Y
B2F5 9D C0 C3    .ÀÃ  STA &C3C0,X
B2F8 C8          È    INY
B2F9 B1 B6       ±¶   LDA (&B6),Y
B2FB 0D 17 C3    ..Ã  ORA &C317
B2FE 9D B6 C3    .¶Ã  STA &C3B6,X
B301 C8          È    INY
B302 B1 B6       ±¶   LDA (&B6),Y
B304 9D F2 C3    .òÃ  STA &C3F2,X
B307 AD 14 C3    ­.Ã  LDA &C314
B30A 9D E8 C3    .èÃ  STA &C3E8,X
B30D AD 15 C3    ­.Ã  LDA &C315
B310 9D DE C3    .ÞÃ  STA &C3DE,X
B313 AD 16 C3    ­.Ã  LDA &C316
B316 9D D4 C3    .ÔÃ  STA &C3D4,X
B319 A9 00       ©.   LDA #&00
B31B 9D 7A C3    .zÃ  STA &C37A,X
B31E 9D 70 C3    .pÃ  STA &C370,X
B321 9D 66 C3    .fÃ  STA &C366,X
B324 9D 5C C3    .\Ã  STA &C35C,X
B327 AD A0 C2    ­ Â  LDA &C2A0
B32A 9D AC C3    .¬Ã  STA &C3AC,X
B32D 8A          .    TXA
B32E 18          .    CLC
B32F 69 30       i0   ADC #&30
B331 48          H    PHA
B332 20 9C B1     .±  JSR &B19C
B335 68          h    PLA
B336 20 D8 89     Ø.  JSR &89D8
B339 A6 C5       ¦Å   LDX &C5
B33B A4 C4       ¤Ä   LDY &C4
B33D 60          `    RTS

B33E 2C A0 C2    , Â  BIT &C2A0
B341 50 18       P.   BVC &B35B
B343 20 E8 8F     è.  JSR &8FE8
B346 08          .    PHP
B347 A9 00       ©.   LDA #&00
B349 28          (    PLP
B34A D0 EA       Ðê   BNE &B336
B34C 20 2C 8D     ,.  JSR &8D2C
B34F A0 01        .   LDY #&01
B351 B1 B6       ±¶   LDA (&B6),Y
B353 30 03       0.   BMI &B358
B355 4C FB 8B    Lû.  JMP &8BFB

B358 4C 75 B2    Lu²  JMP &B275

B35B 20 C8 8D     È.  JSR &8DC8
B35E 20 E8 8F     è.  JSR &8FE8
B361 D0 0C       Ð.   BNE &B36F
B363 20 1B 8D     ..  JSR &8D1B
B366 A0 01        .   LDY #&01
B368 B1 B6       ±¶   LDA (&B6),Y
B36A 10 E9       .é   BPL &B355
B36C 4C CD B3    LÍ³  JMP &B3CD

B36F A9 00       ©.   LDA #&00
B371 A2 0F       ¢.   LDX #&0F
B373 9D 42 C2    .BÂ  STA &C242,X
B376 CA          Ê    DEX
B377 10 FA       .ú   BPL &B373
B379 AE FE C1    ®þÁ  LDX &C1FE
B37C A9 00       ©.   LDA #&00
B37E 1D FE C0    .þÀ  ORA &C0FE,X
B381 1D FF C0    ..À  ORA &C0FF,X
B384 BC FD C0    ¼ýÀ  LDY &C0FD,X
B387 CC 4F C2    ÌOÂ  CPY &C24F
B38A 90 03       ..   BCC &B38F
B38C 8C 4F C2    .OÂ  STY &C24F
B38F CA          Ê    DEX
B390 CA          Ê    DEX
B391 CA          Ê    DEX
B392 D0 EA       Ðê   BNE &B37E
B394 A8          ¨    TAY
B395 F0 07       ð.   BEQ &B39E
B397 8E 4F C2    .OÂ  STX &C24F
B39A E8          è    INX
B39B 8E 50 C2    .PÂ  STX &C250
B39E A9 FF       ©.   LDA #&FF
B3A0 8D 46 C2    .FÂ  STA &C246
B3A3 8D 47 C2    .GÂ  STA &C247
B3A6 8D 48 C2    .HÂ  STA &C248
B3A9 8D 49 C2    .IÂ  STA &C249
B3AC A2 40       ¢@   LDX #&40
B3AE 86 B8       .¸   STX &B8
B3B0 A0 C2        Â   LDY #&C2
B3B2 84 B9       .¹   STY &B9
B3B4 20 D8 89     Ø.  JSR &89D8
B3B7 20 57 8F     W.  JSR &8F57
B3BA 20 91 8F     ..  JSR &8F91
B3BD 20 D5 89     Õ.  JSR &89D5
B3C0 AD 40 C2    ­@Â  LDA &C240
B3C3 85 B4       .´   STA &B4
B3C5 AD 41 C2    ­AÂ  LDA &C241
B3C8 85 B5       .µ   STA &B5
B3CA 20 E8 8F     è.  JSR &8FE8
B3CD A9 00       ©.   LDA #&00
B3CF A6 CF       ¦Ï   LDX &CF
B3D1 9D 52 C3    .RÃ  STA &C352,X
B3D4 9D 48 C3    .HÃ  STA &C348,X
B3D7 9D 3E C3    .>Ã  STA &C33E,X
B3DA 9D 34 C3    .4Ã  STA &C334,X
B3DD 4C D1 B2    LÑ²  JMP &B2D1

CLOSE a channel
===============
B3E0 A4 C4       ¤Ä   LDY &C4		Get handle
B3E2 D0 22       Ð"   BNE &B406		Nonzero, close just this channel
B3E4 A2 09       ¢.   LDX #&09		Loop for all channels
B3E6 BD AC C3    ½¬Ã  LDA &C3AC,X	Get channel flag
B3E9 D0 0C       Ð.   BNE &B3F7		Jump to close this channel
B3EB CA          Ê    DEX		Loop for all channels
B3EC 10 F8       .ø   BPL &B3E6
B3EE 20 28 83     (.  JSR &8328		Wait until ensuring complete
B3F1 A9 00       ©.   LDA #&00		Clear A
B3F3 A6 C5       ¦Å   LDX &C5		Restore X
B3F5 A8          ¨    TAY		Clear Y
B3F6 60          `    RTS		Returns with A and Y preserved

Close a channel with X=offset
-----------------------------
B3F7 8A          .    TXA
B3F8 18          .    CLC
B3F9 69 30       i0   ADC #&30		A=channel number for this offset
B3FB 85 B5       .µ   STA &B5
B3FD 86 CF       .Ï   STX &CF		Save X
B3FF 20 09 B4     .´  JSR &B409		Close this channel
B402 A6 CF       ¦Ï   LDX &CF		Restore X
B404 10 E5       .å   BPL &B3EB		Jump back into close-all loop

Close a channel with Y=handle
-----------------------------
B406 20 0D AD     .­  JSR &AD0D		Check channel and get flags
B409 20 E9 B1     é±  JSR &B1E9		Check something and set flags
B40C BC AC C3    ¼¬Ã  LDY &C3AC,X	Get flags
B40F 9E AC C3    .¬Ã  STZ &C3AC,X	Clear flags
B412 98          .    TYA		Pass flags to A
B413 10 20       .    BPL &B435		Jump ahead if b7=0
B415 BD 52 C3    ½RÃ  LDA &C352,X
B418 DD A2 C3    Ý¢Ã  CMP &C3A2,X
B41B D0 25       Ð%   BNE &B442
B41D BD 48 C3    ½HÃ  LDA &C348,X
B420 DD 98 C3    Ý.Ã  CMP &C398,X
B423 D0 1D       Ð.   BNE &B442
B425 BD 3E C3    ½>Ã  LDA &C33E,X
B428 DD 8E C3    Ý.Ã  CMP &C38E,X
B42B D0 15       Ð.   BNE &B442
B42D BD 34 C3    ½4Ã  LDA &C334,X
B430 DD 84 C3    Ý.Ã  CMP &C384,X
B433 D0 0D       Ð.   BNE &B442		Jump ahead with difference
B435 20 B9 AA     ¹ª  JSR &AAB9		Write buffer?
B438 20 D8 89     Ø.  JSR &89D8		Do something with FSM
B43B A9 00       ©.   LDA #&00
B43D A4 C4       ¤Ä   LDY &C4
B43F A6 C5       ¦Å   LDX &C5
B441 60          `    RTS

Update directory entry?
-----------------------
B442 20 D4 AD     Ô­  JSR &ADD4
B445 BD 52 C3    ½RÃ  LDA &C352,X
B448 C9 01       É.   CMP #&01
B44A AD 34 C2    ­4Â  LDA &C234
B44D 7D 48 C3    }HÃ  ADC &C348,X
B450 8D 34 C2    .4Â  STA &C234
B453 AD 35 C2    ­5Â  LDA &C235
B456 7D 3E C3    }>Ã  ADC &C33E,X
B459 8D 35 C2    .5Â  STA &C235
B45C AD 36 C2    ­6Â  LDA &C236
B45F 7D 34 C3    }4Ã  ADC &C334,X
B462 8D 36 C2    .6Â  STA &C236
B465 BD A2 C3    ½¢Ã  LDA &C3A2,X
B468 C9 01       É.   CMP #&01
B46A BD 98 C3    ½.Ã  LDA &C398,X
B46D FD 48 C3    ýHÃ  SBC &C348,X
B470 8D 37 C2    .7Â  STA &C237
B473 BD 8E C3    ½.Ã  LDA &C38E,X
B476 FD 3E C3    ý>Ã  SBC &C33E,X
B479 8D 38 C2    .8Â  STA &C238
B47C BD 84 C3    ½.Ã  LDA &C384,X
B47F FD 34 C3    ý4Ã  SBC &C334,X
B482 8D 39 C2    .9Â  STA &C239
B485 BD 52 C3    ½RÃ  LDA &C352,X
B488 D0 0D       Ð.   BNE &B497
B48A EE 37 C2    î7Â  INC &C237
B48D D0 08       Ð.   BNE &B497
B48F EE 38 C2    î8Â  INC &C238
B492 D0 03       Ð.   BNE &B497
B494 EE 39 C2    î9Â  INC &C239
B497 BD 52 C3    ½RÃ  LDA &C352,X
B49A A0 12        .   LDY #&12
B49C 91 B8       .¸   STA (&B8),Y
B49E BD 48 C3    ½HÃ  LDA &C348,X
B4A1 C8          È    INY
B4A2 91 B8       .¸   STA (&B8),Y
B4A4 BD 3E C3    ½>Ã  LDA &C33E,X
B4A7 C8          È    INY
B4A8 91 B8       .¸   STA (&B8),Y
B4AA BD 34 C3    ½4Ã  LDA &C334,X
B4AD C8          È    INY
B4AE 91 B8       .¸   STA (&B8),Y
B4B0 20 E1 84     á.  JSR &84E1		Calculate something in FSM
B4B3 20 91 8F     ..  JSR &8F91
B4B6 4C 35 B4    L5´  JMP &B435		Jump back to write buffer?

B4B9 A2 09       ¢.   LDX #&09
B4BB BD AC C3    ½¬Ã  LDA &C3AC,X
B4BE F0 0A       ð.   BEQ &B4CA
B4C0 BD B6 C3    ½¶Ã  LDA &C3B6,X
B4C3 29 E0       )à   AND #&E0
B4C5 CD 17 C3    Í.Ã  CMP &C317
B4C8 F0 15       ð.   BEQ &B4DF
B4CA CA          Ê    DEX
B4CB 10 EE       .î   BPL &B4BB

B4CD AD 17 C3    ­.Ã  LDA &C317
B4D0 20 C5 B5     Åµ  JSR &B5C5
B4D3 AD FB C1    ­ûÁ  LDA &C1FB
B4D6 9D 21 C3    .!Ã  STA &C321,X
B4D9 AD FC C1    ­üÁ  LDA &C1FC
B4DC 9D 22 C3    ."Ã  STA &C322,X
B4DF 20 10 B5     .µ  JSR &B510
B4E2 AD 17 C3    ­.Ã  LDA &C317
B4E5 20 C5 B5     Åµ  JSR &B5C5
B4E8 AD FB C1    ­ûÁ  LDA &C1FB
B4EB DD 21 C3    Ý!Ã  CMP &C321,X
B4EE D0 0F       Ð.   BNE &B4FF
B4F0 AD FC C1    ­üÁ  LDA &C1FC
B4F3 DD 22 C3    Ý"Ã  CMP &C322,X
B4F6 D0 07       Ð.   BNE &B4FF
B4F8 20 60 B5     `µ  JSR &B560
B4FB 8D C2 C2    .ÂÂ  STA &C2C2
B4FE 60          `    RTS

B4FF 20 6B 83     k.  JSR &836B
B502 C8          È    INY
B503 44          D    EQUB &44
B504 69 73       is   ADC #&73
B506 63          c    EQUB &63
B507 20 63 68     ch  JSR &6863
B50A 61 6E       an   ADC (&6E,X)
B50C 67          g    EQUB &67
B50D 65 64       ed   ADC &64
B50F 00          .    BRK
B510 A9 01       ©.   LDA #&01
B512 A2 C8       ¢È   LDX #&C8
B514 A0 C2        Â   LDY #&C2
B516 20 F1 FF     ñ.  JSR &FFF1
B519 A2 00       ¢.   LDX #&00
B51B A0 04        .   LDY #&04
B51D 38          8    SEC
B51E BD C8 C2    ½ÈÂ  LDA &C2C8,X
B521 48          H    PHA
B522 FD C3 C2    ýÃÂ  SBC &C2C3,X
B525 9D C8 C2    .ÈÂ  STA &C2C8,X
B528 68          h    PLA
B529 9D C3 C2    .ÃÂ  STA &C2C3,X
B52C E8          è    INX
B52D 88          .    DEY
B52E 10 EE       .î   BPL &B51E
B530 AD CC C2    ­ÌÂ  LDA &C2CC
B533 0D CB C2    .ËÂ  ORA &C2CB
B536 0D CA C2    .ÊÂ  ORA &C2CA
B539 D0 07       Ð.   BNE &B542
B53B AD C9 C2    ­ÉÂ  LDA &C2C9
B53E C9 02       É.   CMP #&02
B540 90 03       ..   BCC &B545
B542 8C C2 C2    .ÂÂ  STY &C2C2
B545 60          `    RTS

B546 20 10 B5     .µ  JSR &B510
B549 AD 17 C3    ­.Ã  LDA &C317
B54C 20 C5 B5     Åµ  JSR &B5C5
B54F 20 60 B5     `µ  JSR &B560
B552 4D C2 C2    MÂÂ  EOR &C2C2
B555 F0 EE       ðî   BEQ &B545
B557 A2 31       ¢1   LDX #&31
B559 A0 88        .   LDY #&88
B55B 20 AE 82     ®.  JSR &82AE
B55E 80 82       ..   BRA &B4E2

B560 A9 FF       ©.   LDA #&FF
B562 18          .    CLC
B563 2A          *    ROL A
B564 CA          Ê    DEX
B565 CA          Ê    DEX
B566 10 FB       .û   BPL &B563
B568 2D C2 C2    -ÂÂ  AND &C2C2
B56B 60          `    RTS

B56C 29 E0       )à   AND #&E0
B56E 8D CD C2    .ÍÂ  STA &C2CD
B571 DA          Ú    PHX
B572 5A          Z    PHY
B573 20 10 B5     .µ  JSR &B510
B576 AD CD C2    ­ÍÂ  LDA &C2CD
B579 20 C5 B5     Åµ  JSR &B5C5
B57C 20 60 B5     `µ  JSR &B560
B57F 4D C2 C2    MÂÂ  EOR &C2C2
B582 F0 3E       ð>   BEQ &B5C2
B584 AD CD C2    ­ÍÂ  LDA &C2CD
B587 AA          ª    TAX
B588 48          H    PHA
B589 AD 17 C3    ­.Ã  LDA &C317
B58C 8D CD C2    .ÍÂ  STA &C2CD
B58F AC 2F C2    ¬/Â  LDY &C22F
B592 C0 FF       À.   CPY #&FF
B594 D0 06       Ð.   BNE &B59C
B596 8D 2F C2    ./Â  STA &C22F
B599 8C CD C2    .ÍÂ  STY &C2CD
B59C 8E 17 C3    ..Ã  STX &C317
B59F 20 46 B5     Fµ  JSR &B546
B5A2 AC CD C2    ¬ÍÂ  LDY &C2CD
B5A5 8C 17 C3    ..Ã  STY &C317
B5A8 C0 FF       À.   CPY #&FF
B5AA D0 09       Ð.   BNE &B5B5
B5AC AD 2F C2    ­/Â  LDA &C22F
B5AF 8D 17 C3    ..Ã  STA &C317
B5B2 8C 2F C2    ./Â  STY &C22F
B5B5 68          h    PLA
B5B6 CD 17 C3    Í.Ã  CMP &C317
B5B9 F0 07       ð.   BEQ &B5C2
B5BB A2 31       ¢1   LDX #&31
B5BD A0 88        .   LDY #&88
B5BF 20 AE 82     ®.  JSR &82AE
B5C2 7A          z    PLY
B5C3 FA          ú    PLX
B5C4 60          `    RTS

B5C5 4A          J    LSR A
B5C6 4A          J    LSR A
B5C7 4A          J    LSR A
B5C8 4A          J    LSR A
B5C9 AA          ª    TAX
B5CA 60          `    RTS

B5CB 20 7F A7     .§  JSR &A77F
B5CE 8D B4 C2    .´Â  STA &C2B4
B5D1 8D B5 C2    .µÂ  STA &C2B5
B5D4 84 C7       .Ç   STY &C7
B5D6 86 C6       .Æ   STX &C6
B5D8 A0 01        .   LDY #&01
B5DA A2 03       ¢.   LDX #&03
B5DC B1 C6       ±Æ   LDA (&C6),Y
B5DE 99 B7 C2    .·Â  STA &C2B7,Y
B5E1 C8          È    INY
B5E2 CA          Ê    DEX
B5E3 10 F7       .÷   BPL &B5DC
B5E5 AD B4 C2    ­´Â  LDA &C2B4
B5E8 C9 05       É.   CMP #&05
B5EA 90 04       ..   BCC &B5F0
B5EC 4C DA B8    LÚ¸  JMP &B8DA

B5EF 60          `    RTS

B5F0 A8          ¨    TAY
B5F1 F0 FC       ðü   BEQ &B5EF
B5F3 A0 00        .   LDY #&00
B5F5 B1 C6       ±Æ   LDA (&C6),Y
B5F7 A8          ¨    TAY
B5F8 20 0D AD     .­  JSR &AD0D
B5FB 08          .    PHP
B5FC 20 E9 B1     é±  JSR &B1E9
B5FF A6 CF       ¦Ï   LDX &CF
B601 BD B6 C3    ½¶Ã  LDA &C3B6,X
B604 20 6C B5     lµ  JSR &B56C
B607 28          (    PLP
B608 30 0A       0.   BMI &B614
B60A AD B4 C2    ­´Â  LDA &C2B4
B60D C9 03       É.   CMP #&03
B60F B0 03       °.   BCS &B614
B611 4C FA B0    Lú°  JMP &B0FA

B614 AD B4 C2    ­´Â  LDA &C2B4
B617 29 01       ).   AND #&01
B619 F0 0E       ð.   BEQ &B629
B61B A0 0C        .   LDY #&0C
B61D A2 03       ¢.   LDX #&03
B61F B1 C6       ±Æ   LDA (&C6),Y
B621 95 C8       .È   STA &C8,X
B623 88          .    DEY
B624 CA          Ê    DEX
B625 10 F8       .ø   BPL &B61F
B627 A9 01       ©.   LDA #&01
B629 A4 C2       ¤Â   LDY &C2
B62B A2 C8       ¢È   LDX #&C8
B62D 20 AB A9     «©  JSR &A9AB
B630 18          .    CLC
B631 A2 03       ¢.   LDX #&03
B633 A0 05        .   LDY #&05
B635 B1 C6       ±Æ   LDA (&C6),Y
B637 79 C3 00    yÃ.  ADC &00C3,Y
B63A 99 95 C2    ..Â  STA &C295,Y
B63D C8          È    INY
B63E CA          Ê    DEX
B63F 10 F4       .ô   BPL &B635
B641 AD B4 C2    ­´Â  LDA &C2B4
B644 8D B5 C2    .µÂ  STA &C2B5
B647 C9 03       É.   CMP #&03
B649 B0 03       °.   BCS &B64E
B64B 20 6D AE     m®  JSR &AE6D
B64E A0 09        .   LDY #&09
B650 A6 CF       ¦Ï   LDX &CF
B652 AD 9A C2    ­.Â  LDA &C29A
B655 9D 7A C3    .zÃ  STA &C37A,X
B658 91 C6       .Æ   STA (&C6),Y
B65A C8          È    INY
B65B AD 9B C2    ­.Â  LDA &C29B
B65E 9D 70 C3    .pÃ  STA &C370,X
B661 91 C6       .Æ   STA (&C6),Y
B663 C8          È    INY
B664 AD 9C C2    ­.Â  LDA &C29C
B667 9D 66 C3    .fÃ  STA &C366,X
B66A 91 C6       .Æ   STA (&C6),Y
B66C C8          È    INY
B66D AD 9D C2    ­.Â  LDA &C29D
B670 9D 5C C3    .\Ã  STA &C35C,X
B673 91 C6       .Æ   STA (&C6),Y
B675 AD B4 C2    ­´Â  LDA &C2B4
B678 C9 03       É.   CMP #&03
B67A B0 14       °.   BCS &B690
B67C A2 03       ¢.   LDX #&03
B67E A0 05        .   LDY #&05
B680 B1 C6       ±Æ   LDA (&C6),Y
B682 99 3B C2    .;Â  STA &C23B,Y
B685 A9 00       ©.   LDA #&00
B687 91 C6       .Æ   STA (&C6),Y
B689 C8          È    INY
B68A CA          Ê    DEX
B68B 10 F3       .ó   BPL &B680
B68D 4C FE B6    Lþ¶  JMP &B6FE

B690 20 25 AD     %­  JSR &AD25
B693 B0 E7       °ç   BCS &B67C
B695 F0 E5       ðå   BEQ &B67C
B697 9C B5 C2    .µÂ  STZ &C2B5
B69A A6 CF       ¦Ï   LDX &CF
B69C 38          8    SEC
B69D BD 52 C3    ½RÃ  LDA &C352,X
B6A0 E5 C8       åÈ   SBC &C8
B6A2 8D 40 C2    .@Â  STA &C240
B6A5 BD 48 C3    ½HÃ  LDA &C348,X
B6A8 E5 C9       åÉ   SBC &C9
B6AA 8D 41 C2    .AÂ  STA &C241
B6AD BD 3E C3    ½>Ã  LDA &C33E,X
B6B0 E5 CA       åÊ   SBC &CA
B6B2 8D 42 C2    .BÂ  STA &C242
B6B5 BD 34 C3    ½4Ã  LDA &C334,X
B6B8 E5 CB       åË   SBC &CB
B6BA 8D 43 C2    .CÂ  STA &C243
B6BD A2 03       ¢.   LDX #&03
B6BF A0 05        .   LDY #&05
B6C1 38          8    SEC
B6C2 B1 C6       ±Æ   LDA (&C6),Y
B6C4 F9 3B C2    ù;Â  SBC &C23B,Y
B6C7 91 C6       .Æ   STA (&C6),Y
B6C9 C8          È    INY
B6CA CA          Ê    DEX
B6CB 10 F5       .õ   BPL &B6C2
B6CD A6 CF       ¦Ï   LDX &CF
B6CF BD 52 C3    ½RÃ  LDA &C352,X
B6D2 8D 9A C2    ..Â  STA &C29A
B6D5 9D 7A C3    .zÃ  STA &C37A,X
B6D8 91 C6       .Æ   STA (&C6),Y
B6DA C8          È    INY
B6DB BD 48 C3    ½HÃ  LDA &C348,X
B6DE 8D 9B C2    ..Â  STA &C29B
B6E1 9D 70 C3    .pÃ  STA &C370,X
B6E4 91 C6       .Æ   STA (&C6),Y
B6E6 C8          È    INY
B6E7 BD 3E C3    ½>Ã  LDA &C33E,X
B6EA 8D 9C C2    ..Â  STA &C29C
B6ED 9D 66 C3    .fÃ  STA &C366,X
B6F0 91 C6       .Æ   STA (&C6),Y
B6F2 C8          È    INY
B6F3 BD 34 C3    ½4Ã  LDA &C334,X
B6F6 8D 9D C2    ..Â  STA &C29D
B6F9 9D 5C C3    .\Ã  STA &C35C,X
B6FC 91 C6       .Æ   STA (&C6),Y
B6FE A0 01        .   LDY #&01
B700 A2 03       ¢.   LDX #&03
B702 18          .    CLC
B703 B9 3F C2    ¹?Â  LDA &C23F,Y
B706 71 C6       qÆ   ADC (&C6),Y
B708 91 C6       .Æ   STA (&C6),Y
B70A C8          È    INY
B70B CA          Ê    DEX
B70C 10 F5       .õ   BPL &B703
B70E A5 C8       ¥È   LDA &C8
B710 D0 03       Ð.   BNE &B715
B712 4C A5 B7    L¥·  JMP &B7A5

B715 A6 CF       ¦Ï   LDX &CF
B717 18          .    CLC
B718 BD CA C3    ½ÊÃ  LDA &C3CA,X
B71B 65 C9       eÉ   ADC &C9
B71D 8D 96 C2    ..Â  STA &C296
B720 BD C0 C3    ½ÀÃ  LDA &C3C0,X
B723 65 CA       eÊ   ADC &CA
B725 8D 97 C2    ..Â  STA &C297
B728 BD B6 C3    ½¶Ã  LDA &C3B6,X
B72B 65 CB       eË   ADC &CB
B72D 8D 98 C2    ..Â  STA &C298
B730 A9 02       ©.   LDA #&02
B732 CD B4 C2    Í´Â  CMP &C2B4
B735 A9 80       ©.   LDA #&80
B737 6A          j    ROR A
B738 20 E7 AB     ç«  JSR &ABE7
B73B A5 C8       ¥È   LDA &C8
B73D 8D B6 C2    .¶Â  STA &C2B6
B740 9C B7 C2    .·Â  STZ &C2B7
B743 A2 02       ¢.   LDX #&02
B745 BD 9B C2    ½.Â  LDA &C29B,X
B748 D5 C9       ÕÉ   CMP &C9,X
B74A D0 1C       Ð.   BNE &B768
B74C CA          Ê    DEX
B74D 10 F6       .ö   BPL &B745
B74F AD 9A C2    ­.Â  LDA &C29A
B752 8D B7 C2    .·Â  STA &C2B7
B755 20 CA B9     Ê¹  JSR &B9CA
B758 20 D8 89     Ø.  JSR &89D8
B75B 20 9C B1     .±  JSR &B19C
B75E A9 00       ©.   LDA #&00
B760 CD B5 C2    ÍµÂ  CMP &C2B5
B763 A6 C6       ¦Æ   LDX &C6
B765 A4 C7       ¤Ç   LDY &C7
B767 60          `    RTS

B768 20 CA B9     Ê¹  JSR &B9CA
B76B A9 00       ©.   LDA #&00
B76D 38          8    SEC
B76E ED B6 C2    í¶Â  SBC &C2B6
B771 8D B6 C2    .¶Â  STA &C2B6
B774 18          .    CLC
B775 6D B8 C2    m¸Â  ADC &C2B8
B778 8D B8 C2    .¸Â  STA &C2B8
B77B 90 0D       ..   BCC &B78A
B77D EE B9 C2    î¹Â  INC &C2B9
B780 D0 08       Ð.   BNE &B78A
B782 EE BA C2    îºÂ  INC &C2BA
B785 D0 03       Ð.   BNE &B78A
B787 EE BB C2    î»Â  INC &C2BB
B78A 38          8    SEC
B78B AD 40 C2    ­@Â  LDA &C240
B78E ED B6 C2    í¶Â  SBC &C2B6
B791 8D 40 C2    .@Â  STA &C240
B794 B0 0F       °.   BCS &B7A5
B796 A0 01        .   LDY #&01
B798 B9 40 C2    ¹@Â  LDA &C240,Y
B79B E9 00       é.   SBC #&00
B79D 99 40 C2    .@Â  STA &C240,Y
B7A0 B0 03       °.   BCS &B7A5
B7A2 C8          È    INY
B7A3 D0 F3       Ðó   BNE &B798
B7A5 AD 41 C2    ­AÂ  LDA &C241
B7A8 0D 42 C2    .BÂ  ORA &C242
B7AB 0D 43 C2    .CÂ  ORA &C243
B7AE D0 03       Ð.   BNE &B7B3
B7B0 4C 2B B8    L+¸  JMP &B82B

B7B3 A9 01       ©.   LDA #&01
B7B5 8D 15 C2    ..Â  STA &C215
B7B8 A0 03        .   LDY #&03
B7BA B9 B8 C2    ¹¸Â  LDA &C2B8,Y
B7BD 99 16 C2    ..Â  STA &C216,Y
B7C0 88          .    DEY
B7C1 10 F7       .÷   BPL &B7BA
B7C3 A9 02       ©.   LDA #&02
B7C5 CD B4 C2    Í´Â  CMP &C2B4
B7C8 A9 02       ©.   LDA #&02
B7CA 2A          *    ROL A
B7CB 2A          *    ROL A
B7CC 8D 1A C2    ..Â  STA &C21A
B7CF A6 CF       ¦Ï   LDX &CF
B7D1 A5 C8       ¥È   LDA &C8
B7D3 C9 01       É.   CMP #&01
B7D5 BD CA C3    ½ÊÃ  LDA &C3CA,X
B7D8 65 C9       eÉ   ADC &C9
B7DA 8D 1D C2    ..Â  STA &C21D
B7DD BD C0 C3    ½ÀÃ  LDA &C3C0,X
B7E0 65 CA       eÊ   ADC &CA
B7E2 8D 1C C2    ..Â  STA &C21C
B7E5 BD B6 C3    ½¶Ã  LDA &C3B6,X
B7E8 65 CB       eË   ADC &CB
B7EA 8D 1B C2    ..Â  STA &C21B
B7ED A0 04        .   LDY #&04
B7EF B9 13 C3    ¹.Ã  LDA &C313,Y
B7F2 99 2B C2    .+Â  STA &C22B,Y
B7F5 88          .    DEY
B7F6 D0 F7       Ð÷   BNE &B7EF
B7F8 8C 17 C3    ..Ã  STY &C317
B7FB 8C 1E C2    ..Â  STY &C21E
B7FE 8C 1F C2    ..Â  STY &C21F
B801 8C 20 C2    . Â  STY &C220
B804 18          .    CLC
B805 A2 02       ¢.   LDX #&02
B807 B9 41 C2    ¹AÂ  LDA &C241,Y
B80A 99 21 C2    .!Â  STA &C221,Y
B80D 79 B9 C2    y¹Â  ADC &C2B9,Y
B810 99 B9 C2    .¹Â  STA &C2B9,Y
B813 C8          È    INY
B814 CA          Ê    DEX
B815 10 F0       .ð   BPL &B807
B817 20 B9 AA     ¹ª  JSR &AAB9
B81A 20 42 8A     B.  JSR &8A42
B81D AD 2F C2    ­/Â  LDA &C22F
B820 8D 17 C3    ..Ã  STA &C317
B823 A9 FF       ©.   LDA #&FF
B825 8D 2F C2    ./Â  STA &C22F
B828 8D 2E C2    ..Â  STA &C22E
B82B AD 9A C2    ­.Â  LDA &C29A
B82E D0 03       Ð.   BNE &B833
B830 4C 58 B7    LX·  JMP &B758

B833 A6 CF       ¦Ï   LDX &CF
B835 18          .    CLC
B836 BD CA C3    ½ÊÃ  LDA &C3CA,X
B839 6D 9B C2    m.Â  ADC &C29B
B83C 8D 96 C2    ..Â  STA &C296
B83F BD C0 C3    ½ÀÃ  LDA &C3C0,X
B842 6D 9C C2    m.Â  ADC &C29C
B845 8D 97 C2    ..Â  STA &C297
B848 BD B6 C3    ½¶Ã  LDA &C3B6,X
B84B 6D 9D C2    m.Â  ADC &C29D
B84E 8D 98 C2    ..Â  STA &C298
B851 A9 02       ©.   LDA #&02
B853 CD B4 C2    Í´Â  CMP &C2B4
B856 A9 80       ©.   LDA #&80
B858 6A          j    ROR A
B859 20 E7 AB     ç«  JSR &ABE7
B85C 9C B6 C2    .¶Â  STZ &C2B6
B85F AD 9A C2    ­.Â  LDA &C29A
B862 8D B7 C2    .·Â  STA &C2B7
B865 20 CA B9     Ê¹  JSR &B9CA
B868 4C 58 B7    LX·  JMP &B758

B86B 24 CD       $Í   BIT &CD
B86D 10 29       .)   BPL &B898
B86F AD BA C2    ­ºÂ  LDA &C2BA
B872 AE BB C2    ®»Â  LDX &C2BB
B875 20 53 80     S.  JSR &8053
B878 AD BA C2    ­ºÂ  LDA &C2BA
B87B C9 FE       Éþ   CMP #&FE
B87D 90 06       ..   BCC &B885
B87F AD BB C2    ­»Â  LDA &C2BB
B882 1A          .    INC A
B883 F0 13       ð.   BEQ &B898
B885 08          .    PHP
B886 78          x    SEI
B887 20 32 80     2.  JSR &8032
B88A A9 40       ©@   LDA #&40
B88C 04 CD       .Í   TSB &CD
B88E A9 01       ©.   LDA #&01
B890 A2 B8       ¢¸   LDX #&B8
B892 A0 C2        Â   LDY #&C2
B894 20 06 04     ..  JSR &0406
B897 28          (    PLP
B898 64 BD       d½   STZ &BD
B89A AD B8 C2    ­¸Â  LDA &C2B8
B89D 85 B2       .²   STA &B2
B89F AD B9 C2    ­¹Â  LDA &C2B9
B8A2 85 B3       .³   STA &B3
B8A4 60          `    RTS

B8A5 24 CD       $Í   BIT &CD
B8A7 50 04       P.   BVC &B8AD
B8A9 8D E5 FE    .åþ  STA &FEE5
B8AC 60          `    RTS

B8AD 84 BC       .¼   STY &BC
B8AF A4 BD       ¤½   LDY &BD
B8B1 91 B2       .²   STA (&B2),Y
B8B3 E6 BD       æ½   INC &BD
B8B5 D0 02       Ð.   BNE &B8B9
B8B7 E6 B3       æ³   INC &B3
B8B9 A4 BC       ¤¼   LDY &BC
B8BB 60          `    RTS

B8BC A9 0A       ©.   LDA #&0A
B8BE 20 A5 B8     ¥¸  JSR &B8A5
B8C1 38          8    SEC
B8C2 A2 09       ¢.   LDX #&09
B8C4 A0 FF        .   LDY #&FF
B8C6 C8          È    INY
B8C7 90 0A       ..   BCC &B8D3
B8C9 B1 B4       ±´   LDA (&B4),Y
B8CB 29 7F       ).   AND #&7F
B8CD C9 21       É!   CMP #&21
B8CF B0 02       °.   BCS &B8D3
B8D1 A9 20       ©    LDA #&20
B8D3 20 A5 B8     ¥¸  JSR &B8A5
B8D6 CA          Ê    DEX
B8D7 10 ED       .í   BPL &B8C6
B8D9 60          `    RTS

B8DA E9 05       é.   SBC #&05
B8DC A8          ¨    TAY
B8DD F0 0C       ð.   BEQ &B8EB
B8DF 88          .    DEY
B8E0 F0 49       ðI   BEQ &B92B
B8E2 88          .    DEY
B8E3 F0 6A       ðj   BEQ &B94F
B8E5 88          .    DEY
B8E6 D0 3D       Ð=   BNE &B925
B8E8 4C 6A B9    Lj¹  JMP &B96A

B8EB 20 6B B8     k¸  JSR &B86B
B8EE A0 FF        .   LDY #&FF
B8F0 C8          È    INY
B8F1 B9 D9 C8    ¹ÙÈ  LDA &C8D9,Y
B8F4 29 7F       ).   AND #&7F
B8F6 C9 20       É    CMP #&20
B8F8 90 04       ..   BCC &B8FE
B8FA C0 13       À.   CPY #&13
B8FC D0 F2       Ðò   BNE &B8F0
B8FE 98          .    TYA
B8FF 20 A5 B8     ¥¸  JSR &B8A5
B902 A0 FF        .   LDY #&FF
B904 C8          È    INY
B905 B9 D9 C8    ¹ÙÈ  LDA &C8D9,Y
B908 29 7F       ).   AND #&7F
B90A C9 20       É    CMP #&20
B90C 90 07       ..   BCC &B915
B90E 20 A5 B8     ¥¸  JSR &B8A5
B911 C0 13       À.   CPY #&13
B913 D0 EF       Ðï   BNE &B904
B915 AD FD C1    ­ýÁ  LDA &C1FD
B918 20 A5 B8     ¥¸  JSR &B8A5
B91B AD 17 C3    ­.Ã  LDA &C317
B91E 0A          .    ASL A
B91F 2A          *    ROL A
B920 2A          *    ROL A
B921 2A          *    ROL A
B922 20 A5 B8     ¥¸  JSR &B8A5
B925 20 3A 80     :.  JSR &803A
B928 4C 5E B7    L^·  JMP &B75E

B92B 20 6B B8     k¸  JSR &B86B
B92E A9 01       ©.   LDA #&01
B930 20 A5 B8     ¥¸  JSR &B8A5
B933 AD 17 C3    ­.Ã  LDA &C317
B936 20 46 B9     F¹  JSR &B946
B939 A9 00       ©.   LDA #&00
B93B 85 B4       .´   STA &B4
B93D A9 C3       ©Ã   LDA #&C3
B93F 85 B5       .µ   STA &B5
B941 20 BC B8     ¼¸  JSR &B8BC
B944 30 DF       0ß   BMI &B925
B946 0A          .    ASL A
B947 2A          *    ROL A
B948 2A          *    ROL A
B949 2A          *    ROL A
B94A 69 30       i0   ADC #&30
B94C 4C A5 B8    L¥¸  JMP &B8A5

B94F 20 6B B8     k¸  JSR &B86B
B952 A9 01       ©.   LDA #&01
B954 20 A5 B8     ¥¸  JSR &B8A5
B957 AD 1B C3    ­.Ã  LDA &C31B
B95A 20 46 B9     F¹  JSR &B946
B95D A9 0A       ©.   LDA #&0A
B95F 85 B4       .´   STA &B4
B961 A9 C3       ©Ã   LDA #&C3
B963 85 B5       .µ   STA &B5
B965 20 BC B8     ¼¸  JSR &B8BC
B968 30 BB       0»   BMI &B925
B96A 20 6B B8     k¸  JSR &B86B
B96D A0 00        .   LDY #&00
B96F 8C B5 C2    .µÂ  STY &C2B5
B972 AD FA C8    ­úÈ  LDA &C8FA
B975 91 C6       .Æ   STA (&C6),Y
B977 A0 05        .   LDY #&05
B979 B1 C6       ±Æ   LDA (&C6),Y
B97B 85 B0       .°   STA &B0
B97D F0 A6       ð¦   BEQ &B925
B97F A0 09        .   LDY #&09
B981 B1 C6       ±Æ   LDA (&C6),Y
B983 85 B1       .±   STA &B1
B985 C9 2F       É/   CMP #&2F
B987 B0 9C       °.   BCS &B925
B989 AA          ª    TAX
B98A 18          .    CLC
B98B A9 05       ©.   LDA #&05
B98D A0 C4        Ä   LDY #&C4
B98F CA          Ê    DEX
B990 30 08       0.   BMI &B99A
B992 69 1A       i.   ADC #&1A
B994 90 F9       .ù   BCC &B98F
B996 C8          È    INY
B997 18          .    CLC
B998 90 F5       .õ   BCC &B98F
B99A 84 B5       .µ   STY &B5
B99C 85 B4       .´   STA &B4
B99E A0 00        .   LDY #&00
B9A0 B1 B4       ±´   LDA (&B4),Y
B9A2 8D B5 C2    .µÂ  STA &C2B5
B9A5 F0 14       ð.   BEQ &B9BB
B9A7 20 BC B8     ¼¸  JSR &B8BC
B9AA A5 B4       ¥´   LDA &B4
B9AC 18          .    CLC
B9AD 69 1A       i.   ADC #&1A
B9AF 85 B4       .´   STA &B4
B9B1 90 02       ..   BCC &B9B5
B9B3 E6 B5       æµ   INC &B5
B9B5 E6 B1       æ±   INC &B1
B9B7 C6 B0       Æ°   DEC &B0
B9B9 D0 E3       Ðã   BNE &B99E
B9BB A0 05        .   LDY #&05
B9BD A5 B0       ¥°   LDA &B0
B9BF 91 C6       .Æ   STA (&C6),Y
B9C1 A0 09        .   LDY #&09
B9C3 A5 B1       ¥±   LDA &B1
B9C5 91 C6       .Æ   STA (&C6),Y
B9C7 4C 25 B9    L%¹  JMP &B925

B9CA AD B6 C2    ­¶Â  LDA &C2B6
B9CD CD B7 C2    Í·Â  CMP &C2B7
B9D0 D0 01       Ð.   BNE &B9D3
B9D2 60          `    RTS

B9D3 24 CD       $Í   BIT &CD
B9D5 10 2C       .,   BPL &BA03
B9D7 AD BA C2    ­ºÂ  LDA &C2BA
B9DA AE BB C2    ®»Â  LDX &C2BB
B9DD 20 53 80     S.  JSR &8053
B9E0 AD BA C2    ­ºÂ  LDA &C2BA
B9E3 C9 FE       Éþ   CMP #&FE
B9E5 90 06       ..   BCC &B9ED
B9E7 AD BB C2    ­»Â  LDA &C2BB
B9EA 1A          .    INC A
B9EB F0 16       ð.   BEQ &BA03
B9ED A9 40       ©@   LDA #&40
B9EF 04 CD       .Í   TSB &CD
B9F1 20 32 80     2.  JSR &8032
B9F4 AD B4 C2    ­´Â  LDA &C2B4
B9F7 C9 03       É.   CMP #&03
B9F9 A9 00       ©.   LDA #&00
B9FB 2A          *    ROL A
B9FC A2 B8       ¢¸   LDX #&B8
B9FE A0 C2        Â   LDY #&C2
BA00 20 06 04     ..  JSR &0406
BA03 AD B8 C2    ­¸Â  LDA &C2B8
BA06 38          8    SEC
BA07 ED B6 C2    í¶Â  SBC &C2B6
BA0A 85 B2       .²   STA &B2
BA0C AD B9 C2    ­¹Â  LDA &C2B9
BA0F E9 00       é.   SBC #&00
BA11 85 B3       .³   STA &B3
BA13 AD B4 C2    ­´Â  LDA &C2B4
BA16 C9 03       É.   CMP #&03
BA18 AC B6 C2    ¬¶Â  LDY &C2B6
BA1B 08          .    PHP
BA1C 28          (    PLP
BA1D 24 CD       $Í   BIT &CD
BA1F 70 0E       p.   BVS &BA2F
BA21 90 06       ..   BCC &BA29
BA23 B1 BE       ±¾   LDA (&BE),Y
BA25 91 B2       .²   STA (&B2),Y
BA27 B0 17       °.   BCS &BA40
BA29 B1 B2       ±²   LDA (&B2),Y
BA2B 91 BE       .¾   STA (&BE),Y
BA2D 90 11       ..   BCC &BA40
BA2F 20 1B 82     ..  JSR &821B
BA32 90 07       ..   BCC &BA3B
BA34 B1 BE       ±¾   LDA (&BE),Y
BA36 8D E5 FE    .åþ  STA &FEE5
BA39 B0 05       °.   BCS &BA40
BA3B AD E5 FE    ­åþ  LDA &FEE5
BA3E 91 BE       .¾   STA (&BE),Y
BA40 C8          È    INY
BA41 08          .    PHP
BA42 CC B7 C2    Ì·Â  CPY &C2B7
BA45 D0 D5       ÐÕ   BNE &BA1C
BA47 28          (    PLP
BA48 4C 3A 80    L:.  JMP &803A


ACCESS FLOPPY CONTROLLER
========================

Pass SCSI command to floppy controller
--------------------------------------
BA4B 4C 46 BB    LF»  JMP &BB46		Do a SCSI action with floppy drive

BA4E 4C 57 BB    LW»  JMP &BB57

BA51 4C 5D BA    L]º  JMP &BA5D

BA54 4C 61 BA    Laº  JMP &BA61

BA57 A9 FF       ©.   LDA #&FF
BA59 8D E4 C2    .äÂ  STA &C2E4
BA5C 60          `    RTS

BA5D A9 40       ©@   LDA #&40
BA5F D0 02       Ð.   BNE &BA63
BA61 A9 C0       ©À   LDA #&C0
BA63 8D E0 C2    .àÂ  STA &C2E0
BA66 8A          .    TXA
BA67 BA          º    TSX
BA68 8E E7 C2    .çÂ  STX &C2E7
BA6B 48          H    PHA
BA6C 20 DE BB     Þ»  JSR &BBDE
BA6F 20 BE BB     ¾»  JSR &BBBE
BA72 FA          ú    PLX
BA73 24 A1       $¡   BIT &A1
BA75 30 0C       0.   BMI &BA83
BA77 A5 BC       ¥¼   LDA &BC
BA79 8D 0B 0D    ...  STA &0D0B
BA7C A5 BD       ¥½   LDA &BD
BA7E 8D 0C 0D    ...  STA &0D0C
BA81 D0 0A       Ð.   BNE &BA8D
BA83 A5 BE       ¥¾   LDA &BE
BA85 8D 0E 0D    ...  STA &0D0E
BA88 A5 BF       ¥¿   LDA &BF
BA8A 8D 0F 0D    ...  STA &0D0F
BA8D BD 03 C2    ½.Â  LDA &C203,X
BA90 48          H    PHA
BA91 29 1F       ).   AND #&1F
BA93 F0 04       ð.   BEQ &BA99
BA95 68          h    PLA
BA96 4C 6F BF    Lo¿  JMP &BF6F

BA99 68          h    PLA
BA9A 48          H    PHA
BA9B 29 40       )@   AND #&40
BA9D D0 F6       Ðö   BNE &BA95
BA9F 68          h    PLA
BAA0 29 20       )    AND #&20
BAA2 D0 04       Ð.   BNE &BAA8
BAA4 A9 05       ©.   LDA #&05
BAA6 D0 02       Ð.   BNE &BAAA
BAA8 A9 06       ©.   LDA #&06
BAAA 8D 5E 0D    .^.  STA &0D5E
BAAD A9 01       ©.   LDA #&01
BAAF 0C E4 C2    .äÂ  TSB &C2E4
BAB2 BD 01 C2    ½.Â  LDA &C201,X
BAB5 48          H    PHA
BAB6 BD 02 C2    ½.Â  LDA &C202,X
BAB9 AA          ª    TAX
BABA 68          h    PLA
BABB A0 FF        .   LDY #&FF
BABD 20 AB BF     «¿  JSR &BFAB
BAC0 85 A4       .¤   STA &A4
BAC2 84 A5       .¥   STY &A5
BAC4 98          .    TYA
BAC5 38          8    SEC
BAC6 E9 50       éP   SBC #&50
BAC8 30 05       0.   BMI &BACF
BACA 85 A5       .¥   STA &A5
BACC 20 40 BD     @½  JSR &BD40
BACF AD 5E 0D    ­^.  LDA &0D5E
BAD2 8D 24 FE    .$þ  STA &FE24		Drive control register
BAD5 6A          j    ROR A
BAD6 90 0C       ..   BCC &BAE4
BAD8 AD E5 C2    ­åÂ  LDA &C2E5
BADB 85 A3       .£   STA &A3
BADD 2C E4 C2    ,äÂ  BIT &C2E4
BAE0 10 0F       ..   BPL &BAF1
BAE2 30 0A       0.   BMI &BAEE
BAE4 AD E6 C2    ­æÂ  LDA &C2E6
BAE7 85 A3       .£   STA &A3
BAE9 2C E4 C2    ,äÂ  BIT &C2E4
BAEC 50 03       P.   BVC &BAF1
BAEE 20 55 BD     U½  JSR &BD55
BAF1 20 FA BA     úº  JSR &BAFA
BAF4 20 1E BD     .½  JSR &BD1E
BAF7 4C B7 BF    L·¿  JMP &BFB7

BAFA 20 46 BD     F½  JSR &BD46
BAFD A2 00       ¢.   LDX #&00
BAFF 20 3B BB     ;»  JSR &BB3B
BB02 E8          è    INX
BB03 20 3B BB     ;»  JSR &BB3B
BB06 E8          è    INX
BB07 20 3B BB     ;»  JSR &BB3B
BB0A C5 A3       Å£   CMP &A3
BB0C F0 18       ð.   BEQ &BB26
BB0E A9 01       ©.   LDA #&01
BB10 0C E4 C2    .äÂ  TSB &C2E4
BB13 A9 14       ©.   LDA #&14
BB15 0D 5C 0D    .\.  ORA &0D5C
BB18 8D 28 FE    .(þ  STA &FE28		FDC Status/Command
BB1B 20 E5 BC     å¼  JSR &BCE5
BB1E A5 A1       ¥¡   LDA &A1
BB20 6A          j    ROR A
BB21 90 03       ..   BCC &BB26
BB23 4C B7 BF    L·¿  JMP &BFB7

BB26 A5 A5       ¥¥   LDA &A5
BB28 85 A3       .£   STA &A3
BB2A 24 A1       $¡   BIT &A1
BB2C 70 0A       p.   BVS &BB38
BB2E A0 05        .   LDY #&05
BB30 B1 B0       ±°   LDA (&B0),Y
BB32 C9 0B       É.   CMP #&0B
BB34 D0 02       Ð.   BNE &BB38
BB36 F0 EB       ðë   BEQ &BB23
BB38 4C 46 BD    LF½  JMP &BD46

BB3B B5 A3       µ£   LDA &A3,X
BB3D 9D 29 FE    .)þ  STA &FE29,X	Store in FDC Track/Sector
BB40 DD 29 FE    Ý)þ  CMP &FE29,X	Keep storing until it stays there
BB43 D0 F8       Ðø   BNE &BB3D
BB45 60          `    RTS


Access Floppy Disk Controller
-----------------------------
BB46 BA          º    TSX
BB47 8E E7 C2    .çÂ  STX &C2E7		Save stack pointer
BB4A A9 10       ©.   LDA #&10
BB4C 8D E0 C2    .àÂ  STA &C2E0
BB4F 20 72 BB     r»  JSR &BB72
BB52 20 BA BD     º½  JSR &BDBA
BB55 F0 CC       ðÌ   BEQ &BB23
BB57 8D E2 C2    .âÂ  STA &C2E2
BB5A BA          º    TSX
BB5B 8E E7 C2    .çÂ  STX &C2E7
BB5E A9 C2       ©Â   LDA #&C2
BB60 85 B1       .±   STA &B1
BB62 A9 15       ©.   LDA #&15
BB64 85 B0       .°   STA &B0
BB66 9C E0 C2    .àÂ  STZ &C2E0
BB69 20 72 BB     r»  JSR &BB72
BB6C 20 6E BD     n½  JSR &BD6E
BB6F 4C B7 BF    L·¿  JMP &BFB7

BB72 9C E3 C2    .ãÂ  STZ &C2E3
BB75 A0 01        .   LDY #&01		Point to address
BB77 B1 B0       ±°   LDA (&B0),Y
BB79 85 B2       .²   STA &B2
BB7B C8          È    INY
BB7C B1 B0       ±°   LDA (&B0),Y
BB7E 85 B3       .³   STA &B3		&B2/3=>Address low word
BB80 C8          È    INY
BB81 B1 B0       ±°   LDA (&B0),Y	Address byte 3
BB83 AA          ª    TAX
BB84 C8          È    INY
BB85 B1 B0       ±°   LDA (&B0),Y	Address byte 4
BB87 E8          è    INX
BB88 F0 03       ð.   BEQ &BB8D
BB8A E8          è    INX
BB8B D0 04       Ð.   BNE &BB91
BB8D C9 FF       É.   CMP #&FF
BB8F F0 07       ð.   BEQ &BB98
BB91 24 CD       $Í   BIT &CD
BB93 10 03       ..   BPL &BB98
BB95 20 20 80      .  JSR &8020
BB98 A0 05        .   LDY #&05
BB9A B1 B0       ±°   LDA (&B0),Y	Get command
BB9C C9 08       É.   CMP #&08
BB9E F0 10       ð.   BEQ &BBB0		Jump with Read
BBA0 C9 0A       É.   CMP #&0A
BBA2 F0 11       ð.   BEQ &BBB5		Jump with Write
BBA4 C9 0B       É.   CMP #&0B
BBA6 F0 08       ð.   BEQ &BBB0		Jump with Seek
BBA8 A9 67       ©g   LDA #&67		Floppy error &27 'Unsupported command'
BBAA 8D E3 C2    .ãÂ  STA &C2E3
BBAD 4C B7 BF    L·¿  JMP &BFB7		Jump to return with result=&67

Read from floppy
----------------
BBB0 A9 80       ©.   LDA #&80
BBB2 0C E0 C2    .àÂ  TSB &C2E0

Write to floppy
---------------
BBB5 20 DE BB     Þ»  JSR &BBDE
BBB8 20 BE BB     ¾»  JSR &BBBE
BBBB 4C 0A BF    L.¿  JMP &BF0A

BBBE 20 01 BC     .¼  JSR &BC01
BBC1 AD E8 C2    ­èÂ  LDA &C2E8
BBC4 8D 5C 0D    .\.  STA &0D5C
BBC7 64 A0       d    STZ &A0		Clear error
BBC9 64 A2       d¢   STZ &A2
BBCB AD E0 C2    ­àÂ  LDA &C2E0		b7=0=floppy write, 1=floppy read
BBCE 09 20       .    ORA #&20
BBD0 8D E0 C2    .àÂ  STA &C2E0
BBD3 85 A1       .¡   STA &A1
BBD5 A5 CD       ¥Í   LDA &CD
BBD7 8D 5D 0D    .].  STA &0D5D
BBDA 20 18 BC     .¼  JSR &BC18
BBDD 60          `    RTS

BBDE 9C 56 0D    .V.  STZ &0D56
BBE1 9C E8 C2    .èÂ  STZ &C2E8
BBE4 A2 0B       ¢.   LDX #&0B
BBE6 A9 A1       ©¡   LDA #&A1
BBE8 20 F4 FF     ô.  JSR &FFF4
BBEB 98          .    TYA
BBEC 48          H    PHA
BBED 29 02       ).   AND #&02
BBEF F0 05       ð.   BEQ &BBF6
BBF1 A9 03       ©.   LDA #&03
BBF3 8D E8 C2    .èÂ  STA &C2E8
BBF6 68          h    PLA
BBF7 29 01       ).   AND #&01
BBF9 F0 05       ð.   BEQ &BC00
BBFB A9 02       ©.   LDA #&02
BBFD 8D 56 0D    .V.  STA &0D56
BC00 60          `    RTS

Claim NMI space
---------------
BC01 A9 8F       ©.   LDA #&8F
BC03 A2 0C       ¢.   LDX #&0C
BC05 A0 FF        .   LDY #&FF
BC07 20 F4 FF     ô.  JSR &FFF4		Claim NMI space
BC0A 8C E1 C2    .áÂ  STY &C2E1		Store previous owner's ID
BC0D 60          `    RTS

Release NMI space
-----------------
BC0E AC E1 C2    ¬áÂ  LDY &C2E1		Get previous owner's ID
BC11 A9 8F       ©.   LDA #&8F
BC13 A2 0B       ¢.   LDX #&0B
BC15 4C F4 FF    Lô.  JMP &FFF4		Release NMI

Copy NMI code to NMI space
--------------------------
BC18 A0 44        D   LDY #&44
BC1A B9 A0 BC    ¹ ¼  LDA &BCA0,Y
BC1D 99 00 0D    ...  STA &0D00,Y
BC20 88          .    DEY
BC21 10 F7       .÷   BPL &BC1A
BC23 A0 01        .   LDY #&01
BC25 B1 B0       ±°   LDA (&B0),Y
BC27 8D 0E 0D    ...  STA &0D0E
BC2A C8          È    INY
BC2B B1 B0       ±°   LDA (&B0),Y
BC2D 8D 0F 0D    ...  STA &0D0F
BC30 24 A1       $¡   BIT &A1
BC32 30 05       0.   BMI &BC39
BC34 A9 5F       ©_   LDA #&5F
BC36 8D 05 0D    ...  STA &0D05
BC39 24 CD       $Í   BIT &CD
BC3B 50 0B       P.   BVC &BC48
BC3D A5 A1       ¥¡   LDA &A1
BC3F 29 FD       )ý   AND #&FD
BC41 85 A1       .¡   STA &A1
BC43 20 54 BC     T¼  JSR &BC54
BC46 30 03       0.   BMI &BC4B
BC48 20 83 BC     .¼  JSR &BC83
BC4B 8D 5F 0D    ._.  STA &0D5F
BC4E A5 F4       ¥ô   LDA &F4
BC50 8D 32 0D    .2.  STA &0D32
BC53 60          `    RTS

BC54 A5 A1       ¥¡   LDA &A1
BC56 2A          *    ROL A
BC57 A9 00       ©.   LDA #&00
BC59 2A          *    ROL A
BC5A A0 C2        Â   LDY #&C2
BC5C A2 27       ¢'   LDX #&27
BC5E 20 06 04     ..  JSR &0406
BC61 A5 A1       ¥¡   LDA &A1
BC63 29 10       ).   AND #&10
BC65 F0 0F       ð.   BEQ &BC76
BC67 24 A1       $¡   BIT &A1
BC69 30 0C       0.   BMI &BC77
BC6B A0 07        .   LDY #&07
BC6D B9 0E BD    ¹.½  LDA &BD0E,Y
BC70 99 0A 0D    ...  STA &0D0A,Y
BC73 88          .    DEY
BC74 10 F7       .÷   BPL &BC6D
BC76 60          `    RTS

BC77 A0 07        .   LDY #&07
BC79 B9 16 BD    ¹.½  LDA &BD16,Y
BC7C 99 0A 0D    ...  STA &0D0A,Y
BC7F 88          .    DEY
BC80 10 F7       .÷   BPL &BC79
BC82 60          `    RTS

BC83 24 A1       $¡   BIT &A1
BC85 30 18       0.   BMI &BC9F
BC87 A0 0D        .   LDY #&0D
BC89 B9 00 BD    ¹.½  LDA &BD00,Y
BC8C 99 0A 0D    ...  STA &0D0A,Y
BC8F 88          .    DEY
BC90 10 F7       .÷   BPL &BC89
BC92 A0 01        .   LDY #&01
BC94 B1 B0       ±°   LDA (&B0),Y
BC96 8D 0B 0D    ...  STA &0D0B
BC99 C8          È    INY
BC9A B1 B0       ±°   LDA (&B0),Y
BC9C 8D 0C 0D    ...  STA &0D0C
BC9F 60          `    RTS

NMI code, copied to &0D00
-------------------------
BCA0 48          H    PHA
BCA1 AD 28 FE    ­(þ  LDA &FE28		FDC Status/Command
BCA4 29 1F       ).   AND #&1F
BCA6 C9 03       É.   CMP #&03
BCA8 D0 10       Ð.   BNE &BCBA
BCAA AD 2B FE    ­+þ  LDA &FE2B		FDC Data
BCAD 8D FF FF    ...  STA &FFFF		Replaced with destination address
BCB0 EE 0E 0D    î..  INC &0D0E
BCB3 D0 03       Ð.   BNE &BCB8
BCB5 EE 0F 0D    î..  INC &0D0F
BCB8 68          h    PLA
BCB9 40          @    RTI

BCBA 29 58       )X   AND #&58		Check b3, b4, b6 (CRC, Not Found, Write Prot)
BCBC F0 0C       ð.   BEQ &BCCA		No error
BCBE 85 A0       .    STA &A0		Store as floppy error
BCC0 A9 01       ©.   LDA #&01
BCC2 04 A1       .¡   TSB &A1
BCC4 A9 01       ©.   LDA #&01
BCC6 04 A2       .¢   TSB &A2
BCC8 68          h    PLA
BCC9 40          @    RTI

BCCA 24 A2       $¢   BIT &A2
BCCC 50 F6       Pö   BVC &BCC4
BCCE A5 F4       ¥ô   LDA &F4
BCD0 48          H    PHA
BCD1 A9 00       ©.   LDA #&00
BCD3 85 F4       .ô   STA &F4
BCD5 8D 30 FE    .0þ  STA &FE30
BCD8 DA          Ú    PHX
BCD9 20 77 BE     w¾  JSR &BE77
BCDC FA          ú    PLX
BCDD 68          h    PLA
BCDE 85 F4       .ô   STA &F4
BCE0 8D 30 FE    .0þ  STA &FE30
BCE3 68          h    PLA
BCE4 40          @    RTI

BCE5 A5 A2       ¥¢   LDA &A2
BCE7 6A          j    ROR A
BCE8 90 01       ..   BCC &BCEB
BCEA 60          `    RTS

BCEB AD 5D 0D    ­].  LDA &0D5D
BCEE 29 10       ).   AND #&10
BCF0 F0 F3       ðó   BEQ &BCE5
BCF2 24 FF       $.   BIT &FF
BCF4 10 EF       .ï   BPL &BCE5
BCF6 9C 24 FE    .$þ  STZ &FE24		Drive control
BCF9 A9 6F       ©o   LDA #&6F		Floppy error &2F (Abort)
BCFB 85 A0       .    STA &A0
BCFD 4C B7 BF    L·¿  JMP &BFB7

BD00 AD FF FF    ­..  LDA &FFFF
BD03 8D 2B FE    .+þ  STA &FE2B		FDC Data register
BD06 EE 0B 0D    î..  INC &0D0B
BD09 D0 03       Ð.   BNE &BD0E
BD0B EE 0C 0D    î..  INC &0D0C
BD0E AD E5 FE    ­åþ  LDA &FEE5
BD11 8D 2B FE    .+þ  STA &FE2B		FDC Data register
BD14 B0 06       °.   BCS &BD1C
BD16 AD 2B FE    ­+þ  LDA &FE2B		FDC Data register
BD19 8D E5 FE    .åþ  STA &FEE5
BD1C B0 06       °.   BCS &BD24
BD1E 24 A1       $¡   BIT &A1
BD20 30 0D       0.   BMI &BD2F
BD22 A5 A3       ¥£   LDA &A3
BD24 C9 14       É.   CMP #&14
BD26 A9 A0       ©    LDA #&A0
BD28 90 07       ..   BCC &BD31
BD2A 0D 56 0D    .V.  ORA &0D56
BD2D D0 02       Ð.   BNE &BD31
BD2F A9 80       ©.   LDA #&80
BD31 20 62 BD     b½  JSR &BD62
BD34 8D 28 FE    .(þ  STA &FE28		FDC Status/Command
BD37 4C E5 BC    Lå¼  JMP &BCE5

BD3A A9 10       ©.   LDA #&10
BD3C 1C 5E 0D    .^.  TRB &0D5E		Set side 0
BD3F 60          `    RTS

BD40 A9 10       ©.   LDA #&10
BD42 0C 5E 0D    .^.  TSB &0D5E		Set side 1
BD45 60          `    RTS

BD46 A9 01       ©.   LDA #&01
BD48 14 A2       .¢   TRB &A2
BD4A 60          `    RTS

BD4B A9 08       ©.   LDA #&08
BD4D 14 A2       .¢   TRB &A2
BD4F 60          `    RTS

BD50 A9 02       ©.   LDA #&02
BD52 14 A2       .¢   TRB &A2
BD54 60          `    RTS

BD55 A9 00       ©.   LDA #&00
BD57 85 A3       .£   STA &A3
BD59 0D 5C 0D    .\.  ORA &0D5C
BD5C 8D 28 FE    .(þ  STA &FE28		FDC Status/Command
BD5F 4C E5 BC    Lå¼  JMP &BCE5

BD62 6E E4 C2    näÂ  ROR &C2E4
BD65 90 03       ..   BCC &BD6A
BD67 09 04       ..   ORA #&04
BD69 18          .    CLC
BD6A 2E E4 C2    .äÂ  ROL &C2E4
BD6D 60          `    RTS

BD6E AD E2 C2    ­âÂ  LDA &C2E2
BD71 8D 0F 0D    ...  STA &0D0F
BD74 9C 0E 0D    ...  STZ &0D0E
BD77 20 FA BA     úº  JSR &BAFA
BD7A 20 1E BD     .½  JSR &BD1E
BD7D A5 A3       ¥£   LDA &A3
BD7F 48          H    PHA
BD80 AD 16 C2    ­.Â  LDA &C216
BD83 85 A5       .¥   STA &A5
BD85 AD 17 C2    ­.Â  LDA &C217
BD88 85 A6       .¦   STA &A6
BD8A A9 00       ©.   LDA #&00
BD8C 85 A3       .£   STA &A3
BD8E AD E2 C2    ­âÂ  LDA &C2E2
BD91 85 A4       .¤   STA &A4
BD93 24 CD       $Í   BIT &CD
BD95 50 14       P.   BVC &BDAB
BD97 A0 00        .   LDY #&00
BD99 B1 A3       ±£   LDA (&A3),Y
BD9B A2 07       ¢.   LDX #&07
BD9D CA          Ê    DEX
BD9E D0 FD       Ðý   BNE &BD9D
BDA0 8D E5 FE    .åþ  STA &FEE5
BDA3 C8          È    INY
BDA4 CC 1E C2    Ì.Â  CPY &C21E
BDA7 D0 F0       Ðð   BNE &BD99
BDA9 F0 0B       ð.   BEQ &BDB6
BDAB AC 1E C2    ¬.Â  LDY &C21E
BDAE 88          .    DEY
BDAF B1 A3       ±£   LDA (&A3),Y
BDB1 91 A5       .¥   STA (&A5),Y
BDB3 98          .    TYA
BDB4 D0 F8       Ðø   BNE &BDAE
BDB6 68          h    PLA
BDB7 85 A3       .£   STA &A3
BDB9 60          `    RTS

BDBA 20 FA BA     úº  JSR &BAFA
BDBD A9 40       ©@   LDA #&40
BDBF 04 A2       .¢   TSB &A2
BDC1 A0 07        .   LDY #&07
BDC3 B1 B0       ±°   LDA (&B0),Y
BDC5 8D 58 0D    .X.  STA &0D58
BDC8 C8          È    INY
BDC9 B1 B0       ±°   LDA (&B0),Y
BDCB C8          È    INY
BDCC 18          .    CLC
BDCD 71 B0       q°   ADC (&B0),Y
BDCF 8D 59 0D    .Y.  STA &0D59
BDD2 90 03       ..   BCC &BDD7
BDD4 EE 58 0D    îX.  INC &0D58
BDD7 AD 58 0D    ­X.  LDA &0D58
BDDA AA          ª    TAX
BDDB AD 59 0D    ­Y.  LDA &0D59
BDDE A0 FF        .   LDY #&FF
BDE0 20 AB BF     «¿  JSR &BFAB
BDE3 C9 00       É.   CMP #&00
BDE5 D0 02       Ð.   BNE &BDE9
BDE7 A9 10       ©.   LDA #&10
BDE9 A0 09        .   LDY #&09
BDEB 38          8    SEC
BDEC F1 B0       ñ°   SBC (&B0),Y
BDEE B0 1D       °.   BCS &BE0D
BDF0 A9 10       ©.   LDA #&10
BDF2 38          8    SEC
BDF3 E5 A4       å¤   SBC &A4
BDF5 8D 58 0D    .X.  STA &0D58
BDF8 B1 B0       ±°   LDA (&B0),Y
BDFA 38          8    SEC
BDFB ED 58 0D    íX.  SBC &0D58
BDFE A2 00       ¢.   LDX #&00
BE00 A0 FF        .   LDY #&FF
BE02 20 AB BF     «¿  JSR &BFAB
BE05 8C 57 0D    .W.  STY &0D57
BE08 8D 59 0D    .Y.  STA &0D59
BE0B 10 0F       ..   BPL &BE1C
BE0D A0 09        .   LDY #&09
BE0F B1 B0       ±°   LDA (&B0),Y
BE11 8D 58 0D    .X.  STA &0D58
BE14 A9 FF       ©.   LDA #&FF
BE16 8D 57 0D    .W.  STA &0D57
BE19 9C 59 0D    .Y.  STZ &0D59
BE1C 9C 5A 0D    .Z.  STZ &0D5A
BE1F EE 57 0D    îW.  INC &0D57
BE22 CE 58 0D    ÎX.  DEC &0D58
BE25 A2 01       ¢.   LDX #&01
BE27 20 3B BB     ;»  JSR &BB3B
BE2A 24 A1       $¡   BIT &A1
BE2C 30 07       0.   BMI &BE35
BE2E A9 A0       ©    LDA #&A0
BE30 0D 56 0D    .V.  ORA &0D56
BE33 D0 02       Ð.   BNE &BE37
BE35 A9 80       ©.   LDA #&80
BE37 85 A6       .¦   STA &A6
BE39 20 46 BD     F½  JSR &BD46
BE3C A5 A6       ¥¦   LDA &A6
BE3E 8D 28 FE    .(þ  STA &FE28		FDC Status/Command
BE41 20 E5 BC     å¼  JSR &BCE5
BE44 A5 A2       ¥¢   LDA &A2
BE46 29 02       ).   AND #&02
BE48 F0 12       ð.   BEQ &BE5C
BE4A 20 46 BD     F½  JSR &BD46
BE4D 20 50 BD     P½  JSR &BD50
BE50 A9 54       ©T   LDA #&54
BE52 0D 5C 0D    .\.  ORA &0D5C
BE55 8D 28 FE    .(þ  STA &FE28		FDC Status/Command
BE58 E6 A3       æ£   INC &A3
BE5A D0 E5       Ðå   BNE &BE41
BE5C A5 A2       ¥¢   LDA &A2
BE5E 29 08       ).   AND #&08
BE60 F0 2E       ð.   BEQ &BE90
BE62 20 46 BD     F½  JSR &BD46
BE65 20 4B BD     K½  JSR &BD4B
BE68 E6 A3       æ£   INC &A3
BE6A 20 40 BD     @½  JSR &BD40
BE6D A9 00       ©.   LDA #&00
BE6F 0D 5C 0D    .\.  ORA &0D5C
BE72 8D 28 FE    .(þ  STA &FE28		FDC Status/Command
BE75 10 CA       .Ê   BPL &BE41

NMI Routine - called from &0D00
===============================
BE77 20 46 BD     F½  JSR &BD46
BE7A 20 91 BE     .¾  JSR &BE91
BE7D 8A          .    TXA
BE7E D0 05       Ð.   BNE &BE85
BE80 A9 01       ©.   LDA #&01
BE82 04 A2       .¢   TSB &A2
BE84 60          `    RTS

BE85 20 50 BD     P½  JSR &BD50
BE88 A5 A6       ¥¦   LDA &A6
BE8A 20 62 BD     b½  JSR &BD62
BE8D 8D 28 FE    .(þ  STA &FE28		FDC Status/Command
BE90 60          `    RTS

BE91 AD 58 0D    ­X.  LDA &0D58
BE94 D0 62       Ðb   BNE &BEF8
BE96 AD 57 0D    ­W.  LDA &0D57
BE99 D0 0F       Ð.   BNE &BEAA
BE9B AD 59 0D    ­Y.  LDA &0D59
BE9E D0 04       Ð.   BNE &BEA4
BEA0 A2 00       ¢.   LDX #&00
BEA2 F0 65       ðe   BEQ &BF09
BEA4 CE 59 0D    ÎY.  DEC &0D59
BEA7 4C FB BE    Lû¾  JMP &BEFB

BEAA AD 5A 0D    ­Z.  LDA &0D5A
BEAD D0 43       ÐC   BNE &BEF2
BEAF A9 01       ©.   LDA #&01
BEB1 0C E4 C2    .äÂ  TSB &C2E4
BEB4 AD 29 FE    ­)þ  LDA &FE29		FDC Track register
BEB7 C9 4F       ÉO   CMP #&4F
BEB9 90 1F       ..   BCC &BEDA		Less than 80
BEBB AD 5E 0D    ­^.  LDA &0D5E
BEBE 29 10       ).   AND #&10
BEC0 F0 05       ð.   BEQ &BEC7
BEC2 A2 00       ¢.   LDX #&00
BEC4 4C FD BE    Lý¾  JMP &BEFD

BEC7 A9 FF       ©.   LDA #&FF
BEC9 85 A3       .£   STA &A3
BECB 20 40 BD     @½  JSR &BD40
BECE AD 5E 0D    ­^.  LDA &0D5E
BED1 8D 24 FE    .$þ  STA &FE24		Drive control
BED4 A5 A2       ¥¢   LDA &A2
BED6 09 08       ..   ORA #&08
BED8 D0 04       Ð.   BNE &BEDE
BEDA A5 A2       ¥¢   LDA &A2
BEDC 09 02       ..   ORA #&02
BEDE 85 A2       .¢   STA &A2
BEE0 CE 57 0D    ÎW.  DEC &0D57
BEE3 F0 05       ð.   BEQ &BEEA
BEE5 A9 10       ©.   LDA #&10
BEE7 8D 5A 0D    .Z.  STA &0D5A
BEEA A9 FE       ©þ   LDA #&FE
BEEC 85 A4       .¤   STA &A4
BEEE A2 00       ¢.   LDX #&00
BEF0 F0 0B       ð.   BEQ &BEFD
BEF2 CE 5A 0D    ÎZ.  DEC &0D5A
BEF5 4C FB BE    Lû¾  JMP &BEFB

BEF8 CE 58 0D    ÎX.  DEC &0D58
BEFB A2 FF       ¢.   LDX #&FF
BEFD E6 A4       æ¤   INC &A4
BEFF A5 A4       ¥¤   LDA &A4
BF01 8D 2A FE    .*þ  STA &FE2A		FDC Sector register
BF04 CD 2A FE    Í*þ  CMP &FE2A		Keep storing until it stays there
BF07 D0 F6       Ðö   BNE &BEFF
BF09 60          `    RTS

  &A0  Returned error, &40+FDC status or &40+scsi error
  &A1  b7=write/read, b5=??, b0=error occured?
  &A2  b0=?
  &A3
  &A4 sector
  &A5 track
  &A6 drive
  &A7

BF0A A0 06        .   LDY #&06
BF0C B1 B0       ±°   LDA (&B0),Y	Get drive
BF0E 0D 17 C3    ..Ã  ORA &C317		OR with current drive
BF11 85 A6       .¦   STA &A6		Store drive in &A6
BF13 29 1F       ).   AND #&1F		Lose drive bits
BF15 F0 03       ð.   BEQ &BF1A
BF17 4C 6F BF    Lo¿  JMP &BF6F		If sector>&FFFF, jump to 'Sector out of range'

BF1A 24 A6       $¦   BIT &A6		Check drive
BF1C 50 06       P.   BVC &BF24		Drive 0,1,4,5 -> jump ahead
					Can patch here to support drive 2,3,6,7
BF1E A9 65       ©e   LDA #&65		Otherwise, floppy error &25 (Bad drive)
BF20 85 A0       .    STA &A0		Set error
BF22 D0 4F       ÐO   BNE &BF73		Jump to return error

Drive 0,1,4,5
-------------
BF24 A5 A6       ¥¦   LDA &A6		Get drive
BF26 29 20       )    AND #&20
BF28 D0 04       Ð.   BNE &BF2E		Drive 1,5 -> jump ahead
BF2A A9 05       ©.   LDA #&05		Drive 0,4 -> &05=RES+DS0
BF2C D0 02       Ð.   BNE &BF30
BF2E A9 06       ©.   LDA #&06		Drive 1,5 -> &06=RES+DS1
BF30 8D 5E 0D    .^.  STA &0D5E		Store drive control byte
BF33 A9 01       ©.   LDA #&01
BF35 0C E4 C2    .äÂ  TSB &C2E4
BF38 20 5E BF     ^¿  JSR &BF5E		Calculate sector/track
BF3B AD 5E 0D    ­^.  LDA &0D5E		Get drive control byte
BF3E 8D 24 FE    .$þ  STA &FE24		Set drive control register
BF41 6A          j    ROR A		Rotate drive 1 bit into carry
BF42 90 0C       ..   BCC &BF50		Jump if drive 0
BF44 AD E5 C2    ­åÂ  LDA &C2E5
BF47 85 A3       .£   STA &A3
BF49 2C E4 C2    ,äÂ  BIT &C2E4
BF4C 10 0F       ..   BPL &BF5D
BF4E 30 0A       0.   BMI &BF5A

BF50 AD E6 C2    ­æÂ  LDA &C2E6
BF53 85 A3       .£   STA &A3
BF55 2C E4 C2    ,äÂ  BIT &C2E4
BF58 50 03       P.   BVC &BF5D
BF5A 20 55 BD     U½  JSR &BD55
BF5D 60          `    RTS

BF5E A0 07        .   LDY #&07
BF60 B1 B0       ±°   LDA (&B0),Y	Get sector b8-b15
BF62 C9 0A       É.   CMP #&0A		Check for sector &0A00
BF64 90 29       .)   BCC &BF8F		<&A00 - sector within range
					Bug, the rest of these checks shouldn't happen
					Should just drop straight into 'Sector out of range'
BF66 D0 07       Ð.   BNE &BF6F		>&AFF - sector out of range
BF68 C8          È    INY		Check sector &0Axx for some reason
BF69 B1 B0       ±°   LDA (&B0),Y	Get sector b0-b7
BF6B C9 00       É.   CMP #&00		Sector &A00?
BF6D 90 06       ..   BCC &BF75		Will never follow this jump - should this be BEQ ?
BF6F A9 61       ©a   LDA #&61		Floppy error &21 (Bad address)
BF71 85 A0       .    STA &A0

Jump to return floppy error
---------------------------
BF73 D0 42       ÐB   BNE &BFB7		Jump to return error in &A0

This code never entered, as the above BCC &BF75 never followed
BF75 A5 A1       ¥¡   LDA &A1		Get flag
BF77 29 10       ).   AND #&10
BF79 F0 14       ð.   BEQ &BF8F		If b3=0, do it anyway
BF7B A0 09        .   LDY #&09
BF7D B1 B0       ±°   LDA (&B0),Y	Get count
BF7F 88          .    DEY		Point to sector b0-b7
BF80 18          .    CLC
BF81 71 B0       q°   ADC (&B0),Y	A=sector.b0-7 + count
BF83 B0 04       °.   BCS &BF89		>255, jump to volume error
BF85 C9 01       É.   CMP #&01
BF87 90 06       ..   BCC &BF8F		sector+count<1 - do it
BF89 A9 63       ©c   LDA #&63		Floppy error &23 (Volume error)
BF8B 85 A0       .    STA &A0
BF8D D0 28       Ð(   BNE &BFB7		Jump to return error

BF8F A0 07        .   LDY #&07
BF91 B1 B0       ±°   LDA (&B0),Y	Get sector b8-b15
BF93 AA          ª    TAX		Pass to X
BF94 C8          È    INY
BF95 B1 B0       ±°   LDA (&B0),Y	Get sector b0-b7
BF97 A0 FF        .   LDY #&FF
BF99 20 AB BF     «¿  JSR &BFAB		Divide by 16
BF9C 85 A4       .¤   STA &A4		A=sector
BF9E 84 A5       .¥   STY &A5		Y=track 0-159
BFA0 98          .    TYA
BFA1 38          8    SEC
BFA2 E9 50       éP   SBC #&50		Track <80?
BFA4 30 10       0.   BMI &BFB6		Side 0, leave track as 0-79
BFA6 85 A5       .¥   STA &A5		Store track 0-79
BFA8 4C 40 BD    L@½  JMP &BD40		Set side 1

Divide by 16
============
On entry: A=low byte
          X=high byte
          Y=&FF
On exit:  Y=&XA DIV 16
          A=&XA MOD 16
BFAB 38          8    SEC
BFAC E9 10       é.   SBC #&10
BFAE C8          È    INY
BFAF B0 FA       °ú   BCS &BFAB
BFB1 CA          Ê    DEX
BFB2 10 F7       .÷   BPL &BFAB
BFB4 69 10       i.   ADC #&10
BFB6 60          `    RTS

Drive 2,3,6,7
-------------
BFB7 AE E7 C2    ®çÂ  LDX &C2E7
BFBA 9A          .    TXS		Reset stack
BFBB AD E0 C2    ­àÂ  LDA &C2E0
BFBE 29 20       )    AND #&20
BFC0 F0 27       ð'   BEQ &BFE9		b6=0, jump to release and return
BFC2 AD 5E 0D    ­^.  LDA &0D5E		Get drive control byte
BFC5 6A          j    ROR A		Cy=0 drv1/5, Cy=1 drv0/4
BFC6 A5 A3       ¥£   LDA &A3
BFC8 90 0C       ..   BCC &BFD6		Jump if drive 1/5
BFCA 8D E5 C2    .åÂ  STA &C2E5		Store
BFCD 2E E4 C2    .äÂ  ROL &C2E4
BFD0 18          .    CLC
BFD1 6E E4 C2    näÂ  ROR &C2E4		Clear b7
BFD4 B0 0B       °.   BCS &BFE1

BFD6 8D E6 C2    .æÂ  STA &C2E6
BFD9 AD E4 C2    ­äÂ  LDA &C2E4
BFDC 29 BF       )¿   AND #&BF
BFDE 8D E4 C2    .äÂ  STA &C2E4		Clear b6

BFE1 A5 A0       ¥    LDA &A0		Get error
BFE3 8D E3 C2    .ãÂ  STA &C2E3		Store in error block
BFE6 20 0E BC     .¼  JSR &BC0E		Release NMI
BFE9 20 3A 80     :.  JSR &803A		Release Tube, restore screen
BFEC A6 B0       ¦°   LDX &B0
BFEE AD E3 C2    ­ãÂ  LDA &C2E3		Get error
BFF1 F0 07       ð.   BEQ &BFFA		If zero, jump to return Ok
BFF3 09 40       .@   ORA #&40		Set bit 6 to flag FDC error
BFF5 A0 FF        .   LDY #&FF
BFF7 8C E4 C2    .äÂ  STY &C2E4
BFFA A4 B1       ¤±   LDY &B1
BFFC 29 7F       ).   AND #&7F		Remove bit 7 and set EQ
BFFE 60          `    RTS		Return with A=error, EQ=Ok

BFFF A9          ©    DEFB &A9

Courier 8 point, landscape, 2 columns, gap 20mm, margins 10mm, tabs 18mm
